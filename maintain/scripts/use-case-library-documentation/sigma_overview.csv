"Title","Author","Description","Tags","Category","Product","Service","How To Investigate","Known False Positives","Query"
"Auditing Configuration Changes on Linux Host","Mikhail Larin, oscd.community","Detect changes in auditd configuration files","attack.defense_evasion, attack.t1562.006","Not classified","linux","auditd","Review the logs from the auditd service on the Linux host. 
Look for any changes in the specified configuration files (/etc/audit/*, /etc/libaudit.conf, /etc/audisp/*). 
Check if the changes were made by legitimate administrative activity. 
Compare the changes with a known baseline or approved changes. 
If the changes are not expected or authorized, investigate further to determine if they are malicious or unauthorized.","Legitimate administrative activity","type=""PATH"" name IN (""/etc/audit/*"", ""/etc/libaudit.conf"", ""/etc/audisp/*"")"
"Binary Padding - Linux","Igor Fits, oscd.community","Adversaries may use binary padding to add junk data and change the on-disk representation of malware.
This rule detect using dd and truncate to add a junk data to file.
","attack.defense_evasion, attack.t1027.001","Not classified","linux","auditd","Review the command-line arguments and parameters of the executed processes to determine if the use of dd or truncate is legitimate or suspicious. 
Check for any unusual or unexpected file modifications or changes made by the dd or truncate commands. 
Correlate the activity with other security events or indicators of compromise (IOCs) to identify any malicious behavior. 
Consult with system administrators or other relevant personnel to verify the purpose and intent of the executed commands. 
Monitor for any subsequent suspicious or malicious activities that may be related to the use of dd or truncate.","Legitimate use of dd or truncate commands for non-malicious purposes, such as file manipulation or disk space management.","type=""EXECVE"" (""truncate"" ""-s"") OR (""dd"" ""if="" NOT ""of="")"
"BPFDoor Abnormal Process ID or Lock File Accessed","Rafal Piasecki","detects BPFDoor .lock and .pid files access in temporary file storage facility","attack.execution, attack.t1106, attack.t1059","Not classified","linux","auditd","Review the logs from the auditd service on the Linux system 
Look for events related to file access on the specified paths 
Check if the access to the .lock and .pid files is performed by expected processes 
Compare the timestamps of the access events with the normal behavior of the system 
Correlate the events with other suspicious activities or indicators of compromise","Processes legitimately accessing the specified files for normal operations","type=""PATH"" name IN (""/var/run/haldrund.pid"", ""/var/run/xinetd.lock"", ""/var/run/kdevrund.pid"")"
"Possible Coin Miner CPU Priority Param","Florian Roth (Nextron Systems)","Detects command line parameter very often used with coin miners","attack.privilege_escalation, attack.t1068","Not classified","linux","auditd","Check the command line parameters of processes for the presence of --cpu-priority flag. 
Review the process execution logs or audit logs from the log source (e.g., auditd) for any suspicious processes with the --cpu-priority flag. 
Cross-reference the identified processes with known legitimate applications or tools that use the --cpu-priority flag as a false positive mitigation. 
Investigate any processes with the --cpu-priority flag that are not expected or authorized in the environment. 
Monitor the resource usage of the processes with the --cpu-priority flag to identify any abnormal or excessive CPU consumption. 
Consider analyzing network traffic from the suspicious processes to identify any communication with known coin mining infrastructure or suspicious domains.","Other tools that use a --cpu-priority flag","a1=""--cpu-priority*"" OR a2=""--cpu-priority*"" OR a3=""--cpu-priority*"" OR a4=""--cpu-priority*"" OR a5=""--cpu-priority*"" OR a6=""--cpu-priority*"" OR a7=""--cpu-priority*"""
"Disable System Firewall","Pawel Mazur","Detects disabling of system firewalls which could be used by adversaries to bypass controls that limit usage of the network.","attack.t1562.004, attack.defense_evasion","Not classified","linux","auditd","Check the logs from the auditd service on the Linux system. 
Look for events indicating the stopping of the firewalld, iptables, or ufw services. 
Review any associated command-line activity or process information in the logs. 
Correlate with other security events or alerts to identify any suspicious or malicious activity.","Admin activity","type=""SERVICE_STOP"" unit IN (""firewalld"", ""iptables"", ""ufw"")"
"Credentials In Files - Linux","Igor Fits, oscd.community","Detecting attempts to extract passwords with grep","attack.credential_access, attack.t1552.001","Not classified","linux","auditd","Review the command line arguments of the executed process to determine if the grep command was used with malicious intent. 
Check the files that were searched by the grep command to see if any sensitive information, such as passwords, were accessed. 
Correlate the event with other security events or indicators of compromise to identify any malicious activity. 
Review the user account associated with the executed process to determine if it is a privileged account or if it has a history of suspicious activity.","Legitimate use of grep command to search for specific strings in files","type=""EXECVE"" ""grep"" ""password"""
"Linux Keylogging with Pam.d","Pawel Mazur","Detect attempt to enable auditing of TTY input","attack.credential_access, attack.t1003, attack.t1056.001","Not classified","linux","auditd","Check the audit logs for events related to the modification of the /etc/pam.d/system-auth and /etc/pam.d/password-auth files. 
Look for TTY and USER_TTY events in the audit logs. 
Verify if any legitimate administrative work or configuration changes were performed during the time of the detection. 
Cross-reference the detected events with other security controls or logs to validate the presence of keylogging activity. 
If possible, analyze the contents of the modified PAM configuration files to identify any suspicious or unauthorized changes.","Administrative work","(type=""PATH"" name IN (""/etc/pam.d/system-auth"", ""/etc/pam.d/password-auth"")) OR type IN (""TTY"", ""USER_TTY"")"
"Modification of ld.so.preload","E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community","Identifies modification of ld.so.preload for shared object injection. This technique is used by attackers to load arbitrary code into processes.","attack.defense_evasion, attack.t1574.006","Not classified","linux","auditd","Review the contents of the ld.so.preload file to determine if any unauthorized modifications have been made. 
Check for any suspicious or unexpected entries in the ld.so.preload file. 
Monitor for any processes loading shared objects that are not typically associated with the ld.so.preload file. 
Correlate the detection with other security events or indicators of compromise to identify any potential malicious activity. 
Consult system administrators or authorized users to confirm if any legitimate changes were made to the ld.so.preload file.","Legitimate changes to the ld.so.preload file made by system administrators or authorized users.","type=""PATH"" name=""/etc/ld.so.preload"""
"Loading of Kernel Module via Insmod","Pawel Mazur","Detects loading of kernel modules with insmod command.
Loadable Kernel Modules (LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand.
Adversaries may use LKMs to obtain persistence within the system or elevate the privileges.
","attack.persistence, attack.privilege_escalation, attack.t1547.006","Not classified","linux","auditd","Review audit logs from the Linux audit subsystem (auditd) for SYSCALL events with the insmod command and /usr/bin/kmod as the executing binary (exe). 
Check if the insmod command was executed by a privileged user or a non-privileged user. 
Verify if the loaded kernel module is authorized and expected on the system. 
Cross-reference the event with other security logs to identify any suspicious or malicious activities associated with the kernel module loading.","Legitimate use of insmod for authorized kernel module loading.","type=""SYSCALL"" comm=""insmod"" exe=""/usr/bin/kmod"""
"Logging Configuration Changes on Linux Host","Mikhail Larin, oscd.community","Detect changes of syslog daemons configuration files","attack.defense_evasion, attack.t1562.006","Not classified","linux","auditd","Check for legitimate administrative activity in the logs. Look for authorized users or system administrators making changes to the syslog daemon configuration files. Examples of log sources to investigate include 
Audit logs from the Linux host (e.g., /var/log/audit/audit.log) 
Syslog logs from the Linux host (e.g., /var/log/syslog)","Legitimate administrative activity","type=""PATH"" name IN (""/etc/syslog.conf"", ""/etc/rsyslog.conf"", ""/etc/syslog-ng/syslog-ng.conf"")"
"OMIGOD SCX RunAsProvider ExecuteShellCommand - Auditd","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell.
SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager.
Microsoft Azure, and Microsoft Operations Management Suite.
","attack.privilege_escalation, attack.initial_access, attack.execution, attack.t1068, attack.t1190, attack.t1203","Not classified","linux","auditd","Check the command executed by the SCX RunAsProvider Invoke_ExecuteShellCommand. 
Review the user or process invoking the SCX RunAsProvider Invoke_ExecuteShellCommand. 
Analyze the context in which the command is executed, including the current working directory (cwd) and the shell used (comm). 
Correlate with other security events or logs to identify any suspicious or malicious activities. 
Verify if the use of SCX RunAsProvider Invoke_ExecuteShellCommand is authorized and expected in the environment. 
Consult system administrators or relevant personnel to determine if the detected activity is legitimate or requires further investigation.","Legitimate use of SCX RunAsProvider Invoke_ExecuteShellCommand in a specific context or by authorized users. 
Legitimate use of /bin/sh shell for system administration tasks.","type=""SYSCALL"" syscall=""execve"" uid=0 cwd=""/var/opt/microsoft/scx/tmp"" comm=""sh"""
"Webshell Remote Command Execution","Ilyas Ochkov, Beyu Denis, oscd.community","Detects possible command execution by web application/web shell","attack.persistence, attack.t1505.003","Not classified","linux","auditd","Review web server logs for suspicious activity, such as unexpected command execution or unusual file uploads. 
Analyze the command executed and check if it is legitimate or potentially malicious. 
Inspect the web application for any signs of compromise, such as modified files or unexpected behavior. 
Check for any unauthorized access or privilege escalation attempts in the system logs. 
Monitor network traffic for any suspicious connections or data transfers related to the web application.","Admin activity 
Crazy web applications","type=""SYSCALL"" syscall=""execve"" key=""detect_execve_www"""
"DNS Query to External Service Interaction Domains","Florian Roth (Nextron Systems), Matt Kelly (list of domains)","Detects suspicious DNS queries to external service interaction domains often used for out-of-band interactions after successful RCE","attack.initial_access, attack.t1190, attack.reconnaissance, attack.t1595.002","dns","Not classified","Not classified","Review DNS query logs from DNS servers or DNS logs from network devices, such as firewalls or DNS proxies, for any queries containing the listed domains. 
Cross-reference the DNS queries with other security events or indicators of compromise (IOCs) to identify any correlation or patterns. 
Investigate the source IP address and associated user or system to determine if the DNS queries are part of normal or expected behavior. 
Check if the DNS queries are triggered by any known security tools or services used within the organization. 
If possible, analyze the network traffic associated with the DNS queries to identify any additional suspicious or malicious activity.","Legitimate use of external DNS services for specific purposes, such as threat intelligence feeds or security monitoring tools.","query IN (""*.interact.sh*"", ""*.oast.pro*"", ""*.oast.live*"", ""*.oast.site*"", ""*.oast.online*"", ""*.oast.fun*"", ""*.oast.me*"", ""*.burpcollaborator.net*"", ""*.oastify.com*"", ""*.canarytokens.com*"", ""*.requestbin.net*"", ""*.dnslog.cn*"")"
"Cobalt Strike DNS Beaconing","Florian Roth (Nextron Systems)","Detects suspicious DNS queries known from Cobalt Strike beacons","attack.command_and_control, attack.t1071.004","dns","Not classified","Not classified","Investigate the source and destination IP addresses associated with the suspicious DNS queries. 
Check if the DNS queries are part of a legitimate staging or post-processing activity in your environment. 
Review the context of the DNS queries, such as the timing, frequency, and patterns of the queries. 
Correlate the DNS queries with other security events or indicators of compromise (IOCs) to determine if there is a larger attack campaign. 
Consult threat intelligence sources to identify any known Cobalt Strike beaconing patterns or indicators. 
Consider performing network traffic analysis or packet capture to further analyze the DNS traffic and identify any malicious behavior.","Legitimate use of DNS queries for staging or post-processing purposes in certain environments.","query IN (""aaa.stage.*"", ""post.1*"") OR query=""*.stage.123456.*"""
"Monero Crypto Coin Mining Pool Lookup","Florian Roth (Nextron Systems)","Detects suspicious DNS queries to Monero mining pools","attack.impact, attack.t1496, attack.t1567","dns","Not classified","Not classified","Check the source IP address of the DNS query and compare it against known legitimate mining activities. 
Analyze the destination IP address of the DNS query and check if it belongs to a known Monero mining pool. 
Look for other related indicators of compromise (IOCs) such as suspicious network traffic or communication with known mining pool IPs. 
Review any additional logs related to the DNS query, such as firewall logs or proxy logs, to gather more context. 
Cross-reference the timestamp of the DNS query with other events or logs to identify any suspicious patterns or anomalies.","Legitimate crypto coin mining activities","query IN (""*pool.minexmr.com*"", ""*fr.minexmr.com*"", ""*de.minexmr.com*"", ""*sg.minexmr.com*"", ""*ca.minexmr.com*"", ""*us-west.minexmr.com*"", ""*pool.supportxmr.com*"", ""*mine.c3pool.com*"", ""*xmr-eu1.nanopool.org*"", ""*xmr-eu2.nanopool.org*"", ""*xmr-us-east1.nanopool.org*"", ""*xmr-us-west1.nanopool.org*"", ""*xmr-asia1.nanopool.org*"", ""*xmr-jp1.nanopool.org*"", ""*xmr-au1.nanopool.org*"", ""*xmr.2miners.com*"", ""*xmr.hashcity.org*"", ""*xmr.f2pool.com*"", ""*xmrpool.eu*"", ""*pool.hashvault.pro*"")"
"DNS TXT Answer with Possible Execution Strings","Markus Neis","Detects strings used in command execution in DNS TXT Answer","attack.command_and_control, attack.t1071.004","dns","Not classified","Not classified","Review DNS logs for TXT records containing the specified strings. 
Check for any legitimate use of DNS TXT records for non-malicious purposes, such as domain verification or SPF records. 
Correlate with other security events or indicators of compromise to determine if the detection is part of a larger attack. 
Investigate the source and destination IP addresses associated with the DNS TXT records to identify any suspicious or malicious activity. 
Review any associated network traffic or system logs for additional context or evidence of compromise.","Legitimate use of DNS TXT records for non-malicious purposes, such as TXT records used for domain verification or SPF records.","record_type=""TXT"" answer IN (""*IEX*"", ""*Invoke-Expression*"", ""*cmd.exe*"")"
"Wannacry Killswitch Domain","Mike Wade","Detects wannacry killswitch domain dns queries","attack.command_and_control, attack.t1071.001","dns","Not classified","Not classified","Check DNS logs for queries to the following domains 
ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.testing 
ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.test 
ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.com 
ayylmaotjhsstasdfasdfasdfasdfasdfasdfasdf.com 
iuqssfsodp9ifjaposdfjhgosurijfaewrwergwea.com 
If any of these domains are found in the DNS logs, further investigation is required to determine if the queries are malicious or legitimate.","Legitimate testing of security tools or systems that may involve querying the killswitch domain for research purposes.","query IN (""ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.testing"", ""ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.test"", ""ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.com"", ""ayylmaotjhsstasdfasdfasdfasdfasdfasdfasdf.com"", ""iuqssfsodp9ifjaposdfjhgosurijfaewrwergwea.com"")"
"Equation Group C2 Communication","Florian Roth (Nextron Systems)","Detects communication to C2 servers mentioned in the operational notes of the ShadowBroker leak of EquationGroup C2 tools","attack.command_and_control, attack.g0020, attack.t1041","firewall","Not classified","Not classified","Review the firewall logs for matched events. 
Correlate the events with other security data, such as IDS/IPS alerts and endpoint logs, to determine if this is part of a broader attack. 
If the traffic is deemed legitimate, consider creating exceptions or tuning the rule to reduce false positives.","In some cases, legitimate traffic may match this rule. Verify the context and cross-reference with other security data to reduce false positives.","dst_ip IN (""69.42.98.86"", ""89.185.234.145"") OR src_ip IN (""69.42.98.86"", ""89.185.234.145"")"
"APT40 Dropbox Tool User Agent","Thomas Patzke","Detects suspicious user agent string of APT40 Dropbox tool","attack.command_and_control, attack.t1071.001, attack.exfiltration, attack.t1567.002","proxy","Not classified","Not classified","Check proxy logs for user agents matching the APT40 Dropbox tool user agent string. 
Look for connections to the api.dropbox.com host in the proxy logs. 
Analyze the source IP address and URI of the requests in the proxy logs to identify any suspicious activity.","Old browsers","""c-useragent""=""Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36"" ""cs-host""=""api.dropbox.com"""
"BabyShark Agent Pattern","Florian Roth (Nextron Systems)","Detects Baby Shark C2 Framework communication patterns","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Inspect proxy logs for requests containing momyshark?key= in the URI field.","Unknown","""c-uri""=""*momyshark?key=*"""
"Chafer Malware URL Pattern","Florian Roth (Nextron Systems)","Detects HTTP requests used by Chafer malware","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Inspect proxy logs for HTTP requests containing /asp.asp?ui= in the URI field. 
Look for any suspicious or malicious User-Agent strings in the c-useragent field. 
Cross-reference the ClientIP with known malicious IP addresses or indicators of compromise (IOCs).","Legitimate use of /asp.asp?ui=","""c-uri""=""*/asp.asp?ui=*"""
"CobaltStrike Malleable Amazon Browsing Traffic Profile","Markus Neis","Detects Malleable Amazon Profile","attack.defense_evasion, attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Check the proxy logs for GET requests to www.amazon.com with a user agent string similar to Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv11.0) like Gecko and a URI starting with /s/ref=nb_sb_noss_1/ followed by any characters and ending with /field-keywords=books. 
Check the proxy logs for POST requests to www.amazon.com with a user agent string similar to Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv11.0) like Gecko and a URI starting with /N4215/adj/amzn.us.sr.aps.","Legitimate browsing traffic to Amazon with similar user agents and URIs","(""c-useragent""=""Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko"" ""cs-method""=""GET"" ""c-uri""=""/s/ref=nb_sb_noss_1/167-3294888-0262949/field-keywords=books"" ""cs-host""=""www.amazon.com"" ""cs-cookie""=""*=csm-hit=s-24KU11BB82RZSYGJ3BDK|1419899012996"") OR (""c-useragent""=""Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko"" ""cs-method""=""POST"" ""c-uri""=""/N4215/adj/amzn.us.sr.aps"" ""cs-host""=""www.amazon.com"")"
"CobaltStrike Malformed UAs in Malleable Profiles","Florian Roth (Nextron Systems)","Detects different malformed user agents used in Malleable Profiles used with Cobalt Strike","attack.defense_evasion, attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Inspect proxy logs for user agent strings that match the provided examples in the selection1 and selection2 sections of the rule. 
Check if the user agent strings are associated with any suspicious or unauthorized activities. 
Look for any correlation with other indicators of compromise (IOCs) or known malicious behavior. 
Analyze the network traffic associated with the detected user agent strings to identify any malicious communication or command and control (C2) activity. 
Cross-reference the detected user agent strings with threat intelligence sources to determine if they are associated with known Cobalt Strike activity. 
If possible, investigate the source IP addresses and destinations associated with the user agent strings to identify potential compromised systems or malicious infrastructure.","Legitimate user agents that may have similar patterns to the detected malformed user agents","""c-useragent"" IN (""Mozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.1)"", ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E )"", ""Mozilla/5.0 (Windows; U; MSIE 7.0; Windows NT 5.2) Java/1.5.0_08"") OR ""c-useragent""=""*; MANM; MANM)"""
"CobaltStrike Malleable (OCSP) Profile","Markus Neis","Detects Malleable (OCSP) Profile with Typo (OSCP) in URL","attack.defense_evasion, attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Inspect proxy logs for requests containing /oscp/ in the URI and ocsp.verisign.com in the cs-host field. 
Verify if the requests are related to legitimate use of the OCSP protocol for certificate validation. 
Check if the requests are originating from trusted sources or known systems within the network. 
Cross-reference the requests with other security events or indicators of compromise to identify any malicious activity.","Legitimate use of OCSP protocol for certificate validation","""c-uri""=""*/oscp/*"" ""cs-host""=""ocsp.verisign.com"""
"CobaltStrike Malleable OneDrive Browsing Traffic Profile","Markus Neis","Detects Malleable OneDrive Profile","attack.defense_evasion, attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Inspect the proxy logs for GET requests to onedrive.live.com with a URI ending in ?manifest=wac 
Verify if the request is legitimate by checking the user and device context, and comparing with known good traffic 
Look for any suspicious or anomalous behavior associated with the detected traffic, such as large file transfers or unusual access patterns","Legitimate OneDrive traffic with the same characteristics as the detection rule","""cs-method""=""GET"" ""c-uri""=""*?manifest=wac"" ""cs-host""=""onedrive.live.com"" NOT (""c-uri""=""http*"" ""c-uri""=""*://onedrive.live.com/*"")"
"Windows WebDAV User Agent","Florian Roth (Nextron Systems)","Detects WebDav DownloadCradle","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Check proxy logs for requests with a User-Agent starting with Microsoft-WebDAV-MiniRedir/ and the HTTP method GET. 
Look for any suspicious or unauthorized WebDAV activity originating from the client IP address. 
Verify if the detected User-Agent and HTTP method are commonly used by legitimate WebDAV clients.","Administrative scripts that download files from the Internet 
Administrative scripts that retrieve certain website contents 
Legitimate WebDAV administration","""c-useragent""=""Microsoft-WebDAV-MiniRedir/*"" ""cs-method""=""GET"""
"Empire UserAgent URI Combo","Florian Roth (Nextron Systems)","Detects user agent and URI paths used by empire agents","attack.defense_evasion, attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Check the logs from the proxy server for requests with the specified user agent and URI paths. 
Look for POST requests with the user agent Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv11.0) like Gecko. 
Check if the URI paths /admin/get.php, /news.php, or /login/process.php are accessed. 
Verify if the requests are legitimate or if they indicate potential Empire agent activity. 
Cross-reference the IP address of the requests with known Empire C2 server IP addresses.","Valid requests with this exact user agent to server scripts of the defined names","""c-useragent""=""Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko"" ""cs-uri"" IN (""/admin/get.php"", ""/news.php"", ""/login/process.php"") ""cs-method""=""POST"""
"Potential OWASSRF Exploitation Attempt - Proxy","Nasreddine Bencherchali (Nextron Systems)","Detects exploitation attempt of the OWASSRF variant targeting exchange servers It uses the OWA endpoint to access the powershell backend endpoint","attack.initial_access, attack.t1190","proxy","Not classified","Not classified","Not available","Not available","""cs-method""=""POST"" ""sc-status""=200 ""c-uri""=""*/owa/*"" ""c-uri""=""*/powershell*"" ""c-uri"" IN (""*@*"", ""*%40*"") NOT (""c-useragent"" IN (""ClientInfo"", ""Microsoft WinRM Client"", ""Exchange BackEnd Probes""))"
"OWASSRF Exploitation Attempt Using Public POC - Proxy","Nasreddine Bencherchali (Nextron Systems)","Detects exploitation attempt of the OWASSRF variant targeting exchange servers using publicly available POC. It uses the OWA endpoint to access the powershell backend endpoint","attack.initial_access, attack.t1190","proxy","Not classified","Not classified","Not available","Not available","""c-useragent""=""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.5195.54 Safari/537.36"" ""cs-method""=""POST"" ""sc-status""=200 ""c-uri""=""*/owa/mastermailbox*"" ""c-uri""=""*/powershell*"""
"iOS Implant URL Pattern","Florian Roth (Nextron Systems)","Detects URL pattern used by iOS Implant","attack.execution, attack.t1203, attack.collection, attack.t1005, attack.t1119, attack.credential_access, attack.t1528, attack.t1552.001","proxy","Not classified","Not classified","Review proxy logs for requests containing /list/suc?name= in the URI field 
Analyze the associated ClientIP, c-useragent, and other relevant fields to identify any suspicious activity 
Cross-reference with other logs such as authentication logs or endpoint logs to gather additional context 
If the request is determined to be a false positive, add the source IP or user agent to the known_false_positives list","Legitimate use of /list/suc?name= in web applications","""c-uri""=""*/list/suc?name=*"""
"Java Class Proxy Download","Andreas Hunkeler (@Karneades)","Detects Java class download in proxy logs, e.g. used in Log4shell exploitation attacks against Log4j.","attack.initial_access","proxy","Not classified","Not classified","Review proxy logs for requests with URIs ending in .class 
Look for any suspicious or unexpected Java class downloads 
Check the source and destination IP addresses for any anomalies 
Analyze the user agent string to identify any suspicious or malicious activity 
Cross-reference with other security events or alerts to identify any related indicators of compromise 
If possible, compare the downloaded Java class with known good copies from trusted sources 
Consult with the system or application owners to determine if the download is expected or unauthorized","Legitimate Java class downloads from trusted sources","""c-uri""=""*.class"""
"PwnDrp Access","Florian Roth (Nextron Systems)","Detects downloads from PwnDrp web servers developed for red team testing and most likely also used for criminal activity","attack.command_and_control, attack.t1071.001, attack.t1102.001, attack.t1102.003","proxy","Not classified","Not classified","Investigate the following log sources for evidence of PwnDrp access 
Proxy logs Look for requests containing /pwndrop/ in the URI field. 
Web server logs Check for corresponding requests to the PwnDrp web servers. 
Endpoint logs Look for any suspicious activity related to PwnDrp, such as unusual user agent strings or connections to known PwnDrp IP addresses. 
Network traffic logs Analyze network traffic for connections to PwnDrp servers or any suspicious communication patterns.","Legitimate use of PwnDrp web servers for authorized red team testing or research purposes.","""c-uri""=""*/pwndrop/*"""
"Raw Paste Service Access","Florian Roth (Nextron Systems)","Detects direct access to raw pastes in different paste services often used by malware in their second stages to download malicious code in encrypted or encoded form","attack.command_and_control, attack.t1071.001, attack.t1102.001, attack.t1102.003, attack.defense_evasion","proxy","Not classified","Not classified","Investigate the source IP address to determine if it belongs to a known developer or if it is associated with suspicious activity. 
Analyze the user agent string to identify any suspicious or malicious behavior. 
Review the accessed URI to determine if it matches the patterns associated with raw paste services. 
Cross-reference the detection with other security events or indicators of compromise to identify any related malicious activity.","User activity (e.g. developer that shared and copied code snippets and used the raw link instead of just copy & paste)","""c-uri"" IN (""*.paste.ee/r/*"", ""*.pastebin.com/raw/*"", ""*.hastebin.com/raw/*"", ""*.ghostbin.co/paste/*/raw/*"", ""*pastetext.net/*"", ""*pastebin.pl/*"", ""*paste.ee/*"")"
"Flash Player Update from Suspicious Location","Florian Roth (Nextron Systems)","Detects a flashplayer update from an unofficial location","attack.initial_access, attack.t1189, attack.execution, attack.t1204.002, attack.defense_evasion, attack.t1036.005","proxy","Not classified","Not classified","Check the source IP address of the request and verify if it belongs to an official Adobe server. 
Inspect the user agent string in the logs to determine if it matches the expected format for a legitimate flash player update. 
Review the destination URL in the logs to ensure it is pointing to an official Adobe domain. 
Cross-reference the request with other security logs, such as firewall or DNS logs, to identify any suspicious activity associated with the source IP or domain. 
Compare the timestamp of the request with known legitimate flash player update releases from Adobe to identify any discrepancies.","Legitimate flash player updates from official Adobe sources","""c-uri"" IN (""*/flash_install.php*"", ""*/install_flash_player.exe"") NOT ""cs-host""=""*.adobe.com"""
"Turla ComRAT","Florian Roth (Nextron Systems)","Detects Turla ComRAT patterns","attack.defense_evasion, attack.command_and_control, attack.t1071.001, attack.g0010","proxy","Not classified","Not classified","Review proxy logs for requests containing /index/index.php?h= in the URI field.","Legitimate use of /index/index.php?h= in web applications","""c-uri""=""*/index/index.php?h=*"""
"APT User Agent","Florian Roth (Nextron Systems), Markus Neis","Detects suspicious user agent strings used in APT malware in proxy logs","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Review the proxy logs for matched events. 
Cross-reference the user agent strings with other security data to determine the legitimacy of the traffic. 
Consider creating exceptions or tuning the rule to reduce false positives for known, legitimate user agents.","Legitimate user agents may occasionally trigger this rule, especially with old or custom browsers. Verify the context and cross-reference with other security data to reduce false positives.","""c-useragent"" IN (""SJZJ (compatible; MSIE 6.0; Win32)"", ""Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/20.0"", ""User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC"", ""Mozilla/4.0 (compatible; MSIE 7.4; Win32;32-bit)"", ""webclient"", ""Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/200"", ""Mozilla/4.0 (compatible; MSI 6.0;"", ""Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0"", ""Mozilla/5.0 (Windows NT 6.2; WOW64; rv:20.0) Gecko/20100101 Firefox/"", ""Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/2"", ""Mozilla/4.0"", ""Netscape"", ""Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7"", ""Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.13) Firefox/3.6.13 GTB7.1"", ""Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NETCLR 2.0.50727)"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)"", ""Mozilla/4.0 (compatible; MSIE 11.0; Windows NT 6.1; SV1)"", ""Mozilla/4.0 (compatible; MSIE 8.0; Win32)"", ""Mozilla v5.1 (Windows NT 6.1; rv:6.0.1) Gecko/20100101 Firefox/6.0.1"", ""Mozilla/6.1 (compatible; MSIE 9.0; Windows NT 5.3; Trident/5.0)"", ""Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648; InfoPath.1)"", ""Mozilla/5.0 (Windows NT 6.1; WOW64) WinHttp/1.6.3.8 (WinHTTP/5.1) like Gecko"", ""Mozilla v5.1 *"", ""MSIE 8.0"", ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.2)"", ""Mozilla/4.0 (compatible; RMS)"", ""Mozilla/4.0 (compatible; MSIE 6.0; DynGate)"", ""O/9.27 (W; U; Z)"", ""Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0;  Trident/5.0*"", ""Mozilla/5.0 (Windows NT 9; *"", ""hots scot"", ""Mozilla/5.0 (compatible; MSIE 10.0; Windows NT)"", ""Mozilla/5.0 (Windows NT 6.1; WOW64) Chrome/28.0.1500.95 Safari/537.36"", ""Mozilla/5.0 (Windows NT 6.2; Win32; rv:47.0)"", ""Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1;"", ""Mozilla/5.0 (X11; Linux i686; rv:22.0) Firefox/22.0"", ""Mozilla/5.0 Chrome/72.0.3626.109 Safari/537.36"", ""Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:FTS_06) Gecko/22.36.35.06 Firefox/2.0"", ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36 Edg/100.0.1185.39"", ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; InfoPath.3; .NET4.0C; .NET4.0E)"")"
"Bitsadmin to Uncommon IP Server Address","Florian Roth (Nextron Systems)","Detects Bitsadmin connections to IP addresses instead of FQDN names","attack.command_and_control, attack.t1071.001, attack.defense_evasion, attack.persistence, attack.t1197, attack.s0190","proxy","Not classified","Not classified","Check the destination IP address in the logs to determine if it is a known legitimate server or an uncommon IP address 
Review the user agent string to confirm if it matches the expected format for BITSadmin connections 
Cross-reference the BITSadmin connection with other logs, such as firewall or DNS logs, to gather additional context 
If the IP address is internal, investigate if there is a valid reason for BITSadmin to connect to internal IP addresses","Legitimate BITSadmin connections to IP addresses instead of FQDN names 
BITSadmin connections to internal IP addresses","""c-useragent""=""Microsoft BITS/*"" ""cs-host"" IN (""*1"", ""*2"", ""*3"", ""*4"", ""*5"", ""*6"", ""*7"", ""*8"", ""*9"")"
"Crypto Miner User Agent","Florian Roth (Nextron Systems)","Detects suspicious user agent strings used by crypto miners in proxy logs","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Review proxy logs for instances of user agent strings starting with XMRig  or ccminer. Pay attention to the associated ClientIP, c-uri, and c-useragent fields. Cross-reference with authorized users or known legitimate use cases of XMRig or ccminer to eliminate false positives.","Legitimate use of XMRig or ccminer by authorized users","""c-useragent"" IN (""XMRig *"", ""ccminer*"")"
"Exploit Framework User Agent","Florian Roth (Nextron Systems)","Detects suspicious user agent strings used by exploit / pentest frameworks like Metasploit in proxy logs","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Check the associated proxy logs for the detected user agent string 
Look for any suspicious or unauthorized activities associated with the client IP address 
Example log sources Proxy logs, Web server logs 
Analyze the URI accessed by the client to identify any potentially malicious behavior 
Example log sources Proxy logs, Web server logs 
Cross-reference the detected user agent string with known legitimate user agents and security tools 
Example log sources Proxy logs, Endpoint logs 
Investigate any additional indicators of compromise (IOCs) associated with the detected user agent string 
Example log sources IDS/IPS logs, Firewall logs","Legitimate user agents that may trigger the rule 
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3 
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36 
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.81 Safari/537.36 
User agents used by legitimate security tools 
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3 (Nextron Systems Sigma) 
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36 (Nextron Systems Sigma) 
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.81 Safari/537.36 (Nextron Systems Sigma)","""c-useragent"" IN (""Internet Explorer *"", ""Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.2)"", ""Mozilla/4.0 (compatible; Metasploit RSPEC)"", ""Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)"", ""Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)"", ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)"", ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}; SLCC1; .N"", ""Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)"", ""Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13"", ""Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MAAU)"", ""Mozilla/5.0"", ""Mozilla/4.0 (compatible; SPIPE/1.0"", ""Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0"", ""Sametime Community Agent"", ""X-FORWARDED-FOR"", ""DotDotPwn v2.1"", ""SIPDROID"", ""Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:60.0)"", ""Mozilla/6.0 (X11; Linux x86_64; rv:24.0) Gecko/20140205     Firefox/27.0 Iceweasel/25.3.0"", ""*wordpress hash grabber*"", ""*exploit*"")"
"Hack Tool User Agent","Florian Roth (Nextron Systems)","Detects suspicious user agent strings user by hack tools in proxy logs","attack.initial_access, attack.t1190, attack.credential_access, attack.t1110","proxy","Not classified","Not classified","Investigate the source IP address and associated user agent string in the proxy logs. 
Check if the user agent string matches any known hack tools or suspicious activities. 
Look for any other suspicious behavior or indicators of compromise in the logs, such as unusual request patterns or excessive requests from the same IP address. 
Correlate the user agent string with other security events or alerts to identify any potential attack patterns or campaigns.","Legitimate use of user agents that contain similar strings but are not related to hack tools","""c-useragent"" IN (""*(hydra)*"", ""* arachni/*"", ""* BFAC *"", ""* brutus *"", ""* cgichk *"", ""*core-project/1.0*"", ""* crimscanner/*"", ""*datacha0s*"", ""*dirbuster*"", ""*domino hunter*"", ""*dotdotpwn*"", ""*FHScan Core*"", ""*floodgate*"", ""*get-minimal*"", ""*gootkit auto-rooter scanner*"", ""*grendel-scan*"", ""* inspath *"", ""*internet ninja*"", ""*jaascois*"", ""* zmeu *"", ""*masscan*"", ""* metis *"", ""*morfeus fucking scanner*"", ""*n-stealth*"", ""*nsauditor*"", ""*pmafind*"", ""*security scan*"", ""*springenwerk*"", ""*teh forest lobster*"", ""*toata dragostea*"", ""* vega/*"", ""*voideye*"", ""*webshag*"", ""*webvulnscan*"", ""* whcc/*"", ""* Havij*"", ""*absinthe*"", ""*bsqlbf*"", ""*mysqloit*"", ""*pangolin*"", ""*sql power injector*"", ""*sqlmap*"", ""*sqlninja*"", ""*uil2pn*"", ""*ruler*"", ""*Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-PT; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)*"")"
"Malware User Agent","Florian Roth (Nextron Systems), X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects suspicious user agent strings used by malware in proxy logs","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Review the proxy logs for matched events. 
Cross-reference the detected user agent strings with other security data to determine the legitimacy of the traffic. 
Consider creating exceptions or tuning the rule to reduce false positives for known, legitimate user agents.","Legitimate user agents may occasionally trigger this rule, especially with old or custom browsers. Verify the context and cross-reference with other security data to reduce false positives.","""c-useragent"" IN (""Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1)"", ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)"", ""Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR  1.1.4322)"", ""HttpBrowser/1.0"", ""*<|>*"", ""nsis_inetc (mozilla)"", ""Wget/1.9+cvs-stable (Red Hat modified)"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)"", ""*zeroup*"", ""Mozilla/5.0 (Windows NT 5.1 ; v.*"", ""* adlib/*"", ""* tiny"", ""* BGroom *"", ""* changhuatong"", ""* CholTBAgent"", ""Mozilla/5.0 WinInet"", ""RookIE/1.0"", ""M"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)"", ""Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)"", ""backdoorbot"", ""Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)"", ""Opera/8.81 (Windows NT 6.0; U; en)"", ""Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)"", ""Opera"", ""Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)"", ""Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"", ""MSIE"", ""*(Charon; Inferno)"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)"", ""Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)"", ""Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1)"", ""Mozilla/5.0 (Windows NT 10.0; Win64; x64)"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0; Win64; x64)"", ""Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64)"", ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; InfoPath.3)"", ""Mozilla/5.0 (Windows NT 6.1)"", ""AppleWebkit/587.38 (KHTML, like Gecko)"", ""Chrome/91.0.4472.77"", ""Safari/537.36"", ""Edge/91.0.864.37"", ""Firefox/89.0"", ""Gecko/20100101"", ""* pxyscand*"", ""* asd"", ""* mdms"", ""sample"", ""nocase"", ""Moxilla"", ""Win32 *"", ""*Microsoft Internet Explorer*"", ""agent *"", ""AutoIt"", ""IczelionDownLoad"", ""Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 10.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)"", ""record"", ""mozzzzzzzzzzz"", ""Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0"", ""Havana/0.1"", ""antSword/v2.1"", ""rqwrwqrqwrqw"", ""qwrqrwrqwrqwr"", ""rc2.0/client"", ""TakeMyPainBack"", ""xxx"", ""20112211"", ""23591"", ""901785252112"", ""1235125521512"", ""125122112551"", ""B1D3N_RIM_MY_ASS"", ""AYAYAYAY1337"", ""iMightJustPayMySelfForAFeature"", ""ForAFeature"", ""Ares_ldr_v_*"", ""Microsoft Internet Explorer"", ""CLCTR"", ""uploader"", ""agent"", ""License"", ""vb wininet"", ""Client"", ""Lilith-Bot/3.0"", ""svc/1.0"", ""WSHRAT"", ""ZeroStresser Botnet/1.5"", ""OK"", ""Project1sqlite"", ""Project1"", ""DuckTales"", ""Zadanie"", ""GunnaWunnaBlueTips"", ""Xlmst"", ""GeekingToTheMoon"", ""SunShineMoonLight"", ""BunnyRequester"", ""BunnyTasks"", ""BunnyStealer"", ""BunnyLoader_Dropper"", ""BunnyLoader"", ""BunnyShell"", ""SPARK-COMMIT"", ""4B4DB4B3"")"
"Suspicious User Agent","Florian Roth (Nextron Systems)","Detects suspicious malformed user agent strings in proxy logs","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Check the proxy logs for user agent strings that match the suspicious patterns 
Analyze the associated IP addresses and timestamps to identify any patterns or anomalies 
Cross-reference the user agent strings with known legitimate user agents to filter out false positives 
Investigate any user agents that contain CertUtil URL Agent as it may indicate malicious activity 
Look for user agents that match the specific versions of Mozilla or MSIE mentioned in the rule 
Pay attention to user agents containing HTTPS, Erbium-UA-4ce7c27cb4be9d32e333bf032c88235a, x, or xxx as they may be indicators of suspicious activity","Mozilla/3.0 * Acrobat * 
User agents from acrobat.com, adobe.com, and adobe.io","""c-useragent"" IN (""user-agent*"", ""Mozilla/3.0 *"", ""Mozilla/2.0 *"", ""Mozilla/1.0 *"", ""Mozilla *"", "" Mozilla/*"", ""Mozila/*"", ""Mozilla/4.0 (compatible; MSIE 6.0; MS Web Services Client Protocol*"") OR ""c-useragent"" IN (""* (compatible;MSIE *"", ""*.0;Windows NT *"", ""*loader*"") OR ""c-useragent"" IN (""_"", ""CertUtil URL Agent"", ""Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0)"", ""Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0"", ""HTTPS"", ""Erbium-UA-4ce7c27cb4be9d32e333bf032c88235a"", ""x"", ""xxx"") NOT (""c-useragent""=""Mozilla/3.0 * Acrobat *"" OR ""cs-host"" IN (""*.acrobat.com"", ""*.adobe.com"", ""*.adobe.io""))"
"Ursnif Malware C2 URL Pattern","Thomas Patzke","Detects Ursnif C2 traffic.","attack.initial_access, attack.t1566.001, attack.execution, attack.t1204.002, attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Investigate the source IP address (c-ip) and user agent (c-ua) for any suspicious activity or indicators of compromise. 
Analyze the URI path (c-uri) for any base64-encoded URLs that contain _2f or _2b and have .avi or /images/ in the path. 
Review the size of the response (sc-bytes) to identify any unusually large or small responses that may indicate malicious activity.","Legitimate base64-encoded URLs that contain _2f or _2b and have .avi or /images/ in the URI path.","""c-uri"" IN (""*_2f*"", ""*_2b*"") ""c-uri""=""*.avi*"" ""c-uri""=""*/images/*"""
"Ursnif Malware Download URL Pattern","Thomas Patzke","Detects download of Ursnif malware done by dropper documents.","attack.command_and_control, attack.t1071.001","proxy","Not classified","Not classified","Investigate the following log sources 
Proxy logs Look for HTTP requests containing the pattern /.php?l= in the URI and ending with .cab. Check if the response status code is 200 (successful). 
Web server logs Look for corresponding requests with the same URI pattern and response status code. 
Endpoint logs Check for any suspicious activity or indicators of compromise (IOCs) related to Ursnif malware, such as unusual network connections or file modifications. 
Email logs Look for any suspicious emails containing dropper documents that may lead to the download of Ursnif malware.","Legitimate file downloads from trusted sources","""c-uri""=""*/*"" ""c-uri""=""*.php?l=*"" ""c-uri""=""*.cab"" ""sc-status""=200"
"Powerview Add-DomainObjectAcl DCSync AD Extend Right","Samir Bousseaden; Roberto Rodriguez @Cyb3rWard0g; oscd.community; Tim Shelton; Maxence Fossat","Backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer","attack.persistence, attack.t1098","Not classified","windows","security","Check the Windows Security event logs for Event ID 5136. 
Look for the AttributeLDAPDisplayName field in the event and verify if it contains any of the following values 1131f6ad-9c07-11d1-f79f-00c04fc2dcd2, 1131f6aa-9c07-11d1-f79f-00c04fc2dcd2, 89e95b76-444d-4c62-991a-0facbeda640c. 
Verify if the ObjectClass field in the event contains any of the following values dnsNode, dnsZoneScope, dnsZone. 
If the above conditions are met, further investigate the event to determine if the Powerview\Add-DomainObjectAcl DCSync Extended Right cmdlet was used to backdoor a domain object and grant DCSync rights to a regular user or machine account. 
Check the value attribute of the event for user SIDs and verify if it belongs to a regular user or a domain controller computer account.","New Domain Controller computer account, check user SIDs within the value attribute of event 5136 and verify if its a regular user or DC computer account.","source=""WinEventLog:Security"" EventCode=5136 AttributeLDAPDisplayName=""ntSecurityDescriptor"" AttributeValue IN (""*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*"", ""*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*"", ""*89e95b76-444d-4c62-991a-0facbeda640c*"") NOT (ObjectClass IN (""dnsNode"", ""dnsZoneScope"", ""dnsZone""))"
"AD Privileged Users or Groups Reconnaissance","Samir Bousseaden","Detect priv users or groups recon based on 4661 eventid and known privileged users or groups SIDs","attack.discovery, attack.t1087.002","Not classified","windows","security","Check the EventID 4661 logs from the Windows Security event logs on the Domain Controllers 
Verify if the ObjectName ends with any of the known privileged SIDs -512, -502, -500, -505, -519, -520, -544, -551, -555 
Examine the SubjectUserName to ensure it ends with $ indicating a computer account 
Review the context and other relevant logs to determine if the activity is suspicious or part of normal administrative activities 
Cross-reference with other logs, such as authentication logs, to identify any abnormal behavior or patterns","If the EventID 4661 is triggered by legitimate administrative activities, such as system maintenance or authorized user actions 
If the ObjectName contains admin but it is not related to privileged users or groups 
If the SubjectUserName ends with $ but it is a legitimate service account","source=""WinEventLog:Security"" EventCode=4661 ObjectType IN (""SAM_USER"", ""SAM_GROUP"") ObjectName IN (""*-512"", ""*-502"", ""*-500"", ""*-505"", ""*-519"", ""*-520"", ""*-544"", ""*-551"", ""*-555"") OR ObjectName=""*admin*"" NOT SubjectUserName=""*$"""
"ADCS Certificate Template Configuration Vulnerability with Risky EKU","Orlinum , BlueDefenZer","Detects certificate creation with template allowing risk permission subject and risky EKU","attack.privilege_escalation, attack.credential_access","Not classified","windows","security","Check the Windows Security event logs for Event ID 4898 and Event ID 4899. 
Look for the presence of the specific TemplateContent values in the event logs. 
Verify if the TemplateContent contains the CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT flag. 
Review the NewTemplateContent field in Event ID 4899 for the same TemplateContent values and CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT flag. 
Investigate the user or process associated with the certificate creation event. 
Determine if the certificate creation was performed for legitimate purposes or if it indicates a potential privilege escalation or credential access attack.","Administrator activity - This rule may generate false positives if the certificate creation is performed by an administrator for legitimate purposes. 
Proxy SSL certificate with subject modification - If a proxy server is configured to modify the subject of SSL certificates, it may trigger this rule. 
Smart card enrollment - When enrolling smart cards, certain certificate templates may be used that trigger this rule.","source=""WinEventLog:Security"" (EventCode=4898 TemplateContent IN (""*1.3.6.1.5.5.7.3.2*"", ""*1.3.6.1.5.2.3.4*"", ""*1.3.6.1.4.1.311.20.2.2*"", ""*2.5.29.37.0*"") TemplateContent=""*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*"") OR (EventCode=4899 NewTemplateContent IN (""*1.3.6.1.5.5.7.3.2*"", ""*1.3.6.1.5.2.3.4*"", ""*1.3.6.1.4.1.311.20.2.2*"", ""*2.5.29.37.0*"") NewTemplateContent=""*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*"")"
"AD Object WriteDAC Access","Roberto Rodriguez @Cyb3rWard0g","Detects WRITE_DAC access to a domain object","attack.defense_evasion, attack.t1222.001","Not classified","windows","security","Review the Event ID 4662 logs from the Windows Security event logs 
Look for the ObjectServer field to be DS 
Check if the AccessMask field is set to 0x40000 
Verify if the ObjectType field matches 19195a5b-6da0-11d0-afd3-00c04fd930c9 or domainDNS 
Investigate the user or process associated with the event to determine if it is authorized or suspicious","Legitimate changes to object permissions by authorized administrators 
Scheduled system maintenance or backup activities 
Changes made by automated processes or scripts","source=""WinEventLog:Security"" EventCode=4662 ObjectServer=""DS"" AccessMask=""0x40000"" ObjectType IN (""19195a5b-6da0-11d0-afd3-00c04fd930c9"", ""domainDNS"")"
"Active Directory Replication from Non Machine Account","Roberto Rodriguez @Cyb3rWard0g","Detects potential abuse of Active Directory Replication Service (ADRS) from a non machine account to request credentials.","attack.credential_access, attack.t1003.006","Not classified","windows","security","Review the security logs from the Windows Security event log on the domain controllers for Event ID 4662 with the specified AccessMask and Properties values. 
Check the ComputerName, SubjectDomainName, and SubjectUserName fields in the logs to identify the source of the replication request. 
Verify if the SubjectUserName ends with $ and does not start with MSOL_ to determine if it is a non-machine account. 
Cross-reference the identified non-machine account with the organizations user account records to confirm if it is a legitimate account or potentially malicious.","Unknown","source=""WinEventLog:Security"" EventCode=4662 AccessMask=""0x100"" Properties IN (""*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*"", ""*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*"", ""*89e95b76-444d-4c62-991a-0facbeda640c*"") NOT (SubjectUserName IN (""*$"", ""MSOL_*""))"
"Enabled User Right in AD to Control User Objects","@neu5ron","Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects.","attack.persistence, attack.t1098","Not classified","windows","security","Review Windows Security event logs for Event ID 4704. 
Look for entries where the PrivilegeList contains SeEnableDelegationPrivilege. 
Cross-reference the user associated with the event with the organizations authorized administrators list. 
Check if there is a legitimate reason for the use of SeEnableDelegationPrivilege, such as a specific task or troubleshooting activity. 
Investigate any suspicious or unauthorized use of SeEnableDelegationPrivilege by comparing the event details with the organizations security policies and procedures. 
If necessary, escalate the investigation to the appropriate team or personnel for further analysis and response.","Legitimate use of SeEnableDelegationPrivilege by authorized administrators. 
Temporary elevation of privileges for specific tasks or troubleshooting purposes. 
Privilege escalation by security tools or scripts that require this privilege.","source=""WinEventLog:Security"" EventCode=4704 PrivilegeList=""*SeEnableDelegationPrivilege*"""
"Active Directory User Backdoors","@neu5ron","Detects scenarios where one can control another users or computers account without having to use their credentials.","attack.t1098, attack.persistence","Not classified","windows","security","Review the Windows Security event logs for Event ID 4738, which indicates a user account was changed. 
Look for Event ID 5136 in the Windows Security event logs, which indicates changes to Active Directory objects. 
Pay attention to the AttributeLDAPDisplayName field in Event ID 5136, as it can provide information about the specific attribute being modified. 
Cross-reference the changes with known legitimate delegation scenarios and authorized service accounts. 
Investigate any suspicious changes to user attributes or servicePrincipalName in Active Directory.","Legitimate delegation scenarios where users or computers have been explicitly granted permissions to act on behalf of others. 
Authorized service accounts that require delegation for specific tasks. 
Legitimate changes to user attributes or servicePrincipalName in Active Directory.","source=""WinEventLog:Security"" (EventCode=4738 NOT (AllowedToDelegateTo=""-"" OR AllowedToDelegateTo!=*)) OR (EventCode=5136 AttributeLDAPDisplayName=""msDS-AllowedToDelegateTo"") OR (EventCode=5136 ObjectClass=""user"" AttributeLDAPDisplayName=""servicePrincipalName"") OR (EventCode=5136 AttributeLDAPDisplayName=""msDS-AllowedToActOnBehalfOfOtherIdentity"")"
"Weak Encryption Enabled and Kerberoast","@neu5ron","Detects scenario where weak encryption is enabled for a user profile which could be used for hash/password cracking.","attack.defense_evasion, attack.t1562.001","Not classified","windows","security","Check the Event ID 4738 in the Windows Security event logs 
Look for the presence of the NewUacValue field in the event logs 
Compare the NewUacValue with the OldUacValue field to identify changes in UAC settings 
Verify if the NewUacValue ends with 8??? or 9??? or A??? or B??? or C??? or D??? or E??? or F??? for UAC settings related to weak encryption 
Check if the NewUacValue ends with 1???? or 3???? or 5???? or 7???? or 9???? or B???? or D???? or F???? for UAC settings related to weak pre-authentication 
Investigate if the NewUacValue ends with 8?? or 9?? or A?? or B?? or C?? or D?? or E?? or F?? for UAC settings related to weak encryption","User legitimately changed UAC settings 
User legitimately changed UAC pre-authentication settings 
User legitimately changed UAC encryption settings","source=""WinEventLog:Security"" EventCode=4738 (NewUacValue IN (""*8***"", ""*9***"", ""*A***"", ""*B***"", ""*C***"", ""*D***"", ""*E***"", ""*F***"") NOT (OldUacValue IN (""*8***"", ""*9***"", ""*A***"", ""*B***"", ""*C***"", ""*D***"", ""*E***"", ""*F***""))) OR (NewUacValue IN (""*1****"", ""*3****"", ""*5****"", ""*7****"", ""*9****"", ""*B****"", ""*D****"", ""*F****"") NOT (OldUacValue IN (""*1****"", ""*3****"", ""*5****"", ""*7****"", ""*9****"", ""*B****"", ""*D****"", ""*F****""))) OR (NewUacValue IN (""*8**"", ""*9**"", ""*A**"", ""*B**"", ""*C**"", ""*D**"", ""*E**"", ""*F**"") NOT (OldUacValue IN (""*8**"", ""*9**"", ""*A**"", ""*B**"", ""*C**"", ""*D**"", ""*E**"", ""*F**"")))"
"Hacktool Ruler","Florian Roth (Nextron Systems)","This events that are generated when using the hacktool Ruler by Sensepost","attack.discovery, attack.execution, attack.t1087, attack.t1114, attack.t1059, attack.t1550.002","Not classified","windows","security","Check Windows Security event logs for Event IDs 4624 and 4625 with the WorkstationName field set to RULER. These events indicate successful logon and logoff events using the hacktool Ruler. Example log source Windows Security Event Log","Go utilities that use staaldraad awesome NTLM library","source=""WinEventLog:Security"" (EventCode=4776 Workstation=""RULER"") OR (EventCode IN (4624, 4625) WorkstationName=""RULER"")"
"CobaltStrike Service Installations - Security","Florian Roth (Nextron Systems), Wojciech Lesicki","Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement","attack.execution, attack.privilege_escalation, attack.lateral_movement, attack.t1021.002, attack.t1543.003, attack.t1569.002","Not classified","windows","security","Not available","Not available","source=""WinEventLog:Security"" EventCode=4697 (ServiceFileName=""*ADMIN$*"" ServiceFileName=""*.exe*"") OR (ServiceFileName=""*%COMSPEC%*"" ServiceFileName=""*start*"" ServiceFileName=""*powershell*"") OR ServiceFileName=""*powershell -nop -w hidden -encodedcommand*"" OR ServiceFileName=""*SUVYIChOZXctT2JqZWN0IE5ldC5XZWJjbGllbnQpLkRvd25sb2FkU3RyaW5nKCdodHRwOi8vMTI3LjAuMC4xO*"" OR ServiceFileName=""*lFWCAoTmV3LU9iamVjdCBOZXQuV2ViY2xpZW50KS5Eb3dubG9hZFN0cmluZygnaHR0cDovLzEyNy4wLjAuMT*"" OR ServiceFileName=""*JRVggKE5ldy1PYmplY3QgTmV0LldlYmNsaWVudCkuRG93bmxvYWRTdHJpbmcoJ2h0dHA6Ly8xMjcuMC4wLjE6*"""
"DCOM InternetExplorer.Application Iertutil DLL Hijack - Security","Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR)","Detects a threat actor creating a file named `iertutil.dll` in the `C:\Program Files\Internet Explorer\` directory over the network for a DCOM InternetExplorer DLL Hijack scenario.","attack.lateral_movement, attack.t1021.002, attack.t1021.003","Not classified","windows","security","Check the process tree for any suspicious or unauthorized processes that may have created the `iertutil.dll` file. 
Review the network logs for any suspicious network connections or traffic related to the creation of the `iertutil.dll` file. 
Inspect the file properties of the `iertutil.dll` file to identify any anomalies or signs of tampering. 
Check for any other indicators of compromise (IOCs) associated with DLL hijacking or lateral movement techniques. 
Verify the legitimacy of the file by comparing its hash value with known good hashes of the legitimate `iertutil.dll` file. 
Consult with the system owner or user to determine if any authorized installations or updates of Internet Explorer were performed during the time of detection.","Legitimate installation or update of Internet Explorer","source=""WinEventLog:Security"" EventCode=5145 RelativeTargetName=""*\\Internet Explorer\\iertutil.dll"" NOT SubjectUserName=""*$"""
"Mimikatz DC Sync","Benjamin Delpy, Florian Roth (Nextron Systems), Scott Dermott, Sorina Ionescu","Detects Mimikatz DC sync security events","attack.credential_access, attack.s0002, attack.t1003.006","Not classified","windows","security","Check the Windows Security event logs for Event ID 4662. 
Look for the following properties in the event log entry Replicating Directory Changes All, 1131f6ad-9c07-11d1-f79f-00c04fc2dcd2, 1131f6aa-9c07-11d1-f79f-00c04fc2dcd2, 9923a32a-3607-11d2-b9be-0000f87a36b2, 89e95b76-444d-4c62-991a-0facbeda640c, and AccessMask with a value of 0x100. 
Verify that the SubjectDomainName is Window Manager. 
Check if the SubjectUserName starts with NT AUT or MSOL_ and ends with $. 
If the above conditions are met, investigate further to determine if it is a valid DC Sync or a potential security event. 
If it is a known false positive, such as a valid DC Sync that is not covered by the filters or a Local Domain Admin account used for Azure AD Connect, no further action may be required. 
If it is not a known false positive, analyze the event in the context of the overall security posture and investigate any suspicious activities or indicators of compromise.","Valid DC Sync that is not covered by the filters; please report 
Local Domain Admin account used for Azure AD Connect","source=""WinEventLog:Security"" EventCode=4662 Properties IN (""*Replicating Directory Changes All*"", ""*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*"", ""*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*"", ""*9923a32a-3607-11d2-b9be-0000f87a36b2*"", ""*89e95b76-444d-4c62-991a-0facbeda640c*"") AccessMask=""0x100"" NOT (SubjectDomainName=""Window Manager"" OR SubjectUserName IN (""NT AUT*"", ""MSOL_*"") OR SubjectUserName=""*$"")"
"Windows Defender Exclusion Set","@BarryShooshooga","Detects scenarios where an Windows Defender exclusion was added in registry where an entity would want to bypass antivirus scanning from Windows Defender","attack.defense_evasion, attack.t1562.001","Not classified","windows","security","Check the Windows Security event logs for Event IDs 4657, 4656, 4660, and 4663. 
Look for objects in the registry that contain the path \Microsoft\Windows Defender\Exclusions\. 
Review the details of the events to identify the user or process that made the changes. 
Verify if the exclusion was added by an administrator for legitimate reasons. 
If the exclusion was not authorized or appears suspicious, further investigation is required to determine if it is an attempt to bypass Windows Defender.","Intended inclusions by administrator","source=""WinEventLog:Security"" EventCode IN (4657, 4656, 4660, 4663) ObjectName=""*\\Microsoft\\Windows Defender\\Exclusions\\*"""
"Important Windows Event Auditing Disabled","Nasreddine Bencherchali (Nextron Systems)","Detects scenarios where system auditing for important events such as ""Process Creation"" or ""Logon"" events is disabled.","attack.defense_evasion, attack.t1562.002","Not classified","windows","security","To investigate this detection, you can perform the following steps 
Check the Windows Security Event Log (Event ID 4719) on the affected system(s) to confirm if the auditing for important events is indeed disabled. 
Review the systems audit policy settings to determine if any changes have been made to disable auditing for the specified events. 
Consult with the system administrator or security team to understand the reason behind the disabled auditing and verify if it is intentional or a misconfiguration. 
If the disabled auditing is deemed intentional, document the justification and ensure it aligns with the organizations security policies and standards. 
If the disabled auditing is suspected to be a misconfiguration or unauthorized change, investigate further to identify the root cause and take appropriate remedial actions.","There may be cases where the system auditing is intentionally disabled for legitimate reasons, such as performance optimization or specific security configurations. It is important to verify the intent behind the disabled auditing before considering it a false positive.","source=""WinEventLog:Security"" (EventCode=4719 SubcategoryGuid IN (""{0CCE9215-69AE-11D9-BED3-505054503030}"", ""{0CCE922B-69AE-11D9-BED3-505054503030}"", ""{0CCE9240-69AE-11D9-BED3-505054503030}"", ""{0CCE9210-69AE-11D9-BED3-505054503030}"", ""{0CCE9211-69AE-11D9-BED3-505054503030}"", ""{0CCE9212-69AE-11D9-BED3-505054503030}"", ""{0CCE921B-69AE-11D9-BED3-505054503030}"", ""{0CCE922F-69AE-11D9-BED3-505054503030}"", ""{0CCE9230-69AE-11D9-BED3-505054503030}"", ""{0CCE9235-69AE-11D9-BED3-505054503030}"", ""{0CCE9236-69AE-11D9-BED3-505054503030}"", ""{0CCE9237-69AE-11D9-BED3-505054503030}"", ""{0CCE923F-69AE-11D9-BED3-505054503030}"", ""{0CCE9242-69AE-11D9-BED3-505054503030}"") AuditPolicyChanges IN (""*%%8448*"", ""*%%8450*"")) OR (EventCode=4719 SubcategoryGuid=""{0CCE9217-69AE-11D9-BED3-505054503030}"" AuditPolicyChanges=""*%%8448*"")"
"ETW Logging Disabled In .NET Processes - Registry","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Potential adversaries stopping ETW providers recording loaded .NET assemblies.","attack.defense_evasion, attack.t1112, attack.t1562","Not classified","windows","security","Review Windows Security Event Logs for Event ID 4657 with the specified ObjectName and ObjectValueName to identify instances where ETW logging has been disabled in .NET processes. 
Check for any legitimate reasons or authorized changes that may have resulted in the disabling of ETW logging. This can include reviewing change management records, system administrator activity logs, or communication with relevant personnel. 
Analyze the context and timing of the event to determine if the disabling of ETW logging aligns with any suspicious or malicious activities. Look for correlations with other security events or indicators of compromise. 
Cross-reference the event with other log sources such as process monitoring logs, network logs, or endpoint detection and response (EDR) logs to gather additional context and evidence of potential malicious activity. 
Consult with system administrators, developers, or security tool vendors to understand if any legitimate processes or configurations require the disabling of ETW logging. 
If necessary, perform further forensic analysis on the affected system to gather additional evidence or artifacts related to the disabling of ETW logging.","Legitimate changes made by system administrators or authorized users to disable ETW logging for specific purposes. 
Changes made during troubleshooting or debugging scenarios where ETW logging may be temporarily disabled. 
Changes made by security tools or agents that require ETW logging to be disabled for compatibility or performance reasons.","source=""WinEventLog:Security"" (EventCode=4657 ObjectName=""*\\SOFTWARE\\Microsoft\\.NETFramework"" ObjectValueName=""ETWEnabled"" NewValue=0) OR (EventCode=4657 ObjectName=""*\\Environment*"" ObjectValueName IN (""COMPlus_ETWEnabled"", ""COMPlus_ETWFlags"") NewValue=0)"
"DPAPI Domain Backup Key Extraction","Roberto Rodriguez @Cyb3rWard0g","Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers","attack.credential_access, attack.t1003.004","Not classified","windows","security","Review Windows Security Event logs on Domain Controllers for Event ID 4662 with ObjectType set to SecretObject and AccessMask set to 0x2. Look for ObjectName containing BCKUPKEY.","Unknown","source=""WinEventLog:Security"" EventCode=4662 ObjectType=""SecretObject"" AccessMask=""0x2"" ObjectName=""*BCKUPKEY*"""
"Persistence and Execution at Scale via GPO Scheduled Task","Samir Bousseaden","Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale","attack.persistence, attack.lateral_movement, attack.t1053.005","Not classified","windows","security","Review Windows Security event logs for Event ID 5145 with the following criteria 
['ShareName \\\\\\\\*\\\\SYSVOL'] 
['RelativeTargetName ends with ScheduledTasks.xml'] 
['Accesses contain WriteData and %%4417'] 
Identify the source IP address associated with the event and verify its legitimacy. If the source IP is not localhost, investigate further to determine if the changes to GPO scheduled tasks are authorized or suspicious.","If the source IP is not localhost, it may indicate legitimate remote changes to GPO scheduled tasks. It is recommended to investigate the source IP and verify the legitimacy of the changes.","source=""WinEventLog:Security"" EventCode=5145 ShareName=""\\\\\*\\SYSVOL"" RelativeTargetName=""*ScheduledTasks.xml"" Accesses IN (""*WriteData*"", ""*%%4417*"")"
"Hidden Local User Creation","Christian Burkard (Nextron Systems)","Detects the creation of a local hidden user account which should not happen for event ID 4720.","attack.persistence, attack.t1136.001","Not classified","windows","security","To investigate this detection, you can perform the following steps 
Review the Windows Security Event Log for Event ID 4720. 
Look for the TargetUserName field that ends with a $ symbol, indicating a hidden local user account creation. 
Check the event details for any additional information, such as the Account Name, Account Domain, and Caller User Name. 
Verify if the creation of the hidden local user account was authorized and aligns with the organizations security policies. 
If the creation was unauthorized or suspicious, further investigation may be required, such as checking for any associated malicious activities or indicators of compromise. 
Consult with the system administrators or relevant personnel to determine the purpose and legitimacy of the hidden local user account creation.","Legitimate creation of hidden local user accounts for specific administrative purposes, such as system maintenance or application installation.","source=""WinEventLog:Security"" EventCode=4720 TargetUserName=""*$"""
"HybridConnectionManager Service Installation","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Rule to detect the Hybrid Connection Manager service installation.","attack.persistence, attack.t1554","Not classified","windows","security","Check the Windows Security event logs for Event ID 4697. 
Look for the ServiceName field containing HybridConnectionManager. 
Verify if the ServiceFileName contains HybridConnectionManager. 
Review the context of the event to determine if the installation is legitimate or suspicious.","Legitimate use of Hybrid Connection Manager via Azure function apps.","source=""WinEventLog:Security"" EventCode=4697 ServiceName=""HybridConnectionManager"" ServiceFileName=""*HybridConnectionManager*"""
"Impacket PsExec Execution","Bhabesh Raj","Detects execution of Impacket's psexec.py.","attack.lateral_movement, attack.t1021.002","Not classified","windows","security","Review the EventID 5145 logs from the Windows Security event logs. 
Look for events where the ShareName matches \\\\*\\IPC$ and the RelativeTargetName contains RemCom_stdin, RemCom_stdout, or RemCom_stderr. 
Correlate the detection events with other relevant logs, such as authentication logs, process creation logs, and network logs, to gather additional context. 
Identify the source IP address and user account associated with the detection event. 
Verify if the activity was authorized and aligns with the organizations policies and procedures. 
If the activity is deemed legitimate, add the source IP address or user account to the whitelist to prevent future false positives.","Legitimate use of Impackets psexec.py tool within the environment. 
Authorized administrative activity involving IPC$ share and the specified file names. 
Misconfiguration or misinterpretation of the detection rule.","source=""WinEventLog:Security"" EventCode=5145 ShareName=""\\\\\*\\IPC$"" RelativeTargetName IN (""*RemCom_stdin*"", ""*RemCom_stdout*"", ""*RemCom_stderr*"")"
"Possible Impacket SecretDump Remote Activity","Samir Bousseaden, wagga","Detect AD credential dumping using impacket secretdump HKTL","attack.credential_access, attack.t1003.002, attack.t1003.004, attack.t1003.003","Not classified","windows","security","Check the EventID of the triggered event to ensure it matches the expected value (5145). 
Verify the ShareName field to confirm if it is accessing the ADMIN$ share. 
Review the RelativeTargetName field to identify if it contains the expected file paths (e.g., SYSTEM32\) or temporary files with the .tmp extension. 
Cross-reference the event with other relevant logs, such as authentication logs, to determine if the activity is associated with legitimate administrative actions. 
Validate the configuration of the advanced audit policy setting for detailed file share access to ensure it is properly configured for Success/Failure. 
Investigate any misconfigurations in the log sources that may lead to false positives.","Legitimate administrative activity that involves accessing the ADMIN$ share. 
Legitimate file operations in the SYSTEM32 directory. 
Legitimate temporary file creation with the .tmp extension. 
False positives can occur if the audit policy setting for detailed file share access is not properly configured or if there are misconfigurations in the log sources.","source=""WinEventLog:Security"" EventCode=5145 ShareName=""\\\\\*\\ADMIN$"" RelativeTargetName=""*SYSTEM32\\*"" RelativeTargetName=""*.tmp*"""
"Invoke-Obfuscation CLIP+ Launcher - Security","Jonathan Cheong, oscd.community","Detects Obfuscated use of Clip.exe to execute PowerShell","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","Not classified","windows","security","Investigate the command line arguments of the Clip.exe process to determine if any obfuscation techniques are being used. Look for suspicious PowerShell commands or scripts being executed through the Clip.exe process. 
Review the parent process of Clip.exe to identify the source of the command being executed. This can help determine if the execution is part of a legitimate workflow or if it is suspicious. 
Check for any other indicators of compromise (IOCs) associated with the detected activity, such as unusual network connections or file modifications.","Legitimate use of Clip.exe for non-malicious purposes, such as copying text to the clipboard.","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName=""*cmd*"" ServiceFileName=""*&&*"" ServiceFileName=""*clipboard]::*"""
"Invoke-Obfuscation Obfuscated IEX Invocation - Security","Daniel Bohannon (@Mandiant/@FireEye), oscd.community","Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the code block linked in the references","attack.defense_evasion, attack.t1027","Not classified","windows","security","Review the PowerShell logs for the presence of the obfuscated IEX invocation code 
Check the execution context of the PowerShell process to determine if it is running in a suspicious or unauthorized manner 
Analyze the parent-child process relationships to identify any suspicious or malicious activities 
Cross-reference the detected obfuscated code with known legitimate PowerShell scripts or security tools/frameworks 
Consult with system administrators or security teams to validate the purpose and legitimacy of the obfuscated PowerShell scripts","Legitimate PowerShell scripts that use obfuscation techniques 
Obfuscated PowerShell scripts used by system administrators for legitimate purposes 
Obfuscated PowerShell scripts used by security tools or frameworks for testing or research purposes"
"Invoke-Obfuscation STDIN+ Launcher - Security","Jonathan Cheong, oscd.community","Detects Obfuscated use of stdin to execute PowerShell","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","Not classified","windows","security","Check the command line arguments of the process that triggered the detection. Look for the presence of cmd or powershell in the ServiceFileName field. 
Review the process execution context to determine if the use of stdin is expected or suspicious. For example, if the process is a scheduled task or a legitimate administrative script, it may be a known false positive. 
Analyze the command line arguments for the presence of ${input} or noexit in the ServiceFileName field, which may indicate obfuscation techniques. 
Inspect the command line arguments for the presence of  /c  or  /r  in the ServiceFileName field, which may indicate the use of obfuscated commands.","Legitimate use of stdin to execute PowerShell scripts, such as in scheduled tasks or legitimate administrative scripts.","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName=""*cmd*"" ServiceFileName=""*powershell*"" ServiceFileName IN (""*${input}*"", ""*noexit*"") ServiceFileName IN (""* /c *"", ""* /r *"")"
"Invoke-Obfuscation VAR+ Launcher - Security","Jonathan Cheong, oscd.community","Detects Obfuscated use of Environment Variables to execute PowerShell","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","Not classified","windows","security","Review the command executed in the PowerShell process to determine if it is a legitimate use of environment variables or if it is an obfuscated command. 
Check the parent process and command line arguments to identify the source of the PowerShell execution. 
Analyze the PowerShell script or command for any suspicious or malicious behavior. 
Correlate with other security events and logs to identify any related indicators of compromise.","Legitimate use of environment variables in PowerShell scripts or commands.","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName=""*cmd*"" ServiceFileName=""*\""set*"" ServiceFileName=""*-f*"" ServiceFileName IN (""*/c*"", ""*/r*"")"
"Invoke-Obfuscation Via Stdin - Security","Nikita Nazarov, oscd.community","Detects Obfuscated Powershell via Stdin in Scripts","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","Not classified","windows","security","Review the Windows Security Event Log (EID 4697) for matched events. 
Examine the ServiceFileName, CommandLine, and any associated parameters to identify potentially obfuscated PowerShell or command execution. 
Cross-reference the detected events with other security data sources to determine the legitimacy of the activity. 
Consider creating exceptions or tuning the rule to reduce false positives for known, legitimate actions.","Legitimate use of PowerShell and command-line utilities may trigger this rule. Verify the context and cross-reference with other security data to reduce false positives.","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName=""*set*"" ServiceFileName=""*&&*"" ServiceFileName IN (""*environment*"", ""*invoke*"", ""*${input)*"")"
"Invoke-Obfuscation Via Use Clip - Security","Nikita Nazarov, oscd.community","Detects Obfuscated Powershell via use Clip.exe in Scripts","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","Not classified","windows","security","Review Windows Security event logs with Event ID 4697 to identify instances where Clip.exe is used in scripts. 
Analyze the command line arguments and parameters passed to Clip.exe to determine if obfuscation techniques are being employed. 
Cross-reference the detected Clip.exe usage with other security events or logs to identify any suspicious or malicious activities. 
Inspect the script files that contain the Clip.exe invocation to look for signs of obfuscation or other indicators of compromise.","Legitimate use of Clip.exe in scripts where obfuscation is not present","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName=""*(Clipboard|i*"""
"Invoke-Obfuscation Via Use MSHTA - Security","Nikita Nazarov, oscd.community","Detects Obfuscated Powershell via use MSHTA in Scripts","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","Not classified","windows","security","Review the command line arguments of the process that triggered the EventID 4697. Look for suspicious or obfuscated PowerShell code being executed via MSHTA. Check for the presence of known obfuscation techniques such as string concatenation, encoding, or use of special characters. Cross-reference the process with other logs such as PowerShell logs, web proxy logs, or network traffic logs to identify any malicious behavior or communication.","Legitimate use of MSHTA in scripts that are not obfuscated","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName=""*mshta*"" ServiceFileName=""*vbscript:createobject*"" ServiceFileName=""*.run*"" ServiceFileName=""*window.close*"""
"Invoke-Obfuscation Via Use Rundll32 - Security","Nikita Nazarov, oscd.community","Detects Obfuscated Powershell via use Rundll32 in Scripts","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","Not classified","windows","security","Review Windows Security Event Logs (EID 4697) for instances where the ServiceFileName contains rundll32, shell32.dll, and shellexec_rundll. Look for additional keywords such as invoke, comspec, or iex in the ServiceFileName. Cross-reference with other logs such as PowerShell logs or process monitoring logs to identify any suspicious or obfuscated PowerShell usage.","Legitimate use of Rundll32 in scripts or system processes","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName=""*&&*"" ServiceFileName=""*rundll32*"" ServiceFileName=""*shell32.dll*"" ServiceFileName=""*shellexec_rundll*"" ServiceFileName IN (""*value*"", ""*invoke*"", ""*comspec*"", ""*iex*"")"
"Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - Security","Timur Zinniatullin, oscd.community","Detects Obfuscated Powershell via VAR++ LAUNCHER","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","Not classified","windows","security","Investigate the process that triggered the EventID 4697 and analyze the command line arguments and the content of the script file. Look for suspicious or obfuscated PowerShell code that may indicate an attempt to evade detection or perform malicious activities. 
Review the execution context of the PowerShell script, including the user account, process parent-child relationships, and any network connections made during the execution. 
Cross-reference the detected obfuscated PowerShell script with threat intelligence sources to identify any known malicious indicators or behaviors. 
Consider the overall context of the system and user behavior to determine if the obfuscated PowerShell script is part of a legitimate activity or if further investigation is required.","Legitimate use of obfuscated PowerShell scripts for security testing or system administration purposes.","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName=""*&&set*"" ServiceFileName=""*cmd*"" ServiceFileName=""*/c*"" ServiceFileName=""*-f*"" ServiceFileName IN (""*{0}*"", ""*{1}*"", ""*{2}*"", ""*{3}*"", ""*{4}*"", ""*{5}*"")"
"First Time Seen Remote Named Pipe","Samir Bousseaden","This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes","attack.lateral_movement, attack.t1021.002","Not classified","windows","security","Check the Event ID 5145 logs in the Windows Security event logs 
Look for the ShareName field containing the value \\\\*\\IPC$ 
Verify if the RelativeTargetName field matches any of the known false positives 
If the RelativeTargetName does not match any known false positives, investigate further as it may indicate a newly observed named pipe","Update the excluded named pipe to filter out any newly observed legitimate named pipe","source=""WinEventLog:Security"" EventCode=5145 ShareName=""\\\\\*\\IPC$"" NOT (RelativeTargetName IN (""atsvc"", ""samr"", ""lsarpc"", ""lsass"", ""winreg"", ""netlogon"", ""srvsvc"", ""protected_storage"", ""wkssvc"", ""browser"", ""netdfs"", ""svcctl"", ""spoolss"", ""ntsvcs"", ""LSM_API_service"", ""HydraLsPipe"", ""TermSrv_API_service"", ""MsFteWds"", ""sql\\query"", ""eventlog""))"
"LSASS Access from Non System Account","Roberto Rodriguez @Cyb3rWard0g","Detects potential mimikatz-like tools accessing LSASS from non system account","attack.credential_access, attack.t1003.001","Not classified","windows","security","Review the EventID 4663 or 4656 logs from the Windows Security event logs. 
Look for the AccessMask field in the logs to identify the specific access permissions used. 
Check the SubjectUserName field to determine the user account accessing LSASS. 
Verify the ProcessName field to identify the process accessing LSASS. 
Cross-reference the ProcessName with known legitimate processes or known malicious tools. 
Investigate any suspicious or unauthorized access to LSASS from non-system accounts. 
Review the ObjectName field to ensure it ends with \lsass.exe to confirm the target process is LSASS. 
If the ProcessName starts with C\Program Files, it may indicate a potential false positive as legitimate processes are commonly located in this directory. 
If the ProcessName is C\Windows\System32\wbem\WmiPrvSE.exe and the AccessMask is 0x1410, it may indicate a known false positive related to WMI activity. 
If the ProcessName contains \SteamLibrary\steamapps\, it may indicate a known false positive related to gaming activity.","Legitimate administrative activity where LSASS is accessed from a non-system account for authorized purposes.","source=""WinEventLog:Security"" EventCode IN (4663, 4656) AccessMask IN (""0x40"", ""0x1400"", ""0x100000"", ""0x1410"", ""0x1010"", ""0x1438"", ""0x143a"", ""0x1418"", ""0x1f0fff"", ""0x1f1fff"", ""0x1f2fff"", ""0x1f3fff"", 40, 1400, 1000, 100000, 1410, 1010, 1438, ""143a"", 1418, ""1f0fff"", ""1f1fff"", ""1f2fff"", ""1f3fff"") ObjectType=""Process"" ObjectName=""*\\lsass.exe"" NOT (SubjectUserName=""*$"" OR ProcessName=""C:\\Program Files*"" OR (ProcessName=""C:\\Windows\\System32\\wbem\\WmiPrvSE.exe"" AccessMask=""0x1410"") OR ProcessName=""*\\SteamLibrary\\steamapps\\*"")"
"Credential Dumping Tools Service Execution - Security","Florian Roth (Nextron Systems), Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community","Detects well-known credential dumping tools execution via service execution events","attack.credential_access, attack.execution, attack.t1003.001, attack.t1003.002, attack.t1003.004, attack.t1003.005, attack.t1003.006, attack.t1569.002, attack.s0005","Not classified","windows","security","Check the Event ID 4697 logs in the Windows Security event log. 
Look for service execution events with the following Service File Names cachedump, dumpsvc, fgexec, gsecdump, mimidrv, pwdump, servpw. 
Correlate the service execution events with other security events to identify any suspicious or malicious activities. 
Analyze the context of the service execution events, including the user account, process information, and any associated network connections or file accesses. 
Compare the detected service execution events with known legitimate activities, such as password recovery by a legitimate administrator. 
If the service execution events are not associated with legitimate activities, investigate further to determine if credential dumping tools are being used. 
Consult additional data sources, such as endpoint logs, network logs, and threat intelligence feeds, to gather more information about the detected activities. 
If necessary, escalate the investigation to the appropriate teams for further analysis and response.","Legitimate Administrator using credential dumping tool for password recovery","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName IN (""*cachedump*"", ""*dumpsvc*"", ""*fgexec*"", ""*gsecdump*"", ""*mimidrv*"", ""*pwdump*"", ""*servpw*"")"
"Malicious Service Installations","Florian Roth (Nextron Systems), Daniil Yugoslavskiy, oscd.community (update)","Detects known malicious service installs that only appear in cases of lateral movement, credential dumping, and other suspicious activities.","attack.persistence, attack.privilege_escalation, attack.t1003, car.2013-09-005, attack.t1543.003, attack.t1569.002","Not classified","windows","security","Review the Event ID 4697 logs from the Windows Security event logs. 
Look for patterns of service installations that are not associated with legitimate software updates or installations. 
Cross-reference the service name with known malicious service names or indicators of compromise (IOCs) from threat intelligence sources. 
Check for any suspicious behavior or indicators of lateral movement, credential dumping, or other malicious activities associated with the service installation. 
Investigate any anomalies or deviations from normal behavior in the system or network logs that may indicate malicious activity.","Legitimate service installations during software updates or installations","source=""WinEventLog:Security"" EventCode=4697 ServiceName=""javamtsup"""
"WCE wceaux.dll Access","Thomas Patzke","Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host","attack.credential_access, attack.t1003, attack.s0005","Not classified","windows","security","Review Windows Security event logs (Event ID 4656, 4658, 4660, 4663) on the source host for any access to wceaux.dll. 
Check if the access to wceaux.dll is associated with a known legitimate process or tool. 
Verify if the access to wceaux.dll is part of a pass-the-hash remote command execution scenario. 
Cross-reference the event logs with other security logs (e.g., authentication logs) to identify any suspicious or unauthorized activity. 
If possible, analyze the network traffic to and from the source host during the time of the wceaux.dll access to identify any additional indicators of compromise.","Legitimate use of wceaux.dll by authorized system administrators or security tools.","source=""WinEventLog:Security"" EventCode IN (4656, 4658, 4660, 4663) ObjectName=""*\\wceaux.dll"""
"Metasploit SMB Authentication","Chakib Gzenayi (@Chak092), Hosni Mribah","Alerts on Metasploit host's authentications on the domain.","attack.lateral_movement, attack.t1021.002","Not classified","windows","security","Check Windows security logs for Event IDs 4625 and 4624 with Logon Type 3 and NTLM Authentication Package. Look for Workstation Names that match the regular expression pattern ^[A-Za-z0-9]{16}$. 
Review Windows security logs for Event ID 4776 with a Workstation Name that matches the regular expression pattern ^[A-Za-z0-9]{16}$ and a null Process Name.","Linux hostnames composed of 16 characters."
"Metasploit Or Impacket Service Installation Via SMB PsExec","Bartlomiej Czyz, Relativity","Detects usage of Metasploit SMB PsExec (exploit/windows/smb/psexec) and Impacket psexec.py by triggering on specific service installation","attack.lateral_movement, attack.t1021.002, attack.t1570, attack.execution, attack.t1569.002","Not classified","windows","security","Check the Security event logs on Windows systems for Event ID 4697. 
Look for events where the ServiceFileName matches the regular expression ^%systemroot%\\[a-zA-Z]{8}\.exe$. 
Verify that the ServiceName matches the regular expression (^[a-zA-Z]{4}$)|(^[a-zA-Z]{8}$)|(^[a-zA-Z]{16}$). 
Ensure that the ServiceStartType is set to 3 (Automatic). 
Confirm that the ServiceType is 0x10 (Kernel driver). 
Exclude events where the ServiceName is PSEXESVC.","Different agents with an 8-character binary and a 4, 8, or 16-character service name","source=""WinEventLog:Security"" EventCode=4697 ServiceStartType=3 ServiceType=""0x10"" NOT ServiceName=""PSEXESVC"""
"Meterpreter or Cobalt Strike Getsystem Service Installation - Security","Teymur Kheirkhabarov, Ecco, Florian Roth","Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service installation","attack.privilege_escalation, attack.t1134.001, attack.t1134.002","Not classified","windows","security","Investigate the context and purpose of the service installation. Look for any supporting evidence of malicious activity, such as suspicious network connections, unusual process behavior, or additional indicators of compromise (IOCs). 
Review relevant logs and events, such as Windows event logs (e.g., Security, System, PowerShell), network logs (e.g., firewall, proxy), and endpoint logs (e.g., antivirus, host-based intrusion detection system). 
Correlate the detection with other security events and alerts to identify any patterns or related activities. 
Consult with system administrators or other relevant personnel to determine if the service installation was authorized or expected. 
Consider conducting memory or disk forensics to gather additional evidence and artifacts related to the service installation. 
If necessary, escalate the investigation to incident response or threat hunting teams for further analysis and remediation.","There may be legitimate cases where these specific service installations are used, such as during system maintenance or authorized configuration changes.","source=""WinEventLog:Security"" EventCode=4697 (ServiceFileName=""*cmd*"" ServiceFileName=""*/c*"" ServiceFileName=""*echo*"" ServiceFileName=""*\\pipe\\*"") OR (ServiceFileName=""*%COMSPEC%*"" ServiceFileName=""*/c*"" ServiceFileName=""*echo*"" ServiceFileName=""*\\pipe\\*"") OR (ServiceFileName=""*cmd.exe*"" ServiceFileName=""*/c*"" ServiceFileName=""*echo*"" ServiceFileName=""*\\pipe\\*"") OR (ServiceFileName=""*rundll32*"" ServiceFileName=""*.dll,a*"" ServiceFileName=""*/p:*"")"
"NetNTLM Downgrade Attack","Florian Roth (Nextron Systems), wagga","Detects NetNTLM downgrade attack","attack.defense_evasion, attack.t1562.001, attack.t1112","Not classified","windows","security","Review Windows Security Event logs for Event ID 4657 with the specified ObjectName and ObjectValueName fields. 
Check for any changes to the LmCompatibilityLevel, NtlmMinClientSec, and RestrictSendingNTLMTraffic registry values under the specified ObjectName. 
Look for any suspicious modifications or downgrades to these registry values that may indicate a NetNTLM downgrade attack.","Unknown","source=""WinEventLog:Security"" EventCode=4657 ObjectName=""*\\REGISTRY\\MACHINE\\SYSTEM*"" ObjectName=""*ControlSet*"" ObjectName=""*\\Control\\Lsa*"" ObjectValueName IN (""LmCompatibilityLevel"", ""NtlmMinClientSec"", ""RestrictSendingNTLMTraffic"")"
"New or Renamed User Account with '$' in Attribute 'SamAccountName'","Ilyas Ochkov, oscd.community","Detects possible bypass EDR and SIEM via abnormal user account name.","attack.defense_evasion, attack.t1036","Not classified","windows","security","Investigate the source of the event by reviewing the EventID field in the Windows Security logs. 
Check if the event is related to a legitimate service account or a user account that has been intentionally renamed with a $ in the SamAccountName attribute. 
Review the SubjectUserName and NewTargetUserName fields to identify any suspicious or unauthorized activity. 
Cross-reference the event with other security logs, such as authentication logs or network logs, to gather additional context and determine if the event is part of a larger attack. 
If necessary, consult with the system or network administrator to verify the legitimacy of the user account or take appropriate action if it is determined to be malicious.","Service accounts with legitimate reasons for having $ in SamAccountName","source=""WinEventLog:Security"" (EventCode=4720 SamAccountName=""*$*"") OR (EventCode=4781 NewTargetUserName=""*$*"")"
"Possible PetitPotam Coerce Authentication Attempt","Mauricio Velazco, Michael Haag","Detect PetitPotam coerced authentication activity.","attack.credential_access, attack.t1187","Not classified","windows","security","Review the security event logs on the Windows systems for Event ID 5145. 
Look for events where the ShareName starts with \\\\ and ends with \IPC$. 
Check if the RelativeTargetName is lsarpc and the SubjectUserName is ANONYMOUS LOGON. 
Verify if the access to the IPC$ share and the use of the lsarpc service is expected and authorized. 
If the access is unexpected or unauthorized, investigate further to determine if it is a PetitPotam coerced authentication attempt.","Legitimate access to the IPC$ share by authorized users or systems. 
Legitimate use of the lsarpc service by authorized processes. 
False positives may occur if the detection rule is triggered by non-malicious activities that match the selection criteria.","source=""WinEventLog:Security"" EventCode=5145 ShareName=""\\\\*"" ShareName=""*\\IPC$"" RelativeTargetName=""lsarpc"" SubjectUserName=""ANONYMOUS LOGON"""
"PetitPotam Suspicious Kerberos TGT Request","Mauricio Velazco, Michael Haag","Detect suspicious Kerberos TGT requests.
Once an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes.
One way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus.
This request will generate a 4768 event with some unusual fields depending on the environment.
This analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts.
","attack.credential_access, attack.t1187","Not classified","windows","security","Check the Windows Security event logs for Event ID 4768. 
Look for events where the TargetUserName ends with $. 
Verify if the CertThumbprint field contains any value. 
Filter the Account_Name field to the Domain Controller computer accounts to reduce false positives. 
Investigate the source IP address of the event. In this case, check if the IP address is 1 (localhost). 
If the above conditions are met, further analysis is required to determine if the Kerberos TGT request is suspicious or not.","Environments using certificates for authentication may trigger false positives. 
Accounts with names ending in $ that are not related to PetitPotam attacks may trigger false positives.","source=""WinEventLog:Security"" EventCode=4768 TargetUserName=""*$"" CertThumbprint=""*"" NOT (IpAddress=""::1"" OR CertThumbprint="""")"
"PowerShell Scripts Installed as Services - Security","oscd.community, Natalia Shornikova","Detects powershell script installed as a Service","attack.execution, attack.t1569.002","Not classified","windows","security","Review the Event ID 4697 logs from the Windows Security event logs. 
Look for service names that contain powershell or pwsh. 
Check if the service installation was performed by a system administrator or authorized user. 
Verify if the service installation is associated with a legitimate software installation. 
Cross-reference with other logs such as process creation logs or command-line logs to identify any suspicious activity related to the PowerShell script installation.","Legitimate PowerShell scripts installed as services by system administrators or authorized users. 
PowerShell scripts installed as services by legitimate software installations.","source=""WinEventLog:Security"" EventCode=4697 ServiceFileName IN (""*powershell*"", ""*pwsh*"")"
"Protected Storage Service Access","Roberto Rodriguez @Cyb3rWard0g","Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers","attack.lateral_movement, attack.t1021.002","Not classified","windows","security","Review Windows Security event logs (Event ID 5145) for instances where the ShareName contains IPC and the RelativeTargetName is protected_storage. 
Check if the access to the protected_storage service is performed by authorized users or applications. 
Analyze the source IP address and user account associated with the access to determine if it aligns with expected behavior. 
Cross-reference the event with other security logs, such as authentication logs, to identify any suspicious or anomalous activity. 
If possible, gather additional context from network logs, such as firewall logs or network traffic captures, to understand the full scope of the access.","Legitimate access to the protected_storage service by authorized users or applications.","source=""WinEventLog:Security"" EventCode=5145 ShareName=""*IPC*"" RelativeTargetName=""protected_storage"""
"RDP over Reverse SSH Tunnel WFP","Samir Bousseaden","Detects svchost hosting RDP termsvcs communicating with the loopback address","attack.defense_evasion, attack.command_and_control, attack.lateral_movement, attack.t1090.001, attack.t1090.002, attack.t1021.001, car.2013-07-002","Not classified","windows","security","Check the security logs on the Windows system for Event ID 5156. 
Look for svchost processes hosting RDP termsvcs. 
Verify if the communication is with the loopback address (127.0.0.1 or 1). 
Check if the source or destination port is 3389. 
Investigate if the communication is originating from or destined to an AppContainer Loopback. 
Examine the application name to see if it ends with \thor.exe or \thor64.exe. 
Cross-reference the detected activity with other security events to identify any suspicious behavior or patterns.","Programs that connect locally to the RDP port","source=""WinEventLog:Security"" EventCode=5156 (SourcePort=3389 DestAddress IN (""127.*"", ""::1"")) OR (DestPort=3389 SourceAddress IN (""127.*"", ""::1"")) NOT (FilterOrigin=""AppContainer Loopback"" OR Application IN (""*\\thor.exe"", ""*\\thor64.exe""))"
"Register new Logon Process by Rubeus","Roberto Rodriguez (source), Ilyas Ochkov (rule), oscd.community","Detects potential use of Rubeus via registered new trusted logon process","attack.lateral_movement, attack.privilege_escalation, attack.t1558.003","Not classified","windows","security","Review Windows Security Event logs for Event ID 4611 with LogonProcessName User32LogonProcesss. 
Check for any legitimate use of Rubeus or other trusted logon processes in the environment. 
Correlate with other security events to identify any suspicious or malicious activities. 
Investigate any anomalies or deviations from normal behavior in the logon process.","Unknown","source=""WinEventLog:Security"" EventCode=4611 LogonProcessName=""User32LogonProcesss"""
"Remote PowerShell Sessions Network Connections (WinRM)","Roberto Rodriguez @Cyb3rWard0g","Detects basic PowerShell Remoting (WinRM) by monitoring for network inbound connections to ports 5985 OR 5986","attack.execution, attack.t1059.001","Not classified","windows","security","Review Windows Security event logs for Event ID 5156 with the destination port set to 5985 or 5986. 
Look for patterns of multiple inbound connections to these ports from different source IP addresses. 
Cross-reference the timestamps of the events with other logs, such as firewall logs or network traffic logs, to identify any suspicious activity. 
Check for any known legitimate use of remote PowerShell execution in your environment, such as system administration or remote management tools. 
If the connections are determined to be malicious, investigate the source IP addresses and any associated user accounts or processes for further analysis.","Legitimate use of remote PowerShell execution","source=""WinEventLog:Security"" EventCode=5156 DestPort IN (5985, 5986) LayerRTID=44"
"Replay Attack Detected","frack113","Detects possible Kerberos Replay Attack on the domain controllers when ""KRB_AP_ERR_REPEAT"" Kerberos response is sent to the client","attack.credential_access, attack.t1558","Not classified","windows","security","Investigate the source IP address of the client initiating the Kerberos authentication. Check if the client is a legitimate user or if it is associated with any suspicious activity or known malicious behavior. 
Review the timestamp of the event to determine if it coincides with any other suspicious or anomalous activity on the network. 
Check for any other related events or indicators of compromise (IOCs) that may indicate a larger attack campaign or ongoing security incident. 
Collect additional logs from the domain controllers, such as authentication logs, network logs, and endpoint logs, to gather more context and evidence of the potential replay attack. 
Consult with the network and system administrators to understand the normal Kerberos authentication patterns and identify any deviations or anomalies. 
If necessary, escalate the investigation to the incident response team or the appropriate security personnel for further analysis and response.","Legitimate use of Kerberos replay protection mechanisms may trigger this detection, such as when a client retries a failed authentication attempt.","source=""WinEventLog:Security"" EventCode=4649"
"SAM Registry Hive Handle Request","Roberto Rodriguez @Cyb3rWard0g","Detects handles requested to SAM registry hive","attack.discovery, attack.t1012, attack.credential_access, attack.t1552.002","Not classified","windows","security","Review the EventID 4656 logs from the Windows Security event logs. 
Look for instances where the ObjectType is Key and the ObjectName ends with \SAM. 
Check if the activity is performed by a legitimate user or process. 
Compare the activity with known administrative activities that involve accessing the SAM registry hive. 
If the activity is suspicious or performed by an unauthorized user or process, further investigation is required.","Legitimate administrative activity that involves accessing the SAM registry hive, such as system maintenance or configuration changes.","source=""WinEventLog:Security"" EventCode=4656 ObjectType=""Key"" ObjectName=""*\\SAM"""
"Service Installed By Unusual Client - Security","Tim Rauch","Detects a service installed by a client which has PID 0 or whose parent has PID 0","attack.privilege_escalation, attack.t1543","Not classified","windows","security","Not available","Not available","source=""WinEventLog:Security"" EventCode=4697 ClientProcessId=0 OR ParentProcessId=0"
"SMB Create Remote File Admin Share","Jose Rodriguez (@Cyb3rPandaH), OTR (Open Threat Research)","Look for non-system accounts SMB accessing a file with write (0x2) access mask via administrative share (i.e C$).","attack.lateral_movement, attack.t1021.002","Not classified","windows","security","Review the EventID 5145 logs from the Windows Security event log on the affected system(s). 
Look for non-system accounts accessing the C$ share with write (0x2) access mask. 
Verify if the access is legitimate by cross-referencing with authorized user accounts or system processes. 
Check if any suspicious or unauthorized activities are associated with the access.","Legitimate administrative access to the C$ share by authorized users or system processes.","source=""WinEventLog:Security"" EventCode=5145 ShareName=""*C$"" AccessMask=""0x2"" NOT SubjectUserName=""*$"""
"Win Susp Computer Name Containing Samtheadmin","elhoim","Detects suspicious computer name samtheadmin-{1..100}$ generated by hacktool","cve.2021.42278, cve.2021.42287, attack.persistence, attack.privilege_escalation, attack.t1078","Not classified","windows","security","Not available","Not available","source=""WinEventLog:Security"" (SamAccountName=""SAMTHEADMIN-*"" SamAccountName=""*$"") OR (TargetUserName=""SAMTHEADMIN-*"" TargetUserName=""*$"")"
"Password Change on Directory Service Restore Mode (DSRM) Account","Thomas Patzke","The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence.","attack.persistence, attack.t1098","Not classified","windows","security","Check Windows Security Event logs for Event ID 4794. 
Look for changes to the DSRM account password. 
Review the event details for the source IP address and user account associated with the password change.","Initial installation of a domain controller","source=""WinEventLog:Security"" EventCode=4794"
"Security Eventlog Cleared","Florian Roth (Nextron Systems)","One of the Windows Eventlogs has been cleared. e.g. caused by ""wevtutil cl"" command execution","attack.defense_evasion, attack.t1070.001, car.2016-04-002","Not classified","windows","security","Check the Event Viewer logs for Event ID 517 and 1102 in the Security log on Windows systems. 
Look for other suspicious activities or events that may be related to the log clearing, such as unusual command executions or changes in system configuration. 
Check for any evidence of unauthorized access or privilege escalation. 
Review the timeline of events leading up to and following the log clearing to identify any patterns or correlations. 
If possible, correlate the log clearing event with other security events or alerts from different log sources, such as network logs or endpoint logs, to gain a broader understanding of the incident.","Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog) 
System provisioning (system reset before the golden image creation)","source=""WinEventLog:Security"" (EventCode=517 Provider_Name=""Security"") OR (EventCode=1102 Provider_Name=""Microsoft-Windows-Eventlog"")"
"Kerberos Manipulation","Florian Roth (Nextron Systems)","This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages","attack.credential_access, attack.t1212","Not classified","windows","security","Investigate the source of the Kerberos Failure Codes in the provided EventIDs. Look for any suspicious activity or signs of manipulation in the Kerberos messages. 
Review the network logs for any abnormal traffic related to Kerberos authentication. 
Check for any unauthorized modifications or tampering with Kerberos tickets or tokens. 
Analyze the behavior of the affected user accounts and their associated activities. 
Cross-reference the detected Kerberos Failure Codes with other security events or indicators of compromise to identify any potential attack patterns or techniques.","Faulty legacy applications","source=""WinEventLog:Security"" EventCode IN (675, 4768, 4769, 4771) FailureCode IN (""0x9"", ""0xA"", ""0xB"", ""0xF"", ""0x10"", ""0x11"", ""0x13"", ""0x14"", ""0x1A"", ""0x1F"", ""0x21"", ""0x22"", ""0x23"", ""0x24"", ""0x26"", ""0x27"", ""0x28"", ""0x29"", ""0x2C"", ""0x2D"", ""0x2E"", ""0x2F"", ""0x31"", ""0x32"", ""0x3E"", ""0x3F"", ""0x40"", ""0x41"", ""0x43"", ""0x44"")"
"Suspicious LDAP-Attributes Used","xknow @xknow_infosec","Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies.","attack.t1001.003, attack.command_and_control","Not classified","windows","security","Check the Event ID 5136 in the Windows Security logs 
Look for events where the AttributeLDAPDisplayName matches any of the suspicious values primaryInternationalISDNNumber, otherFacsimileTelephoneNumber, primaryTelexNumber 
Analyze the associated user or object that triggered the event 
Cross-reference the event with other security logs to identify any suspicious or malicious activities 
If necessary, investigate the network traffic and communication patterns of the user or object involved in the LDAP exchange 
Consult with the organizations LDAP administrators or security team to validate the legitimacy of the LDAP activity","Companies that use these default LDAP-Attributes for legitimate purposes","source=""WinEventLog:Security"" EventCode=5136 AttributeValue=""*"" AttributeLDAPDisplayName IN (""primaryInternationalISDNNumber"", ""otherFacsimileTelephoneNumber"", ""primaryTelexNumber"")"
"Suspicious Windows ANONYMOUS LOGON Local Account Created","James Pemberton / @4A616D6573","Detects the creation of suspicious accounts similar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts.","attack.persistence, attack.t1136.001, attack.t1136.002","Not classified","windows","security","Check the Event Viewer logs on the Windows Security event log for Event ID 4720. 
Look for the SamAccountName field in the event log entry to identify the account name. 
Verify if the account creation is expected and authorized by the organization. 
If the account creation is unexpected or suspicious, investigate further by checking the associated IP address, timestamp, and other relevant details. 
Cross-reference the account creation with other security events or logs to identify any related suspicious activities.","Legitimate creation of accounts with names containing ANONYMOUS LOGON for specific business purposes. 
Creation of accounts with names containing ANONYMOUS LOGON during system installation or configuration processes.","source=""WinEventLog:Security"" EventCode=4720 SamAccountName=""*ANONYMOUS*"" SamAccountName=""*LOGON*"""
"Password Dumper Activity on LSASS","sigma","Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN","attack.credential_access, attack.t1003.001","Not classified","windows","security","Investigate the process that triggered the event by reviewing the associated logs and gathering additional context. Look for any suspicious behavior or anomalies in the process activity. 
Check if the process accessing LSASS with the specified access mask and object type is a known legitimate process or if it is associated with any known security tools or applications. 
Review the user account associated with the process and check for any signs of compromise or unauthorized access. 
Correlate the event with other security events or indicators of compromise to identify any related malicious activity. 
If possible, analyze memory dumps or perform forensic analysis on the system to identify any artifacts or evidence of password dumping activity.","Legitimate administrative activity that involves accessing LSASS with the specified access mask and object type.","source=""WinEventLog:Security"" EventCode=4656 ProcessName=""*\\lsass.exe"" AccessMask=""0x705"" ObjectType=""SAM_DOMAIN"""
"Reconnaissance Activity","Florian Roth (Nextron Systems), Jack Croock (method), Jonhnathan Ribeiro (improvements), oscd.community","Detects activity as ""net user administrator /domain"" and ""net group domain admins /domain""","attack.discovery, attack.t1087.002, attack.t1069.002, attack.s0039","Not classified","windows","security","Check the Windows Security event logs on the Domain Controllers for Event ID 4661 
Look for the AccessMask value of 0x2d 
Verify that the ObjectType is either SAM_USER or SAM_GROUP 
Check if the ObjectName starts with ""S-1-5-21-"" and ends with either ""-500"" or ""-512"" 
Review the context of the event to determine if it matches the reconnaissance activity described in the rule","Administrator activity","source=""WinEventLog:Security"" EventCode=4661 AccessMask=""0x2d"" ObjectType IN (""SAM_USER"", ""SAM_GROUP"") ObjectName=""S-1-5-21-*"" ObjectName IN (""*-500"", ""*-512"")"
"Password Protected ZIP File Opened (Suspicious Filenames)","Florian Roth (Nextron Systems)","Detects the extraction of password protected ZIP archives with suspicious file names. See the filename variable for more details on which file has been opened.","attack.command_and_control, attack.defense_evasion, attack.t1027, attack.t1105, attack.t1036","Not classified","windows","security","Check the EventID 5379 in the Windows Security event logs 
Look for the TargetName field containing Microsoft_Windows_Shell_ZipFolderfilename 
Examine the filename variable to identify the specific file that was opened 
Verify if the file has suspicious keywords such as invoice, new order, rechnung, factura, delivery, purchase, order, payment 
Cross-reference the file with other logs or sources to gather more context, such as the user who opened the file, the source IP address, or the time of the event 
If necessary, investigate the file further by analyzing its content or performing additional forensic analysis","Legitimate use of encrypted ZIP files for secure file transfer or storage 
Legitimate use of password-protected ZIP files for sensitive data protection","source=""WinEventLog:Security"" EventCode=5379 TargetName=""*Microsoft_Windows_Shell_ZipFolder:filename*"" TargetName IN (""*invoice*"", ""*new order*"", ""*rechnung*"", ""*factura*"", ""*delivery*"", ""*purchase*"", ""*order*"", ""*payment*"")"
"Password Protected ZIP File Opened (Email Attachment)","Florian Roth (Nextron Systems)","Detects the extraction of password protected ZIP archives. See the filename variable for more details on which file has been opened.","attack.defense_evasion, attack.initial_access, attack.t1027, attack.t1566.001","Not classified","windows","security","Review the logs from the Windows Security event logs with EventID 5379. 
Look for the TargetName field in the logs to identify the file that was opened. 
Check if the file is located in the \Temporary Internet Files\Content.Outlook directory. 
Verify if the file is a password protected ZIP archive. 
Investigate the user account associated with the event to determine if it is authorized to open password protected ZIP files. 
If necessary, interview the user to gather additional information about the file and its source.","Legitimate use of encrypted ZIP files","source=""WinEventLog:Security"" EventCode=5379 TargetName=""*Microsoft_Windows_Shell_ZipFolder:filename*"" TargetName=""*\\Temporary Internet Files\\Content.Outlook*"""
"Suspicious Outbound Kerberos Connection - Security","Ilyas Ochkov, oscd.community","Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.","attack.lateral_movement, attack.t1558.003","Not classified","windows","security","Check the source and destination IP addresses to identify the systems involved in the suspicious outbound connection. 
Review the EventID 5156 logs to gather more information about the connection. 
Analyze the process/application mentioned in the Application field of the logs to determine if it is legitimate or potentially malicious. 
Cross-reference the timestamp of the event with other security logs to identify any related suspicious activities or indicators of compromise. 
Inspect the network traffic logs to identify any other suspicious activities or communication patterns involving the source or destination IP addresses. 
If possible, perform endpoint analysis on the systems involved to identify any signs of compromise or malicious activity. 
Consult threat intelligence sources and security forums to check if similar outbound Kerberos connections have been reported as part of known attack campaigns.","Web Browsers","source=""WinEventLog:Security"" EventCode=5156 DestPort=88 NOT (Application IN (""C:\\Windows\\System32\\lsass.exe"", ""C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"", ""C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"", ""C:\\Program Files\\Mozilla Firefox\\firefox.exe"", ""C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe""))"
"Possible Shadow Credentials Added","Nasreddine Bencherchali (Nextron Systems), Elastic (idea)","Detects possible addition of shadow credentials to an active directory object.","attack.credential_access, attack.t1556","Not classified","windows","security","Check the Event ID 5136 in the Windows Security logs. 
Look for the AttributeLDAPDisplayName field with the value msDS-KeyCredentialLink. 
Verify the source IP address and user account associated with the event. 
Cross-reference the event with other logs, such as authentication logs, to determine if the activity is suspicious. 
If the modification is performed by the Azure AD Connect synchronization account or the ADFS service account, it can be considered a known false positive.","Modifications in the msDS-KeyCredentialLink attribute can be done legitimately by the Azure AD Connect synchronization account or the ADFS service account. These accounts can be added as Exceptions.","source=""WinEventLog:Security"" EventCode=5136 AttributeLDAPDisplayName=""msDS-KeyCredentialLink"""
"Suspicious PsExec Execution","Samir Bousseaden","detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one","attack.lateral_movement, attack.t1021.002","Not classified","windows","security","Check the EventID 5145 logs from the Windows Security event logs 
Look for events where the ShareName is \\*\IPC$ and the RelativeTargetName ends with -stdin, -stdout, or -stderr 
Exclude events where the RelativeTargetName starts with PSEXESVC 
Analyze the process and command-line arguments associated with the event to determine if it is a suspicious PsExec execution 
Cross-reference the event with other relevant logs, such as process creation logs, network logs, and endpoint logs, to gather additional context and evidence of malicious activity","Legitimate use of psexec or paexec with renamed service name 
Use of a different psexec client other than the sysinternal one 
Execution of legitimate scripts or tools that have names starting with PSEXESVC","source=""WinEventLog:Security"" EventCode=5145 ShareName=""\\\\\*\\IPC$"" RelativeTargetName IN (""*-stdin"", ""*-stdout"", ""*-stderr"") NOT RelativeTargetName=""PSEXESVC*"""
"Suspicious Scheduled Task Creation","Nasreddine Bencherchali (Nextron Systems)","Detects suspicious scheduled task creation events. Based on attributes such as paths, commands line flags, etc.","attack.execution, attack.privilege_escalation, attack.persistence, attack.t1053.005","Not classified","windows","security","Check the Event ID 4698 in the Windows Security event logs. 
Look for scheduled task creation events that match the specified paths in the TaskContent field. For example, you can search for events where the TaskContent contains \AppData\Local\Temp\ or C\ProgramData\. 
Analyze the Command field extracted from the embedded XML in the event data. Look for suspicious commands such as regsvr32, powershell, mshta, etc. 
Compare the detected scheduled tasks with a baseline of authorized scheduled tasks to identify any anomalies. 
Review the documentation and authorization for any legitimate software installations or updates that may have triggered the rule. 
Cross-reference the TaskContent and Command fields with known legitimate scheduled tasks to eliminate false positives. 
If necessary, investigate further by analyzing the behavior and impact of the suspicious scheduled task.","Legitimate scheduled tasks created by system administrators or authorized users may trigger this rule. It is important to have a baseline of authorized scheduled tasks to distinguish them from suspicious ones. 
Scheduled tasks created by legitimate software installations or updates may also trigger this rule. Ensure that the software installations and updates are properly documented and authorized. 
False positives may occur if the TaskContent field in the event data contains keywords or paths that are commonly used by legitimate scheduled tasks. Review the TaskContent field and cross-reference with known legitimate scheduled tasks. 
False positives may occur if the Command field extracted from the embedded XML in the event data contains keywords or commands that are commonly used by legitimate scheduled tasks. Review the Command field and cross-reference with known legitimate scheduled tasks.","source=""WinEventLog:Security"" EventCode=4698 TaskContent IN (""*\\AppData\\Local\\Temp\\*"", ""*\\AppData\\Roaming\\*"", ""*\\Users\\Public\\*"", ""*\\WINDOWS\\Temp\\*"", ""*C:\\Temp\\*"", ""*\\Desktop\\*"", ""*\\Downloads\\*"", ""*\\Temporary Internet*"", ""*C:\\ProgramData\\*"", ""*C:\\Perflogs\\*"") TaskContent IN (""*regsvr32*"", ""*rundll32*"", ""*cmd.exe</Command>*"", ""*cmd</Command>*"", ""*<Arguments>/c *"", ""*<Arguments>/k *"", ""*<Arguments>/r *"", ""*powershell*"", ""*pwsh*"", ""*mshta*"", ""*wscript*"", ""*cscript*"", ""*certutil*"", ""*bitsadmin*"", ""*bash.exe*"", ""*bash *"", ""*scrcons*"", ""*wmic *"", ""*wmic.exe*"", ""*forfiles*"", ""*scriptrunner*"", ""*hh.exe*"")"
"Suspicious Scheduled Task Update","Nasreddine Bencherchali (Nextron Systems)","Detects update to a scheduled task event that contain suspicious keywords.","attack.execution, attack.privilege_escalation, attack.persistence, attack.t1053.005","Not classified","windows","security","Check the event logs for Event ID 4702 
Look for scheduled task updates that match the specified paths and contain the suspicious keywords 
Review the associated event data to extract the Command field and analyze the executed command 
Cross-reference the scheduled task update with authorized changes made by system administrators or authorized personnel 
Verify if the scheduled task update is related to a legitimate software installation or update","Legitimate scheduled task updates that contain the suspicious keywords 
Scheduled task updates performed by system administrators or authorized personnel 
Scheduled task updates triggered by legitimate software installations or updates","source=""WinEventLog:Security"" EventCode=4702 TaskContentNew IN (""*\\AppData\\Local\\Temp\\*"", ""*\\AppData\\Roaming\\*"", ""*\\Users\\Public\\*"", ""*\\WINDOWS\\Temp\\*"", ""*C:\\Temp\\*"", ""*\\Desktop\\*"", ""*\\Downloads\\*"", ""*\\Temporary Internet*"", ""*C:\\ProgramData\\*"", ""*C:\\Perflogs\\*"") TaskContentNew IN (""*regsvr32*"", ""*rundll32*"", ""*cmd.exe</Command>*"", ""*cmd</Command>*"", ""*<Arguments>/c *"", ""*<Arguments>/k *"", ""*<Arguments>/r *"", ""*powershell*"", ""*pwsh*"", ""*mshta*"", ""*wscript*"", ""*cscript*"", ""*certutil*"", ""*bitsadmin*"", ""*bash.exe*"", ""*bash *"", ""*scrcons*"", ""*wmic *"", ""*wmic.exe*"", ""*forfiles*"", ""*scriptrunner*"", ""*hh.exe*"")"
"SysKey Registry Keys Access","Roberto Rodriguez @Cyb3rWard0g","Detects handle requests and access operations to specific registry keys to calculate the SysKey","attack.discovery, attack.t1012","Not classified","windows","security","Review the Event ID 4656 and 4663 logs from the Windows Security event log. 
Look for events where the ObjectType is key and the ObjectName ends with lsa\JD, lsa\GBG, lsa\Skew1, or lsa\Data. 
Check the account associated with the event to determine if it is a legitimate user or process. 
Verify if the access to the registry keys aligns with any known system updates, installations, or monitoring activities. 
Cross-reference the event with other security logs or system logs to gather additional context. 
If necessary, consult with the user or process owner to confirm the legitimacy of the access.","Legitimate access to the specific registry keys by authorized users or processes. 
Access to the registry keys during system updates or installations. 
Access to the registry keys by system monitoring or auditing tools.","source=""WinEventLog:Security"" EventCode IN (4656, 4663) ObjectType=""key"" ObjectName IN (""*lsa\\JD"", ""*lsa\\GBG"", ""*lsa\\Skew1"", ""*lsa\\Data"")"
"Sysmon Channel Reference Deletion","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Potential threat actor tampering with Sysmon manifest and eventually disabling it","attack.defense_evasion, attack.t1112","Not classified","windows","security","Check Windows Security Event Logs for Event ID 4657 and 4663 with the specified ObjectName and ObjectValueName. 
Verify if the changes to the Sysmon manifest and channel reference were made by authorized personnel or if they are suspicious in nature. 
Review any related logs or events that may provide additional context or evidence of malicious activity. 
Cross-reference with other security controls or indicators to determine if the changes align with known legitimate actions or if they indicate a potential compromise.","Legitimate changes to Sysmon configuration","source=""WinEventLog:Security"" (EventCode=4657 ObjectName IN (""*WINEVT\\Publishers\\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}*"", ""*WINEVT\\Channels\\Microsoft-Windows-Sysmon/Operational*"") ObjectValueName=""Enabled"" NewValue=0) OR (EventCode=4663 ObjectName IN (""*WINEVT\\Publishers\\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}*"", ""*WINEVT\\Channels\\Microsoft-Windows-Sysmon/Operational*"") AccessMask=65536)"
"Suspicious Teams Application Related ObjectAcess Event","@SerkinValery","Detects an access to authentication tokens and accounts of Microsoft Teams desktop application.","attack.credential_access, attack.t1528","Not classified","windows","security","Review the EventID 4663 logs from the Windows Security event logs on the affected system. 
Look for the presence of the ObjectName containing \Microsoft\Teams\Cookies or \Microsoft\Teams\Local Storage\leveldb. 
Verify if the ProcessName contains \Microsoft\Teams\current\Teams.exe. 
Check if the access is performed by authorized users or system processes. 
Cross-reference with other logs such as authentication logs or network logs to identify any suspicious activities or anomalies. 
If necessary, escalate the investigation to the appropriate teams for further analysis.","Legitimate access by authorized users or system processes.","source=""WinEventLog:Security"" EventCode=4663 ObjectName IN (""*\\Microsoft\\Teams\\Cookies*"", ""*\\Microsoft\\Teams\\Local Storage\\leveldb*"") NOT ProcessName=""*\\Microsoft\\Teams\\current\\Teams.exe*"""
"User Couldn't Call a Privileged Service 'LsaRegisterLogonProcess'","Roberto Rodriguez (source), Ilyas Ochkov (rule), oscd.community","The 'LsaRegisterLogonProcess' function verifies that the application making the function call is a logon process by checking that it has the SeTcbPrivilege privilege set. Possible Rubeus tries to get a handle to LSA.","attack.lateral_movement, attack.privilege_escalation, attack.t1558.003","Not classified","windows","security","Check the Event ID 4673 logs in the Windows Security event logs 
Look for the LsaRegisterLogonProcess() service in the logs 
Identify the process and account associated with the service call 
Verify if the process making the call has the SeTcbPrivilege privilege set 
Cross-reference with known authorized logon processes and trusted system components 
Investigate any suspicious or unauthorized processes making the service call","Legitimate usage of LsaRegisterLogonProcess by authorized logon processes 
Legitimate usage of LsaRegisterLogonProcess by trusted system components","source=""WinEventLog:Security"" EventCode=4673 Service=""LsaRegisterLogonProcess()"" Keywords=""0x8010000000000000"""
"T1047 Wmiprvse Wbemcomn DLL Hijack","Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR)","Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network for a WMI DLL Hijack scenario.","attack.execution, attack.t1047, attack.lateral_movement, attack.t1021.002","Not classified","windows","security","Check the process that created the `wbemcomn.dll` file. If it is a known legitimate process, it may be a false positive. If it is an unknown or suspicious process, further investigation is required. 
Review the EventID 5145 logs to gather additional information about the event, such as the user account associated with the creation of the file and the source IP address. 
Cross-reference the event with other logs, such as network logs, to identify any suspicious network activity associated with the creation of the `wbemcomn.dll` file. 
Check for any other indicators of compromise (IOCs) associated with WMI DLL hijacking, such as unusual process behavior or modifications to other system files. 
Consult with the system owner or application administrator to determine if any legitimate software installations or updates occurred around the time of the detection.","Legitimate software installation or update that involves creating the `wbemcomn.dll` file in the `C\Windows\System32\wbem\` directory.","source=""WinEventLog:Security"" EventCode=5145 RelativeTargetName=""*\\wbem\\wbemcomn.dll"" NOT SubjectUserName=""*$"""
"DiagTrackEoP Default Login Username","Nasreddine Bencherchali (Nextron Systems)","Detects the default ""UserName"" used by the DiagTrackEoP POC","attack.privilege_escalation","Not classified","windows","security","Review the Windows Security Event Log (EID 4624) for matched events. 
Examine the ""TargetOutboundUserName"" field in the event to identify the username used. 
Cross-reference the detected events with other security data sources to verify the legitimacy of the login attempt. 
Consider checking the log source for any known, legitimate processes or services that may use the specified username. 
Evaluate the context and any additional information available to confirm the authenticity of the detection.","This rule may generate false positives if legitimate security events use the same ""TargetOutboundUserName"" value. Investigate further to confirm any positive matches.","source=""WinEventLog:Security"" EventCode=4624 LogonType=9 TargetOutboundUserName=""thisisnotvaliduser"""
"Successful Overpass the Hash Attempt","Roberto Rodriguez (source), Dominik Schaudel (rule)","Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz's sekurlsa::pth module.","attack.lateral_movement, attack.s0002, attack.t1550.002","Not classified","windows","security","Check Windows Security event logs for Event ID 4624 with LogonType 9 and LogonProcessName seclogo and AuthenticationPackageName Negotiate. 
Look for any suspicious logon activity with these specific parameters, as it may indicate a successful Overpass the Hash attempt. 
Review the associated user account and source IP address to determine if the activity is legitimate or potentially malicious. 
Cross-reference the event with other security logs, such as network logs or endpoint logs, to gather additional context and evidence of compromise.","Runas command-line tool using /netonly parameter","source=""WinEventLog:Security"" EventCode=4624 LogonType=9 LogonProcessName=""seclogo"" AuthenticationPackageName=""Negotiate"""
"Scanner PoC for CVE-2019-0708 RDP RCE Vuln","Florian Roth (Nextron Systems), Adam Bradbury (idea)","Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to  CVE-2019-0708 RDP RCE aka BlueKeep","attack.lateral_movement, attack.t1210, car.2013-07-002","Not classified","windows","security","Check the EventID 4625 logs from the Windows Security event logs. 
Look for the TargetUserName field in the logs to identify the username associated with the event. 
Verify if the user AAAAAAA is performing any suspicious or unauthorized activities on the system. 
Cross-reference the activity with other logs such as network logs, process logs, or file access logs to gather more context and determine if it is a legitimate action or a potential security threat.","User with the username AAAAAAA is performing legitimate actions on the system.","source=""WinEventLog:Security"" EventCode=4625 TargetUserName=""AAAAAAA"""
"RDP Login from Localhost","Thomas Patzke","RDP login with localhost source address may be a tunnelled login","attack.lateral_movement, car.2013-07-002, attack.t1021.001","Not classified","windows","security","Review Windows Security Event logs for Event ID 4624 with Logon Type 10 and source IP address of 1 or 127.0.0.1 
Check for legitimate reasons for RDP connections from localhost, such as administrative tasks or remote management tools","Legitimate RDP connections from localhost","source=""WinEventLog:Security"" EventCode=4624 LogonType=10 IpAddress IN (""::1"", ""127.0.0.1"")"
"Remote WMI ActiveScriptEventConsumers","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Detect potential adversaries leveraging WMI ActiveScriptEventConsumers remotely to move laterally in a network","attack.lateral_movement, attack.privilege_escalation, attack.persistence, attack.t1546.003","Not classified","windows","security","Check for legitimate use of WMI ActiveScriptEventConsumers by SCCM or other authorized systems. 
Review the EventID 4624 logs with LogonType 3 and ProcessName ending with scrcons.exe. 
Look for any suspicious or unauthorized use of WMI ActiveScriptEventConsumers. 
Cross-reference with other logs such as process creation logs, network logs, and file system logs to identify any anomalous behavior. 
Investigate any instances where WMI ActiveScriptEventConsumers are used remotely to move laterally in the network. 
Consider checking for any other indicators of compromise (IOCs) associated with lateral movement or privilege escalation.","SCCM","source=""WinEventLog:Security"" EventCode=4624 LogonType=3 ProcessName=""*scrcons.exe"" NOT TargetLogonId=""0x3e7"""
"KrbRelayUp Attack Pattern","@SBousseaden, Florian Roth","Detects logon events that have characteristics of events generated during an attack with KrbRelayUp and the like","attack.privilege_escalation, attack.credential_access","Not classified","windows","security","To investigate this rule, you can analyze the following log sources 
Windows Security Event Logs Look for Event ID 4624 with Logon Type 3 and the Kerberos authentication package. 
Network logs Check for suspicious network traffic related to Kerberos authentication, such as unusual authentication requests or excessive failed authentication attempts. 
Active Directory logs Monitor for any changes or anomalies in user accounts, group memberships, or privilege escalation activities. 
Endpoint logs Analyze endpoint logs for any suspicious activities or processes related to privilege escalation or credential access. 
SIEM correlation Correlate the KrbRelayUp detection with other security events and alerts to identify any potential attack patterns or indicators of compromise.","Legitimate Kerberos logon events from trusted sources may trigger this rule. For example, when a legitimate user logs on to a Windows system using Kerberos authentication, it will generate Event ID 4624 with Logon Type 3 and the Kerberos authentication package.","source=""WinEventLog:Security"" EventCode=4624 LogonType=3 AuthenticationPackageName=""Kerberos"" IpAddress=""127.0.0.1"" TargetUserSid=""S-1-5-21-*"" TargetUserSid=""*-500"""
"RottenPotato Like Attack Pattern","@SBousseaden, Florian Roth","Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like","attack.privilege_escalation, attack.credential_access, attack.t1557.001","Not classified","windows","security","To investigate this rule, you can analyze the following log sources 
Windows Security Event Logs Look for Event ID 4624 with LogonType 3 and TargetUserName ANONYMOUS LOGON. Analyze the other fields in the log event to determine if it matches the characteristics of a RottenPotato-like attack. 
Network logs Check for network traffic originating from the IP addresses 127.0.0.1 and 1 during the time of the logon event. Look for any suspicious connections or communication patterns. 
Endpoint logs Review endpoint logs for any suspicious activities or processes running during the time of the logon event. Pay attention to any privilege escalation or credential access attempts. 
User activity logs Monitor user activity logs to identify any abnormal behavior or actions performed by the TargetUserName ANONYMOUS LOGON. Look for any unauthorized access attempts or unusual activity patterns.","Legitimate logon events from authorized users with the LogonType 3 and TargetUserName ANONYMOUS LOGON may trigger this rule. It is important to investigate the context and other log events related to the logon event to determine if it is a false positive.","source=""WinEventLog:Security"" EventCode=4624 LogonType=3 TargetUserName=""ANONYMOUS LOGON"" WorkstationName=""-"" IpAddress IN (""127.0.0.1"", ""::1"")"
"HackTool - CACTUSTORCH Remote Thread Creation","@SBousseaden (detection), Thomas Patzke (rule)","Detects remote thread creation from CACTUSTORCH as described in references.","attack.defense_evasion, attack.execution, attack.t1055.012, attack.t1059.005, attack.t1059.007, attack.t1218.005","create_remote_thread","windows","Not classified","Investigate the process that initiated the remote thread creation and determine if it is a known legitimate process or if it is associated with suspicious or malicious activity. 
Review the command-line arguments and parameters used by the process to identify any suspicious or unauthorized activity. 
Check if the remote thread creation is part of a known software installation or system maintenance procedure. 
Correlate the remote thread creation event with other security events and logs to identify any patterns or indicators of compromise. 
Consult threat intelligence sources and security forums to check if the remote thread creation technique is being used by known threat actors or malware.","Legitimate use of remote thread creation for legitimate purposes such as software installation or system maintenance.","SourceImage IN (""*\\System32\\cscript.exe"", ""*\\System32\\wscript.exe"", ""*\\System32\\mshta.exe"", ""*\\winword.exe"", ""*\\excel.exe"") TargetImage=""*\\SysWOW64\\*"" StartModule!=*"
"HackTool - Potential CobaltStrike Process Injection","Olaf Hartong, Florian Roth (Nextron Systems), Aleksey Potapov, oscd.community","Detects a potential remote threat creation with certain characteristics which are typical for Cobalt Strike beacons","attack.defense_evasion, attack.t1055.001","create_remote_thread","windows","Not classified","Investigate the process that triggered the detection and analyze its behavior and parent-child relationships. 
Check if the process is a known legitimate process that commonly uses remote thread creation. 
Review the processs command-line arguments and loaded modules for any suspicious or malicious activity. 
Correlate the detection with other security events and logs, such as network traffic logs or endpoint logs, to gather more context. 
If available, check for any indicators of compromise (IOCs) associated with Cobalt Strike beacons, such as known IP addresses or domain names. 
Consult threat intelligence sources to check if there are any known campaigns or indicators related to Cobalt Strike.","Legitimate use of remote thread creation for legitimate purposes such as debugging or software development","StartAddress IN (""*0B80"", ""*0C7C"", ""*0C88"")"
"CreateRemoteThread API and LoadLibrary","Roberto Rodriguez @Cyb3rWard0g","Detects potential use of CreateRemoteThread api and LoadLibrary function to inject DLL into a process","attack.defense_evasion, attack.t1055.001","create_remote_thread","windows","Not classified","Review process creation events (e.g., Event ID 4688) to identify the parent process and command-line arguments used for CreateRemoteThread and LoadLibrary calls. 
Analyze DLL injection techniques in conjunction with other suspicious activities or indicators of compromise (IOCs) to determine if the behavior is malicious. 
Check for any abnormal network connections or communication patterns associated with the process that performed the CreateRemoteThread and LoadLibrary calls. 
Inspect the process memory for injected DLLs using memory analysis tools like Volatility or YARA rules. 
Monitor for any abnormal behavior or system instability that may indicate a successful DLL injection.","Legitimate use of CreateRemoteThread and LoadLibrary for system processes or authorized software installations.","StartModule=""*\\kernel32.dll"" StartFunction=""LoadLibraryA"""
"Password Dumper Remote Thread in LSASS","Thomas Patzke","Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage.
The process in field Process is the malicious program. A single execution can lead to hundreds of events.
","attack.credential_access, attack.s0005, attack.t1003.001","create_remote_thread","windows","Not classified","Check for multiple events with the same Process field value within a short time frame. 
Review the associated EventID 8 events to identify the source of the remote thread creation. 
Analyze the process tree to determine if the remote thread creation is part of a legitimate activity or if it is suspicious. 
Correlate with other security events such as failed login attempts or unusual network traffic originating from the same source. 
Inspect the lsass.exe process for any signs of compromise, such as unexpected network connections or abnormal behavior. 
Collect memory dumps or perform forensic analysis on the system to identify any artifacts related to password dumping tools or techniques.","Antivirus products","TargetImage=""*\\lsass.exe"" StartModule="""""
"Potential Credential Dumping Attempt Via PowerShell Remote Thread","oscd.community, Natalia Shornikova","Detects remote thread creation by PowerShell processes into ""lsass.exe""","attack.credential_access, attack.t1003.001","create_remote_thread","windows","Not classified","Check for scheduled tasks that create remote threads into lsass.exe 
Review PowerShell remoting activity for administrative purposes 
Analyze network traffic for any suspicious PowerShell activity targeting lsass.exe 
Inspect PowerShell logs for any abnormal usage of remote thread creation","Scheduled task that legitimately creates a remote thread into lsass.exe 
Legitimate use of PowerShell remoting for administrative purposes","SourceImage IN (""*\\powershell.exe"", ""*\\pwsh.exe"") TargetImage=""*\\lsass.exe"""
"Remote Thread Creation Ttdinject.exe Proxy","frack113","Detects a remote thread creation of Ttdinject.exe used as proxy","attack.defense_evasion, attack.t1127","create_remote_thread","windows","Not classified","Check for any legitimate use of Ttdinject.exe as a proxy tool in your environment. 
Review process creation logs for instances of Ttdinject.exe being created remotely. 
Analyze network traffic logs for any suspicious communication involving Ttdinject.exe. 
Cross-reference with other security events or alerts to identify any related indicators of compromise.","Unknown","SourceImage=""*\\ttdinject.exe"""
"Exports Registry Key To an Alternate Data Stream","Oddvar Moe, Sander Wiebing, oscd.community","Exports the target Registry key and hides it in the specified alternate data stream.","attack.defense_evasion, attack.t1564.004","create_stream_hash","windows","Not classified","Check for legitimate use of regedit.exe to export registry keys by trusted users or system processes. 
Look for any suspicious or unauthorized use of regedit.exe to export registry keys by non-standard users or processes. 
Cross-reference the exported registry keys with known good configurations or baselines to identify any anomalies or unauthorized changes.","Legitimate use of regedit.exe to export registry keys","Image=""*\\regedit.exe"""
"DNS HybridConnectionManager Service Bus","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Detects Azure Hybrid Connection Manager services querying the Azure service bus service","attack.persistence, attack.t1554","dns_query","windows","Not classified","Check if the DNS query is originating from a legitimate source within the organizations network. 
Verify if the Azure Hybrid Connection Manager and the Azure Service Bus service are being used for legitimate purposes. 
Review the network traffic logs to identify any suspicious or unauthorized activities related to the Azure Hybrid Connection Manager and the Azure Service Bus service.","Legitimate use of Azure Hybrid Connection Manager and the Azure Service Bus service","QueryName=""*servicebus.windows.net*"" Image=""*HybridConnectionManager*"""
"Suspicious Cobalt Strike DNS Beaconing - Sysmon","Florian Roth (Nextron Systems)","Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons","attack.command_and_control, attack.t1071.004","dns_query","windows","Not classified","Review DNS query logs from Windows DNS servers for queries matching the suspicious patterns mentioned in the rule. 
Analyze network traffic logs for DNS queries with similar patterns originating from other sources. 
Inspect the Image and CommandLine fields in the logs to identify the program responsible for the suspicious DNS queries.","Unknown","QueryName IN (""aaa.stage.*"", ""post.1*"") OR QueryName=""*.stage.123456.*"""
"Credential Dumping Tools Service Execution","Florian Roth (Nextron Systems), Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community","Detects well-known credential dumping tools execution via service execution events","attack.credential_access, attack.execution, attack.t1003.001, attack.t1003.002, attack.t1003.004, attack.t1003.005, attack.t1003.006, attack.t1569.002, attack.s0005","driver_load","windows","Not classified","Check for the presence of the detected service execution events in the Windows Event Logs, specifically the driver_load category. 
Review the associated process and command line arguments to determine if it matches any known credential dumping tools. 
Cross-reference the event timestamp with other security logs to identify any suspicious or malicious activities associated with the detected service execution.","Legitimate Administrator using credential dumping tool for password recovery","ImageLoaded IN (""*cachedump*"", ""*dumpsvc*"", ""*fgexec*"", ""*gsecdump*"", ""*mimidrv*"", ""*pwdump*"", ""*servpw*"")"
"PowerShell Scripts Run by a Services","oscd.community, Natalia Shornikova","Detects powershell script installed as a Service","attack.execution, attack.t1569.002","driver_load","windows","Not classified","Review Windows Event Logs for events related to service creation and execution, such as Event ID 7045 (Service Creation) and Event ID 7046 (Service State Change). Look for PowerShell or pwsh in the ImagePath field of the event.","Legitimate PowerShell scripts executed as services","ImageLoaded IN (""*powershell*"", ""*pwsh*"")"
"Suspicious Driver Load from Temp","Florian Roth (Nextron Systems)","Detects a driver load from a temporary directory","attack.persistence, attack.privilege_escalation, attack.t1543.003","driver_load","windows","Not classified","Review the logs from the Windows Event Log, specifically the Microsoft-Windows-DriverFrameworks-UserMode/Operational log, for events related to driver loads from temporary directories. 
Look for events with the ImageLoaded field containing the \Temp\ string. 
Cross-reference the events with known legitimate software installations or updates that may load drivers from temporary directories. 
Investigate any events that do not match known legitimate software installations or updates. 
Check the file path and name of the driver being loaded to determine if it is suspicious or malicious. 
If necessary, analyze the driver file using antivirus or other security tools to identify any potential threats.","Legitimate software installations or updates that load drivers from temporary directories","ImageLoaded=""*\\Temp\\*"""
"Vulnerable HackSys Extreme Vulnerable Driver Load","Nasreddine Bencherchali (Nextron Systems)","Detects the load of HackSys Extreme Vulnerable Driver which is an intentionally vulnerable Windows driver developed for security enthusiasts to learn and polish their exploitation skills at Kernel level and often abused by threat actors","attack.privilege_escalation, attack.t1543.003","driver_load","windows","Not classified","Check Windows event logs for driver load events with the image name ending with \HEVD.sys. 
Review Sysmon logs for processes with the specified IMPHASH values. 
Inspect other log sources that capture driver load events and check for the specified IMPHASH values.","Unlikely","ImageLoaded=""*\\HEVD.sys"" OR Hashes IN (""*IMPHASH=f26d0b110873a1c7d8c4f08fbeab89c5*"", ""*IMPHASH=c46ea2e651fd5f7f716c8867c6d13594*"") OR Imphash IN (""f26d0b110873a1c7d8c4f08fbeab89c5"", ""c46ea2e651fd5f7f716c8867c6d13594"")"
"Vulnerable WinRing0 Driver Load","Florian Roth (Nextron Systems)","Detects the load of a signed WinRing0 driver often used by threat actors, crypto miners (XMRIG) or malware for privilege escalation","attack.privilege_escalation, attack.t1543.003","driver_load","windows","Not classified","Check Windows Event Logs for driver load events with the following image names WinRing0x64.sys, WinRing0.sys, WinRing0.dll, WinRing0x64.dll, winring00x64.sys 
Review Sysmon logs for processes with the IMPHASH=D41FA95D4642DC981F10DE36F4DC8CD7 hash value 
Inspect other log sources that capture driver load events and look for the Imphash value d41fa95d4642dc981f10de36f4dc8cd7","Unknown","ImageLoaded IN (""*\\WinRing0x64.sys"", ""*\\WinRing0.sys"", ""*\\WinRing0.dll"", ""*\\WinRing0x64.dll"", ""*\\winring00x64.sys"") OR Hashes=""*IMPHASH=D41FA95D4642DC981F10DE36F4DC8CD7*"" OR Imphash=""d41fa95d4642dc981f10de36f4dc8cd7"""
"WinDivert Driver Load","Florian Roth (Nextron Systems)","Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection package for Windows","attack.collection, attack.defense_evasion, attack.t1599.001, attack.t1557.001","driver_load","windows","Not classified","Check the process that loaded the WinDivert driver and verify if it is a legitimate usage. 
Review the command-line arguments and parent process of the process that loaded the driver. 
Check if the driver is loaded from a trusted source or if it is signed by a trusted certificate authority. 
Analyze network traffic to identify any suspicious behavior or communication associated with the loaded driver. 
Monitor for any additional suspicious activities or processes that may be related to the WinDivert driver.","Legitimate WinDivert driver usage","ImageLoaded IN (""*\\WinDivert.sys*"", ""*\\WinDivert64.sys*"", ""*\\NordDivert.sys*"", ""*\\lingtiwfp.sys*"", ""*\\eswfp.sys*"") OR Hashes IN (""*IMPHASH=0604bb7cb4bb851e2168d5c7d9399087*"", ""*IMPHASH=2e5f0e649d97f32b03c09e4686d0574f*"", ""*IMPHASH=52f8aa269f69f0edad9e8fcdaedce276*"", ""*IMPHASH=c0e5d314da39dbf65a2dbff409cc2c76*"", ""*IMPHASH=58623490691babe8330adc81cd04a663*"", ""*IMPHASH=8ee39b48656e4d6b8459d7ba7da7438b*"", ""*IMPHASH=45ee545ae77e8d43fc70ede9efcd4c96*"", ""*IMPHASH=a1b2e245acd47e4a348e1a552a02859a*"", ""*IMPHASH=2a5f85fe4609461c6339637594fa9b0a*"", ""*IMPHASH=6b2c6f95233c2914d1d488ee27531acc*"", ""*IMPHASH=9f2fdd3f9ab922bbb0560a7df46f4342*"", ""*IMPHASH=d8a719865c448b1bd2ec241e46ac1c88*"", ""*IMPHASH=0ea54f8c9af4a2fe8367fa457f48ed38*"", ""*IMPHASH=9d519ae0a0864d6d6ae3f8b6c9c70af6*"", ""*IMPHASH=a74929edfc3289895e3f2885278947ae*"", ""*IMPHASH=a66b476c2d06c370f0a53b5537f2f11e*"", ""*IMPHASH=bdcd836a46bc2415773f6b5ea77a46e4*"", ""*IMPHASH=c28cd6ccd83179e79dac132a553693d9*"") OR Imphash IN (""0604bb7cb4bb851e2168d5c7d9399087"", ""2e5f0e649d97f32b03c09e4686d0574f"", ""52f8aa269f69f0edad9e8fcdaedce276"", ""c0e5d314da39dbf65a2dbff409cc2c76"", ""58623490691babe8330adc81cd04a663"", ""8ee39b48656e4d6b8459d7ba7da7438b"", ""45ee545ae77e8d43fc70ede9efcd4c96"", ""a1b2e245acd47e4a348e1a552a02859a"", ""2a5f85fe4609461c6339637594fa9b0a"", ""6b2c6f95233c2914d1d488ee27531acc"", ""9f2fdd3f9ab922bbb0560a7df46f4342"", ""d8a719865c448b1bd2ec241e46ac1c88"", ""0ea54f8c9af4a2fe8367fa457f48ed38"", ""9d519ae0a0864d6d6ae3f8b6c9c70af6"", ""a74929edfc3289895e3f2885278947ae"", ""a66b476c2d06c370f0a53b5537f2f11e"", ""bdcd836a46bc2415773f6b5ea77a46e4"", ""c28cd6ccd83179e79dac132a553693d9"")"
"Load Of Dbghelp/Dbgcore DLL From Suspicious Process","Perez Diego (@darkquassar), oscd.community, Ecco","Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes.
Tools like ProcessHacker and some attacker tradecraft use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll.
As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.
","attack.credential_access, attack.t1003.001","image_load","windows","Not classified","Check the process that loaded the dbghelp.dll or dbgcore.dll 
Verify if the process is suspicious or authorized 
Review the command line arguments and parent process of the suspicious process 
Cross-reference with known legitimate uses of the MiniDumpWriteDump API 
Analyze the behavior and network activity of the process 
Look for any signs of data exfiltration or unusual network connections 
Check for any other indicators of compromise (IOCs) associated with the process 
Consult with the system owner or relevant stakeholders to confirm legitimacy","Legitimate use of dbghelp/dbgcore DLL by authorized processes 
Legitimate use of the MiniDumpWriteDump API by authorized tools 
Legitimate use of the listed processes for normal operations","ImageLoaded IN (""*\\dbghelp.dll"", ""*\\dbgcore.dll"") Image IN (""*\\msbuild.exe"", ""*\\cmd.exe"", ""*\\rundll32.exe"", ""*\\winword.exe"", ""*\\excel.exe"", ""*\\powerpnt.exe"", ""*\\outlook.exe"", ""*\\monitoringhost.exe"", ""*\\wmic.exe"", ""*\\bash.exe"", ""*\\wscript.exe"", ""*\\cscript.exe"", ""*\\mshta.exe"", ""*\\dnx.exe"", ""*\\regsvcs.exe"", ""*\\sc.exe"", ""*\\scriptrunner.exe"") NOT (CommandLine=""C:\\WINDOWS\\winsxs\\*"" CommandLine=""*\\TiWorker.exe -Embedding"")"
"Suspicious Unsigned Dbghelp/Dbgcore DLL Loaded","Perez Diego (@darkquassar), oscd.community, Ecco","Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes.
Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll.
As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.
","attack.credential_access, attack.t1003.001","image_load","windows","Not classified","Review the process that loaded the dbghelp/dbgcore DLLs for any suspicious behavior or indicators of compromise. 
Check if the process is a known legitimate debugging tool or software that uses dbghelp/dbgcore DLLs. 
Analyze the network traffic of the process to identify any suspicious communication with external systems. 
Inspect the memory dumps created by the process for any sensitive or unauthorized data. 
Cross-reference the process with known threat intelligence sources to identify any malicious associations.","Legitimate debugging tools or software that use dbghelp/dbgcore DLLs","ImageLoaded IN (""*\\dbghelp.dll"", ""*\\dbgcore.dll"") Signed=""false"""
"PCRE.NET Package Image Load","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Detects processes loading modules related to PCRE.NET package","attack.execution, attack.t1059","image_load","windows","Not classified","Check the process name and path of the loaded module to determine if it is related to PCRE.NET package. 
Review the process execution context and behavior to identify any suspicious or malicious activity. 
Cross-reference the loaded module with known good or bad indicators of compromise (IOCs) to determine its reputation. 
Analyze the parent-child relationship of the process loading the module to identify any anomalous behavior or suspicious chain of execution.","Legitimate processes loading modules related to PCRE.NET package","ImageLoaded=""*\\AppData\\Local\\Temp\\ba9ea7344a4a5f591d6e5dc32a13494b\\*"""
"Time Travel Debugging Utility Usage - Image","Ensar amil, @sblmsrsn, @oscd_initiative","Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.","attack.defense_evasion, attack.credential_access, attack.t1218, attack.t1003.001","image_load","windows","Not classified","Check for any legitimate usage of Time Travel Debugging Utility by software developers or testers. Look for any authorized processes or tools that may be using the tttracer.exe binary. Review the logs from the image load events on Windows systems to identify any suspicious activity related to the loading of ttdrecord.dll, ttdwriter.dll, or ttdloader.dll. Some log sources that may be useful for investigation include 
Windows Event Logs Look for Event ID 7 in the System event log, which indicates the loading of a DLL. 
Sysmon Logs Check for events with Event ID 7, which captures image load events. 
Endpoint Security Logs Review logs from endpoint security solutions, such as antivirus or EDR tools, for any alerts or detections related to the Time Travel Debugging Utility or the tttracer.exe binary. 
Process Monitoring Logs Analyze logs from process monitoring tools, such as Procmon or Sysinternals Process Explorer, to identify any suspicious processes or activity related to the Time Travel Debugging Utility.","Legitimate usage by software developers/testers","ImageLoaded IN (""*\\ttdrecord.dll"", ""*\\ttdwriter.dll"", ""*\\ttdloader.dll"")"
"HackTool - SILENTTRINITY Stager DLL Load","Aleksey Potapov, oscd.community","Detects SILENTTRINITY stager dll loading activity","attack.command_and_control, attack.t1071","image_load","windows","Not classified","Review Windows event logs for image load events with st2stager in the description field.","Unlikely","Description=""*st2stager*"""
"Potential DCOM InternetExplorer.Application DLL Hijack - Image Load","Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga","Detects potential DLL hijack of ""iertutil.dll"" found in the DCOM InternetExplorer.Application Class","attack.lateral_movement, attack.t1021.002, attack.t1021.003","image_load","windows","Not classified","Review the process tree and command-line arguments of the iexplore.exe process to determine if it is being launched in an unexpected or suspicious manner. 
Check the digital signature of the iertutil.dll file to verify its authenticity. 
Monitor for any abnormal behavior or network connections initiated by the iexplore.exe process. 
Inspect the file system and registry for any signs of tampering or unauthorized modifications related to iexplore.exe or iertutil.dll. 
Cross-reference the detection with other security events or alerts to identify any correlated suspicious activities.","Legitimate updates or installations of Internet Explorer or related software may trigger this detection.","Image=""*\\Internet Explorer\\iexplore.exe"" ImageLoaded=""*\\Internet Explorer\\iertutil.dll"""
"GAC DLL Loaded Via Office Applications","Antonlovesdnb","Detects any GAC DLL being loaded by an Office Product","attack.execution, attack.t1204.002","image_load","windows","Not classified","Check the process name and path of the loaded DLL 
Verify if the DLL is being loaded by one of the specified Office applications (e.g., excel.exe, winword.exe) 
Review the parent process and command line arguments for any suspicious activity 
Cross-reference the loaded DLL with known good DLLs from the GAC 
Analyze any associated network connections or file modifications made by the process 
Look for any other indicators of compromise or suspicious behavior in the system logs","Legitimate usage of GAC DLLs by Office applications during normal operation","Image IN (""*\\excel.exe"", ""*\\mspub.exe"", ""*\\onenote.exe"", ""*\\onenoteim.exe"", ""*\\outlook.exe"", ""*\\powerpnt.exe"", ""*\\winword.exe"") ImageLoaded=""C:\\Windows\\Microsoft.NET\\assembly\\GAC_MSIL*"""
"Microsoft VBA For Outlook Addin Loaded Via Outlook","Nasreddine Bencherchali (Nextron Systems)","Detects outlvba (Microsoft VBA for Outlook Addin) DLL being loaded by the outlook process","attack.execution, attack.t1204.002","image_load","windows","Not classified","Check for any legitimate macro usage in the environment. 
Review logs from the image_load category in the Windows event logs. 
Look for instances where the outlook.exe process loads the outlvba.dll file.","Legitimate macro usage. Add the appropriate filter according to your environment","Image=""*\\outlook.exe"" ImageLoaded=""\\outlvba.dll*"""
"VBA DLL Loaded Via Office Application","Antonlovesdnb","Detects VB DLL's loaded by an office application. Which could indicate the presence of VBA Macros.","attack.execution, attack.t1204.002","image_load","windows","Not classified","Check the image load events in your Windows security event logs (or equivalent) for any matches to this rule. 
Look for details in the events, including the ""Image"" and ""ImageLoaded"" fields, to identify the specific office application and DLL that triggered the detection. 
Consider cross-referencing the events with other logs and data sources to confirm the presence of VBA macros or any suspicious activity. 
Investigate the context of the event, such as the user account and the timing of the detection, to determine if further action is necessary.","This rule may generate false positives in environments where legitimate VBA macros are in use. Consider adding appropriate filters and exclusions based on known legitimate activity in your environment.","Image IN (""*\\excel.exe"", ""*\\mspub.exe"", ""*\\onenote.exe"", ""*\\onenoteim.exe"", ""*\\outlook.exe"", ""*\\powerpnt.exe"", ""*\\winword.exe"") ImageLoaded IN (""*\\VBE7.DLL"", ""*\\VBEUI.DLL"", ""*\\VBE7INTL.DLL"")"
"Potential DLL Sideloading Via comctl32.dll","Nasreddine Bencherchali (Nextron Systems), Subhash Popuri (@pbssubhash)","Detects potential DLL sideloading using comctl32.dll to obtain system privileges","attack.defense_evasion, attack.persistence, attack.privilege_escalation, attack.t1574.001, attack.t1574.002","image_load","windows","Not classified","Check for any suspicious or unexpected software installations or updates that involve loading comctl32.dll. Look for any abnormal behavior or signs of privilege escalation. 
Review the logs of system processes that load comctl32.dll during normal operation to ensure they are legitimate and expected.","Legitimate software installation or update that involves loading comctl32.dll 
Legitimate system processes loading comctl32.dll during normal operation","ImageLoaded IN (""C:\\Windows\\System32\\logonUI.exe.local\\*"", ""C:\\Windows\\System32\\werFault.exe.local\\*"", ""C:\\Windows\\System32\\consent.exe.local\\*"", ""C:\\Windows\\System32\\narrator.exe.local\\*"", ""C:\\windows\\system32\\wermgr.exe.local\\*"") ImageLoaded=""*\\comctl32.dll"""
"DLL Sideloading Of ShellChromeAPI.DLL","Nasreddine Bencherchali (Nextron Systems)","Detects processes loading the non-existent DLL ""ShellChromeAPI"". One known example is the ""DeviceEnroller"" binary in combination with the ""PhoneDeepLink"" flag tries to load this DLL.
Adversaries can drop their own renamed DLL and execute it via DeviceEnroller.exe using this parameter
","attack.defense_evasion, attack.persistence, attack.privilege_escalation, attack.t1574.001, attack.t1574.002","image_load","windows","Not classified","Review the process that triggered the detection and check if it is a known legitimate process or a suspicious one. 
Check if the process is associated with any known software or system component that requires the loading of ShellChromeAPI.dll. 
Analyze the command-line arguments or parameters used by the process to determine if it aligns with any known legitimate use cases. 
Inspect the process behavior and its interactions with other system components to identify any malicious activities or indicators of compromise. 
Cross-reference the detection with other security events or logs, such as network traffic logs, to gather additional context and evidence of potential malicious behavior.","Legitimate software or system processes that load the ShellChromeAPI.dll 
DLL sideloading performed by authorized applications or scripts","ImageLoaded=""*\\ShellChromeAPI.dll"""
"Svchost DLL Search Order Hijack","SBousseaden","Detects DLL sideloading of DLLs that are loaded by the SCM for some services (IKE, IKEEXT, SessionEnv) which do not exists on a typical modern system
IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\Windows\System32\ by default.
An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services ""svchost.exe -k netsvcs"" to gain code execution on a remote machine.
","attack.persistence, attack.defense_evasion, attack.t1574.002, attack.t1574.001","image_load","windows","Not classified","Check the process tree to identify the parent process of svchost.exe and the command-line arguments used to launch it. 
Review the loaded DLLs for svchost.exe and identify any DLLs that match the ones specified in the rule (tsmsisrv.dll, tsvipsrv.dll, wlbsctrl.dll). 
Verify the path of the loaded DLLs and check if they are located in the C\Windows\WinSxS\ directory. 
If the loaded DLLs are not located in the C\Windows\WinSxS\ directory, further investigation is required to determine if the DLL sideloading is malicious or legitimate. 
Investigate the purpose and behavior of the loaded DLLs to determine if they are associated with the Svchost DLL Search Order Hijack technique. 
If the loaded DLLs are confirmed to be associated with the Svchost DLL Search Order Hijack technique, analyze the malicious logic within the PROCESS_ATTACH block of the library to understand the attackers intent and potential impact.","Legitimate software or system updates that may load DLLs from non-standard locations. 
DLLs loaded by legitimate software that are not related to the Svchost DLL Search Order Hijack technique.","Image=""*\\svchost.exe"" ImageLoaded IN (""*\\tsmsisrv.dll"", ""*\\tsvipsrv.dll"", ""*\\wlbsctrl.dll"") NOT ImageLoaded=""C:\\Windows\\WinSxS\\*"""
"Fax Service DLL Search Order Hijack","NVISO","The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service.","attack.persistence, attack.defense_evasion, attack.t1574.001, attack.t1574.002","image_load","windows","Not classified","Check for the presence of ualapi.dll in the expected location (C\Windows\WinSxS\) on the affected system. 
Review the logs from the image_load category in the Windows event logs for instances where fxssvc.exe attempts to load ualapi.dll. 
Look for any suspicious or unexpected DLLs loaded by fxssvc.exe. 
Correlate the detection with other security events or indicators of compromise to determine if it is part of a larger attack.","In some cases, legitimate software may attempt to load ualapi.dll for a specific purpose, resulting in a false positive.","Image=""*\\fxssvc.exe"" ImageLoaded=""*ualapi.dll"" NOT ImageLoaded=""C:\\Windows\\WinSxS\\*"""
"DotNet CLR DLL Loaded By Scripting Applications","omkar72, oscd.community","Detects .NET CLR DLLs being loaded by scripting applications such as wscript or cscript. This could be an indication of potential suspicious execution.","attack.execution, attack.privilege_escalation, attack.t1055","image_load","windows","Not classified","Review the process tree and command-line arguments of the scripting application to determine the context of the DLL loading 
Check if the DLL being loaded is a known system DLL or a suspicious DLL 
Analyze the behavior of the scripting application and the loaded DLL for any signs of malicious activity 
Correlate the detection with other security events and logs to identify any related indicators of compromise 
Consult with the application owner or developer to understand if the DLL loading is expected and legitimate","Legitimate use of scripting applications loading .NET CLR DLLs 
Known benign activity involving the specified log sources","Image IN (""*\\cmstp.exe"", ""*\\cscript.exe"", ""*\\mshta.exe"", ""*\\msxsl.exe"", ""*\\regsvr32.exe"", ""*\\wmic.exe"", ""*\\wscript.exe"") ImageLoaded IN (""*\\clr.dll"", ""*\\mscoree.dll"", ""*\\mscorlib.dll"")"
"Possible Process Hollowing Image Loading","Markus Neis","Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz","attack.defense_evasion, attack.t1574.002","image_load","windows","Not classified","Review process creation logs (e.g., Windows Event ID 4688) to identify the parent process of notepad.exe and verify its legitimacy. 
Check if the parent process is a known system process or a legitimate software application. 
If the parent process is suspicious or unknown, investigate further to determine if process hollowing or other evasion techniques are being used. 
Review the loaded DLLs for notepad.exe and check if samlib.dll or WinSCard.dll are present. 
If samlib.dll or WinSCard.dll are loaded from an untypical process or location, it may indicate process hollowing or other malicious activity. 
Collect additional information such as command-line arguments, network connections, and file modifications to further analyze the suspicious activity.","Legitimate software or system processes loading samlib.dll or WinSCard.dll","Image=""*\\notepad.exe"" ImageLoaded IN (""*\\samlib.dll"", ""*\\WinSCard.dll"")"
"Suspicious Unsigned Thor Scanner Execution","Nasreddine Bencherchali (Nextron Systems)","Detects loading and execution of an unsigned thor scanner binary.","attack.defense_evasion, attack.t1574.002","image_load","windows","Not classified","Not available","Not available","Image IN (""*\\thor.exe"", ""*\\thor64.exe"") ImageLoaded IN (""*\\thor.exe"", ""*\\thor64.exe"") NOT (Signed=""true"" SignatureStatus=""valid"" Signature=""Nextron Systems GmbH"")"
"UAC Bypass Using Iscsicpl - ImageLoad","Nasreddine Bencherchali (Nextron Systems)","Detects the ""iscsicpl.exe"" UAC bypass technique that leverages a DLL Search Order hijacking technique to load a custom DLL's from temp or a any user controlled location in the users %PATH%","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","image_load","windows","Not classified","Check the image load events in your Windows security event logs (or equivalent) for any matches to this rule. 
Look for details in the events, including the ""Image"" and ""ImageLoaded"" fields, to confirm the presence of ""iscsicpl.exe"" and the loading of ""iscsiexe.dll."" 
Investigate the context of the event, such as the user account and the timing of the detection. 
Determine if the ""iscsiexe.dll"" loaded from a user-controlled location is legitimate or suspicious. 
Consider checking the digital signature of ""iscsiexe.dll"" to further validate its authenticity.","This rule may generate false positives in cases where legitimate processes or applications load ""iscsiexe.dll"" from user-controlled directories. Investigate the context of the event to differentiate between malicious and legitimate activity.","Image=""C:\\Windows\\SysWOW64\\iscsicpl.exe"" ImageLoaded=""*\\iscsiexe.dll"" NOT (ImageLoaded=""*C:\\Windows\\*"" ImageLoaded=""*iscsiexe.dll*"")"
"UAC Bypass With Fake DLL","oscd.community, Dmitry Uchakin","Attempts to load dismcore.dll after dropping it","attack.persistence, attack.defense_evasion, attack.privilege_escalation, attack.t1548.002, attack.t1574.002","image_load","windows","Not classified","Check the process tree to identify the parent process of dism.exe and dismcore.dll 
Review the command-line arguments used to execute dism.exe 
Analyze the network traffic generated by the process 
Inspect the file system for any other suspicious files or artifacts dropped by the process 
Correlate the event with other security events or indicators of compromise (IOCs) 
Consult threat intelligence sources for any known malicious behavior associated with dism.exe and dismcore.dll","Actions of a legitimate telnet client","Image=""*\\dism.exe"" ImageLoaded=""*\\dismcore.dll"" NOT ImageLoaded=""C:\\Windows\\System32\\Dism\\dismcore.dll"""
"Wmiprvse Wbemcomn DLL Hijack","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\Windows\System32\wbem\` directory over the network and loading it for a WMI DLL Hijack scenario.","attack.execution, attack.t1047, attack.lateral_movement, attack.t1021.002","image_load","windows","Not classified","Check the process tree for any suspicious or unauthorized instances of `wmiprvse.exe`. 
Review the file creation events in the `C\Windows\System32\wbem\` directory to identify any unauthorized creation of `wbemcomn.dll`. 
Analyze the network traffic logs to identify any suspicious communication related to the creation and loading of `wbemcomn.dll` over the network.","Legitimate use of WMI for system administration purposes may trigger this rule.","Image=""*\\wmiprvse.exe"" ImageLoaded=""*\\wbem\\wbemcomn.dll"""
"WMI Persistence - Command Line Event Consumer","Thomas Patzke","Detects WMI command line event consumers","attack.t1546.003, attack.persistence","image_load","windows","Not classified","Check for legitimate use of WMI command line event consumers in the environment 
Review WMI logs for any suspicious or unauthorized command line event consumers 
Analyze the command line arguments and parameters used by the event consumers 
Compare the observed behavior with known legitimate use cases","Legitimate use of WMI command line event consumers in specific environments","Image=""C:\\Windows\\System32\\wbem\\WmiPrvSE.exe"" ImageLoaded=""*\\wbemcons.dll"""
"Microsoft Binary Suspicious Communication Endpoint","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects an executable in the Windows folder accessing suspicious domains","attack.lateral_movement, attack.t1105","network_connection","windows","Not classified","Check the process image path to determine if it is a legitimate Microsoft binary or a suspicious executable. Log sources Windows Event Logs (Event ID 4688 - Process Creation) 
Review the destination domains to identify any known legitimate services or applications that may access these domains. Log sources Firewall logs, Proxy logs, DNS logs 
Correlate the network connection with other security events or indicators of compromise to identify any malicious activity. Log sources SIEM logs, IDS/IPS logs, Endpoint logs","Legitimate software or system processes accessing the listed domains 
Authorized users or applications accessing the listed domains for legitimate purposes","Image IN (""C:\\PerfLogs*"", ""C:\\Temp\\*"", ""C:\\Users\\Public\\*"", ""C:\\Windows\\*"") OR Image=""*\\AppData\\Temp\\*"" Initiated=""true"" DestinationHostname IN (""*.githubusercontent.com"", ""*anonfiles.com"", ""*cdn.discordapp.com"", ""*cdn.discordapp.com/attachments/"", ""*ddns.net"", ""*dl.dropboxusercontent.com"", ""*ghostbin.co"", ""*gofile.io"", ""*hastebin.com"", ""*mediafire.com"", ""*mega.nz"", ""*paste.ee"", ""*pastebin.com"", ""*pastebin.pl"", ""*pastetext.net"", ""*privatlab.com"", ""*privatlab.net"", ""*send.exploit.in"", ""*sendspace.com"", ""*storage.googleapis.com"", ""*storjshare.io"", ""*temp.sh"", ""*transfer.sh"", ""*ufile.io"")"
"Connection Initiated Via Certutil.EXE","frack113, Florian Roth (Nextron Systems)","Detects a network connection initiated by the certutil.exe tool.
Attackers can abuse the utility in order to download malware or additional payloads.
","attack.command_and_control, attack.t1105","network_connection","windows","Not classified","Review network connection logs for instances of certutil.exe initiating connections on ports 80, 135, 443, or 445. 
Look for patterns of suspicious or unauthorized activity, such as connections to known malicious IP addresses or domains. 
Cross-reference with other security events or indicators of compromise (IOCs) to identify any related malicious activity. 
Consider checking the command-line arguments used with certutil.exe to determine if any suspicious options or parameters were used. 
Consult with system administrators or other relevant personnel to determine if any legitimate administrative tasks involving certutil.exe were performed during the same time period.","Legitimate use of certutil.exe for valid administrative purposes.","Image=""*\\certutil.exe"" Initiated=""true"" DestinationPort IN (80, 135, 443, 445)"
"Network Communication With Crypto Mining Pool","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects initiated network connections to crypto mining pools","attack.impact, attack.t1496","network_connection","windows","Not classified","Check the source and destination IP addresses to determine if they are associated with known crypto mining pools 
Review the network traffic logs for any suspicious or unauthorized activities 
Analyze the payload of the network connections to identify any indicators of malicious activity 
Cross-reference the detected connections with other security events or indicators of compromise to determine if there is a larger security incident 
Consult with the system or network administrators to understand the context and purpose of the detected connections","Legitimate connections to known crypto mining pools 
Connections to mining pools used for legitimate purposes such as mining cryptocurrencies for authorized activities 
Connections to mining pools used for research or testing purposes","DestinationHostname IN (""alimabi.cn"", ""ap.luckpool.net"", ""bcn.pool.minergate.com"", ""bcn.vip.pool.minergate.com"", ""bohemianpool.com"", ""ca.minexmr.com"", ""ca.monero.herominers.com"", ""cbd.monerpool.org"", ""cbdv2.monerpool.org"", ""cryptmonero.com"", ""crypto-pool.fr"", ""crypto-pool.info"", ""cryptonight-hub.miningpoolhub.com"", ""d1pool.ddns.net"", ""d5pool.us"", ""daili01.monerpool.org"", ""de.minexmr.com"", ""dl.nbminer.com"", ""donate.graef.in"", ""donate.ssl.xmrig.com"", ""donate.v2.xmrig.com"", ""donate.xmrig.com"", ""donate2.graef.in"", ""drill.moneroworld.com"", ""dwarfpool.com"", ""emercoin.com"", ""emercoin.net"", ""emergate.net"", ""ethereumpool.co"", ""eu.luckpool.net"", ""eu.minerpool.pw"", ""fcn-xmr.pool.minergate.com"", ""fee.xmrig.com"", ""fr.minexmr.com"", ""hellominer.com"", ""herominers.com"", ""huadong1-aeon.ppxxmr.com"", ""iwanttoearn.money"", ""jw-js1.ppxxmr.com"", ""koto-pool.work"", ""lhr.nbminer.com"", ""lhr3.nbminer.com"", ""linux.monerpool.org"", ""lokiturtle.herominers.com"", ""luckpool.net"", ""masari.miner.rocks"", ""mine.c3pool.com"", ""mine.moneropool.com"", ""mine.ppxxmr.com"", ""mine.zpool.ca"", ""mine1.ppxxmr.com"", ""minemonero.gq"", ""miner.ppxxmr.com"", ""miner.rocks"", ""minercircle.com"", ""minergate.com"", ""minerpool.pw"", ""minerrocks.com"", ""miners.pro"", ""minerxmr.ru"", ""minexmr.cn"", ""minexmr.com"", ""mining-help.ru"", ""miningpoolhub.com"", ""mixpools.org"", ""moner.monerpool.org"", ""moner1min.monerpool.org"", ""monero-master.crypto-pool.fr"", ""monero.crypto-pool.fr"", ""monero.hashvault.pro"", ""monero.herominers.com"", ""monero.lindon-pool.win"", ""monero.miners.pro"", ""monero.riefly.id"", ""monero.us.to"", ""monerocean.stream"", ""monerogb.com"", ""monerohash.com"", ""moneroocean.stream"", ""moneropool.com"", ""moneropool.nl"", ""monerorx.com"", ""monerpool.org"", ""moriaxmr.com"", ""mro.pool.minergate.com"", ""multipool.us"", ""myxmr.pw"", ""na.luckpool.net"", ""nanopool.org"", ""nbminer.com"", ""node3.luckpool.net"", ""noobxmr.com"", ""pangolinminer.comgandalph3000.com"", ""pool.4i7i.com"", ""pool.armornetwork.org"", ""pool.cortins.tk"", ""pool.gntl.co.uk"", ""pool.hashvault.pro"", ""pool.minergate.com"", ""pool.minexmr.com"", ""pool.monero.hashvault.pro"", ""pool.ppxxmr.com"", ""pool.somec.cc"", ""pool.support"", ""pool.supportxmr.com"", ""pool.usa-138.com"", ""pool.xmr.pt"", ""pool.xmrfast.com"", ""pool2.armornetwork.org"", ""poolchange.ppxxmr.com"", ""pooldd.com"", ""poolmining.org"", ""poolto.be"", ""ppxvip1.ppxxmr.com"", ""ppxxmr.com"", ""prohash.net"", ""r.twotouchauthentication.online"", ""randomx.xmrig.com"", ""ratchetmining.com"", ""seed.emercoin.com"", ""seed.emercoin.net"", ""seed.emergate.net"", ""seed1.joulecoin.org"", ""seed2.joulecoin.org"", ""seed3.joulecoin.org"", ""seed4.joulecoin.org"", ""seed5.joulecoin.org"", ""seed6.joulecoin.org"", ""seed7.joulecoin.org"", ""seed8.joulecoin.org"", ""sg.minexmr.com"", ""sheepman.mine.bz"", ""siamining.com"", ""sumokoin.minerrocks.com"", ""supportxmr.com"", ""suprnova.cc"", ""teracycle.net"", ""trtl.cnpool.cc"", ""trtl.pool.mine2gether.com"", ""turtle.miner.rocks"", ""us-west.minexmr.com"", ""usxmrpool.com"", ""viaxmr.com"", ""webservicepag.webhop.net"", ""xiazai.monerpool.org"", ""xiazai1.monerpool.org"", ""xmc.pool.minergate.com"", ""xmo.pool.minergate.com"", ""xmr-asia1.nanopool.org"", ""xmr-au1.nanopool.org"", ""xmr-eu1.nanopool.org"", ""xmr-eu2.nanopool.org"", ""xmr-jp1.nanopool.org"", ""xmr-us-east1.nanopool.org"", ""xmr-us-west1.nanopool.org"", ""xmr-us.suprnova.cc"", ""xmr-usa.dwarfpool.com"", ""xmr.2miners.com"", ""xmr.5b6b7b.ru"", ""xmr.alimabi.cn"", ""xmr.bohemianpool.com"", ""xmr.crypto-pool.fr"", ""xmr.crypto-pool.info"", ""xmr.f2pool.com"", ""xmr.hashcity.org"", ""xmr.hex7e4.ru"", ""xmr.ip28.net"", ""xmr.monerpool.org"", ""xmr.mypool.online"", ""xmr.nanopool.org"", ""xmr.pool.gntl.co.uk"", ""xmr.pool.minergate.com"", ""xmr.poolto.be"", ""xmr.ppxxmr.com"", ""xmr.prohash.net"", ""xmr.simka.pw"", ""xmr.somec.cc"", ""xmr.suprnova.cc"", ""xmr.usa-138.com"", ""xmr.vip.pool.minergate.com"", ""xmr1min.monerpool.org"", ""xmrf.520fjh.org"", ""xmrf.fjhan.club"", ""xmrfast.com"", ""xmrigcc.graef.in"", ""xmrminer.cc"", ""xmrpool.de"", ""xmrpool.eu"", ""xmrpool.me"", ""xmrpool.net"", ""xmrpool.xyz"", ""xx11m.monerpool.org"", ""xx11mv2.monerpool.org"", ""xxx.hex7e4.ru"", ""zarabotaibitok.ru"", ""zer0day.ru"")"
"Potential Dead Drop Resolvers","Sorina Ionescu, X__Junior (Nextron Systems)","Detects an executable, which is not an internet browser, making DNS request to legit popular websites, which were seen to be used as dead drop resolvers in previous attacks.","attack.command_and_control, attack.t1102, attack.t1102.001","network_connection","windows","Not classified","Check your network connection logs for any events matching this rule. 
Pay special attention to the ""Initiated"" field, which should be set to ""true."" 
Investigate the ""DestinationHostname"" to determine if it matches one of the listed popular websites. 
Review the ""Image"" field to identify the executable that initiated the DNS request. 
Cross-reference the identified executable with known browsers and other legitimate applications. 
If the executable is not a legitimate browser or application, further investigation is warranted to determine its nature and intent.","False positives may occur when legitimate applications other than web browsers make DNS requests to the listed popular websites. Exclude such applications from detection. 
Custom tuning may be required to reduce false positives further.","Initiated=""true"" DestinationHostname IN (""*.t.me"", ""*4shared.com"", ""*anonfiles.com"", ""*cdn.discordapp.com"", ""*cloudflare.com"", ""*ddns.net"", ""*discord.com"", ""*docs.google.com"", ""*drive.google.com"", ""*dropbox.com"", ""*dropmefiles.com"", ""*facebook.com"", ""*feeds.rapidfeeds.com"", ""*fotolog.com"", ""*ghostbin.co/"", ""*githubusercontent.com"", ""*gofile.io"", ""*hastebin.com"", ""*imgur.com"", ""*livejournal.com"", ""*mediafire.com"", ""*mega.nz"", ""*onedrive.com"", ""*paste.ee"", ""*pastebin.com"", ""*pastebin.pl"", ""*pastetext.net"", ""*privatlab.com"", ""*privatlab.net"", ""*reddit.com"", ""*send.exploit.in"", ""*sendspace.com"", ""*steamcommunity.com"", ""*storage.googleapis.com"", ""*technet.microsoft.com"", ""*temp.sh"", ""*transfer.sh"", ""*twitter.com"", ""*ufile.io"", ""*vimeo.com"", ""*wetransfer.com"", ""*youtube.com"") NOT (Image IN (""C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"", ""C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"") OR (Image=""C:\\Users\\*"" Image=""*\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe"") OR Image IN (""C:\\Program Files\\Mozilla Firefox\\firefox.exe"", ""C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe"") OR (Image=""C:\\Users\\*"" Image=""*\\AppData\\Local\\Mozilla Firefox\\firefox.exe"") OR Image IN (""C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe"", ""C:\\Program Files\\Internet Explorer\\iexplore.exe"") OR Image=""C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\*"" OR Image=""*\\WindowsApps\\MicrosoftEdge.exe"" OR Image IN (""C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe"", ""C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe"") OR (Image IN (""C:\\Program Files (x86)\\Microsoft\\EdgeCore\\*"", ""C:\\Program Files\\Microsoft\\EdgeCore\\*"") Image IN (""*\\msedge.exe"", ""*\\msedgewebview2.exe"")) OR Image=""*\\safari.exe"" OR Image IN (""*\\MsMpEng.exe"", ""*\\MsSense.exe"") OR Image IN (""*C:\\Program Files (x86)\\PRTG Network Monitor\\PRTG Probe.exe"", ""*C:\\Program Files\\PRTG Network Monitor\\PRTG Probe.exe"") OR (Image=""*\\brave.exe"" Image=""C:\\Program Files\\BraveSoftware\\*"") OR (Image=""*\\AppData\\Local\\Maxthon\\*"" Image=""*\\maxthon.exe"") OR (Image=""*\\AppData\\Local\\Programs\\Opera\\*"" Image=""*\\opera.exe"") OR (Image IN (""C:\\Program Files\\SeaMonkey\\*"", ""C:\\Program Files (x86)\\SeaMonkey\\*"") Image=""*\\seamonkey.exe"") OR (Image=""*\\AppData\\Local\\Vivaldi\\*"" Image=""*\\vivaldi.exe"") OR (Image IN (""C:\\Program Files\\Naver\\Naver Whale\\*"", ""C:\\Program Files (x86)\\Naver\\Naver Whale\\*"") Image=""*\\whale.exe"") OR Image=""*\\Tor Browser\\*"" OR (Image IN (""C:\\Program Files\\Waterfox\\*"", ""C:\\Program Files (x86)\\Waterfox\\*"") Image=""*\\Waterfox.exe"") OR (Image=""*\\AppData\\Local\\Programs\\midori-ng\\*"" Image=""*\\Midori Next Generation.exe"") OR (Image IN (""C:\\Program Files\\SlimBrowser\\*"", ""C:\\Program Files (x86)\\SlimBrowser\\*"") Image=""*\\slimbrowser.exe"") OR (Image=""*\\AppData\\Local\\Flock\\*"" Image=""*\\Flock.exe"") OR (Image=""*\\AppData\\Local\\Phoebe\\*"" Image=""*\\Phoebe.exe"") OR (Image IN (""C:\\Program Files\\Falkon\\*"", ""C:\\Program Files (x86)\\Falkon\\*"") Image=""*\\falkon.exe"") OR (Image IN (""C:\\Program Files (x86)\\QtWeb\\*"", ""C:\\Program Files\\QtWeb\\*"") Image=""*\\QtWeb.exe"") OR (Image IN (""C:\\Program Files (x86)\\Avant Browser\\*"", ""C:\\Program Files\\Avant Browser\\*"") Image=""*\\avant.exe"") OR (Image IN (""C:\\Program Files (x86)\\WindowsApps\\*"", ""C:\\Program Files\\WindowsApps\\*"") Image=""*WhatsApp.exe"") OR (Image=""*\\AppData\\Roaming\\Telegram Desktop\\*"" Image=""*\\Telegram.exe"" DestinationHostname=""*.t.me"") OR (Image=""*\\AppData\\Local\\Microsoft\\OneDrive\\*"" Image=""*\\OneDrive.exe"" DestinationHostname=""*onedrive.com"") OR (Image IN (""C:\\Program Files (x86)\\Dropbox\\Client\\*"", ""C:\\Program Files\\Dropbox\\Client\\*"") Image=""*\\Dropbox.exe"" DestinationHostname=""*dropbox.com"") OR (Image=""*\\AppData\\Local\\MEGAsync\\*"" Image=""*MEGAsync.exe"" DestinationHostname=""*mega.nz"") OR (Image IN (""C:\\Program Files\\Google\\Drive File Stream\\*"", ""C:\\Program Files (x86)\\Google\\Drive File Stream\\*"") Image=""*GoogleDriveFS.exe"" DestinationHostname=""*drive.google.com"") OR (Image=""*\\AppData\\Local\\Discord\\*"" Image=""*\\Discord.exe"" DestinationHostname IN (""*discord.com"", ""*cdn.discordapp.com"")))"
"Equation Editor Network Connection","Max Altgelt (Nextron Systems)","Detects network connections from Equation Editor","attack.execution, attack.t1203","network_connection","windows","Not classified","Investigate network connections originating from the Equation Editor executable (eqnedt32.exe) on Windows systems. 
Review network logs from firewalls, proxies, or network intrusion detection systems (NIDS) for connections to external IP addresses associated with Equation Editor. 
Analyze the destination IP addresses and ports to determine if they are known malicious or suspicious. 
Correlate the network connections with other security events or indicators of compromise (IOCs) to identify any related malicious activity. 
If the network connections are found to be part of a legitimate usage scenario, document the findings as a known false positive.","Legitimate network connections from Equation Editor during normal usage scenarios.","Image=""*\\eqnedt32.exe"""
"Network Connection Initiated By IMEWDBLD.EXE","frack113","Detects network connections initiated by IMEWDBLD. This might indicate potential abuse to download arbitrary files via this utility","attack.command_and_control, attack.t1105","network_connection","windows","Not classified","Check the source IP address and destination IP address of the network connection 
Review the process tree to identify the parent process that initiated IMEWDBLD.exe 
Inspect the command-line arguments passed to IMEWDBLD.exe 
Analyze the downloaded file for any malicious indicators","Legitimate use of IMEWDBLD.exe for authorized file downloads","Initiated=""true"" Image=""*\\IMEWDBLD.exe"""
"Communication To Mega.nz","Florian Roth (Nextron Systems)","Detects an executable accessing mega.co.nz, which could be a sign of forbidden file sharing use of data exfiltration by malicious actors","attack.exfiltration, attack.t1567.001","network_connection","windows","Not classified","Review network connection logs from Windows systems for connections to api.mega.co.nz. 
Look for any associated process or executable initiating the connection. 
Check if the connection is part of a legitimate use of mega.nz uploaders and tools. 
If the connection is not expected or suspicious, further investigation is recommended.","Legitimate use of mega.nz uploaders and tools","Initiated=""true"" DestinationHostname=""*api.mega.co.nz"""
"Communication To Ngrok Domains","Florian Roth (Nextron Systems)","Detects an executable accessing ngrok domains, which could be a sign of forbidden data exfiltration by malicious actors","attack.exfiltration, attack.t1567.001","network_connection","windows","Not classified","Not available","Not available"
"Communication To Ngrok.Io","Florian Roth (Nextron Systems)","Detects an executable accessing ngrok.io, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors","attack.exfiltration, attack.t1567.001","network_connection","windows","Not classified","Review network connection logs from the Windows product category for connections to ngrok.io. 
Look for any suspicious or unauthorized executables accessing ngrok.io. 
Cross-reference the process or executable accessing ngrok.io with known good or bad indicators from threat intelligence sources. 
Check if the ngrok.io connection is part of a legitimate use case or if it aligns with any known malicious activities. 
Investigate any other related logs or events that may provide additional context or evidence of exfiltration attempts.","Legitimate use of ngrok.io","Initiated=""true"" DestinationHostname=""*.ngrok.io"""
"Communication To Ngrok Tunneling Service","Florian Roth (Nextron Systems)","Detects an executable accessing an ngrok tunneling endpoint, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors","attack.exfiltration, attack.command_and_control, attack.t1567, attack.t1568.002, attack.t1572, attack.t1090, attack.t1102, attack.s0508","network_connection","windows","Not classified","Check the process name and path of the executable accessing the ngrok tunneling endpoint. Look for any suspicious or unknown executables. 
Review the network connection logs for any other indicators of compromise, such as unusual destination IP addresses or ports. 
Cross-reference the timestamp of the detection with other security events to identify any correlated activities. 
If possible, analyze the content or payload of the network traffic to determine if any sensitive or unauthorized data is being exfiltrated. 
Consider checking the ngrok logs or authentication logs for any suspicious or unauthorized access attempts.","Legitimate use of ngrok","DestinationHostname IN (""*tunnel.us.ngrok.com*"", ""*tunnel.eu.ngrok.com*"", ""*tunnel.ap.ngrok.com*"", ""*tunnel.au.ngrok.com*"", ""*tunnel.sa.ngrok.com*"", ""*tunnel.jp.ngrok.com*"", ""*tunnel.in.ngrok.com*"")"
"Notepad Making Network Connection","EagleEye Team","Detects suspicious network connection by Notepad","attack.command_and_control, attack.execution, attack.defense_evasion, attack.t1055","network_connection","windows","Not classified","Check the destination IP address and port to determine if it is a known malicious IP or port associated with command and control servers. 
Review the process tree to see if any other suspicious processes are running alongside Notepad. 
Inspect the network traffic to identify any unusual patterns or communication with known malicious domains. 
Check if any suspicious files have been downloaded or executed by Notepad. 
Review any relevant logs, such as firewall logs, proxy logs, or DNS logs, to gather additional information about the network connection. 
Correlate the network connection with other security events or indicators of compromise to identify any potential threats or malicious activities.","Legitimate use of Notepad for network-related activities, such as accessing network shares or downloading files from the internet.","Image=""*\\notepad.exe"" NOT DestinationPort=9100"
"Outbound RDP Connections Over Non-Standard Tools","Markus Neis","Detects Non-Standard Tools Connecting to TCP port 3389 indicating possible lateral movement","attack.lateral_movement, attack.t1021.001, car.2013-07-002","network_connection","windows","Not classified","Review the network connection logs for outbound connections on TCP port 3389 
Identify the process initiating the connection 
Check if the process is a known legitimate RDP tool or a non-standard tool 
If the process is a known legitimate RDP tool, no further investigation is required 
If the process is a non-standard tool, investigate further for possible lateral movement or unauthorized access 
Cross-reference with other security events or logs to gather additional context","Third party RDP tools","DestinationPort=3389 Initiated=""true"" NOT (Image IN (""C:\\Windows\\System32\\mstsc.exe"", ""C:\\Windows\\SysWOW64\\mstsc.exe"")) NOT ((Image=""C:\\Windows\\System32\\dns.exe"" SourcePort=53 Protocol=""udp"") OR Image IN (""*\\Avast Software\\Avast\\AvastSvc.exe"", ""*\\Avast\\AvastSvc.exe"") OR Image=""*\\RDCMan.exe"" OR Image=""C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"" OR ""\\FSAssessment.exe"" OR ""\\FSDiscovery.exe"" OR ""\\MobaRTE.exe"" OR ""\\mRemote.exe"" OR ""\\mRemoteNG.exe"" OR ""\\Passwordstate.exe"" OR ""\\RemoteDesktopManager.exe"" OR ""\\RemoteDesktopManager64.exe"" OR ""\\RemoteDesktopManagerFree.exe"" OR ""\\RSSensor.exe"" OR ""\\RTS2App.exe"" OR ""\\RTSApp.exe"" OR ""\\spiceworks-finder.exe"" OR ""\\Terminals.exe"" OR ""\\ws_TunnelService.exe"" OR Image IN (""*\\thor.exe"", ""*\\thor64.exe"") OR Image=""C:\\Program Files\\SplunkUniversalForwarder\\bin\\*"" OR Image=""*\\Ranger\\SentinelRanger.exe"" OR Image=""C:\\Program Files\\Mozilla Firefox\\firefox.exe"" OR Image!=* OR Image="""" OR Image=""<unknown process>"")"
"RDP Over Reverse SSH Tunnel","Samir Bousseaden","Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389","attack.command_and_control, attack.t1572, attack.lateral_movement, attack.t1021.001, car.2013-07-002","network_connection","windows","Not classified","Check the source IP address of the network connection logs to determine if it is a trusted system or an external IP address 
Review the destination IP address to confirm if it is the loopback address (127.0.0.1 or 1) 
Verify if the destination port is TCP port 3389 
Investigate the process image name to ensure it is svchost.exe 
Analyze the context of the network connection to identify any suspicious or anomalous behavior","Legitimate RDP connections to the loopback address (127.0.0.1 or 1) on TCP port 3389 
Legitimate usage of svchost.exe hosting RDP termsvcs","Image=""*\\svchost.exe"" Initiated=""true"" SourcePort=3389 DestinationIp IN (""127.*"", ""::1"")"
"RDP to HTTP or HTTPS Target Ports","Florian Roth (Nextron Systems)","Detects svchost hosting RDP termsvcs communicating to target systems on TCP port 80 or 443","attack.command_and_control, attack.t1572, attack.lateral_movement, attack.t1021.001, car.2013-07-002","network_connection","windows","Not classified","Review your network connection logs for events matching this rule. 
Pay attention to the ""Initiated"" field, which should be set to true. 
Check the ""Image"" field to identify the executable hosting the RDP connection, typically svchost.exe. 
Examine the ""SourcePort"" to verify its set to 3389, which is the default RDP port. 
Investigate the ""DestinationPort"" to see if it matches either port 80 or 443. 
Verify the legitimacy of the RDP connection. If its not a legitimate RDP session or if there are suspicious indicators, further investigation is needed.","False positives may occur when legitimate RDP connections are made to target systems on port 80 or 443. This could happen in scenarios where organizations use non-standard RDP configurations or when RDP servers are misconfigured to listen on these ports.","Image=""*\\svchost.exe"" Initiated=""true"" SourcePort=3389 DestinationPort IN (80, 443)"
"Remote PowerShell Session (Network)","Roberto Rodriguez @Cyb3rWard0g","Detects remote PowerShell connections by monitoring network outbound connections to ports 5985 or 5986 from a non-network service account.","attack.execution, attack.t1059.001, attack.lateral_movement, attack.t1021.006","network_connection","windows","Not classified","Check if the remote PowerShell connection was initiated from a non-network service account. 
Verify the destination ports 5985 or 5986 to determine if they are commonly used for legitimate purposes such as remote administration and monitoring. 
Review the user account associated with the connection to ensure it is not a known false positive, such as NETWORK SERVICE or localized variations. 
Examine the source IP address to identify any suspicious or unexpected sources. 
Analyze the image path of the process initiating the connection, especially if it is associated with known legitimate software like Avast antivirus. 
If the source and destination IP addresses are both localhost (1 or 127.0.0.1), it is likely a legitimate local connection. 
If the above investigation steps do not provide enough information, further analysis of the network traffic and any associated logs (e.g., firewall logs, proxy logs) may be necessary.","Legitimate usage of remote PowerShell, e.g. remote administration and monitoring. 
Network Service user name of a not-covered localization","DestinationPort IN (5985, 5986) Initiated=""true"" NOT (User IN (""*NETWORK SERVICE*"", ""*NETZWERKDIENST*"", ""*SERVIZIO DI RETE*"", ""*SERVICIO DE RED*"") OR (User=""*SERVICE R*"" User=""*SEAU*"") OR SourceIp=""0:0:*"" OR Image IN (""C:\\Program Files\\Avast Software\\Avast\\AvastSvc.exe"", ""C:\\Program Files (x86)\\Avast Software\\Avast\\AvastSvc.exe"") OR (SourceIp IN (""::1"", ""127.0.0.1"") DestinationIp IN (""::1"", ""127.0.0.1"")))"
"Script Initiated Connection to Non-Local Network","frack113, Florian Roth","Detects a script interpreter wscript/cscript opening a network connection to a non-local network. Adversaries may use script to download malicious payloads.","attack.command_and_control, attack.t1105","network_connection","windows","Not classified","Check logs from the network_connection category on Windows systems. 
Examine process execution logs for instances of wscript.exe or cscript.exe. 
Identify the purpose and legitimacy of the script. 
Verify if the destination IP is indeed non-local and not part of legitimate business operations. 
Check for logs related to IPv6 connections, especially if they involve ::1 (IPv6 loopback) or private address ranges. 
Review logs related to failed connection attempts, especially if they involve the specified IP address ranges. 
Determine if failed connection attempts are due to misconfigurations or if they represent potential security threats.","No known false positives","Initiated=""true"" Image IN (""*\\wscript.exe"", ""*\\cscript.exe"") NOT (DestinationIp IN (""127.*"", ""10.*"", ""172.*"", ""192.*"", ""169.254.*"", ""20.*"") OR DestinationIp IN (""::1*"", ""0:0:0:0:0:0:0:1*"", ""fe80:*"", ""fc*"", ""fd*""))"
"Silenttrinity Stager Msbuild Activity","Kiran kumar s, oscd.community","Detects a possible remote connections to Silenttrinity c2","attack.execution, attack.t1127.001","network_connection","windows","Not classified","Review network connection logs from Windows systems for instances of msbuild.exe connecting to remote destinations on ports 80 or 443. 
Check if the connections are initiated by the system or by a user process. 
Verify if the connections are part of authorized activities, such as software development or build processes. 
If the connections are suspicious and not expected, further investigation is required to determine if it is related to Silenttrinity C2 activity.","Legitimate use of msbuild.exe for authorized purposes, such as software development or build processes.","Image=""*\\msbuild.exe"" DestinationPort IN (80, 443) Initiated=""true"""
"Suspicious Network Connection Binary No CommandLine","Florian Roth (Nextron Systems)","Detects suspicious network connections made by a well-known Windows binary run with no command line parameters","attack.defense_evasion","network_connection","windows","Not classified","Check the source and destination IP addresses of the network connection 
Analyze the network protocol and port used in the connection 
Review the process tree and parent process of the suspicious binary 
Look for any additional suspicious activity or indicators of compromise in other logs, such as firewall logs, IDS/IPS logs, or endpoint logs 
Compare the network connection against known good or expected network behavior for the specific system or environment 
Consult threat intelligence sources to identify any known malicious behavior associated with the binary or IP addresses involved in the connection 
Consider performing memory or disk forensics on the system running the suspicious binary to gather additional evidence","Legitimate network connections made by the specified Windows binaries without command line parameters 
Network connections made by other legitimate binaries without command line parameters","Initiated=""true"" Image IN (""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\dllhost.exe"") CommandLine IN (""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\dllhost.exe"") NOT (CommandLine="""" OR CommandLine!=*)"
"Cmstp Making Network Connection","Nasreddine Bencherchali (Nextron Systems)","Detects suspicious network connection by Cmstp","attack.defense_evasion, attack.t1218.003","network_connection","windows","Not classified","Review network connection logs from Windows event logs or network monitoring tools for instances of Cmstp.exe making network connections. 
Check if the network connections made by Cmstp.exe are expected and part of legitimate operations. 
Compare the network connections made by Cmstp.exe with known good patterns or baselines to identify any anomalies.","Legitimate use of Cmstp for network connections","Image=""*\\cmstp.exe"" Initiated=""true"""
"Suspicious Dropbox API Usage","Florian Roth (Nextron Systems)","Detects an executable that isn't dropbox but communicates with the Dropbox API","attack.command_and_control, attack.t1105","network_connection","windows","Not classified","Review network connection logs for communication with api.dropboxapi.com and content.dropboxapi.com 
Identify the process or executable initiating the connection 
Verify if the process or executable is legitimate or suspicious 
Check if the process or executable contains the string \Dropbox in its image path","Legitimate use of the Dropbox API by authorized applications","Initiated=""true"" DestinationHostname IN (""*api.dropboxapi.com"", ""*content.dropboxapi.com"") NOT Image=""*\\Dropbox*"""
"Suspicious Outbound Kerberos Connection","Ilyas Ochkov, oscd.community","Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.","attack.credential_access, attack.t1558, attack.lateral_movement, attack.t1550.003","network_connection","windows","Not classified","Review your network connection logs for events matching this rule. 
Focus on events where the ""DestinationPort"" is set to 88, which is the default port for Kerberos. 
Check if ""Initiated"" is set to true, indicating outbound network activity. 
Examine the ""Image"" field, which shows the executable responsible for the network activity. 
Investigate the purpose of the Kerberos connection - If the ""Image"" is lsass.exe, this could be a legitimate Windows process. - If the ""Image"" is a web browser executable, its likely normal web traffic. 
Consider the context of the event, such as user behavior and authentication patterns. 
If the traffic is suspicious and not expected, further investigation is required.","Legitimate use of Kerberos traffic is common in Windows environments and may include authentication and authorization processes. False positives may occur when normal Kerberos traffic is detected, such as when a user logs into a Windows machine or accesses network resources.","DestinationPort=88 Initiated=""true"" NOT (Image IN (""C:\\Windows\\System32\\lsass.exe"", ""C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"", ""C:\\Program Files\\Mozilla Firefox\\firefox.exe""))"
"Suspicious Program Location with Network Connections","Florian Roth (Nextron Systems), Tim Shelton","Detects programs with network connections running in suspicious files system locations","attack.command_and_control, attack.t1105","network_connection","windows","Not classified","Check the process image path and verify if it matches any known legitimate system directories. 
Review the process behavior and network connections to determine if it aligns with expected system behavior. 
Cross-reference the process with known good hashes or digital signatures. 
Analyze the process execution context and parent-child relationships to identify any suspicious activity. 
Monitor the process for any additional indicators of compromise, such as abnormal network traffic or file modifications.","Programs installed in legitimate system directories 
System processes accessing network connections in suspicious locations","Image IN (""*\\Users\\All Users\\*"", ""*\\Users\\Default\\*"", ""*\\Users\\Public\\*"", ""*\\Users\\Contacts\\*"", ""*\\Users\\Searches\\*"", ""*\\config\\systemprofile\\*"", ""*\\Windows\\Fonts\\*"", ""*\\Windows\\IME\\*"", ""*\\Windows\\addins\\*"") OR Image=""*\\$Recycle.bin"" OR Image=""C:\\Perflogs\\*"" NOT Image=""C:\\Users\\Public\\IBM\\ClientSolutions\\Start_Programs\\*"""
"CobaltStrike Named Pipe","Florian Roth (Nextron Systems), Wojciech Lesicki","Detects the creation of a named pipe as used by CobaltStrike","attack.defense_evasion, attack.privilege_escalation, attack.t1055","pipe_created","windows","Not classified","Inspect Sysmon logs for Event ID 17 and Event ID 18 that capture named pipe creation events. 
Look for named pipes with the following prefixes \MSSE-, \postex_, \status_, \msagent_, \mojo_, \interprocess_, \samr_, \netlogon_, \srvsvc_, \lsarpc_, \wkssvc_. 
Analyze the process that created the named pipe to determine if it is associated with CobaltStrike. 
Cross-reference the named pipe creation events with other security events and indicators of compromise to identify any malicious activity. 
Monitor for any suspicious or unauthorized named pipe creations that match the selection criteria.","Unknown","(PipeName=""*\\MSSE-*"" PipeName=""*-server*"") OR PipeName=""\\postex_*"" OR PipeName=""\\status_*"" OR PipeName=""\\msagent_*"" OR PipeName=""\\mojo_*"" OR PipeName=""\\interprocess_*"" OR PipeName=""\\samr_*"" OR PipeName=""\\netlogon_*"" OR PipeName=""\\srvsvc_*"" OR PipeName=""\\lsarpc_*"" OR PipeName=""\\wkssvc_*"""
"CobaltStrike Named Pipe Pattern Regex","Florian Roth (Nextron Systems)","Detects the creation of a named pipe matching a pattern used by CobaltStrike Malleable C2 profiles","attack.defense_evasion, attack.privilege_escalation, attack.t1055","pipe_created","windows","Not classified","Inspect the logs from Sysmon with Event ID 17 and Event ID 18 for named pipe creation events. 
Check for the presence of named pipes matching the provided regex patterns in the log entries. 
Verify the source and destination of the named pipe creation events. 
Look for any suspicious or unauthorized processes or users associated with the named pipe creation. 
Cross-reference the named pipe patterns with known legitimate applications or services that may use similar naming conventions. 
Investigate any anomalies or deviations from normal behavior in the named pipe creation events. 
Analyze any additional log sources that may provide context or corroborating evidence, such as network traffic logs or endpoint logs. 
Consult threat intelligence sources or security forums for any known CobaltStrike Malleable C2 profiles or related indicators of compromise (IOCs).","Unknown"
"CobaltStrike Named Pipe Patterns","Florian Roth (Nextron Systems), Christian Burkard (Nextron Systems)","Detects the creation of a named pipe with a pattern found in CobaltStrike malleable C2 profiles","attack.defense_evasion, attack.privilege_escalation, attack.t1055","pipe_created","windows","Not classified","Check the process creating the named pipe and verify if it is a legitimate process or associated with CobaltStrike. Look for any suspicious behavior or indicators of compromise in the processs activity. 
Analyze the network traffic associated with the named pipe to identify any malicious communication or C2 activity. 
Inspect the file system for any related artifacts or files associated with CobaltStrike. 
Correlate the named pipe creation with other security events or alerts to identify any patterns or anomalies. 
Consult threat intelligence sources or security forums to gather additional information about the named pipe and its association with CobaltStrike.","Chrome instances using the exact same pipe name ""mojo.xxx""","PipeName IN (""\\DserNamePipe*"", ""\\f4c3*"", ""\\f53f*"", ""\\fullduplex_*"", ""\\mojo.5688.8052.183894939787088877*"", ""\\mojo.5688.8052.35780273329370473*"", ""\\MsFteWds*"", ""\\msrpc_*"", ""\\mypipe-f*"", ""\\mypipe-h*"", ""\\ntsvcs*"", ""\\PGMessagePipe*"", ""\\rpc_*"", ""\\scerpc*"", ""\\SearchTextHarvester*"", ""\\spoolss*"", ""\\win_svc*"", ""\\win\\msrpc_*"", ""\\windows.update.manager*"", ""\\wkssvc*"") OR PipeName IN (""\\demoagent_11"", ""\\demoagent_22"") OR (PipeName=""\\Winsock2\\CatalogChangeListener-*"" PipeName=""*-0,"") NOT (PipeName IN (""\\wkssvc"", ""\\spoolss"", ""\\scerpc"", ""\\ntsvcs"", ""\\SearchTextHarvester"", ""\\PGMessagePipe"", ""\\MsFteWds""))"
"HackTool - Credential Dumping Tools Named Pipe Created","Teymur Kheirkhabarov, oscd.community","Detects well-known credential dumping tools execution via specific named pipe creation","attack.credential_access, attack.t1003.001, attack.t1003.002, attack.t1003.004, attack.t1003.005","pipe_created","windows","Not classified","Check the logs from Sysmon with Event ID 17 and Event ID 18 for named pipe creation events. 
Look for the specific named pipes mentioned in the detection rule \cachedump, \lsadump, \wceservicepipe. 
Verify if the named pipe creation events are associated with any suspicious processes or activities. 
Cross-reference the timestamps of the named pipe creation events with other security events to identify any correlation or potential malicious activity. 
If necessary, investigate the legitimacy of the administrators actions by reviewing their access rights and permissions. 
Consider analyzing the behavior and reputation of the processes involved in the named pipe creation events. 
Consult any available threat intelligence sources to determine if the named pipes are associated with known credential dumping tools.","Legitimate Administrator using tool for password recovery","PipeName IN (""*\\cachedump*"", ""*\\lsadump*"", ""*\\wceservicepipe*"")"
"Malicious Named Pipe Created","Florian Roth (Nextron Systems), blueteam0ps, elhoim","Detects the creation of a named pipe seen used by known APTs or malware.","attack.defense_evasion, attack.privilege_escalation, attack.t1055","pipe_created","windows","Not classified","Check the process that created the named pipe and verify its legitimacy 
Analyze the command-line arguments or parameters used to create the named pipe 
Cross-reference the named pipe with known legitimate named pipes 
Check for any suspicious or malicious activity associated with the named pipe, such as unusual network connections or file access 
Review the logs of relevant applications or services that may interact with the named pipe, such as PowerShell or Cobalt Strike 
Monitor for any subsequent actions or behaviors associated with the named pipe, such as file transfers or privilege escalation attempts","Legitimate named pipes created by system processes or applications 
Named pipes created by legitimate software tools like PowerShell remoting or Cobalt Strike 
Named pipes created during normal system operations","PipeName IN (""\\46a676ab7f179e511e30dd2dc41bd388"", ""\\583da945-62af-10e8-4902-a8f205c72b2e"", ""\\6e7645c4-32c5-4fe3-aabf-e94c2f4370e7"", ""\\9f81f59bc58452127884ce513865ed20"", ""\\adschemerpc"", ""\\ahexec"", ""\\AnonymousPipe"", ""\\bc31a7"", ""\\bc367"", ""\\bizkaz"", ""\\csexecsvc"", ""\\dce_3d"", ""\\e710f28d59aa529d6792ca6ff0ca1b34"", ""\\gruntsvc"", ""\\isapi_dg"", ""\\isapi_dg2"", ""\\isapi_http"", ""\\jaccdpqnvbrrxlaf"", ""\\lsassw"", ""\\NamePipe_MoreWindows"", ""\\pcheap_reuse"", ""\\Posh*"", ""\\rpchlp_3"", ""\\sdlrpc"", ""\\svcctl"", ""\\testPipe"", ""\\winsession"")"
"WMI Event Consumer Created Named Pipe","Florian Roth (Nextron Systems)","Detects the WMI Event Consumer service scrcons.exe creating a named pipe","attack.t1047, attack.execution","pipe_created","windows","Not classified","Review the logs from Sysmon with Event ID 17 and Event ID 18 
Look for instances where the Image field ends with \scrcons.exe 
Verify if the named pipe creation is associated with legitimate activities or if it indicates malicious behavior 
Cross-reference the event with other relevant logs, such as process creation logs, network logs, and endpoint security logs, to gather additional context 
If necessary, analyze the behavior of the process creating the named pipe using tools like Process Monitor or Process Explorer","Legitimate use of WMI Event Consumer service creating a named pipe 
False positive due to misconfiguration or misinterpretation of the log data","Image=""*\\scrcons.exe"""
"ADFS Database Named Pipe Connection","Roberto Rodriguez @Cyb3rWard0g","Detects suspicious local connections via a named pipe to the AD FS configuration database (Windows Internal Database).
Used to access information such as the AD FS configuration settings which contains sensitive information used to sign SAML tokens.
","attack.collection, attack.t1005","pipe_created","windows","Not classified","Review the logs from Sysmon with Event ID 17 and Event ID 18 to identify named pipe events. 
Look for named pipe connections with the PipeName \MICROSOFT##WID\tsql\query. 
Check the processes involved in the connection and verify if they are legitimate or suspicious. 
Investigate any processes that match the filter condition but are not indicative of malicious activity, as they may be false positives. 
Correlate the named pipe connection with other security events and indicators of compromise to determine the extent of the potential threat. 
Consider analyzing the network traffic associated with the named pipe connection to gather additional information. 
Consult relevant documentation and resources to understand the context and implications of the AD FS configuration database connection. 
If necessary, escalate the investigation to the appropriate teams or stakeholders for further analysis and response.","Legitimate processes that match the filter condition but are not indicative of malicious activity","PipeName=""\\MICROSOFT##WID\\tsql\\query"" NOT (Image IN (""*\\Microsoft.IdentityServer.ServiceHost.exe"", ""*\\Microsoft.Identity.Health.Adfs.PshSurrogate.exe"", ""*\\AzureADConnect.exe"", ""*\\Microsoft.Tri.Sensor.exe"", ""*\\wsmprovhost.exe"", ""*\\mmc.exe"", ""*\\sqlservr.exe"", ""*\\tssdis.exe"", ""*C:\\Windows\\system32\\svchost.exe""))"
"CMSTP Execution Process Access","Nik Seetharaman","Detects various indicators of Microsoft Connection Manager Profile Installer execution","attack.defense_evasion, attack.t1218.003, attack.execution, attack.t1559.001, attack.g0069, attack.g0080, car.2019-04-001","process_access","windows","Not classified","Review the CommandLine and ParentCommandLine fields in the logs to identify the presence of CMSTP execution. 
Look for any suspicious or unexpected use of CMSTP, especially in combination with other indicators of malicious activity. 
Cross-reference the CMSTP execution with other logs, such as network traffic logs or endpoint logs, to gather additional context and evidence of compromise.","Legitimate CMSTP use (unlikely in modern enterprise environments)","CallTrace=""*cmlua.dll*"""
"CobaltStrike BOF Injection Pattern","Christian Burkard (Nextron Systems)","Detects a typical pattern of a CobaltStrike BOF which inject into other processes","attack.execution, attack.t1106, attack.defense_evasion, attack.t1562.001","process_access","windows","Not classified","Check if the detected process injection is associated with known security tools or system components. Examples of log sources to investigate include 
Endpoint protection logs 
Application control logs 
System event logs 
Analyze the process access patterns during software installation or updates to determine if they match the detection rule. Examples of log sources to investigate include 
Windows Installer logs 
Patch management logs 
Software deployment logs","Legitimate process injection techniques used by security tools or system components 
Legitimate process access patterns during software installation or updates","GrantedAccess IN (""0x1028"", ""0x1fffff"")"
"SysmonEnte Usage","Florian Roth (Nextron Systems)","Detects the use of SysmonEnte, a tool to attack the integrity of Sysmon","attack.defense_evasion, attack.t1562.002","process_access","windows","Not classified","Check the process execution logs for instances of Sysmon64.exe with GrantedAccess value of 0x1400 
Review the process execution logs for any instances where the SourceImage starts with C\Program Files or C\Windows\System32\, excluding cases where the process is related to Windows Defender 
Analyze the CallTrace field in the process execution logs for the presence of Ente 
Verify if the use of SysmonEnte is authorized or expected in the environment 
Cross-reference the detection with other security events or indicators of compromise to determine the context and severity of the activity","Legitimate use of SysmonEnte for testing or research purposes 
False positive due to similar process names or access patterns 
Legitimate use of Sysmon64.exe with the specified access rights 
Legitimate use of C\Program Files or C\Windows\System32\ in the SourceImage","(TargetImage=""C:\\Windows\\Sysmon64.exe"" GrantedAccess=""0x1400"" NOT (SourceImage IN (""C:\\Program Files*"", ""C:\\Windows\\System32\\*"") OR (SourceImage=""C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\*"" SourceImage=""*\\MsMpEng.exe""))) OR CallTrace=""Ente"""
"HandleKatz Duplicating LSASS Handle","Bhabesh Raj (rule), @thefLinkk","Detects HandleKatz opening LSASS to duplicate its handle to later dump the memory without opening any new handles","attack.execution, attack.t1106, attack.defense_evasion, attack.t1003.001","process_access","windows","Not classified","Check if the process accessing LSASS is a legitimate system process or a known application 
Review the call trace to identify any suspicious or unauthorized activities 
Cross-reference with other security events or logs to gather additional context 
Analyze the process behavior and its relationship with other processes or network activity 
Consult with system administrators or application owners to validate the activity","Legitimate processes accessing LSASS for authorized purposes 
Security tools or monitoring agents performing LSASS-related activities 
Known system or application behavior that triggers the detection","TargetImage=""*\\lsass.exe"" GrantedAccess=""0x1440"" CallTrace=""C:\\Windows\\System32\\ntdll.dll+*"" CallTrace=""*|UNKNOWN(*"" CallTrace=""*)"""
"Credential Dumping by LaZagne","Bhabesh Raj, Jonhnathan Ribeiro","Detects LSASS process access by LaZagne for credential dumping.","attack.credential_access, attack.t1003.001, attack.s0349","process_access","windows","Not classified","Review the process access logs for LSASS.exe on Windows systems. 
Look for the presence of the specific DLLs mentioned in the CallTrace field. 
Check if the GrantedAccess value is set to 0x1FFFFF.","Unknown","TargetImage=""*\\lsass.exe"" CallTrace=""*C:\\Windows\\SYSTEM32\\ntdll.dll+*"" CallTrace=""*|C:\\Windows\\System32\\KERNELBASE.dll+*"" CallTrace=""*_ctypes.pyd+*"" CallTrace=""*python27.dll+*"" GrantedAccess=""0x1FFFFF"""
"LittleCorporal Generated Maldoc Injection","Christian Burkard (Nextron Systems)","Detects the process injection of a LittleCorporal generated Maldoc.","attack.execution, attack.t1204.002, attack.t1055.003","process_access","windows","Not classified","Check for any legitimate use of process injection techniques by authorized tools or scripts. 
Verify if the detected process injection is part of a known software installation or update process. 
Analyze the behavior of the process and its associated network connections for any malicious activity. 
Review the processs parent-child relationship to identify any suspicious or unauthorized processes. 
Inspect the system for any signs of compromise, such as additional malicious files or registry modifications.","Unknown","SourceImage=""*\\winword.exe"" CallTrace=""*:\\Windows\\Microsoft.NET\\Framework64\\v2.*"" CallTrace=""*UNKNOWN*"""
"Load Undocumented Autoelevated COM Interface","oscd.community, Dmitry Uchakin","COM interface (EditionUpgradeManager) that is not used by standard executables.","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_access","windows","Not classified","Review the CallTrace field in the logs to identify the process that loaded the editionupgrademanagerobj.dll. 
Check if the process loading the editionupgrademanagerobj.dll is a known and authorized application. 
If the process is not recognized or suspicious, investigate further to determine its origin and purpose. 
Cross-reference the activity with other security events and logs to identify any additional indicators of compromise or malicious behavior.","Legitimate use of the EditionUpgradeManager COM interface by authorized applications. 
Instances where the editionupgrademanagerobj.dll is loaded as part of a legitimate software installation or update process.","CallTrace=""*editionupgrademanagerobj.dll*"""
"Lsass Memory Dump via Comsvcs DLL","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass.","attack.credential_access, attack.t1003.001","process_access","windows","Not classified","Review process access logs for instances of rundll32.exe accessing lsass.exe with comsvcs.dll in the call trace. 
Check if the process access is performed by a legitimate user or a suspicious account. 
Look for any abnormal or unauthorized use of the MiniDump export function from comsvcs.dll via rundll32. 
Correlate the activity with other security events or indicators of compromise to determine if it is part of a larger attack. 
If in doubt, consult with the system owner or authorized personnel to confirm the legitimacy of the activity.","Legitimate use of MiniDump export function from comsvcs.dll via rundll32 for authorized system troubleshooting or debugging purposes.","TargetImage=""*\\lsass.exe"" SourceImage=""C:\\Windows\\System32\\rundll32.exe"" CallTrace=""*comsvcs.dll*"""
"LSASS Memory Dump","Samir Bousseaden, Michael Haag","Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up.","attack.credential_access, attack.t1003.001, attack.s0002","process_access","windows","Not classified","Check the logs from the Windows Security Event Log for process access events that match the selection criteria 
['TargetImage ends with \\lsass.exe'] 
['GrantedAccess contains 0x1038, 0x1438, or 0x143a'] 
['CallTrace contains dbghelp.dll, dbgcore.dll, or ntdll.dll'] 
Review the logs from the following log sources 
['Windows Security Event Log'] 
['Sysmon logs (C\\Windows\\Sysmon64.exe)'] 
Look for any suspicious activity related to LSASS memory dump tools such as Mimikatz, NanoDump, Invoke-Mimikatz, Procdump, or Taskmgr. 
Pay attention to any anomalous or unauthorized access to the LSASS process. 
Investigate any processes or command lines associated with the LSASS memory dump tools. 
Analyze the CallTrace to identify any abnormal behavior or indications of memory dumping. 
Cross-reference the findings with threat intelligence sources and known indicators of compromise (IOCs).","False positives are present when looking for 0x1410. Exclusions may be required.","TargetImage=""*\\lsass.exe"" GrantedAccess IN (""*0x1038*"", ""*0x1438*"", ""*0x143a*"") CallTrace IN (""*dbghelp.dll*"", ""*dbgcore.dll*"", ""*ntdll.dll*"") NOT ((CallTrace=""*|C:\\Windows\\Temp\\asgard2-agent\\*"" CallTrace=""*\\thor\\thor64.exe+*"" CallTrace=""*|UNKNOWN(*"" GrantedAccess=""0x103800"") OR SourceImage=""C:\\Windows\\Sysmon64.exe"")"
"LSASS Access from White-Listed Processes","Florian Roth (Nextron Systems)","Detects a possible process memory dump that uses the white-listed filename like TrolleyExpress.exe as a way to dump the lsass process memory without Microsoft Defender interference","attack.credential_access, attack.t1003.001, attack.s0002","process_access","windows","Not classified","Review the process access logs for instances where the lsass.exe process is accessed by the white-listed processes (TrolleyExpress.exe, ProcessDump.exe, dump64.exe). 
Check if the access is performed with any of the granted access rights specified in the rule. 
Verify if the access is performed by any legitimate system administration tools or security tools that may access lsass.exe for authorized purposes. 
If the access is not expected or authorized, investigate further to determine if it is an attempt to dump the lsass process memory without Microsoft Defender interference.","Legitimate system administration tools or security tools that may access lsass.exe for authorized purposes","TargetImage=""*\\lsass.exe"" SourceImage IN (""*\\TrolleyExpress.exe"", ""*\\ProcessDump.exe"", ""*\\dump64.exe"") GrantedAccess IN (""*10"", ""*30"", ""*50"", ""*70"", ""*90"", ""*B0"", ""*D0"", ""*F0"", ""*18"", ""*38"", ""*58"", ""*78"", ""*98"", ""*B8"", ""*D8"", ""*F8"", ""*1A"", ""*3A"", ""*5A"", ""*7A"", ""*9A"", ""*BA"", ""*DA"", ""*FA"", ""*0x14C2"", ""*FF"")"
"LSASS Memory Access by Tool Named Dump","Florian Roth (Nextron Systems)","Detects a possible process memory dump based on a keyword in the file name of the accessing process","attack.credential_access, attack.t1003.001, attack.s0002","process_access","windows","Not classified","Review the process access logs on Windows systems for instances where the TargetImage ends with \lsass.exe and the SourceImage contains the keyword dump. 
Check the GrantedAccess field for values that end with 10, 30, 50, 70, 90, B0, D0, F0, 18, 38, 58, 78, 98, B8, D8, F8, 1A, 3A, 5A, 7A, 9A, BA, DA, FA, 0x14C2, or FF. 
Verify if the accessing process is a known legitimate program that contains the word dump in its name and has a valid reason to access lsass.exe. 
If the accessing process is not a known legitimate program, further investigation is required to determine if it is a malicious tool attempting to dump credentials from the LSASS process.","Rare programs that contain the word dump in their name and access lsass","TargetImage=""*\\lsass.exe"" SourceImage=""*dump*"" GrantedAccess IN (""*10"", ""*30"", ""*50"", ""*70"", ""*90"", ""*B0"", ""*D0"", ""*F0"", ""*18"", ""*38"", ""*58"", ""*78"", ""*98"", ""*B8"", ""*D8"", ""*F8"", ""*1A"", ""*3A"", ""*5A"", ""*7A"", ""*9A"", ""*BA"", ""*DA"", ""*FA"", ""*0x14C2"", ""*FF"")"
"WerFault Accassing LSASS","Florian Roth (Nextron Systems)","Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up.","attack.credential_access, attack.t1003.001, attack.s0002","process_access","windows","Not classified","Check for any legitimate processes or system operations that may trigger a crash dump of lsass.exe, such as system updates or software installations. 
Review the system logs for any related events or errors that may indicate a legitimate reason for WerFault accessing lsass.exe. 
Analyze the memory dump files generated by WerFault to determine if any malicious activity is present, such as the presence of Mimikatz or other credential dumping tools.","Actual failures in lsass.exe that trigger a crash dump (unlikely) 
Unknown cases in which WerFault accesses lsass.exe","SourceImage=""*\\WerFault.exe"" TargetImage=""*\\lsass.exe"" GrantedAccess=""0x1FFFFF"""
"Malware Shellcode in Verclsid Target Process","John Lambert (tech), Florian Roth (Nextron Systems)","Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro","attack.defense_evasion, attack.privilege_escalation, attack.t1055","process_access","windows","Not classified","Check the process access events with Event ID 10 on the Windows system 
Look for the presence of verclsid.exe in the TargetImage field 
Verify if the process has been granted excessive access rights (0x1FFFFF) 
Examine the CallTrace field for the presence of UNKNOWN( and VBE7.DLL 
Investigate the SourceImage field for the presence of \Microsoft Office\ and the CallTrace field for UNKNOWN 
Cross-reference the detected process with known legitimate processes that access verclsid.exe 
Analyze the context and behavior of the process to determine if it is malicious 
Consider system misconfigurations or anomalies that may cause false positives","Legitimate processes accessing verclsid.exe for valid reasons 
False positives caused by misconfiguration or system anomalies","TargetImage=""*\\verclsid.exe"" GrantedAccess=""0x1FFFFF"" (CallTrace=""*|UNKNOWN(*"" CallTrace=""*VBE7.DLL*"") OR (SourceImage=""*\\Microsoft Office\\*"" CallTrace=""*|UNKNOWN*"")"
"Mimikatz through Windows Remote Management","Patryk Prauze - ING Tech","Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe.","attack.credential_access, attack.execution, attack.t1003.001, attack.t1059.001, attack.lateral_movement, attack.t1021.006, attack.s0002","process_access","windows","Not classified","Review the process access logs from Windows systems to identify instances where wsmprovhost.exe accesses the lsass process. 
Look for patterns of suspicious activity, such as frequent or unusual access to lsass by wsmprovhost.exe. 
Correlate the process access logs with other security events or indicators of compromise to determine if the activity is part of a larger attack. 
Consider the context of the activity, including the user account associated with the wsmprovhost.exe process and any other relevant log data. 
If in doubt, consult with system administrators or other security analysts to determine if the activity is expected or requires further investigation.","There may be legitimate cases where wsmprovhost.exe accesses the lsass process for valid reasons, such as system administration tasks or authorized remote management activities.","TargetImage=""*\\lsass.exe"" SourceImage=""C:\\Windows\\system32\\wsmprovhost.exe"" NOT GrantedAccess=""0x80000000"""
"Credential Dumping by Pypykatz","Bhabesh Raj","Detects LSASS process access by pypykatz for credential dumping.","attack.credential_access, attack.t1003.001","process_access","windows","Not classified","1. Check if pypykatz is authorized and being used for legitimate purposes, such as password recovery or forensic analysis. 
2. Verify if LSASS process access by pypykatz is expected and aligned with the organizations security policies. 
3. Review the command-line arguments and parameters used with pypykatz to determine if they are consistent with authorized usage. 
4. Cross-reference the activity with user access logs, authentication logs, and any other relevant logs to identify any suspicious or unauthorized activity. 
5. If possible, analyze the memory dumps of the LSASS process to identify any signs of credential dumping or unauthorized access. 
6. Consult with the system owner or user to confirm the purpose and intent behind the use of pypykatz and LSASS process access.","Legitimate use of pypykatz for authorized credential retrieval.","TargetImage=""*\\lsass.exe"" CallTrace=""*C:\\Windows\\SYSTEM32\\ntdll.dll+*"" CallTrace=""*C:\\Windows\\System32\\KERNELBASE.dll+*"" CallTrace=""*libffi-7.dll*"" CallTrace=""*_ctypes.pyd+*"" CallTrace=""*python3*.dll+*"" GrantedAccess=""0x1FFFFF"""
"Potential Shellcode Injection","Bhabesh Raj","Detects potential shellcode injection used by tools such as Metasploit's migrate and Empire's psinject","attack.defense_evasion, attack.privilege_escalation, attack.t1055","process_access","windows","Not classified","Check if the process accessing another process is a known legitimate process. For example, check if the SourceImage and TargetImage paths match known paths of legitimate processes. 
Verify if the GrantedAccess value is within the expected range for legitimate processes. 
Analyze the CallTrace to determine if it contains any suspicious or malicious code. 
Cross-reference the detected process with known legitimate processes that use shellcode injection techniques, such as Metasploits migrate or Empires psinject. 
Review the logs of Dell software, such as Dell Update Service or Dell Data Vault Data Collector, to confirm if the detected activity is expected and legitimate. 
Review the logs of Microsoft Visual Studio to confirm if the detected activity is expected and legitimate. 
Review the logs of the WMI service to confirm if the detected activity is expected and legitimate.","Legitimate use of Metasploits migrate or Empires psinject 
Legitimate use of Dell software 
Legitimate use of Microsoft Visual Studio 
Legitimate use of Dell Data Vault Data Collector 
Legitimate use of WMI service","GrantedAccess IN (""0x147a"", ""0x1f3fff"") CallTrace=""*UNKNOWN*"" NOT ((SourceImage IN (""C:\\Program Files\\Dell\\*"", ""C:\\Program Files (x86)\\Dell\\*"") TargetImage IN (""C:\\Program Files\\Dell\\*"", ""C:\\Program Files (x86)\\Dell\\*"") GrantedAccess=""0x1F3FFF"" CallTrace=""C:\\Windows\\System32\\ntdll.dll*"") OR (SourceImage=""C:\\Program Files (x86)\\Dell\\UpdateService\\ServiceShell.exe"" TargetImage=""C:\\Windows\\Explorer.EXE"" GrantedAccess=""0x1F3FFF"" CallTrace=""C:\\Windows\\System32\\ntdll.dll*"") OR (SourceImage IN (""C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\IDE\\PerfWatson2.exe"", ""C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\Common7\\IDE\\PerfWatson2.exe"") TargetImage IN (""C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\Common7\\IDE\\devenv.exe"", ""C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\Common7\\IDE\\devenv.exe"") CallTrace=""C:\\Windows\\System32\\ntdll.dll*"") OR (SourceImage=""C:\\Program Files\\Microsoft Visual Studio\\*"" SourceImage=""*\\MSBuild\\Current\\Bin\\MSBuild.exe"" TargetImage=""C:\\Program Files\\Dell\\DellDataVault\\DDVDataCollector.exe"") OR (SourceImage=""C:\\Windows\\System32\\Wbem\\Wmiprvse.exe"" TargetImage=""C:\\Windows\\system32\\lsass.exe"" CallTrace=""C:\\Windows\\SYSTEM32\\ntdll.dll*""))"
"Suspicious LSASS Access Via MalSecLogon","Samir Bousseaden (original elastic rule), Nasreddine Bencherchali (sigma)","Detects suspicious access to Lsass handle via a call trace to ""seclogon.dll""","attack.credential_access, attack.t1003.001","process_access","windows","Not classified","Check the process tree to identify the parent process of svchost.exe and verify its legitimacy 
Review the command-line arguments of svchost.exe to identify any suspicious behavior 
Analyze the call trace to seclogon.dll to determine if it matches known malicious patterns 
Correlate the detection with other security events or alerts to identify any related suspicious activities 
Check the digital signature of seclogon.dll to ensure its integrity and authenticity 
Monitor the behavior of the system and network traffic for any signs of lateral movement or credential abuse","Legitimate use of seclogon.dll by authorized system processes 
Legitimate use of svchost.exe accessing lsass.exe with the specified granted access 
Legitimate use of seclogon.dll by security tools or monitoring agents","TargetImage=""*\\lsass.exe"" SourceImage=""*\\svchost.exe"" GrantedAccess=""0x14c0"" CallTrace=""*seclogon.dll*"""
"SVCHOST Credential Dump","Florent Labouyrie","Detects when a process, such as mimikatz, accesses the memory of svchost to dump credentials","attack.t1548","process_access","windows","Not classified","Review the process access logs for svchost.exe and identify the process that accessed its memory. 
Check if the process accessing svchost memory is a known legitimate system administration tool or process. 
If the process is not a known legitimate tool or process, investigate further for signs of credential dumping activity, such as the presence of mimikatz or other credential dumping tools. 
Correlate the activity with other security events or indicators of compromise to determine the extent of the potential breach.","Legitimate system administration tools or processes that may access svchost memory for valid reasons, such as antivirus software or system monitoring tools.","TargetImage=""*\\svchost.exe"" GrantedAccess=""0x143a"" NOT (SourceImage IN (""*\\services.exe"", ""*\\msiexec.exe""))"
"UAC Bypass Using WOW64 Logger DLL Hijack","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using a WoW64 logger DLL hijack (UACMe 30)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_access","windows","Not classified","Check for any suspicious processes accessing files in \Windows\SysWOW64\ 
Review the call trace of the suspicious process to identify any unknown or unauthorized activity 
Verify the legitimacy of the access by checking the process and its associated image 
Cross-reference with trusted applications that may use WOW64 logger DLL hijack for legitimate purposes 
Analyze the context and behavior of the process to determine if it aligns with UAC bypass techniques","Legitimate use of WOW64 logger DLL hijack by trusted applications 
Legitimate access to \Windows\SysWOW64\ by system processes","SourceImage=""*:\\Windows\\SysWOW64\\*"" GrantedAccess=""0x1fffff"" CallTrace=""UNKNOWN(0000000000000000)|UNKNOWN(0000000000000000)|*"""
"Potential Credential Dumping Attempt Via PowerShell","oscd.community, Natalia Shornikova","Detects PowerShell processes requesting access to ""lsass.exe""","attack.credential_access, attack.t1003.001","process_access","windows","Not classified","Review the process access logs from Windows event logs or SIEM for instances where PowerShell processes request access to lsass.exe. 
Look for the specific process names powershell.exe or pwsh.exe in the SourceImage field. 
Check if the TargetImage field ends with \lsass.exe. 
Analyze the associated process parameters and command-line arguments for any suspicious or unauthorized activity. 
Correlate the event with other security events or indicators of compromise (IOCs) to identify any potential credential dumping attempts. 
If possible, review the PowerShell script or command executed by the process to understand the intent and potential impact.","Legitimate use of PowerShell for administrative purposes, such as scheduled tasks or system management.","SourceImage IN (""*\\powershell.exe"", ""*\\pwsh.exe"") TargetImage=""*\\lsass.exe"""
"Suspicious AgentExecutor PowerShell Execution","Nasreddine Bencherchali (Nextron Systems), memory-shards","Detects execution of the AgentExecutor.exe binary. Which can be abused as a LOLBIN to execute powershell scripts with the ExecutionPolicy ""Bypass"" or any binary named ""powershell.exe"" located in the path provided by 6th positional argument","attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Not available","Not available","Image=""*\\AgentExecutor.exe"" OR OriginalFileName=""AgentExecutor.exe"" CommandLine IN (""* -powershell*"", ""* -remediationScript*"") NOT (CommandLine IN (""*C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\*"", ""*C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\*""))"
"Interactive AT Job","E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community","Detects an interactive AT job, which may be used as a form of privilege escalation.","attack.privilege_escalation, attack.t1053.002","process_creation","windows","Not classified","Review your process creation logs for events matching this rule. 
Focus on events where the ""Image"" ends with \at.exe, indicating the use of the at command-line tool. 
Check if the ""CommandLine"" contains interactive, which is a strong indicator of an interactive AT job. 
Investigate the context of the event, such as the user account responsible for creating the AT job. 
Consider the purpose of the interactive AT job and whether it aligns with legitimate activities. Be especially cautious if it is related to privilege escalation. 
Verify the state of at.exe on the system, as it is deprecated as of Windows 8. If detected on a newer Windows version, it may warrant further investigation.","This detection is unlikely to have false positives since the presence of an interactive AT job should be a rare occurrence and may indicate an attempt at privilege escalation.","Image=""*\\at.exe"" CommandLine=""*interactive*"""
"Audit Policy Tampering Via NT Resource Kit Auditpol","Nasreddine Bencherchali (Nextron Systems)","Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.
","attack.defense_evasion, attack.t1562.002","process_creation","windows","Not classified","Check the process creation logs on Windows systems for any instances of the auditpol binary being executed with the suspicious command line arguments. 
Look for any modifications made to the audit policy configuration on the affected systems. 
Review any changes to the auditpol binary itself, such as file modifications or unusual file locations. 
Analyze any other relevant logs, such as system logs or security logs, for any suspicious activities or indicators of compromise.","The old auditpol utility isnt available by default on recent versions of Windows as it was replaced by a newer version. The FP rate should be very low except for tools that use a similar flag structure","CommandLine IN (""*/logon:none*"", ""*/system:none*"", ""*/sam:none*"", ""*/privilege:none*"", ""*/object:none*"", ""*/process:none*"", ""*/policy:none*"")"
"Audit Policy Tampering Via Auditpol","Janantha Marasinghe (https://github.com/blueteam0ps)","Threat actors can use auditpol binary to change audit policy configuration to impair detection capability.
This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.
","attack.defense_evasion, attack.t1562.002","process_creation","windows","Not classified","Check the process creation logs for instances of auditpol.exe being executed with command line arguments related to disabling, clearing, removing, or restoring audit policies. 
Review any changes made to the audit policy configuration and compare them against known legitimate changes made by system administrators. 
Cross-reference the activity with other security events or indicators of compromise to identify any suspicious or malicious behavior.","Legitimate system administrators may use auditpol to modify audit policies for legitimate purposes.","Image=""*\\auditpol.exe"" OR OriginalFileName=""AUDITPOL.EXE"" CommandLine IN (""*disable*"", ""*clear*"", ""*remove*"", ""*restore*"")"
"Boot Configuration Tampering Via Bcdedit.EXE","E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community","Detects the use of the bcdedit command to tamper with the boot configuration data. This technique is often times used by malware or attackers as a destructive way before launching ransomware.","attack.impact, attack.t1490","process_creation","windows","Not classified","Check the command line arguments of the process creation events for the presence of bcdedit.exe and set keywords. 
Review the ComputerName, User, and CommandLine fields in the process creation events for any suspicious activity. 
Cross-reference the CommandLine field with known legitimate uses of bcdedit.exe to identify false positives. 
Investigate any instances where bootstatuspolicy ignoreallfailures or recoveryenabled no are set, as these may indicate malicious activity. 
Review any associated network or file activity that may be related to the suspicious bcdedit.exe command.","Legitimate system administrators or IT personnel may use bcdedit.exe to modify boot configuration data for legitimate purposes.","Image=""*\\bcdedit.exe"" OR OriginalFileName=""bcdedit.exe"" CommandLine=""*set*"" (CommandLine=""*bootstatuspolicy*"" CommandLine=""*ignoreallfailures*"") OR (CommandLine=""*recoveryenabled*"" CommandLine=""*no*"")"
"Potential Data Stealing Via Chromium Headless Debugging","Nasreddine Bencherchali (Nextron Systems)","Detects chromium based browsers starting in headless and debugging mode and pointing to a user profile. This could be a sign of data stealing or remote control","attack.credential_access, attack.t1185","process_creation","windows","Not classified","Not available","Not available","CommandLine=""*--remote-debugging-*"" CommandLine=""*--user-data-dir*"" CommandLine=""*--headless*"""
"File Download with Headless Browser","Sreeman, Florian Roth (Nextron Systems)","Detects execution of chromium based browser in headless mode using the ""dump-dom"" command line to download files","attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Review process creation logs for instances of the specified browser executables (e.g., brave.exe, chrome.exe, msedge.exe, opera.exe, vivaldi.exe) being launched with the --headless flag and the dump-dom command line argument. 
Check the command line arguments of the process to see if it contains the --headless flag and the dump-dom argument. 
Look for network traffic to HTTP URLs originating from the headless browser process. 
Inspect any downloaded files to determine if they are suspicious or match known indicators of compromise.","Legitimate use of headless browsers for web scraping or automated testing","Image IN (""*\\brave.exe"", ""*\\chrome.exe"", ""*\\msedge.exe"", ""*\\opera.exe"", ""*\\vivaldi.exe"") CommandLine=""*--headless*"" CommandLine=""*dump-dom*"" CommandLine=""*http*"""
"Tor Client/Browser Execution","frack113","Detects the use of Tor or Tor-Browser to connect to onion routing networks","attack.command_and_control, attack.t1090.003","process_creation","windows","Not classified","Review process creation logs for instances of tor.exe or Tor Browsers firefox.exe being executed. 
Look for any suspicious network traffic to known onion routing networks. 
Cross-reference with other security events or indicators of compromise (IOCs) to identify any malicious activity. 
Consider user behavior and context to determine if the use of Tor or Tor-Browser is legitimate or potentially malicious.","Legitimate use of Tor or Tor-Browser for privacy purposes","Image IN (""*\\tor.exe"", ""*\\Tor Browser\\Browser\\firefox.exe"")"
"Suspicious Calculator Usage","Florian Roth (Nextron Systems)","Detects suspicious use of 'calc.exe' with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion.
","attack.defense_evasion, attack.t1036","process_creation","windows","Not classified","Not available","Not available"
"Process Access via TrolleyExpress Exclusion","Florian Roth (Nextron Systems)","Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory","attack.defense_evasion, attack.t1218.011, attack.credential_access, attack.t1003.001","process_creation","windows","Not classified","Check the parent process of TrolleyExpress.exe to determine if it is being used in a legitimate manner. Look for any suspicious or unauthorized activity associated with the process. 
Review the command line arguments of TrolleyExpress.exe to identify any unusual or unexpected behavior. 
Correlate the TrolleyExpress.exe activity with other security events or indicators of compromise to determine if it is part of a larger attack or malicious activity. 
Monitor for any subsequent actions or events that may indicate unauthorized access or data exfiltration. 
Consult with system administrators or other relevant personnel to verify the purpose and legitimacy of TrolleyExpress.exe usage.","Legitimate use of TrolleyExpress.exe for authorized memory dumps","CommandLine IN (""*\\TrolleyExpress 7*"", ""*\\TrolleyExpress 8*"", ""*\\TrolleyExpress 9*"", ""*\\TrolleyExpress.exe 7*"", ""*\\TrolleyExpress.exe 8*"", ""*\\TrolleyExpress.exe 9*"", ""*\\TrolleyExpress.exe -ma *"") OR (Image=""*\\TrolleyExpress.exe"" NOT (OriginalFileName=""*CtxInstall*"" OR OriginalFileName!=*))"
"Curl Download And Execute Combination","Sreeman, Nasreddine Bencherchali (Nextron Systems)","Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later.","attack.execution, attack.t1218, attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Investigate the ParentImage field to determine the origin of the curl command. Look for any suspicious or unauthorized processes that may be invoking curl. Examples of log sources that can provide this information include 
Windows Security Event Logs (Event ID 4688) which capture process creation events. 
Endpoint Detection and Response (EDR) logs which provide detailed information about process execution. 
Network logs (e.g., firewall logs, proxy logs) which can show the destination URL being accessed by curl. 
Web server logs which can show requests made to download files using curl.","Legitimate use of curl for downloading files or accessing legitimate resources.","CommandLine=""* /c *"" CommandLine=""*curl *"" CommandLine=""*http*"" CommandLine=""*-o*"" CommandLine=""*&*"""
"Potential Privilege Escalation Using Symlink Between Osk and Cmd","frack113","Detects the creation of a symbolic link between ""cmd.exe"" and the accessibility on-screen keyboard binary (osk.exe) using ""mklink"". This technique provides an elevated command prompt to the user from the login screen without the need to log in.","attack.privilege_escalation, attack.persistence, attack.t1546.008","process_creation","windows","Not classified","Review process creation logs for instances of the mklink command being used with the arguments \osk.exe and \cmd.exe. 
Look for any abnormal or unauthorized usage of the mklink command. 
Check if the creation of the symbolic link between osk.exe and cmd.exe is part of a legitimate system administration activity or authorized debugging/troubleshooting process. 
Cross-reference with user activity logs to identify any suspicious or unauthorized actions associated with the creation of the symbolic link. 
Consult with system administrators or relevant personnel to validate the purpose and legitimacy of the symbolic link creation.","Legitimate use of mklink command for authorized system administration purposes. 
Legitimate use of symbolic links between osk.exe and cmd.exe for accessibility features. 
Legitimate use of symbolic links between osk.exe and cmd.exe for authorized debugging or troubleshooting purposes.","Image=""*\\cmd.exe"" OR OriginalFileName=""Cmd.Exe"" CommandLine=""*mklink*"" CommandLine=""*\\osk.exe*"" CommandLine=""*\\cmd.exe*"""
"VolumeShadowCopy Symlink Creation Via Mklink","Teymur Kheirkhabarov, oscd.community","Shadow Copies storage symbolic link creation using operating systems utilities","attack.credential_access, attack.t1003.002, attack.t1003.003","process_creation","windows","Not classified","Check for any legitimate administrative activity related to shadow copies and backup processes. 
Review the command line arguments of the process creation events. 
Look for any abnormal or unauthorized usage of mklink command with HarddiskVolumeShadowCopy parameter.","Legitimate administrator working with shadow copies, access for backup purposes","CommandLine=""*mklink*"" CommandLine=""*HarddiskVolumeShadowCopy*"""
"NtdllPipe Like Activity Execution","Florian Roth (Nextron Systems)","Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection. As seen being used in the POC NtdllPipe","attack.defense_evasion","process_creation","windows","Not classified","Check for the presence of other suspicious activities or commands executed by the same process or user. 
Review the command line arguments and parameters passed to the type command. 
Analyze the process tree to identify any abnormal parent-child relationships. 
Inspect the output file or pipe to determine if it contains sensitive or unexpected data. 
Cross-reference with other security events or alerts to identify any correlation or patterns.","Legitimate use of type command to read the content of ntdll.dll for troubleshooting purposes.","CommandLine IN (""*type %windir%\\system32\\ntdll.dll*"", ""*type %systemroot%\\system32\\ntdll.dll*"", ""*type c:\\windows\\system32\\ntdll.dll*"", ""*\\ntdll.dll > \\\\.\\pipe\\*"")"
"Potential CommandLine Path Traversal Via Cmd.EXE","xknow @xknow_infosec, Tim Shelton","Detects potential path traversal attempt via cmd.exe. Could indicate possible command/argument confusion/hijacking","attack.execution, attack.t1059.003","process_creation","windows","Not classified","Review process creation logs from Windows event logs or other process monitoring solutions. 
Look for instances of cmd.exe being executed with command line arguments such as /c, /k, or /r. 
Check for parent processes that contain path traversal sequences like /../../ in their command line. 
Investigate any instances of cmd.exe being executed with path traversal sequences like /../../ in their command line. 
Pay attention to any Java tools that may be loading libraries and producing false positives, such as \Tasktop\keycloak\bin\/../../jre\bin\java.","Java tools are known to produce false-positive when loading libraries","ParentImage=""*\\cmd.exe"" OR Image=""*\\cmd.exe"" OR OriginalFileName=""cmd.exe"" ParentCommandLine IN (""*/c*"", ""*/k*"", ""*/r*"") OR CommandLine IN (""*/c*"", ""*/k*"", ""*/r*"") ParentCommandLine=""/../../"" OR CommandLine=""*/../../*"" NOT CommandLine=""*\\Tasktop\\keycloak\\bin\\/../../jre\\bin\\java*"""
"Sticky Key Like Backdoor Execution","Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community","Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen","attack.privilege_escalation, attack.persistence, attack.t1546.008, car.2014-11-003, car.2014-11-008","process_creation","windows","Not classified","Review process creation logs from the Windows event logs, specifically focusing on the ParentImage, Image, and CommandLine fields. 
Look for instances where the ParentImage ends with \winlogon.exe and the Image ends with any of the following \cmd.exe, \cscript.exe, \mshta.exe, \powershell.exe, \pwsh.exe, \regsvr32.exe, \rundll32.exe, \wscript.exe, \wt.exe. 
Check if the CommandLine contains any of the following sethc.exe, utilman.exe, osk.exe, Magnify.exe, Narrator.exe, DisplaySwitch.exe. 
Analyze the context of the activity, including the user account, time of occurrence, and any additional suspicious behavior. 
Consult with system administrators or security personnel to determine if the activity was authorized or expected. 
If the activity is deemed suspicious, further investigation may be required to identify the presence of a backdoor or malicious activity.","There may be instances where legitimate system administrators or security tools use these commands and executables for legitimate purposes. It is important to verify the context and intent of the activity before considering it a false positive.","ParentImage=""*\\winlogon.exe"" Image IN (""*\\cmd.exe"", ""*\\cscript.exe"", ""*\\mshta.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\wscript.exe"", ""*\\wt.exe"") CommandLine IN (""*sethc.exe*"", ""*utilman.exe*"", ""*osk.exe*"", ""*Magnify.exe*"", ""*Narrator.exe*"", ""*DisplaySwitch.exe*"")"
"CMSTP Execution Process Creation","Nik Seetharaman","Detects various indicators of Microsoft Connection Manager Profile Installer execution","attack.defense_evasion, attack.execution, attack.t1218.003, attack.g0069, car.2019-04-001","process_creation","windows","Not classified","Review process creation logs from Windows Event Logs or Sysmon for instances where the ParentImage ends with \cmstp.exe. 
Analyze the CommandLine, ParentCommandLine, and Details fields of the process creation logs to identify any suspicious or malicious activity. 
Cross-reference the detected CMSTP execution with other security events or indicators of compromise to determine the severity and impact of the activity.","Legitimate CMSTP use (unlikely in modern enterprise environments)","ParentImage=""*\\cmstp.exe"""
"Conhost.exe CommandLine Path Traversal","Nasreddine Bencherchali (Nextron Systems)","detects the usage of path traversal in conhost.exe indicating possible command/argument confusion/hijacking","attack.execution, attack.t1059.003","process_creation","windows","Not classified","Review process creation logs from Windows event logs or other relevant sources. 
Look for instances of conhost.exe being executed with command line arguments containing path traversal patterns like /../../. 
Check for any abnormal or unexpected behavior associated with the conhost.exe process. 
Correlate the detection with other security events or indicators of compromise to determine the severity and impact of the potential command/argument confusion/hijacking.","Unlikely","ParentCommandLine=""*conhost*"" CommandLine=""*/../../*"""
"Control Panel Items","Kyaw Min Thein, Furkan Caliskan (@caliskanfurkan_)","Detects the malicious use of a control panel item","attack.execution, attack.defense_evasion, attack.t1218.002, attack.persistence, attack.t1546","process_creation","windows","Not classified","Check the process creation logs for instances of reg.exe being used with the add command and CurrentVersion\Control Panel\CPLs parameter. 
Look for command lines ending with .cpl that are not associated with system directories such as \System32\, %System%, or C\Windows\system32. 
Investigate instances of regsvr32 being used with the /s flag and igfxCPL.cpl parameter in the command line.","Legitimate use of control panel items by system administrators or authorized users","(Image=""*\\reg.exe"" OR OriginalFileName=""reg.exe"" CommandLine=""*add*"" CommandLine=""*CurrentVersion\\Control Panel\\CPLs*"") OR (CommandLine=""*.cpl"" NOT (CommandLine IN (""*\\System32\\*"", ""*%System%*"", ""*|C:\\Windows\\system32|*"") OR (CommandLine=""*regsvr32 *"" CommandLine=""* /s *"" CommandLine=""*igfxCPL.cpl*"")))"
"CreateDump Process Dump","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects uses of the createdump.exe LOLOBIN utility to dump process memory","attack.defense_evasion, attack.t1036, attack.t1003.001","process_creation","windows","Not classified","Check the process creation logs for instances of createdump.exe being executed. 
Look for command lines containing the flags -u, --full, -f, --name, and .dmp. 
Review the associated process information, such as the parent process, user account, and command line arguments. 
Cross-reference the process execution with other security events, such as network connections or file modifications, to determine if any malicious activity occurred.","Command lines that use the same flags","Image=""*\\createdump.exe"" OR OriginalFileName=""FX_VER_INTERNALNAME_STR"" CommandLine IN (""* -u *"", ""* --full *"", ""* -f *"", ""* --name *"", ""*.dmp *"")"
"Csc.EXE Execution Form Potentially Suspicious Parent","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems), X__Junior (Nextron Systems)","Detects a potentially suspicious parent of ""csc.exe"", which could be a sign of payload delivery.","attack.execution, attack.t1059.005, attack.t1059.007, attack.defense_evasion, attack.t1218.005, attack.t1027.004","process_creation","windows","Not classified","Check the parent process of csc.exe and verify if it is a known legitimate process. Examples of suspicious parent processes include cscript.exe, mshta.exe, winword.exe, and wscript.exe. 
Check the command line arguments of the parent process to identify any suspicious behavior. For example, if the parent process is powershell.exe or pwsh.exe and the command line contains the arguments -Encoded or FromBase64String, it could indicate malicious activity. 
Analyze the parent process command line for suspicious file locations. Look for command lines that contain paths like ProgramData, %LocalAppData%, AppData, Roaming, Users\Public, PerfLogs, Temporary Internet, Users\Favorites, Users\Favourites, Users\Contacts, or Users\Pictures. 
If available, check the logs of the parent process for any additional indicators of compromise or suspicious activity. 
If the parent process command line contains encoded or obfuscated data, consider decoding or deobfuscating it to reveal its true nature. 
If the parent process is executed from an Ansible playbook, investigate the playbook and associated tasks for any signs of malicious activity.","Legitimate use of csc.exe by developers for compiling C# code 
Legitimate use of csc.exe by .NET framework 
Legitimate use of csc.exe by build automation tools like MSBuild 
Legitimate use of csc.exe by code obfuscation tools 
Legitimate use of csc.exe by malware analysis tools"
"Suspicious Use of CSharp Interactive Console","Michael R. (@nahamike01)","Detects the execution of CSharp interactive console by PowerShell","attack.execution, attack.t1127","process_creation","windows","Not classified","Check the process creation logs for instances of csi.exe being executed by powershell.exe, pwsh.exe, or powershell_ise.exe. 
Review the command-line arguments passed to csi.exe for any suspicious or unauthorized activity. 
Cross-reference with network connection logs to identify any suspicious network activity associated with the execution of csi.exe.","Legitimate use of CSharp interactive console by authorized users.","Image=""*\\csi.exe"" ParentImage IN (""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\powershell_ise.exe"") OriginalFileName=""csi.exe"""
"Suspicious Desktopimgdownldr Command","Florian Roth (Nextron Systems)","Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet","attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Check the CommandLine and ParentCommandLine fields in process creation logs 
Look for the presence of /lockscreenurl in the CommandLine field 
Verify if the file extensions .jpg, .jpeg, or .png are present in the CommandLine field 
Examine the CommandLine field for the presence of reg delete and \PersonalizationCSP 
Cross-reference the suspicious command line with known legitimate usage of desktopimgdownldr, reg delete, and PersonalizationCSP 
Investigate the source and purpose of the file download, ensuring it aligns with authorized activities and policies 
Consult with system administrators or users to confirm if the observed activity is expected and legitimate 
Analyze network traffic logs for any suspicious communication related to the downloaded files","Legitimate usage of desktopimgdownldr with valid parameters 
Legitimate usage of reg delete command with valid arguments 
Legitimate usage of PersonalizationCSP in command line arguments 
False positives may occur when legitimate processes or tools are used to download files from the Internet","(CommandLine=""* /lockscreenurl:*"" NOT (CommandLine IN (""*.jpg*"", ""*.jpeg*"", ""*.png*""))) OR (CommandLine=""*reg delete*"" CommandLine=""*\\PersonalizationCSP*"")"
"DLL Sideloading by VMware Xfer Utility","Nasreddine Bencherchali (Nextron Systems)","Detects execution of VMware Xfer utility (VMwareXferlogs.exe) from the non-default directory which may be an attempt to sideload arbitrary DLL","attack.defense_evasion, attack.t1574.002","process_creation","windows","Not classified","Review process creation logs from Windows systems for instances of VMwareXferlogs.exe being executed from non-default directories. 
Check the command-line arguments used when executing VMwareXferlogs.exe to identify any suspicious or unexpected parameters. 
Inspect the parent process of VMwareXferlogs.exe to determine if it is a known legitimate process or if it is associated with any suspicious activity. 
Analyze network traffic logs for any unusual or suspicious communication originating from the system running VMwareXferlogs.exe. 
Monitor for any other indicators of compromise (IOCs) associated with DLL sideloading or known malicious activity.","Unlikely","Image=""*\\VMwareXferlogs.exe"" NOT Image=""C:\\Program Files\\VMware\\*"""
"New DNS ServerLevelPluginDll Installed Via Dnscmd.EXE","Florian Roth (Nextron Systems)","Detects the installation of a DNS plugin DLL via ServerLevelPluginDll parameter in registry, which can be used to execute code in context of the DNS server (restart required)","attack.defense_evasion, attack.t1574.002, attack.t1112","process_creation","windows","Not classified","Review your process creation logs for events matching this rule. 
Pay special attention to events where the ""Image"" ends with \dnscmd.exe. 
Focus on events where the ""CommandLine"" contains both /config and /serverlevelplugindll, indicating an attempt to install a DNS plugin DLL. 
Investigate the context of the event, such as the user account responsible for running dnscmd.exe. 
Examine any changes to the ServerLevelPluginDll registry key associated with DNS server configuration. 
Consider the purpose and legitimacy of the DNS plugin DLL installation. If it appears to be unauthorized or malicious, take appropriate action, including analyzing the DLL and potentially rolling back changes.","It can be challenging to determine known false positives since the installation of a DNS plugin DLL via dnscmd.exe is a potentially malicious action. Consider investigating each detection carefully.","Image=""*\\dnscmd.exe"" CommandLine=""*/config*"" CommandLine=""*/serverlevelplugindll*"""
"DNS Exfiltration and Tunneling Tools Execution","Daniil Yugoslavskiy, oscd.community","Well-known DNS Exfiltration tools execution","attack.exfiltration, attack.t1048.001, attack.command_and_control, attack.t1071.004, attack.t1132.001","process_creation","windows","Not classified","Review process creation logs for instances of the following executables 
iodine.exe 
dnscat2.exe 
Check for any suspicious or unauthorized usage of these tools. 
Cross-reference with network logs to identify any abnormal DNS traffic patterns. 
Investigate any connections to known malicious domains or IP addresses. 
Interview system administrators or users to determine if the usage was authorized.","Legitimate use of DNS tunneling tools for authorized purposes","Image IN (""*\\iodine.exe"", ""*\\dnscat2*"")"
"Suspicious Kernel Dump Using Dtrace","Florian Roth (Nextron Systems)","Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1","attack.discovery, attack.t1082","process_creation","windows","Not classified","Check the command line arguments of the process creation event for the presence of dtrace.exe and lkd(0) 
Review the process creation event for any other suspicious activity or indicators of compromise 
Cross-reference with other logs such as network traffic, file system activity, and authentication logs to identify any related suspicious behavior","Legitimate use of dtrace.exe for authorized debugging purposes","(Image=""*\\dtrace.exe"" CommandLine=""*lkd(0)*"") OR (CommandLine=""*syscall:::return*"" CommandLine=""*lkd(*"")"
"Copying Sensitive Files with Credential Data","Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community","Files with well-known filenames (sensitive files with credential data) copying","attack.credential_access, attack.t1003.002, attack.t1003.003, car.2013-07-001, attack.s0404","process_creation","windows","Not classified","Check if the file copy operation is performed by a legitimate process or user. 
Verify if the file copy operation is part of a backup or restore process. 
Investigate if the file copy operation is performed by a known incident responder or forensic investigator. 
Review the command-line arguments of the process to identify any suspicious or unauthorized activity. 
Analyze the file paths involved in the copy operation to determine if they are sensitive files with credential data. 
Cross-reference the file copy operation with other security events or indicators of compromise to identify any malicious behavior.","Copying sensitive files for legitimate use (e.g., backup) or forensic investigation by legitimate incident responder or forensic investigator","(Image=""*\\esentutl.exe"" OR OriginalFileName=""\\esentutl.exe"" CommandLine IN (""*vss*"", ""* /m *"", ""* /y *"")) OR CommandLine IN (""*\\windows\\ntds\\ntds.dit*"", ""*\\config\\sam*"", ""*\\config\\security*"", ""*\\config\\system *"", ""*\\repair\\sam*"", ""*\\repair\\system*"", ""*\\repair\\security*"", ""*\\config\\RegBack\\sam*"", ""*\\config\\RegBack\\system*"", ""*\\config\\RegBack\\security*"")"
"Potentially Suspicious Event Viewer Child Process","Florian Roth (Nextron Systems)","Detects uncommon or suspicious child processes of ""eventvwr.exe"" which might indicate a UAC bypass attempt","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002, car.2019-04-001","process_creation","windows","Not classified","Review the process tree to identify the parent process of eventvwr.exe and its child processes 
Check the command-line arguments and parameters used by the child processes of eventvwr.exe 
Analyze the behavior and network connections of the child processes of eventvwr.exe using network logs or endpoint detection and response (EDR) logs 
Cross-reference the child processes of eventvwr.exe with known good processes or whitelisted applications 
Consult with system administrators or security teams to verify the legitimacy of the child processes of eventvwr.exe","Legitimate child processes of eventvwr.exe that are part of normal system operations 
Child processes of eventvwr.exe initiated by authorized system administrators or security tools 
Child processes of eventvwr.exe that are part of legitimate software installations or updates","ParentImage=""*\\eventvwr.exe"" NOT (Image IN (""*:\\Windows\\System32\\mmc.exe"", ""*:\\Windows\\System32\\WerFault.exe"", ""*:\\Windows\\SysWOW64\\WerFault.exe""))"
"Explorer NOUACCHECK Flag","Florian Roth (Nextron Systems)","Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks","attack.defense_evasion, attack.t1548.002","process_creation","windows","Not classified","Check the process creation logs for instances of explorer.exe with the /NOUACCHECK flag in the command line. 
Look for parent processes that are not typical for explorer.exe, such as svchost.exe with specific command line parameters. 
Verify if the suspicious explorer.exe process is running with elevated privileges and bypassing UAC checks. 
Cross-reference the process with other security events or indicators of compromise to determine if it is part of a larger attack. 
Investigate any network connections or file activity associated with the suspicious process. 
Consult with system administrators or application owners to determine if any legitimate software products use the /NOUACCHECK flag.","Domain Controller User Logon","Image=""*\\explorer.exe"" CommandLine=""*/NOUACCHECK*"" NOT (ParentCommandLine=""C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Schedule"" OR ParentImage=""C:\\Windows\\System32\\svchost.exe"")"
"Findstr GPP Passwords","frack113","Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt.","attack.credential_access, attack.t1552.006","process_creation","windows","Not classified","Review process creation logs for instances of findstr.exe being executed with the specified command line arguments. 
Check for legitimate use of findstr.exe for other purposes, such as searching for specific strings in files. 
Inspect the identified Group Policy Preference files on the Domain Controller to determine if the cpassword value is encrypted within them. 
Use gpp-decrypt tool to decrypt the cpassword value and verify if it matches the expected format.","Legitimate use of findstr.exe for other purposes, such as searching for specific strings in files.","Image=""*\\findstr.exe"" OR OriginalFileName=""FINDSTR.EXE"" CommandLine=""*cpassword*"" CommandLine=""*\\sysvol\\*"" CommandLine=""*.xml*"""
"Sysmon Discovery Via Default Driver Altitude Using Findstr.EXE","frack113","Detects usage of ""findstr"" with the argument ""385201"". Which could indicate potential discovery of an installed Sysinternals Sysmon service using the default driver altitude (even if the name is changed).","attack.discovery, attack.t1518.001","process_creation","windows","Not classified","Check the command line arguments of the process creation events for instances of findstr.exe with the argument ""385201"". 
Review the parent process and command line arguments to determine the context of the findstr.exe execution. 
Correlate with other events and logs to identify any suspicious or malicious activities associated with the findstr.exe execution. 
If possible, analyze the file system and registry for any changes or artifacts related to Sysmon service discovery.","Legitimate use of findstr.exe with the argument ""385201"" for non-malicious purposes.","Image=""*\\findstr.exe"" OR OriginalFileName=""FINDSTR.EXE"" CommandLine=""* 385201*"""
"Finger.exe Suspicious Invocation","Florian Roth (Nextron Systems), omkar72, oscd.community","Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays","attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Check the process creation logs for instances of finger.exe being executed. 
Look for any suspicious command-line arguments or parameters used with finger.exe. 
Correlate the finger.exe execution with other security events or indicators of compromise (IOCs). 
Review network logs for any unusual network connections or traffic associated with finger.exe. 
Compare the file hash of the finger.exe executable with known malicious hashes. 
Check if finger.exe is being executed from unusual or unauthorized locations on the system. 
Monitor for any abnormal behavior or system changes following the execution of finger.exe.","Admin activity (unclear what they do nowadays with finger.exe)","OriginalFileName=""finger.exe"" OR Image=""*\\finger.exe"""
"Filter Driver Unloaded Via Fltmc.EXE","Nasreddine Bencherchali","Detect filter driver unloading activity via fltmc.exe","attack.defense_evasion, attack.t1070, attack.t1562, attack.t1562.002","process_creation","windows","Not classified","Check for legitimate system maintenance or updates that may involve unloading filter drivers. 
Review system logs for any related events or activities. 
Cross-reference with change management records or maintenance schedules. 
Verify the presence of any authorized scripts or tools that may perform filter driver unloading. 
If no legitimate explanation is found, investigate further for signs of malicious activity.","Legitimate unloading of filter drivers during system maintenance or updates.","Image=""*\\fltMC.exe"" OR OriginalFileName=""fltMC.exe"" CommandLine=""*unload*"" NOT CommandLine=""*unload rtp_filesystem_filter"""
"Sysmon Driver Unloaded Via Fltmc.EXE","Kirill Kiryanov, oscd.community","Detects possible Sysmon filter driver unloaded via fltmc.exe","attack.defense_evasion, attack.t1070, attack.t1562, attack.t1562.002","process_creation","windows","Not classified","Check for legitimate reasons for unloading Sysmon filter driver via fltmc.exe, such as system maintenance or troubleshooting. 
Review the command line arguments of the fltmc.exe process to determine if the unload operation was intentional or suspicious. 
Cross-reference with other security events and logs to identify any other suspicious activities or indicators of compromise. 
Monitor for any subsequent events related to the unloaded Sysmon filter driver, such as attempts to bypass or disable other security controls.","Unlikely","Image=""*\\fltMC.exe"" OR OriginalFileName=""fltMC.exe"" CommandLine=""*unload*"" CommandLine=""*sysmon*"""
"Fsutil Suspicious Invocation","Ecco, E.M. Anhaus, oscd.community","Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc).
Might be used by ransomwares during the attack (seen by NotPetya and others).
","attack.defense_evasion, attack.impact, attack.t1070, attack.t1485","process_creation","windows","Not classified","Check the process creation logs for the execution of fsutil.exe with suspicious parameters such as deletejournal, createjournal, or setZeroData. 
Look for any correlation with other suspicious activities or indicators of compromise (IOCs) related to ransomware attacks. 
Analyze the command-line arguments and parameters passed to fsutil.exe to determine if they align with legitimate administrative tasks or if they indicate malicious intent. 
Cross-reference the detected activity with known ransomware variants and their associated techniques, such as NotPetya or Lockbit. 
Review any additional logs or events that may provide context or evidence of malicious activity, such as file system changes or network connections. 
Consult with relevant threat intelligence sources or security vendors for any known patterns or indicators associated with this type of suspicious fsutil.exe invocation.","Admin activity 
Scripts and administrative tools used in the monitored environment","Image=""*\\fsutil.exe"" OR OriginalFileName=""fsutil.exe"" CommandLine IN (""*deletejournal*"", ""*createjournal*"", ""*setZeroData*"")"
"Suspicious GUP Usage","Florian Roth (Nextron Systems)","Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks","attack.defense_evasion, attack.t1574.002","process_creation","windows","Not classified","Check process creation logs for instances of GUP.exe being executed in the specified suspicious directories 
Windows Security Event Logs (Event ID 4688) can provide process creation information. 
Sysmon logs can also be used to track process creation events (Event ID 1). 
Endpoint detection and response (EDR) solutions may provide additional visibility into process execution. 
Once a potential match is found, investigate the process and its associated activities further 
Check the parent process and command-line arguments to identify the source of execution. 
Look for any suspicious network connections or file modifications made by the process. 
Analyze the process behavior using behavioral analysis tools or sandboxes to identify any malicious activities. 
Cross-reference the process with threat intelligence sources to determine if it is associated with known malicious activity. 
If the process is determined to be malicious, take appropriate response actions, such as isolating the affected system, blocking network communication, and initiating incident response procedures.","Execution of tools named GUP.exe and located in folders different than Notepad++\updater","Image=""*\\GUP.exe"" NOT (Image IN (""*\\Program Files\\Notepad++\\updater\\GUP.exe"", ""*\\Program Files (x86)\\Notepad++\\updater\\GUP.exe"") OR (Image=""*\\Users\\*"" Image IN (""*\\AppData\\Local\\Notepad++\\updater\\GUP.exe"", ""*\\AppData\\Roaming\\Notepad++\\updater\\GUP.exe"")))"
"HTML Help HH.EXE Suspicious Child Process","Maxim Pavlunin, Nasreddine Bencherchali (Nextron Systems)","Detects a suspicious child process of a Microsoft HTML Help (HH.exe)","attack.defense_evasion, attack.execution, attack.initial_access, attack.t1047, attack.t1059.001, attack.t1059.003, attack.t1059.005, attack.t1059.007, attack.t1218, attack.t1218.001, attack.t1218.010, attack.t1218.011, attack.t1566, attack.t1566.001","process_creation","windows","Not classified","Check the parent process to determine if it is a legitimate process or if it has been compromised. 
If the parent process is legitimate, investigate the child process to determine its purpose and whether it is expected in the environment. 
If the parent process is compromised, further investigation is required to identify the source of compromise and remediate the issue. 
Review relevant logs such as process creation logs (e.g., Windows Event ID 4688) to gather additional information about the parent and child processes. 
Analyze network traffic logs to identify any suspicious communication associated with the child process. 
Consult threat intelligence sources to check if the child process is known to be associated with any malicious activity. 
If necessary, perform memory or disk forensics to gather more evidence and understand the full extent of the compromise.","Legitimate processes that may be used by system administrators or legitimate software installations. 
False positives can occur if the parent process is legitimate and the child process is also legitimate. 
False positives can occur if the parent process is compromised and the child process is malicious, but the rule triggers on the child process only.","ParentImage=""*\\hh.exe"" Image IN (""*\\CertReq.exe"", ""*\\CertUtil.exe"", ""*\\cmd.exe"", ""*\\cscript.exe"", ""*\\installutil.exe"", ""*\\MSbuild.exe"", ""*\\MSHTA.EXE"", ""*\\msiexec.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\schtasks.exe"", ""*\\wmic.exe"", ""*\\wscript.exe"")"
"Suspicious HH.EXE Execution","Maxim Pavlunin","Detects a suspicious execution of a Microsoft HTML Help (HH.exe)","attack.defense_evasion, attack.execution, attack.initial_access, attack.t1047, attack.t1059.001, attack.t1059.003, attack.t1059.005, attack.t1059.007, attack.t1218, attack.t1218.001, attack.t1218.010, attack.t1218.011, attack.t1566, attack.t1566.001","process_creation","windows","Not classified","Check the command line arguments of the process to determine if it is being used in a suspicious manner. 
Review the parent process and its legitimacy to understand the context of the HH.exe execution. 
Analyze the file path of HH.exe to identify any unusual or unexpected locations. 
Correlate the HH.exe execution with other security events or indicators of compromise (IOCs) to identify any malicious activity. 
Check the reputation of the file and its associated processes using threat intelligence sources. 
Monitor for any abnormal network connections or communication associated with the HH.exe execution. 
Review any relevant logs, such as web proxy logs, to identify any suspicious or malicious activity related to HH.exe. 
Consider performing a memory analysis or endpoint forensics to gather additional information about the HH.exe execution.","Legitimate use of HH.exe for authorized purposes, such as opening Microsoft HTML Help files","OriginalFileName=""HH.exe"" OR Image=""*\\hh.exe"" CommandLine IN (""*.application*"", ""*\\AppData\\Local\\Temp\\*"", ""*\\Content.Outlook\\*"", ""*\\Downloads\\*"", ""*\\Users\\Public\\*"", ""*\\Windows\\Temp\\*"")"
"HackTool - ADCSPwn Execution","Florian Roth (Nextron Systems)","Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service","attack.credential_access, attack.t1557.001","process_creation","windows","Not classified","Review process creation logs on Windows systems for command line parameters containing --adcs and --port. 
Look for any suspicious activity or unauthorized use of ADCSPwn tool. 
Cross-reference with other security events or alerts to identify any related malicious activities. 
Investigate any abnormal network traffic or communication with the certificate service.","Unlikely","CommandLine=""* --adcs *"" CommandLine=""* --port *"""
"HackTool - Bloodhound/Sharphound Execution","Florian Roth (Nextron Systems)","Detects command line parameters used by Bloodhound and Sharphound hack tools","attack.discovery, attack.t1087.001, attack.t1087.002, attack.t1482, attack.t1069.001, attack.t1069.002, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check process creation logs for the presence of the following images \Bloodhound.exe and \SharpHound.exe 
Look for command line parameters that match the following patterns 
-CollectionMethod All 
--CollectionMethods Session 
--Loop --Loopduration 
--PortScanTimeout 
['.exe -c All -d'] 
['Invoke-Bloodhound'] 
['Get-BloodHoundData'] 
-JsonFolder 
-ZipFileName 
['DCOnly'] 
--NoSaveCache 
Investigate any processes that match the above criteria to determine if they are related to Bloodhound or Sharphound hack tools","Other programs that use these command line options and accept an All parameter","Product=""*SharpHound*"" OR Description=""*SharpHound*"" OR Company IN (""*SpecterOps*"", ""*evil corp*"") OR Image IN (""*\\Bloodhound.exe*"", ""*\\SharpHound.exe*"") OR CommandLine IN (""* -CollectionMethod All *"", ""* --CollectionMethods Session *"", ""* --Loop --Loopduration *"", ""* --PortScanTimeout *"", ""*.exe -c All -d *"", ""*Invoke-Bloodhound*"", ""*Get-BloodHoundData*"") OR (CommandLine=""* -JsonFolder *"" CommandLine=""* -ZipFileName *"") OR (CommandLine=""* DCOnly *"" CommandLine=""* --NoSaveCache *"")"
"HackTool - F-Secure C3 Load by Rundll32","Alfie Champion (ajpc500)","F-Secure C3 produces DLLs with a default exported StartNodeRelay function.","attack.defense_evasion, attack.t1218.011","process_creation","windows","Not classified","Investigate the process creation logs for instances of rundll32.exe being used to load DLLs with the StartNodeRelay function. 
Review the command line arguments of rundll32.exe processes to identify any suspicious DLLs being loaded. 
Check if the F-Secure C3 tool is authorized and being used for legitimate purposes. 
Cross-reference the detected activity with information from other log sources such as network logs, file system logs, and user activity logs to gather more context. 
If the activity is determined to be legitimate, add the process or DLL to the whitelist to prevent future false positives.","Legitimate use of F-Secure C3 tool for authorized purposes.","CommandLine=""*rundll32.exe*"" CommandLine=""*.dll*"" CommandLine=""*StartNodeRelay*"""
"CobaltStrike Load by Rundll32","Wojciech Lesicki","Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line.","attack.defense_evasion, attack.t1218.011","process_creation","windows","Not classified","Check the command line arguments of the rundll32.exe process for the presence of .dll and StartW or ,StartW 
Review the parent process and command line arguments to determine if it is a known legitimate use of rundll32.exe 
Analyze the loaded DLLs to identify any suspicious or malicious behavior","Legitimate use of rundll32.exe to load DLLs from the command line","Image=""*\\rundll32.exe"" OR OriginalFileName=""RUNDLL32.EXE"" OR CommandLine IN (""*rundll32.exe*"", ""*rundll32 *"") CommandLine=""*.dll*"" CommandLine IN (""* StartW"", ""*,StartW"")"
"HackTool - Covenant PowerShell Launcher","Florian Roth (Nextron Systems), Jonhnathan Ribeiro, oscd.community","Detects suspicious command lines used in Covenant luanchers","attack.execution, attack.defense_evasion, attack.t1059.001, attack.t1564.003","process_creation","windows","Not classified","Check the process creation logs for the presence of the suspicious command line parameters 
Review the command line arguments and look for any encoded commands or hidden windows 
Correlate the process creation event with other events or logs to identify any malicious behavior 
Check the reputation of the process or file involved in the detection 
If the detection is triggered by a legitimate use of PowerShell, investigate the purpose and context of the command","Legitimate use of PowerShell with similar command line parameters 
Administrative scripts or tools that use encoded commands","(CommandLine=""*-Sta*"" CommandLine=""*-Nop*"" CommandLine=""*-Window*"" CommandLine=""*Hidden*"" CommandLine IN (""*-Command*"", ""*-EncodedCommand*"")) OR CommandLine IN (""*sv o (New-Object IO.MemorySteam);sv d *"", ""*mshta file.hta*"", ""*GruntHTTP*"", ""*-EncodedCommand cwB2ACAAbwAgA*"")"
"HackTool - CrackMapExec Execution","Florian Roth (Nextron Systems)","This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced.","attack.execution, attack.persistence, attack.privilege_escalation, attack.credential_access, attack.discovery, attack.t1047, attack.t1053, attack.t1059.003, attack.t1059.001, attack.t1110, attack.t1201","process_creation","windows","Not classified","Check the CommandLine field in process creation logs for the presence of CrackMapExec binary (crackmapexec.exe). 
Look for specific flag combinations used by CrackMapExec, such as -M pe_inject, --local-auth, -u, -x, -p, -H, -M, -d, -o. 
Review the ComputerName and User fields to identify the source of the execution. 
Cross-reference the detected activity with other logs, such as network traffic logs, to gather additional context. 
If the activity is associated with a known penetration testing or red teaming activity, it can be considered a false positive.","CrackMapExec used for legitimate purposes such as penetration testing or red teaming activities.","Image=""*\\crackmapexec.exe"" OR CommandLine=""* -M pe_inject *"" OR (CommandLine=""* --local-auth*"" CommandLine=""* -u *"" CommandLine=""* -x *"") OR (CommandLine=""* --local-auth*"" CommandLine=""* -u *"" CommandLine=""* -p *"" CommandLine=""* -H 'NTHASH'*"") OR (CommandLine=""* mssql *"" CommandLine=""* -u *"" CommandLine=""* -p *"" CommandLine=""* -M *"" CommandLine=""* -d *"") OR (CommandLine=""* smb *"" CommandLine=""* -u *"" CommandLine=""* -H *"" CommandLine=""* -M *"" CommandLine=""* -o *"") OR (CommandLine=""* smb *"" CommandLine=""* -u *"" CommandLine=""* -p *"" CommandLine=""* --local-auth*"") OR (CommandLine=""* --local-auth*"" CommandLine=""* -u *"" CommandLine=""* -p *"" CommandLine=""* 10.*"" CommandLine=""* 192.168.*"" CommandLine=""*/24 *"")"
"HackTool - CrackMapExec Execution Patterns","Thomas Patzke","Detects various execution patterns of the CrackMapExec pentesting framework","attack.execution, attack.t1047, attack.t1053, attack.t1059.003, attack.t1059.001, attack.s0106","process_creation","windows","Not classified","Review the CommandLine field in process creation logs for the presence of the following patterns 
cmd.exe /Q /c * 1> \\\\*\\*\\* 2>&1 
cmd.exe /C * > \\\\*\\*\\* 2>&1 
cmd.exe /C * > *\\Temp\\* 2>&1 
powershell.exe -exec bypass -noni -nop -w 1 -C "" 
powershell.exe -noni -nop -w 1 -enc "" 
If any of these patterns are found, investigate the associated ComputerName and User fields to determine if the activity is expected or suspicious. 
Cross-reference the activity with other logs, such as network traffic logs or authentication logs, to gather additional context and determine if the activity is part of an authorized penetration testing engagement or an actual attack.","Legitimate use of CrackMapExec during authorized penetration testing engagements","CommandLine IN (""*cmd.exe /Q /c * 1> \\\\*\\*\\* 2>&1*"", ""*cmd.exe /C * > \\\\*\\*\\* 2>&1*"", ""*cmd.exe /C * > *\\Temp\\* 2>&1*"", ""*powershell.exe -exec bypass -noni -nop -w 1 -C \""*"", ""*powershell.exe -noni -nop -w 1 -enc *"")"
"HackTool - CreateMiniDump Execution","Florian Roth (Nextron Systems)","Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine","attack.credential_access, attack.t1003.001","process_creation","windows","Not classified","Search your SIEM for process creation events that match this rule. 
Examine the ""Image"" field to identify instances where CreateMiniDump.exe is executed. 
Investigate the associated process, parent process, and the user account responsible for the execution. 
Verify the legitimacy of the action by considering the context in which CreateMiniDump.exe is executed. 
Determine if the activity is consistent with normal operations or indicative of a potential credential extraction attempt.","False positives may occur if legitimate system or security tools use CreateMiniDump.exe for valid purposes. Its essential to validate the intent and context of its execution before concluding malicious activity.","Image=""*\\CreateMiniDump.exe"" OR Imphash=""4a07f944a83e8a7c2525efa35dd30e2f"" OR Hashes=""*IMPHASH=4a07f944a83e8a7c2525efa35dd30e2f*"""
"HackTool - DInjector PowerShell Cradle Execution","Florian Roth (Nextron Systems)","Detects the use of the Dinject PowerShell cradle based on the specific flags","attack.defense_evasion, attack.t1055","process_creation","windows","Not classified","Check process creation logs for instances where the command line contains /am51 and /password. 
Review PowerShell logs for suspicious PowerShell cradle usage. 
Inspect network traffic logs for any suspicious communication related to DInjector. 
Analyze any other relevant logs that may provide additional context, such as endpoint security logs or system logs.","Unlikely","CommandLine=""* /am51*"" CommandLine=""* /password*"""
"HackTool - Dumpert Process Dumper Execution","Florian Roth (Nextron Systems)","Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory","attack.credential_access, attack.t1003.001","process_creation","windows","Not classified","Check process creation logs for instances of Dumpert.dll being loaded. 
Review the hashes of the processes involved to identify any matches with the provided hash (09D278F9DE118EF09163C6140255C690). 
Analyze the command line arguments of the process creation events to identify any instances where Dumpert.dll is being used.","Very unlikely","Hashes=""*09D278F9DE118EF09163C6140255C690*"" OR CommandLine=""*Dumpert.dll*"""
"HackTool - Empire PowerShell Launch Parameters","Florian Roth (Nextron Systems)","Detects suspicious powershell command line parameters used in Empire","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check the process creation logs for any instances where the command line contains the following suspicious parameters 
-NoP -sta -NonI -W Hidden -Enc 
-noP -sta -w 1 -enc 
-NoP -NonI -W Hidden -enc 
-noP -sta -w 1 -enc 
-enc  SQB 
-nop -exec bypass -EncodedCommand 
Look for any associated Empire-related activity or artifacts, such as the presence of Empire modules or scripts. 
Analyze the behavior of the process and its interactions with other systems or processes. 
Cross-reference the detected activity with threat intelligence sources to identify any known indicators of compromise (IOCs) associated with Empire or other malicious activities.","Other tools that incidentally use the same command line parameters","CommandLine IN (""* -NoP -sta -NonI -W Hidden -Enc *"", ""* -noP -sta -w 1 -enc *"", ""* -NoP -NonI -W Hidden -enc *"", ""* -noP -sta -w 1 -enc*"", ""* -enc  SQB*"", ""* -nop -exec bypass -EncodedCommand *"")"
"HackTool - Empire PowerShell UAC Bypass","Ecco","Detects some Empire PowerShell UAC bypass methods","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002, car.2019-04-001","process_creation","windows","Not classified","Check the CommandLine and ParentCommandLine fields in the process_creation logs 
Look for the presence of the specific command line arguments mentioned in the detection rule 
Analyze the context and purpose of the PowerShell execution 
Cross-reference with other logs or events to identify any suspicious or malicious activities 
If necessary, investigate the script or command referenced in the detection rule for further analysis","Legitimate use of PowerShell with similar command line arguments 
Execution of scripts or commands related to Windows Update 
Execution of scripts or commands related to UAC bypass methods","CommandLine IN (""* -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update)*"", ""* -NoP -NonI -c $x=$((gp HKCU:Software\\Microsoft\\Windows Update).Update);*"")"
"HackTool - Hashcat Password Cracker Execution","frack113","Execute Hashcat.exe with provided SAM file from registry of Windows and Password list to crack against","attack.credential_access, attack.t1110.002","process_creation","windows","Not classified","Check the command line arguments of the process creation event to see if it contains -a, -m 1000, and -r flags. 
Review the parent process and command line arguments to determine if it is a legitimate use of Hashcat. 
Analyze the associated log events, such as authentication logs, to identify any suspicious or unauthorized activity. 
Cross-reference the process execution with other security events, such as network traffic or file access, to gather additional context.","Legitimate use of Hashcat for authorized password cracking during penetration testing or password recovery.","Image=""*\\hashcat.exe"" OR (CommandLine=""*-a *"" CommandLine=""*-m 1000 *"" CommandLine=""*-r *"")"
"HackTool - Hydra Password Bruteforce Execution","Vasiliy Burov","Detects command line parameters used by Hydra password guessing hack tool","attack.credential_access, attack.t1110, attack.t1110.001","process_creation","windows","Not classified","Review process creation logs from Windows systems 
Look for instances where the command line contains the -u and -p parameters 
Check if the command line also contains the keywords ^USER^ and ^PASS^ 
Analyze the context of the process creation event to determine if it is related to legitimate software or potentially malicious activity","Software that uses the caret encased keywords PASS and USER in its command line","CommandLine=""*-u *"" CommandLine=""*-p *"" CommandLine IN (""*^USER^*"", ""*^PASS^*"")"
"HackTool - Potential Impacket Lateral Movement Activity","Ecco, oscd.community, Jonhnathan Ribeiro, Tim Rauch","Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework","attack.execution, attack.t1047, attack.lateral_movement, attack.t1021.003","process_creation","windows","Not classified","Review process creation logs for instances of wmiexec.py, atexec.py, smbexec.py, or dcomexec.py being executed with suspicious command line parameters. 
Look for the presence of the following parent processes wmiprvse.exe, mmc.exe, explorer.exe, services.exe. 
Check if the command line contains cmd.exe, /Q, /c, \\\\127.0.0.1\\, and &1. 
Review process creation logs for instances of atexec.py being executed with suspicious command line parameters. 
Look for the presence of the following parent processes svchost.exe -k netsvcs, taskeng.exe. 
Check if the command line contains cmd.exe, /C, Windows\Temp\, and &1.","Legitimate use of Impacket framework for authorized purposes, such as penetration testing or system administration.","(ParentImage IN (""*\\wmiprvse.exe"", ""*\\mmc.exe"", ""*\\explorer.exe"", ""*\\services.exe"") CommandLine=""*cmd.exe*"" CommandLine=""*/Q*"" CommandLine=""*/c*"" CommandLine=""*\\\\127.0.0.1\\*"" CommandLine=""*&1*"") OR (ParentCommandLine IN (""*svchost.exe -k netsvcs*"", ""*taskeng.exe*"") CommandLine=""*cmd.exe*"" CommandLine=""*/C*"" CommandLine=""*Windows\\Temp\\*"" CommandLine=""*&1*"")"
"HackTool - Impacket Tools Execution","Florian Roth (Nextron Systems)","Detects the execution of different compiled Windows binaries of the impacket toolset (based on names or part of their names - could lead to false positives)","attack.execution, attack.t1557.001","process_creation","windows","Not classified","Check the process creation logs from Windows systems 
Look for processes with image names containing or ending with the impacket toolset binaries mentioned in the rule 
Verify if the process execution is expected and authorized 
If the process execution is unexpected or unauthorized, investigate further to determine if it is a malicious use of the impacket tools 
Cross-reference the process execution with other security events and indicators of compromise to identify any associated malicious activity","Legitimate use of the impacket tools","Image IN (""*\\goldenPac*"", ""*\\karmaSMB*"", ""*\\kintercept*"", ""*\\ntlmrelayx*"", ""*\\rpcdump*"", ""*\\samrdump*"", ""*\\secretsdump*"", ""*\\smbexec*"", ""*\\smbrelayx*"", ""*\\wmiexec*"", ""*\\wmipersist*"") OR Image IN (""*\\atexec_windows.exe"", ""*\\dcomexec_windows.exe"", ""*\\dpapi_windows.exe"", ""*\\findDelegation_windows.exe"", ""*\\GetADUsers_windows.exe"", ""*\\GetNPUsers_windows.exe"", ""*\\getPac_windows.exe"", ""*\\getST_windows.exe"", ""*\\getTGT_windows.exe"", ""*\\GetUserSPNs_windows.exe"", ""*\\ifmap_windows.exe"", ""*\\mimikatz_windows.exe"", ""*\\netview_windows.exe"", ""*\\nmapAnswerMachine_windows.exe"", ""*\\opdump_windows.exe"", ""*\\psexec_windows.exe"", ""*\\rdp_check_windows.exe"", ""*\\sambaPipe_windows.exe"", ""*\\smbclient_windows.exe"", ""*\\smbserver_windows.exe"", ""*\\sniffer_windows.exe"", ""*\\sniff_windows.exe"", ""*\\split_windows.exe"", ""*\\ticketer_windows.exe"")"
"Invoke-Obfuscation CLIP+ Launcher","Jonathan Cheong, oscd.community","Detects Obfuscated use of Clip.exe to execute PowerShell","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check process creation logs for instances of Clip.exe being used with obfuscated PowerShell commands. 
Look for command lines containing cmd, &&, clipboard], and -f. 
Also, check for command lines containing /c and /r. 
Review the parent process and command line arguments to determine if the use of Clip.exe is legitimate or suspicious.","Legitimate use of Clip.exe for copying text to the clipboard","CommandLine=""*cmd*"" CommandLine=""*&&*"" CommandLine=""*clipboard]::*"" CommandLine=""*-f*"" CommandLine IN (""*/c*"", ""*/r*"")"
"Invoke-Obfuscation Obfuscated IEX Invocation","Daniel Bohannon (@Mandiant/@FireEye), oscd.community","Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review the command line arguments of the process creation events for any obfuscated PowerShell code that matches the provided regular expressions. 
Check if the obfuscated code is part of a legitimate script or tool that uses PowerShell obfuscation techniques. 
If the obfuscated code is not part of a known legitimate script or tool, further investigation is required to determine if it is malicious. 
Correlate the process creation events with other relevant events, such as network connections or file modifications, to gather additional context and determine the intent of the obfuscated code.","Legitimate use of PowerShell obfuscation techniques in scripts or tools"
"Invoke-Obfuscation STDIN+ Launcher","Jonathan Cheong, oscd.community","Detects Obfuscated use of stdin to execute PowerShell","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check the command line arguments of the process creation events 
Look for obfuscated or suspicious PowerShell commands executed through stdin 
Analyze the context and purpose of the PowerShell execution 
Cross-reference with other logs such as network traffic or file access logs to identify any malicious behavior 
Consider the reputation and trustworthiness of the process and its associated files 
Consult with the system owner or user to determine if the activity is expected or authorized 
If unsure, escalate the investigation to a higher-level analyst or incident response team","Legitimate use of stdin in PowerShell scripts 
Legitimate use of cmd.exe with /c or /r options","CommandLine=""*cmd*"" CommandLine=""*powershell*"" CommandLine IN (""*/c*"", ""*/r*"") CommandLine=""*noexit*"" OR (CommandLine=""*input*"" CommandLine=""*$*"")"
"Invoke-Obfuscation VAR+ Launcher","Jonathan Cheong, oscd.community","Detects Obfuscated use of Environment Variables to execute PowerShell","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review process creation logs from Windows event logs (Event ID 4688) for instances where the command line contains cmd, ""set, -f, /c, or /r. Look for patterns of obfuscation or unusual use of environment variables in the command line arguments.","Legitimate use of environment variables in PowerShell scripts or batch files","CommandLine=""*cmd*"" CommandLine=""*\""set*"" CommandLine=""*-f*"" CommandLine IN (""*/c*"", ""*/r*"")"
"Invoke-Obfuscation Via Stdin","Nikita Nazarov, oscd.community","Detects Obfuscated Powershell via Stdin in Scripts","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","1. Identify the process name and command line associated with the detection. 
2. Review the process creation logs from the log source specified in the logsource field. 
3. Analyze the command line arguments and look for indicators of obfuscation techniques such as the presence of set and && operators. 
4. Check if the process is executed in an environment where obfuscated PowerShell scripts are commonly used. 
5. If the process is not expected or the obfuscation is suspicious, further investigation is recommended.","Legitimate use of obfuscated PowerShell scripts in specific environments where obfuscation is a common practice.","CommandLine=""*set*"" CommandLine=""*&&*"" CommandLine IN (""*environment*"", ""*invoke*"", ""*input*"")"
"Invoke-Obfuscation Via Use Clip","Nikita Nazarov, oscd.community","Detects Obfuscated Powershell via use Clip.exe in Scripts","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check the command line of the process creation event for the presence of echo, clip, and && keywords 
Look for any obfuscation techniques used in the PowerShell script, such as character encoding or string manipulation 
Analyze the context of the script execution and determine if it is part of a legitimate operation or if it is suspicious","Legitimate use of Clip.exe in scripts that are not obfuscated 
Legitimate use of PowerShell commands that contain the keywords invoke, i, n, v, o, k, e in non-obfuscated scripts","CommandLine=""*echo*"" CommandLine=""*clip*"" CommandLine=""*&&*"" CommandLine IN (""*clipboard*"", ""*invoke*"", ""*i`*"", ""*n`*"", ""*v`*"", ""*o`*"", ""*k`*"", ""*e`*"")"
"Invoke-Obfuscation Via Use MSHTA","Nikita Nazarov, oscd.community","Detects Obfuscated Powershell via use MSHTA in Scripts","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Inspect process creation logs for instances where the command line contains set, &&, mshta, vbscriptcreateobject, .run, and (window.close). 
Review the associated process details and parent-child relationships to identify any suspicious behavior or anomalies. 
Cross-reference with other security events and logs to gather additional context and evidence of malicious activity.","Unknown","CommandLine=""*set*"" CommandLine=""*&&*"" CommandLine=""*mshta*"" CommandLine=""*vbscript:createobject*"" CommandLine=""*.run*"" CommandLine=""*(window.close)*"""
"Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION","Timur Zinniatullin, oscd.community","Detects Obfuscated Powershell via VAR++ LAUNCHER","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Investigate the process creation logs for the presence of the following indicators
- CommandLine contains &&set, cmd, /c, -f
- CommandLine contains any of the following variables {0}, {1}, {2}, {3}, {4}, {5}

Example log sources to investigate
- Windows Security Event Logs (Event ID 4688) for process creation events
- Sysmon logs for process creation events
- PowerShell logs for PowerShell script execution events","Legitimate use of obfuscated PowerShell scripts for security testing or system administration purposes.","CommandLine=""*&&set*"" CommandLine=""*cmd*"" CommandLine=""*/c*"" CommandLine=""*-f*"" CommandLine IN (""*{0}*"", ""*{1}*"", ""*{2}*"", ""*{3}*"", ""*{4}*"", ""*{5}*"")"
"HackTool - Koadic Execution","wagga, Jonhnathan Ribeiro, oscd.community","Detects command line parameters used by Koadic hack tool","attack.execution, attack.t1059.003, attack.t1059.005, attack.t1059.007","process_creation","windows","Not classified","Review process creation logs for instances of cmd.exe with the /q, /c, or chcp parameters 
Check the parent command line for any suspicious activity or known malicious processes 
Cross-reference with other security events or indicators of compromise to determine if the activity is part of a larger attack campaign","Legitimate use of cmd.exe with /q, /c, or chcp parameters in a non-malicious context","Image=""*\\cmd.exe"" OR OriginalFileName=""Cmd.Exe"" CommandLine=""*/q*"" CommandLine=""*/c*"" CommandLine=""*chcp*"""
"Potential Meterpreter/CobaltStrike Activity","Teymur Kheirkhabarov, Ecco, Florian Roth","Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting","attack.privilege_escalation, attack.t1134.001, attack.t1134.002","process_creation","windows","Not classified","Check the ParentImage field in the log to verify if the process was spawned by services.exe 
Examine the CommandLine field in the log to identify the presence of specific indicators such as /c, echo, \pipe\, cmd, %COMSPEC%, rundll32, .dll,a, /p 
Cross-reference the detected process with known legitimate uses of cmd.exe or rundll32.exe for system administration or troubleshooting purposes 
Review scheduled tasks or services that use cmd.exe or rundll32.exe 
Analyze the context and purpose of the command execution to determine if it aligns with normal system behavior or indicates malicious activity","Legitimate use of cmd.exe or rundll32.exe for system administration or troubleshooting purposes 
Scheduled tasks or services that use cmd.exe or rundll32.exe 
Commandlines containing components like cmd accidentally 
Jobs and services started with cmd","ParentImage=""*\\services.exe"" (CommandLine=""*/c*"" CommandLine=""*echo*"" CommandLine=""*\\pipe\\*"" CommandLine IN (""*cmd*"", ""*%COMSPEC%*"")) OR (CommandLine=""*rundll32*"" CommandLine=""*.dll,a*"" CommandLine=""*/p:*"") NOT CommandLine=""*MpCmdRun*"""
"HackTool - Mimikatz Execution","Teymur Kheirkhabarov, oscd.community, David ANDRE (additional keywords), Tim Shelton","Detection well-known mimikatz command line arguments","attack.credential_access, attack.t1003.001, attack.t1003.002, attack.t1003.004, attack.t1003.005, attack.t1003.006","process_creation","windows","Not classified","Check the process creation logs for the presence of the command line arguments DumpCreds or mimikatz 
Review the process command line arguments for any of the following function names aadcookie, detours, memssp, mflt, ncroutemon, ngcsign, printnightmare, skeleton, preshutdown, mstsc, multirdp 
Analyze the process command line arguments for any of the following module names rpc, token, crypto, dpapi, sekurlsa, kerberos, lsadump, privilege, process, vault 
Verify if the detected activity is performed by authorized system administrators 
Cross-reference the detected command line arguments, function names, or module names with known legitimate tools or utilities 
Consider the context of the activity and the environment in which it is observed, as similar command line arguments, function names, or module names may be used by other legitimate software or in non-Windows environments","Legitimate use of DumpCreds or mimikatz by authorized system administrators 
Use of similar command line arguments by other legitimate tools or utilities 
Use of similar function or module names by other legitimate software 
Use of similar command line arguments, function names, or module names in non-Windows environments","CommandLine IN (""*DumpCreds*"", ""*mimikatz*"") OR CommandLine IN (""*::aadcookie*"", ""*::detours*"", ""*::memssp*"", ""*::mflt*"", ""*::ncroutemon*"", ""*::ngcsign*"", ""*::printnightmare*"", ""*::skeleton*"", ""*::preshutdown*"", ""*::mstsc*"", ""*::multirdp*"") OR CommandLine IN (""*rpc::*"", ""*token::*"", ""*crypto::*"", ""*dpapi::*"", ""*sekurlsa::*"", ""*kerberos::*"", ""*lsadump::*"", ""*privilege::*"", ""*process::*"", ""*vault::*"")"
"HackTool - Default PowerSploit/Empire Scheduled Task Creation","Markus Neis, @Karneades","Detects the creation of a schtask via PowerSploit or Empire Default Configuration.","attack.execution, attack.persistence, attack.privilege_escalation, attack.s0111, attack.g0022, attack.g0060, car.2013-08-001, attack.t1053.005, attack.t1059.001","process_creation","windows","Not classified","Review the command line arguments of the schtasks.exe process to determine if it matches the expected pattern of PowerSploit or Empire scheduled task creation. 
Check the parent process to see if it is a PowerShell process (powershell.exe or pwsh.exe) as this is a common indicator of malicious activity. 
Verify if the scheduled task is being created with suspicious parameters such as /SC ONLOGON, /SC DAILY /ST, /SC ONIDLE, or /SC HOURLY.","Scheduled tasks created by legitimate system administrators or automated processes.","ParentImage IN (""*\\powershell.exe"", ""*\\pwsh.exe"") Image=""*\\schtasks.exe"" CommandLine=""*/Create*"" CommandLine=""*powershell.exe -NonI*"" CommandLine=""*/TN Updater /TR*"" CommandLine IN (""*/SC ONLOGON*"", ""*/SC DAILY /ST*"", ""*/SC ONIDLE*"", ""*/SC HOURLY*"")"
"HackTool - PurpleSharp Execution","Florian Roth (Nextron Systems)","Detects the execution of the PurpleSharp adversary simulation tool","attack.t1587, attack.resource_development","process_creation","windows","Not classified","Check process creation logs for instances of PurpleSharp.exe being executed. 
Review command-line logs for any occurrences of PurpleSharp or xyz123456.exe. 
Cross-reference with any other relevant logs such as network traffic or file system activity logs to identify any suspicious behavior associated with the PurpleSharp execution.","Unlikely","Image=""*\\purplesharp*"" OR OriginalFileName=""PurpleSharp.exe"" OR CommandLine IN (""*xyz123456.exe*"", ""*PurpleSharp*"")"
"HackTool - Pypykatz Credentials Dumping Activity","frack113","Detects the usage of ""pypykatz"" to obtain stored credentials. Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database through Windows registry where the SAM database is stored","attack.credential_access, attack.t1003.002","process_creation","windows","Not classified","Investigate the process creation logs for instances of pypykatz.exe or python.exe with command line arguments containing live and registry. 
Review the context of the process creation event to determine if the usage of pypykatz is legitimate or malicious. 
Cross-reference with other logs such as Windows registry logs or authentication logs to identify any suspicious or unauthorized activity. 
If the usage of pypykatz is authorized, verify the presence of appropriate documentation or approval from system administrators or security personnel.","Legitimate usage of pypykatz for authorized credential extraction during security assessments or system administration tasks.","Image IN (""*\\pypykatz.exe"", ""*\\python.exe"") CommandLine=""*live*"" CommandLine=""*registry*"""
"HackTool - RedMimicry Winnti Playbook Execution","Alexander Rausch","Detects actions caused by the RedMimicry Winnti playbook a automated breach emulations utility","attack.execution, attack.defense_evasion, attack.t1106, attack.t1059.003, attack.t1218.011","process_creation","windows","Not classified","Not available","Not available","Image IN (""*\\rundll32.exe"", ""*\\cmd.exe"") CommandLine IN (""*gthread-3.6.dll*"", ""*\\Windows\\Temp\\tmp.bat*"", ""*sigcmm-2.4.dll*"")"
"Potential SMB Relay Attack Tool Execution","Florian Roth (Nextron Systems)","Detects different hacktools used for relay attacks on Windows for privilege escalation","attack.execution, attack.t1557.001","process_creation","windows","Not classified","Check the process creation logs for the presence of the suspicious hacktool names mentioned in the rule, such as PetitPotam, RottenPotato, HotPotato, JuicyPotato, etc. 
Look for command-line invocations that include known SMB relay attack tools, such as Invoke-Tater, smbrelay, ntlmrelay, cme smb, etc. 
Investigate command-line invocations that use Invoke-PetitPotam with specific parameters like -t * -p 
Examine command-line invocations that end with .exe -c ""{...}"" -z, which may indicate the use of JuicyPotato for privilege escalation 
Pay attention to any process with names like HotPotatoes6, HotPotatoes7, or HotPotatoes 
Verify if the detected processes are part of legitimate activities or if they are being used for malicious purposes 
Cross-reference the detected processes with known legitimate software and their expected behavior 
Analyze the context in which the suspicious processes are executed, including parent processes, network connections, and file system activity 
Consult with the system owner or user to determine if the detected activity is expected or unauthorized","Legitimate files with similar names to the hacktools 
Legitimate usage of tools like Responder.exe or smbrelayx in a non-malicious context","Image IN (""*PetitPotam*"", ""*RottenPotato*"", ""*HotPotato*"", ""*JuicyPotato*"", ""*\\just_dce_*"", ""*Juicy Potato*"", ""*\\temp\\rot.exe*"", ""*\\Potato.exe*"", ""*\\SpoolSample.exe*"", ""*\\Responder.exe*"", ""*\\smbrelayx*"", ""*\\ntlmrelayx*"", ""*\\LocalPotato*"") OR CommandLine IN (""*Invoke-Tater*"", ""* smbrelay*"", ""* ntlmrelay*"", ""*cme smb *"", ""* /ntlm:NTLMhash *"", ""*Invoke-PetitPotam*"", ""*.exe -t * -p *"") OR (CommandLine=""*.exe -c \""{*"" CommandLine=""*}\"" -z"") NOT (Image IN (""*HotPotatoes6*"", ""*HotPotatoes7*"", ""*HotPotatoes *""))"
"HackTool - Rubeus Execution","Florian Roth (Nextron Systems)","Detects the execution of the hacktool Rubeus via PE information of command line parameters","attack.credential_access, attack.t1003, attack.t1558.003, attack.lateral_movement, attack.t1550.003","process_creation","windows","Not classified","Check the process creation logs for instances of Rubeus.exe being executed with any of the following command line parameters 
asreproast 
dump /servicekrbtgt 
dump /luid0x 
kerberoast 
createnetonly /program 
ptt /ticket 
/impersonateuser 
renew /ticket 
asktgt /user 
harvest /interval 
s4u /user 
s4u /ticket 
hash /password 
golden /aes256 
silver /user","There may be legitimate use cases for Rubeus.exe, such as during penetration testing or security assessments where it is used with proper authorization.","Image=""*\\Rubeus.exe"" OR OriginalFileName=""Rubeus.exe"" OR Description=""Rubeus"" OR CommandLine IN (""*asreproast *"", ""*dump /service:krbtgt *"", ""*dump /luid:0x*"", ""*kerberoast *"", ""*createnetonly /program:*"", ""*ptt /ticket:*"", ""*/impersonateuser:*"", ""*renew /ticket:*"", ""*asktgt /user:*"", ""*harvest /interval:*"", ""*s4u /user:*"", ""*s4u /ticket:*"", ""*hash /password:*"", ""*golden /aes256:*"", ""*silver /user:*"")"
"HackTool - SecurityXploded Execution","Florian Roth (Nextron Systems)","Detects the execution of SecurityXploded Tools","attack.credential_access, attack.t1555","process_creation","windows","Not classified","Review process creation logs on Windows systems for instances of SecurityXploded tools being executed. 
Look for the presence of the PasswordDump.exe image name or PasswordDump.exe in the original file name. 
Cross-reference the process creation logs with other security events such as network traffic logs or authentication logs to identify any suspicious or unauthorized activity. 
Investigate any instances of SecurityXploded tools being executed in conjunction with other indicators of compromise or known malicious activity.","Unlikely","Company=""SecurityXploded"" OR Image=""*PasswordDump.exe"" OR OriginalFileName=""*PasswordDump.exe"""
"HackTool - PPID Spoofing SelectMyParent Tool Execution","Florian Roth (Nextron Systems)","Detects the use of parent process ID spoofing tools like Didier Stevens tool SelectMyParent","attack.defense_evasion, attack.t1134.004","process_creation","windows","Not classified","Investigate the process creation events on the Windows system logs (Event ID 4688) to identify the presence of the SelectMyParent.exe tool or any suspicious command lines containing keywords like PPID-spoof, ppid_spoof, spoof-ppid, spoof_ppid, ppidspoof, spoofppid, spoofedppid, or -spawnto. 
Check the OriginalFileName field in the process creation events for any matches with keywords like PPID-spoof, ppid_spoof, spoof-ppid, spoof_ppid, ppidspoof, spoofppid, or spoofedppid. 
Verify the Description field in the process creation events for the presence of SelectMyParent. 
Check the Imphash field in the process creation events for any matches with the provided hashes. 
Review the Hashes field in the process creation events for any matches with the provided IMPHASH values.","There may be legitimate use cases where a process legitimately uses parent process ID spoofing for legitimate purposes, such as certain security tools or debugging scenarios.","Image=""*\\SelectMyParent.exe"" OR CommandLine IN (""*PPID-spoof*"", ""*ppid_spoof*"", ""*spoof-ppid*"", ""*spoof_ppid*"", ""*ppidspoof*"", ""*spoofppid*"", ""*spoofedppid*"", ""* -spawnto *"") OR OriginalFileName IN (""*PPID-spoof*"", ""*ppid_spoof*"", ""*spoof-ppid*"", ""*spoof_ppid*"", ""*ppidspoof*"", ""*spoofppid*"", ""*spoofedppid*"") OR Description=""SelectMyParent"" OR Imphash IN (""04d974875bd225f00902b4cad9af3fbc"", ""a782af154c9e743ddf3f3eb2b8f3d16e"", ""89059503d7fbf470e68f7e63313da3ad"", ""ca28337632625c8281ab8a130b3d6bad"") OR Hashes IN (""*IMPHASH=04D974875BD225F00902B4CAD9AF3FBC*"", ""*IMPHASH=A782AF154C9E743DDF3F3EB2B8F3D16E*"", ""*IMPHASH=89059503D7FBF470E68F7E63313DA3AD*"", ""*IMPHASH=CA28337632625C8281AB8A130B3D6BAD*"")"
"HackTool - SILENTTRINITY Stager Execution","Aleksey Potapov, oscd.community","Detects SILENTTRINITY stager use via PE metadata","attack.command_and_control, attack.t1071","process_creation","windows","Not classified","Check process creation logs for instances of st2stager in the description field.","Unlikely","Description=""*st2stager*"""
"HackTool - UACMe Akagi Execution","Christian Burkard (Nextron Systems), Florian Roth (Nextron Systems)","Detects the execution of UACMe, a tool used for UAC bypasses, via default PE metadata","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check process creation logs for the execution of UACMe tool (Akagi.exe or Akagi64.exe). 
Look for any suspicious command-line arguments or parameters used during the execution. 
Review the parent process and command-line arguments to identify the source of the execution. 
Cross-reference the process execution with other security events or indicators of compromise (IOCs) to determine if it is part of a larger attack campaign. 
Analyze the process behavior and network connections to identify any malicious activities or communication. 
Check the reputation of the file hashes associated with the UACMe tool using threat intelligence sources or antivirus/endpoint protection solutions. 
If possible, perform memory or disk forensics to gather additional evidence of the UACMe tool execution.","Unknown","Product=""UACMe"" OR Company IN (""REvol Corp"", ""APT 92"", ""UG North"", ""Hazardous Environments"", ""CD Project Rekt"") OR Description IN (""UACMe main module"", ""Pentesting utility"") OR OriginalFileName IN (""Akagi.exe"", ""Akagi64.exe"") OR Image IN (""*\\Akagi64.exe"", ""*\\Akagi.exe"") OR Hashes IN (""*IMPHASH=767637C23BB42CD5D7397CF58B0BE688*"", ""*IMPHASH=14C4E4C72BA075E9069EE67F39188AD8*"", ""*IMPHASH=3C782813D4AFCE07BBFC5A9772ACDBDC*"", ""*IMPHASH=7D010C6BB6A3726F327F7E239166D127*"", ""*IMPHASH=89159BA4DD04E4CE5559F132A9964EB3*"", ""*IMPHASH=6F33F4A5FC42B8CEC7314947BD13F30F*"", ""*IMPHASH=5834ED4291BDEB928270428EBBAF7604*"", ""*IMPHASH=5A8A8A43F25485E7EE1B201EDCBC7A38*"", ""*IMPHASH=DC7D30B90B2D8ABF664FBED2B1B59894*"", ""*IMPHASH=41923EA1F824FE63EA5BEB84DB7A3E74*"", ""*IMPHASH=3DE09703C8E79ED2CA3F01074719906B*"") OR Imphash IN (""767637c23bb42cd5d7397cf58b0be688"", ""14c4e4c72ba075e9069ee67f39188ad8"", ""3c782813d4afce07bbfc5a9772acdbdc"", ""7d010c6bb6a3726f327f7e239166d127"", ""89159ba4dd04e4ce5559f132a9964eb3"", ""6f33f4a5fc42b8cec7314947bd13f30f"", ""5834ed4291bdeb928270428ebbaf7604"", ""5a8a8a43f25485e7ee1b201edcbc7a38"", ""dc7d30b90b2d8abf664fbed2b1b59894"", ""41923ea1f824fe63ea5beb84db7a3e74"", ""3de09703c8e79ed2ca3f01074719906b"")"
"HackTool - Windows Credential Editor (WCE) Execution","Florian Roth (Nextron Systems)","Detects the use of Windows Credential Editor (WCE)","attack.credential_access, attack.t1003.001, attack.s0005","process_creation","windows","Not classified","Check process creation logs for instances where the Windows Credential Editor (WCE) is executed. 
Look for processes with the following characteristics 
['Image ends with \\clussvc.exe'] 
['Command line ends with .exe -S'] 
['Parent image ends with \\services.exe'] 
Verify the presence of the following hashes in the process 
['a53a02b997935fd8eedcb5f7abab9b9f'] 
['e96a73c7bf33a464c510ede582318bf2'] 
If the above conditions and hashes are met, further investigation is required to determine if the use of Windows Credential Editor (WCE) is malicious.","Another service that uses a single -s command line switch","Imphash IN (""a53a02b997935fd8eedcb5f7abab9b9f"", ""e96a73c7bf33a464c510ede582318bf2"") OR Hashes IN (""*IMPHASH=a53a02b997935fd8eedcb5f7abab9b9f*"", ""*IMPHASH=e96a73c7bf33a464c510ede582318bf2*"") OR (CommandLine=""*.exe -S"" ParentImage=""*\\services.exe"") NOT Image=""*\\clussvc.exe"""
"HackTool - XORDump Execution","Florian Roth (Nextron Systems)","Detects suspicious use of XORDump process memory dumping utility","attack.defense_evasion, attack.t1036, attack.t1003.001","process_creation","windows","Not classified","Check the process creation logs for the execution of XORDump with the specified command line switches 
Image ends with \xordump.exe 
CommandLine contains -process lsass.exe, -m comsvcs, -m dbghelp, -m dbgcore 
Review the context of the XORDump execution, including the parent process, user account, and any associated network activity 
Compare the observed behavior with known legitimate use cases of XORDump or other similar tools 
If necessary, analyze the dumped memory for any signs of malicious activity","Legitimate use of XORDump for memory analysis or debugging purposes 
Other tools that have similar command line switches as XORdump","Image=""*\\xordump.exe"" OR CommandLine IN (""* -process lsass.exe *"", ""* -m comsvcs *"", ""* -m dbghelp *"", ""* -m dbgcore *"")"
"Suspicious HWP Sub Processes","Florian Roth (Nextron Systems)","Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation","attack.initial_access, attack.t1566.001, attack.execution, attack.t1203, attack.t1059.003, attack.g0032","process_creation","windows","Not classified","Check the command line arguments of the suspicious sub processes to identify any unusual or malicious behavior. 
Review the process tree to determine if the Hangul Word Processor sub processes are spawned from legitimate parent processes. 
Analyze the network traffic generated by the suspicious sub processes to identify any communication with known malicious IP addresses or domains. 
Inspect the file system for any artifacts or indicators of compromise associated with the suspicious sub processes. 
Correlate the detection with other security events or indicators of compromise to determine the extent of the potential exploitation.","Legitimate usage of Hangul Word Processor sub processes","ParentImage=""*\\Hwp.exe"" Image=""*\\gbb.exe"""
"File Download And Execution Via IEExec.EXE","Nasreddine Bencherchali (Nextron Systems)","Detects execution of the IEExec utility to download and execute files","attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Not available","Not available"
"Microsoft IIS Connection Strings Decryption","Tim Rauch","Detects use of aspnet_regiis to decrypt Microsoft IIS connection strings. An attacker with Microsoft IIS web server access via a webshell or alike can decrypt and dump any hardcoded connection strings, such as the MSSQL service account password using aspnet_regiis command.","attack.credential_access, attack.t1003","process_creation","windows","Not classified","Not available","Not available","Image=""*\\aspnet_regiis.exe"" OR OriginalFileName=""aspnet_regiis.exe"" CommandLine=""*connectionStrings*"" CommandLine=""* -pdf*"""
"Suspicious IIS Module Registration","Florian Roth (Nextron Systems), Microsoft (idea)","Detects a suspicious IIS module registration as described in Microsoft threat report on IIS backdoors","attack.persistence, attack.t1505.004","process_creation","windows","Not classified","Check the process creation logs for instances of w3wp.exe with the command line containing appcmd.exe add module. 
Look for instances of powershell.exe with the command line containing system.enterpriseservices.internal.publish and the image ending with \powershell.exe. 
Search for instances of command line containing gacutil and /I in the process creation logs.","Administrative activity","ParentImage=""*\\w3wp.exe"" CommandLine=""*appcmd.exe add module*"" OR (CommandLine=""* system.enterpriseservices.internal.publish*"" Image=""*\\powershell.exe"") OR (CommandLine=""*gacutil*"" CommandLine=""* /I*"")"
"ImagingDevices Unusual Parent/Child Processes","Nasreddine Bencherchali (Nextron Systems)","Detects unusual parent or children of the ImagingDevices.exe (Windows Contacts) process as seen being used with Bumblebee activity","attack.defense_evasion, attack.execution","process_creation","windows","Not classified","Not available","Not available","(ParentImage IN (""*\\WmiPrvSE.exe"", ""*\\svchost.exe"", ""*\\dllhost.exe"") Image=""*\\ImagingDevices.exe"") OR ParentImage=""*\\ImagingDevices.exe"""
"Suspicious Windows Trace ETW Session Tamper Via Logman.EXE","Florian Roth (Nextron Systems)","Detects the execution of ""logman"" utility in order to disable or delete Windows trace sessions","attack.defense_evasion, attack.t1562.001, attack.t1070.001","process_creation","windows","Not classified","Check the command line arguments of the executed process to see if it contains stop or delete keywords. 
Look for the presence of Circular Kernel Context Logger, EventLog-, SYSMON TRACE, or SysmonDnsEtwSession in the command line arguments. 
Review the process creation logs for any suspicious activity related to logman.exe. 
Cross-reference the activity with other security events or logs to identify any correlation or patterns of malicious behavior. 
If the activity is performed by administrative staff or during the installation of legitimate tools, verify the purpose and intent behind the action.","Legitimate deactivation by administrative staff 
Installer tools that disable services, e.g. before log collection agent installation","Image=""*\\logman.exe"" OR OriginalFileName=""Logman.exe"" CommandLine IN (""*stop *"", ""*delete *"") CommandLine IN (""*Circular Kernel Context Logger*"", ""*EventLog-*"", ""*SYSMON TRACE*"", ""*SysmonDnsEtwSession*"")"
"ZOHO Dctask64 Process Injection","Florian Roth (Nextron Systems)","Detects suspicious process injection using ZOHO's dctask64.exe","attack.defense_evasion, attack.t1055.001","process_creation","windows","Not classified","Review process creation logs for instances of dctask64.exe being launched with suspicious command line parameters or from unexpected parent processes. 
Cross-reference with authorized system management tasks to identify any deviations or anomalies. 
Check for any signs of process injection techniques being used in conjunction with dctask64.exe, such as suspicious DLL loading or memory manipulation. 
Investigate any network connections or communication associated with dctask64.exe for signs of malicious activity.","Legitimate use of ZOHOs dctask64.exe for authorized system management tasks","Image=""*\\dctask64.exe"" NOT CommandLine=""*DesktopCentral_Agent\\agent*"""
"Devtoolslauncher.exe Executes Specified Binary","Beyu Denis, oscd.community (rule), @_felamos (idea)","The Devtoolslauncher.exe executes other binary","attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Check the command line arguments of the process creation event for the presence of devtoolslauncher.exe and LaunchForDeploy. 
Review the parent process and its legitimacy. 
Analyze the executed binary for any signs of malicious behavior. 
Cross-reference with other security events and logs to identify any related suspicious activities. 
Consider the context of the system and user behavior to determine if the execution is expected or anomalous.","Legitimate use of devtoolslauncher.exe by legitimate user","Image=""*\\devtoolslauncher.exe"" CommandLine=""*LaunchForDeploy*"""
"Xwizard DLL Sideloading","Christian Burkard (Nextron Systems)","Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll","attack.defense_evasion, attack.t1574.002","process_creation","windows","Not classified","Check the process creation logs for instances of Xwizard.exe being executed from non-default directories. 
Review the command-line arguments and parameters used with Xwizard.exe to identify any suspicious or unauthorized activity. 
Cross-reference the execution of Xwizard.exe with other security events or indicators of compromise to determine if it is part of a larger attack or malicious activity.","Windows installed on non-C drive","Image=""*\\xwizard.exe"" NOT Image=""C:\\Windows\\System32\\*"""
"Suspicious Dump64.exe Execution","Austin Songer @austinsonger, Florian Roth","Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder","attack.credential_access, attack.t1003.001","process_creation","windows","Not classified","Check process creation logs for instances of dump64.exe being executed. 
Look for command line arguments containing -ma and accepteula in the process creation logs. 
Verify if the process image path contains \Installer\Feedback\dump64.exe. 
If any of the above conditions are met, investigate further to determine if the execution is malicious or legitimate.","Dump64.exe used legitimately by Visual Studio for debugging purposes","(Image=""*\\dump64.exe"" NOT Image=""*\\Installer\\Feedback\\dump64.exe*"") OR (Image=""*\\dump64.exe"" CommandLine IN (""* -ma *"", ""*accepteula*""))"
"Format.com FileSystem LOLBIN","Florian Roth (Nextron Systems)","Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs","attack.defense_evasion","process_creation","windows","Not classified","Investigate the process creation logs for instances of format.com being executed with suspicious filesystem selections. 
Look for the presence of format.com in the process creation logs. 
Check if the command line contains the /fs parameter, indicating a filesystem selection. 
Examine the filesystem selection values used with format.com, such as /fsFAT, /fsexFAT, /fsNTFS, /fsUDF, or /fsReFS. 
Determine if the combination of format.com execution and the filesystem selection is unusual or unexpected in the context of normal system operations. 
Correlate the format.com execution with other suspicious activities or indicators of compromise to identify potential defense evasion activities. 
Consult with system administrators or users to confirm if the format.com execution was part of legitimate system maintenance or troubleshooting activities.","Legitimate use of format.com for formatting drives or filesystems during normal system maintenance or troubleshooting.","Image=""*\\format.com"" CommandLine=""*/fs:*"" NOT (CommandLine IN (""*/fs:FAT*"", ""*/fs:exFAT*"", ""*/fs:NTFS*"", ""*/fs:UDF*"", ""*/fs:ReFS*""))"
"Abusing IEExec To Download Payloads","Nasreddine Bencherchali (Nextron Systems)","Detects execution of the IEExec utility to download payloads","attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Review process creation logs from Windows event logs or endpoint security solutions. 
Look for instances of IEExec.exe being executed with a remote URL in the command line. 
Check if the remote URL is a known legitimate source or matches any authorized downloads in the environment. 
Verify if the IEExec.exe execution is part of a sanctioned activity or if it is potentially malicious.","Legitimate use of IEExec.exe for authorized downloads","Image=""*\\IEExec.exe"" OR OriginalFileName=""IEExec.exe"" CommandLine IN (""*https://*"", ""*http://*"")"
"Kavremover Dropped Binary LOLBIN Usage","Nasreddine Bencherchali (Nextron Systems)","Detects the execution of a signed binary dropped by Kaspersky Lab Products Remover (kavremover) which can be abused as a LOLBIN to execute arbitrary commands and binaries.","attack.defense_evasion, attack.t1127","process_creation","windows","Not classified","Check the process creation logs for instances where the CommandLine contains  run run-cmd  and the ParentImage ends with \kavremover.exe or \cleanapi.exe. 
Review the command line arguments and the parent process image to determine if the execution is legitimate or potentially malicious. 
Cross-reference the process execution with other security events and indicators of compromise (IOCs) to identify any associated malicious activity. 
Consult threat intelligence sources and security advisories for any known instances of LOLBIN abuse using Kaspersky Lab Products Remover (kavremover).","Unknown","CommandLine=""* run run-cmd *"" NOT (ParentImage IN (""*\\kavremover.exe"", ""*\\cleanapi.exe""))"
"Potential Manage-bde.wsf Abuse To Proxy Execution","oscd.community, Natalia Shornikova, Nasreddine Bencherchali (Nextron Systems)","Detects potential abuse of the ""manage-bde.wsf"" script as a LOLBIN to proxy execution","attack.defense_evasion, attack.t1216","process_creation","windows","Not classified","Review process creation logs for instances of wscript.exe or cscript.exe executing manage-bde.wsf. 
Check for any suspicious or unexpected command line arguments passed to manage-bde.wsf. 
Correlate with other security events or indicators of compromise to identify any malicious activity. 
Verify if the execution of manage-bde.wsf is part of a legitimate disk encryption or decryption process.","Instances where legitimate use of manage-bde.wsf is expected, such as during disk encryption or decryption processes.","(Image=""*\\wscript.exe"" OR OriginalFileName=""wscript.exe"" CommandLine=""*manage-bde.wsf*"") OR (ParentImage IN (""*\\cscript.exe"", ""*\\wscript.exe"") ParentCommandLine=""*manage-bde.wsf*"" NOT Image=""*\\cmd.exe"")"
"Mavinject Inject DLL Into Running Process","frack113, Florian Roth","Detects process injection using the signed Windows tool ""Mavinject"" via the ""INJECTRUNNING"" flag","attack.defense_evasion, attack.privilege_escalation, attack.t1055.001, attack.t1218.013","process_creation","windows","Not classified","Check the process creation logs for instances where the Mavinject tool is used with the /INJECTRUNNING flag. 
Look for the AppVClient.exe process as the parent process of the injected DLL. 
Review the command-line arguments of the Mavinject process to identify the target process being injected into. 
Inspect the injected DLL for any suspicious or unauthorized behavior. 
Correlate the detection with other security events or indicators of compromise to determine the extent of the attack.","Unknown","CommandLine=""* /INJECTRUNNING *"" NOT ParentImage=""C:\\Windows\\System32\\AppVClient.exe"""
"MpiExec Lolbin","Florian Roth (Nextron Systems)","Detects a certain command line flag combination used by mpiexec.exe LOLBIN from HPC pack that can be used to execute any other binary","attack.execution, attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Check the process creation logs for instances of mpiexec.exe with the command line flags /n 1 or -n 1 
Verify the legitimacy of the command line flag combination by reviewing the context in which mpiexec.exe is executed 
Cross-reference the process execution with other relevant logs, such as network traffic logs or file access logs, to identify any suspicious or malicious activity","Legitimate use of mpiexec.exe with the specified command line flag combination 
Legitimate use of mpiexec.exe with different command line flag combinations 
Legitimate use of other binaries with similar command line flag combinations","Image=""*\\mpiexec.exe"" OR Imphash=""d8b52ef6aaa3a81501bdfff9dbb96217"" OR Hashes=""*IMPHASH=d8b52ef6aaa3a81501bdfff9dbb96217*"" CommandLine IN (""* /n 1 *"", ""* -n 1 *"")"
"Execute MSDT Via Answer File","Nasreddine Bencherchali (Nextron Systems)","Detects execution of ""msdt.exe"" using an answer file which is simulating the legitimate way of calling msdt via ""pcwrun.exe"" (For example from the compatibility tab)","attack.defense_evasion, attack.t1218, attack.execution","process_creation","windows","Not classified","Check the parent process of msdt.exe to ensure it is pcwrun.exe 
Verify that the command line of msdt.exe contains the path to the PCWDiagnostic.xml file 
Confirm that the command line of msdt.exe includes the -af or /af parameter 
Review the answer file path used in the command line of msdt.exe to ensure it matches the expected path","Execution of msdt.exe with legitimate parent processes other than pcwrun.exe 
Execution of msdt.exe without the use of an answer file 
Execution of msdt.exe with a different answer file path","Image=""*\\msdt.exe"" CommandLine=""*\\WINDOWS\\diagnostics\\index\\PCWDiagnostic.xml*"" CommandLine IN (""* -af *"", ""* /af *"") NOT ParentImage=""*\\pcwrun.exe"""
"OpenWith.exe Executes Specified Binary","Beyu Denis, oscd.community (rule), @harr0ey (idea)","The OpenWith.exe executes other binary","attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Review process creation logs for instances of OpenWith.exe being executed with a command-line argument containing /c. 
Check if the executed binary is a known legitimate application or if it is suspicious or malicious. 
Analyze the command-line argument to determine if it is a common technique used by attackers. 
Correlate the OpenWith.exe execution with other suspicious activities or indicators of compromise.","Legitimate use of OpenWith.exe to open files with specified applications","Image=""*\\OpenWith.exe"" CommandLine=""*/c*"""
"Execute Pcwrun.EXE To Leverage Follina","Nasreddine Bencherchali (Nextron Systems)","Detects indirect command execution via Program Compatibility Assistant ""pcwrun.exe"" leveraging the follina (CVE-2022-30190) vulnerability","attack.defense_evasion, attack.t1218, attack.execution","process_creation","windows","Not classified","Check the process creation logs for instances of pcwrun.exe being executed with a command line containing ../. 
Review the command line arguments and parameters passed to pcwrun.exe for any suspicious or unexpected values. 
Cross-reference the process creation logs with other relevant logs such as network traffic logs or file system logs to identify any associated suspicious activity or artifacts. 
Investigate any instances of pcwrun.exe being executed in conjunction with the follina (CVE-2022-30190) vulnerability, such as attempts to exploit the vulnerability or perform unauthorized actions on the system.","Unlikely","Image=""*\\pcwrun.exe"" CommandLine=""*../*"""
"PrintBrm ZIP Creation of Extraction","frack113","Detects the execution of the LOLBIN PrintBrm.exe, which can be used to create or extract ZIP files. PrintBrm.exe should not be run on a normal workstation.","attack.command_and_control, attack.t1105, attack.defense_evasion, attack.t1564.004","process_creation","windows","Not classified","1. Check the command line arguments of the process creation event to see if it includes the PrintBrm.exe executable and the -f flag followed by a .zip file extension. 
2. Verify if the process execution is happening on a normal workstation or an authorized system where PrintBrm.exe is expected to be used for ZIP file operations. 
3. Cross-reference the process execution with other security events or logs to identify any suspicious or malicious activities associated with the PrintBrm.exe execution. 
4. If necessary, investigate the file or directory accessed by PrintBrm.exe to determine if it contains any sensitive or unauthorized data.","Legitimate use of PrintBrm.exe for creating or extracting ZIP files on authorized systems.","Image=""*\\PrintBrm.exe"" CommandLine=""* -f*"" CommandLine=""*.zip*"""
"Using SettingSyncHost.exe as LOLBin","Anton Kutepov, oscd.community","Detects using SettingSyncHost.exe to run hijacked binary","attack.execution, attack.defense_evasion, attack.t1574.008","process_creation","windows","Not classified","Check the process creation logs for instances of SettingSyncHost.exe being used to run hijacked binaries. 
Look for parent processes that contain the command line cmd.exe /c RoamDiag.cmd -outputpath. 
Review the TargetFilename and Image fields in the process creation logs to identify any suspicious activity.","Unknown","NOT (Image IN (""C:\\Windows\\System32\\*"", ""C:\\Windows\\SysWOW64\\*"")) ParentCommandLine=""*cmd.exe /c*"" ParentCommandLine=""*RoamDiag.cmd*"" ParentCommandLine=""*-outputpath*"""
"Suspicious LOLBIN AccCheckConsole","Florian Roth (Nextron Systems)","Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL","attack.execution","process_creation","windows","Not classified","Check process creation logs for instances of AccCheckConsole.exe being executed with the parameters -window and .dll. 
Review the command-line arguments and look for any suspicious or unexpected DLLs being loaded. 
Cross-reference the process execution with other security events or indicators of compromise to identify any malicious activity. 
If possible, analyze the content of the loaded DLLs for signs of malicious behavior or known indicators of compromise.","Legitimate use of the UI Accessibility Checker","Image=""*\\AccCheckConsole.exe"" OR OriginalFileName=""AccCheckConsole.exe"" CommandLine=""* -window *"" CommandLine=""*.dll*"""
"Suspicious Atbroker Execution","Mateusz Wydra, oscd.community","Atbroker executing non-deafualt Assistive Technology applications","attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Check the command line arguments of the process execution 
Look for any suspicious or unusual command line parameters 
Verify if the executed process is related to any known assistive technology applications 
Cross-reference the process execution with the list of known false positives 
Analyze the parent process and its behavior for any signs of compromise 
Review any related network traffic or file activity associated with the process 
Consult with the user or system owner to determine if the execution was expected or authorized","Legitimate, non-default assistive technology applications execution","Image=""*AtBroker.exe"" CommandLine=""*start*"" NOT (CommandLine IN (""*animations*"", ""*audiodescription*"", ""*caretbrowsing*"", ""*caretwidth*"", ""*colorfiltering*"", ""*cursorscheme*"", ""*filterkeys*"", ""*focusborderheight*"", ""*focusborderwidth*"", ""*highcontrast*"", ""*keyboardcues*"", ""*keyboardpref*"", ""*magnifierpane*"", ""*messageduration*"", ""*minimumhitradius*"", ""*mousekeys*"", ""*Narrator*"", ""*osk*"", ""*overlappedcontent*"", ""*showsounds*"", ""*soundsentry*"", ""*stickykeys*"", ""*togglekeys*"", ""*windowarranging*"", ""*windowtracking*"", ""*windowtrackingtimeout*"", ""*windowtrackingzorder*""))"
"Suspicious Certreq Command to Download","Christian Burkard (Nextron Systems)","Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files","attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Check the command line arguments of the certreq.exe process to identify any suspicious parameters such as -Post, -config, http, or C\windows\win.ini 
Review the parent process command line to understand the context of the certreq.exe execution 
Analyze network logs for any outgoing connections to suspicious URLs or IP addresses mentioned in the certreq.exe command line 
Examine the file system for any downloaded files or artifacts related to the certreq.exe execution 
Cross-reference the certreq.exe execution with other security events or indicators of compromise to identify any correlation or patterns","Legitimate use of certreq.exe for certificate management and enrollment 
Use of certreq.exe with benign command line arguments","Image=""*\\certreq.exe"" OR OriginalFileName=""CertReq.exe"" CommandLine=""* -Post *"" CommandLine=""* -config *"" CommandLine=""* http*"" CommandLine=""* C:\\windows\\win.ini *"""
"Suspicious GrpConv Execution","Florian Roth (Nextron Systems)","Detects the suspicious execution of a utility to convert Windows 3.x .grp files or for persistence purposes by malicious software or actors","attack.persistence, attack.t1547","process_creation","windows","Not classified","Review process creation logs from Windows systems for instances of grpconv.exe being executed with the -o or -O option. 
Check if the execution of grpconv.exe is associated with any suspicious or unauthorized activity, such as unusual network connections or file modifications. 
Compare the command line arguments used with grpconv.exe against known legitimate usage patterns. 
Correlate the execution of grpconv.exe with other security events or indicators of compromise to determine if it is part of a larger attack or persistence mechanism.","Legitimate usage of grpconv.exe for valid purposes, such as system maintenance or file conversion.","CommandLine IN (""*grpconv.exe -o*"", ""*grpconv -o*"")"
"Windows Defender Download Activity","Matthew Matchen","Detect the use of Windows Defender to download payloads","attack.defense_evasion, attack.t1218, attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Check for legitimate use of Windows Defender for downloading files by correlating with other logs such as network traffic logs, proxy logs, or firewall logs. 
Look for patterns of suspicious or malicious behavior in the downloaded files, such as known malware signatures or indicators of compromise (IOCs). 
Verify the integrity of the downloaded files using hash values or digital signatures. 
Check if the download activity is part of a scheduled or authorized update process. 
Investigate the source URL and determine if it is a known malicious domain or if it has been flagged by threat intelligence sources.","Legitimate use of Windows Defender for downloading files","CommandLine=""*MpCmdRun.exe*"" OR Description=""Microsoft Malware Protection Command Line Utility"" CommandLine=""*DownloadFile*"" CommandLine=""*url*"""
"Time Travel Debugging Utility Usage","Ensar amil, @sblmsrsn, @oscd_initiative","Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.","attack.defense_evasion, attack.credential_access, attack.t1218, attack.t1003.001","process_creation","windows","Not classified","Check for tttracer.exe process execution in the process creation logs on Windows systems.","Legitimate usage by software developers/testers","ParentImage=""*\\tttracer.exe"""
"Visual Basic Command Line Compiler Usage","Ensar amil, @sblmsrsn, @oscd_initiative","Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter.","attack.defense_evasion, attack.t1027.004","process_creation","windows","Not classified","Check process creation logs for instances of vbc.exe being executed with cvtres.exe as the child process. 
Look for any unusual or unauthorized usage of Visual Basic Command Line Compiler in the environment. 
Review the command-line arguments and parameters used during the compilation process. 
Cross-reference the compilation activity with other security events or indicators of compromise to identify any potential malicious activity.","Utilization of this tool should not be seen in enterprise environment","ParentImage=""*\\vbc.exe"" Image=""*\\cvtres.exe"""
"Proxy Execution via Wuauclt","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), Florian Roth (Nextron Systems), Sreeman, FPT.EagleEye Team","Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code.","attack.defense_evasion, attack.t1218, attack.execution","process_creation","windows","Not classified","Check the command line arguments of the wuauclt.exe process to identify any suspicious or unexpected parameters. 
Review the parent process of wuauclt.exe to determine if it is being launched from a legitimate source. 
Analyze the network traffic generated by wuauclt.exe to identify any unusual or malicious communication. 
Monitor for any abnormal behavior or system changes that occur after the execution of wuauclt.exe. 
Cross-reference the execution of wuauclt.exe with other security events or indicators of compromise to identify any related malicious activity.","Legitimate use of wuauclt.exe for Windows Update operations. 
Legitimate use of wuauclt.exe for Windows Update-related software installations. 
Legitimate use of wuauclt.exe for Windows Update-related troubleshooting. 
Legitimate use of wuauclt.exe for Windows Update-related scripting or automation. 
Legitimate use of wuauclt.exe for Windows Update-related third-party software installations. 
Legitimate use of wuauclt.exe for Windows Update-related Group Policy updates. 
Legitimate use of wuauclt.exe for Windows Update-related WSUS (Windows Server Update Services) operations.","Image=""*\\wuauclt.exe"" OR OriginalFileName=""wuauclt.exe"" CommandLine=""*UpdateDeploymentProvider*"" CommandLine=""*.dll*"" CommandLine=""*RunHandlerComServer*"" NOT (CommandLine IN (""* /UpdateDeploymentProvider UpdateDeploymentProvider.dll *"", ""* wuaueng.dll *""))"
"Potential Credential Dumping Via LSASS Process Clone","Florian Roth (Nextron Systems), Samir Bousseaden","Detects a suspicious LSASS process process clone that could be a sign of credential dumping activity","attack.credential_access, attack.t1003, attack.t1003.001","process_creation","windows","Not classified","Check for any legitimate system updates or patching activities that may have caused the LSASS process clone. 
Review the process creation logs for any suspicious activities related to the LSASS process clone. 
Look for any other indicators of credential dumping activity, such as unusual network traffic or abnormal behavior from user accounts. 
Correlate the detection with other security events or alerts to identify any potential malicious activity.","Legitimate process clones during system updates or patching","ParentImage=""*\\Windows\\System32\\lsass.exe"" Image=""*\\Windows\\System32\\lsass.exe"""
"Sensitive Registry Access via Volume Shadow Copy","Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)","Detects a command that accesses password storing registry hives via volume shadow backups","attack.impact, attack.t1490","process_creation","windows","Not classified","Check for legitimate backup and restore operations that involve accessing the registry hives via volume shadow copies. 
Verify if the command is executed by a trusted process or user. 
Review the command line arguments and parameters to identify any suspicious or unauthorized activity. 
Cross-reference the accessed files (e.g., NTDS.dit, SYSTEM, SECURITY) with the expected backup and restore operations. 
Analyze the destination path (e.g., C\tmp\log) to determine if it aligns with legitimate backup and restore activities.","Some rare backup scenarios","CommandLine=""*\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy*"" CommandLine IN (""*\\NTDS.dit*"", ""*\\SYSTEM*"", ""*\\SECURITY*"", ""*C:\\tmp\\log*"")"
"WScript or CScript Dropper","Margaritis Dimitrios (idea), Florian Roth (Nextron Systems), oscd.community","Detects wscript/cscript executions of scripts located in user directories","attack.execution, attack.t1059.005, attack.t1059.007","process_creation","windows","Not classified","Check the CommandLine field in process_creation logs for instances of wscript.exe or cscript.exe being executed. 
Look for command lines that contain paths in user directories (e.g., C\Users\) or the ProgramData directory (e.g., C\ProgramData\). 
Inspect the CommandLine field for script file extensions such as .jse, .vbe, .js, .vba, or .vbs. 
Exclude instances where the ParentImage field contains the string \winzip as this is a known false positive.","Winzip 
Other self-extractors","Image IN (""*\\wscript.exe"", ""*\\cscript.exe"") CommandLine IN (""*C:\\Users\\*"", ""*C:\\ProgramData\\*"") CommandLine IN (""*.jse*"", ""*.vbe*"", ""*.js*"", ""*.vba*"", ""*.vbs*"") NOT ParentImage=""*\\winzip*"""
"MMC20 Lateral Movement","@2xxeformyshirt (Security Risk Advisors) - rule; Teymur Kheirkhabarov (idea)","Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of ""-Embedding"" as a child of svchost.exe","attack.execution, attack.t1021.003","process_creation","windows","Not classified","Review process creation logs from Windows event logs or SIEM for instances where MMC.exe is spawned as a child of svchost.exe with the command line parameter -Embedding. 
Check if the parent process is legitimate and expected to spawn MMC.exe with the -Embedding command line parameter. 
Verify if the command line parameter -Embedding is being used for legitimate purposes, such as when using Microsoft Management Console (MMC) snap-ins. 
Cross-reference with other security events or indicators of compromise to determine if the activity is part of a larger attack or if it is an isolated incident.","Legitimate use of MMC.exe with the -Embedding command line parameter, such as when using Microsoft Management Console (MMC) snap-ins.","ParentImage=""*\\svchost.exe"" Image=""*\\mmc.exe"" CommandLine=""*-Embedding*"""
"MMC Spawning Windows Shell","Karneades, Swisscom CSIRT","Detects a Windows command line executable started from MMC","attack.lateral_movement, attack.t1021.003","process_creation","windows","Not classified","Review process creation logs from Windows event logs or SIEM for instances where MMC spawns command line executables. 
Look for any suspicious or unauthorized use of MMC to start command line executables. 
Cross-reference the command line arguments and parent process information to identify any potentially malicious activity.","Legitimate use of MMC to start command line executables","ParentImage=""*\\mmc.exe"" Image IN (""*\\cmd.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\wscript.exe"", ""*\\cscript.exe"", ""*\\sh.exe"", ""*\\bash.exe"", ""*\\reg.exe"", ""*\\regsvr32.exe"") OR Image=""*\\BITSADMIN*"""
"File Download Via Windows Defender MpCmpRun.EXE","Matthew Matchen","Detects the use of Windows Defender MpCmdRun.EXE to download files","attack.defense_evasion, attack.t1218, attack.command_and_control, attack.t1105","process_creation","windows","Not classified","Not available","Not available"
"Windows Defender Definition Files Removed","frack113","Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check for other indicators of compromise (IOCs) or suspicious activities on the affected system, such as unusual network connections, unauthorized file modifications, or the presence of known malware. 
Review system logs, such as event logs, for any related events or anomalies. 
Cross-reference with other security tools or logs, such as antivirus logs or endpoint detection and response (EDR) logs, to identify any additional signs of malicious activity. 
Interview the system user or administrator to determine if the removal of Windows Defender Definition Files was authorized or expected. 
If possible, analyze the parent process of MpCmdRun.exe to identify any suspicious behavior or potential compromise. 
Consider conducting a forensic analysis of the affected system to gather additional evidence and determine the extent of the incident.","Legitimate removal of Windows Defender Definition Files during authorized maintenance or updates.","Image=""*\\MpCmdRun.exe"" OR OriginalFileName=""MpCmdRun.exe"" CommandLine=""* -RemoveDefinitions*"" CommandLine=""* -All*"""
"Suspicious JavaScript Execution Via Mshta.EXE","E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community","Detects execution of javascript code using ""mshta.exe"".","attack.defense_evasion, attack.t1218.005","process_creation","windows","Not classified","Check the command line arguments of the process creation event for the presence of mshta.exe and javascript. 
Review the parent process and command line arguments to determine if the execution is expected or suspicious. 
Analyze the content of the executed JavaScript file to identify any malicious behavior or indicators of compromise. 
Cross-reference with other security events and logs to identify any related suspicious activities or indicators of compromise. 
Consider the context of the execution, such as the user, time, and network connections, to determine if it aligns with normal behavior or indicates a potential security incident.","Legitimate use of mshta.exe for executing JavaScript files as part of normal system operations.","Image=""*\\mshta.exe"" OR OriginalFileName=""MSHTA.EXE"" CommandLine=""*javascript*"""
"Potential LethalHTA Technique Execution","Markus Neis","Detects potential LethalHTA technique where the ""mshta.exe"" is spawned by an ""svchost.exe"" process","attack.defense_evasion, attack.t1218.005","process_creation","windows","Not classified","Review process creation logs from Windows Event Logs (Event ID 4688) to identify instances where mshta.exe is spawned by svchost.exe. Look for any suspicious or unexpected instances of this behavior. 
Check for any command-line arguments or parameters passed to mshta.exe that are unusual or suspicious. 
Correlate with other security events or indicators of compromise (IOCs) to determine if the behavior is part of a larger attack or campaign.","Legitimate use of mshta.exe by svchost.exe for system operations","ParentImage=""*\\svchost.exe"" Image=""*\\mshta.exe"""
"Suspicious MSHTA Child Process","Michael Haag","Detects a suspicious process spawning from an ""mshta.exe"" process, which could be indicative of a malicious HTA script execution","attack.defense_evasion, attack.t1218.005, car.2013-02-003, car.2013-03-001, car.2014-04-003","process_creation","windows","Not classified","Check the command-line arguments of the suspicious child process to identify any malicious behavior or unusual parameters. 
Analyze the network connections made by the child process to determine if it is communicating with suspicious or known malicious IP addresses or domains. 
Inspect the process tree to identify any other related processes or parent-child relationships that may indicate a larger attack. 
Review any relevant log sources such as firewall logs, antivirus logs, or web proxy logs to gather additional information about the suspicious activity. 
Conduct a memory analysis of the parent and child processes to identify any signs of code injection or other memory-based attacks. 
Compare the hash values of the suspicious child process with known malicious hashes from threat intelligence sources to determine if it is associated with any known malware. 
If available, review any relevant endpoint detection and response (EDR) logs or alerts to gather additional context about the suspicious activity. 
Consult with the system owner or user to gather information about any legitimate activities or software installations that may have triggered the detection.","Printer software / driver installations 
HP software","ParentImage=""*\\mshta.exe"" Image IN (""*\\cmd.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\wscript.exe"", ""*\\cscript.exe"", ""*\\sh.exe"", ""*\\bash.exe"", ""*\\reg.exe"", ""*\\regsvr32.exe"", ""*\\bitsadmin.exe"") OR OriginalFileName IN (""Cmd.Exe"", ""PowerShell.EXE"", ""pwsh.dll"", ""wscript.exe"", ""cscript.exe"", ""Bash.exe"", ""reg.exe"", ""REGSVR32.EXE"", ""bitsadmin.exe"")"
"MSHTA Suspicious Execution 01","Diego Perez (@darkquassar), Markus Neis, Swisscom (Improve Rule)","Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism","attack.defense_evasion, attack.t1140, attack.t1218.005, attack.execution, attack.t1059.007, cve.2020.1599","process_creation","windows","Not classified","Examine the process creation logs in your SIEM for events matching this rule. 
Focus on events where the ""Image"" ends with \mshta.exe. 
Investigate the ""CommandLine"" to see which suspicious patterns triggered the rule. 
Verify the context of the execution, including the user account involved. 
Check the specific use case for executing mshta.exe to determine whether it was a legitimate activity or suspicious behavior. 
Consider additional context, such as the source of the execution and the target files, to make an informed assessment. 
Adjust the rule as needed to reduce false positives while maintaining coverage for potentially malicious activities.","False positives can occur depending on the legitimate scripts, tools, or activities in your monitored environment. Review and adjust the rule based on your specific environment to reduce false positives.","Image=""*\\mshta.exe"" CommandLine IN (""*vbscript*"", ""*.jpg*"", ""*.png*"", ""*.lnk*"", ""*.xls*"", ""*.doc*"", ""*.zip*"", ""*.dll*"")"
"Potential MsiExec Masquerading","Florian Roth (Nextron Systems)","Detects the execution of msiexec.exe from an uncommon directory","attack.defense_evasion, attack.t1036.005","process_creation","windows","Not classified","Check the command-line arguments used with msiexec.exe to determine if any suspicious options or parameters were passed 
Review the parent process and its command-line arguments to identify any unusual behavior or suspicious activity 
Analyze the process tree to identify any other related processes or activities 
Correlate the msiexec.exe execution with other security events, such as network connections or file modifications, to determine if it is part of a larger attack chain 
Monitor the execution of msiexec.exe from other directories to establish a baseline of normal behavior and identify anomalies","Legitimate use of msiexec.exe from a non-standard directory 
Execution of msiexec.exe from a directory added to the system PATH variable","Image=""*\\msiexec.exe"" OR OriginalFileName=""\\msiexec.exe"" NOT (Image IN (""C:\\Windows\\System32\\*"", ""C:\\Windows\\SysWOW64\\*"", ""C:\\Windows\\WinSxS\\*""))"
"Potential MSTSC Shadowing Activity","Florian Roth (Nextron Systems)","Detects RDP session hijacking by using MSTSC shadowing","attack.lateral_movement, attack.t1563.002","process_creation","windows","Not classified","Review Windows process creation logs for instances where the MSTSC process is launched with the shadow parameter. 
Check if the noconsentprompt flag is used in conjunction with the shadow parameter. 
Verify the user account associated with the RDP session and compare it with the authorized administrators list. 
Cross-reference the activity with other security events to identify any suspicious or malicious behavior.","Legitimate use of MSTSC shadowing by authorized administrators","CommandLine=""*noconsentprompt*"" CommandLine=""*shadow:*"""
"Suspicious Program Location Whitelisted In Firewall Via Netsh.EXE","Sander Wiebing, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community","Detects Netsh command execution that whitelists a program located in a suspicious location in the Windows Firewall","attack.defense_evasion, attack.t1562.004","process_creation","windows","Not classified","Check the command line arguments of the process creation event for the presence of netsh.exe and firewall add allowedprogram or advfirewall firewall add rule action=allow program= 
Review the path of the program being whitelisted in the Windows Firewall to determine if it is located in a suspicious location such as %TEMP%, %TMP%, \$Recycle.bin\, \RECYCLER\, \SystemVolumeInformation\, \Temp\, \Users\Default\, \Users\Desktop\, \Users\Public\, \Windows\addins\, \Windows\cursors\, \Windows\debug\, \Windows\drivers\, \Windows\fonts\, \Windows\help\, \Windows\system32\tasks\, \Windows\Tasks\, \Windows\Temp\, \Downloads\, \Local Settings\Temporary Internet Files\, \Temporary Internet Files\Content.Outlook\","Legitimate whitelisting of a program in the Windows Firewall via Netsh.EXE","Image=""*\\netsh.exe"" OR OriginalFileName=""netsh.exe"" (CommandLine=""*firewall*"" CommandLine=""*add*"" CommandLine=""*allowedprogram*"") OR (CommandLine=""*advfirewall*"" CommandLine=""*firewall*"" CommandLine=""*add*"" CommandLine=""*rule*"" CommandLine=""*action=allow*"" CommandLine=""*program=*"") CommandLine IN (""*%Public%\\*"", ""*%TEMP%*"", ""*%TMP%*"", ""*:\\$Recycle.bin\\*"", ""*:\\RECYCLER\\*"", ""*:\\SystemVolumeInformation\\*"", ""*:\\Temp\\*"", ""*:\\Users\\Default\\*"", ""*:\\Users\\Desktop\\*"", ""*:\\Users\\Public\\*"", ""*:\\Windows\\addins\\*"", ""*:\\Windows\\cursors\\*"", ""*:\\Windows\\debug\\*"", ""*:\\Windows\\drivers\\*"", ""*:\\Windows\\fonts\\*"", ""*:\\Windows\\help\\*"", ""*:\\Windows\\system32\\tasks\\*"", ""*:\\Windows\\Tasks\\*"", ""*:\\Windows\\Temp\\*"", ""*\\Downloads\\*"", ""*\\Local Settings\\Temporary Internet Files\\*"", ""*\\Temporary Internet Files\\Content.Outlook\\*"")"
"RDP Connection Allowed Via Netsh.EXE","Sander Wiebing","Detects usage of the netsh command to open and allow connections to port 3389 (RDP). As seen used by Sarwent Malware","attack.defense_evasion, attack.t1562.004","process_creation","windows","Not classified","Check if the netsh.exe process was executed with the command line containing firewall, add, tcp, and 3389 
Verify if the command line includes portopening, advfirewall, rule, and allow 
Review the context of the event to determine if it aligns with legitimate administration activity 
Cross-reference with other logs such as firewall logs, network logs, and authentication logs to identify any suspicious or malicious behavior 
If possible, check for any correlation with known indicators of compromise (IOCs) related to Sarwent Malware 
Consult with system administrators or network security teams to validate the activity and determine if it is expected or anomalous","Legitimate administration activity involving netsh.exe and opening port 3389 for RDP","Image=""*\\netsh.exe"" OR OriginalFileName=""netsh.exe"" CommandLine=""*firewall *"" CommandLine=""*add *"" CommandLine=""*tcp *"" CommandLine=""*3389*"" CommandLine=""*portopening*"" OR (CommandLine=""*advfirewall*"" CommandLine=""*rule*"" CommandLine=""*allow*"")"
"Potential Persistence Via Netsh Helper DLL","Victor Sergeev, oscd.community","Detects the execution of netsh with ""add helper"" flag in order to add a custom helper DLL. This technique can be abused to add a malicious helper DLL that can be used as a persistence proxy that gets called when netsh.exe is executed.","attack.privilege_escalation, attack.persistence, attack.t1546.007, attack.s0108","process_creation","windows","Not classified","Check the CommandLine field for the presence of netsh.exe and add helper 
Review the ParentCommandLine field to identify the parent process that executed netsh.exe 
Verify the legitimacy of the helper DLL being added by checking its digital signature or comparing its hash with known good DLLs","Legitimate use of netsh.exe to add a valid helper DLL","Image=""*\\netsh.exe"" CommandLine=""*add*"" CommandLine=""*helper*"""
"RDP Port Forwarding Rule Added Via Netsh.EXE","Florian Roth (Nextron Systems), oscd.community","Detects the execution of netsh to configure a port forwarding of port 3389 (RDP) rule","attack.lateral_movement, attack.defense_evasion, attack.command_and_control, attack.t1090","process_creation","windows","Not classified","Check for legitimate administration activity related to port forwarding of port 3389 (RDP) rule using netsh.exe. 
Review the command line arguments used with netsh.exe to determine if they match the expected pattern for legitimate administration activity. 
Cross-reference the activity with other logs, such as firewall logs or network traffic logs, to identify any suspicious or unauthorized connections to port 3389.","Legitimate administration activity","Image=""*\\netsh.exe"" OR OriginalFileName=""netsh.exe"" CommandLine=""* i*"" CommandLine=""* p*"" CommandLine=""*=3389*"" CommandLine=""* c*"""
"New User Created Via Net.EXE With Never Expire Option","Nasreddine Bencherchali (Nextron Systems)","Detects creation of local users via the net.exe command with the option ""never expire""","attack.persistence, attack.t1136.001","process_creation","windows","Not classified","Review process creation logs from Windows systems for instances of net.exe or net1.exe being executed with the user add expiresnever command line options.","Unlikely","Image IN (""*\\net.exe"", ""*\\net1.exe"") OR OriginalFileName IN (""net.exe"", ""net1.exe"") CommandLine=""*user*"" CommandLine=""*add*"" CommandLine=""*expires:never*"""
"Network Reconnaissance Activity","Florian Roth (Nextron Systems)","Detects a set of suspicious network related commands often used in recon stages","attack.discovery, attack.t1087, attack.t1082, car.2016-03-001","process_creation","windows","Not classified","Review the command line arguments of the process creation events in the Windows event logs for the presence of nslookup and _ldap._tcp.dc._msdcs.. 
Check if the nslookup command is being used for legitimate DNS troubleshooting or administration purposes. 
If the command is being used in an unusual or suspicious context, investigate further to determine the intent and potential threat.","Legitimate use of nslookup for DNS troubleshooting or administration","CommandLine=""*nslookup*"" CommandLine=""*_ldap._tcp.dc._msdcs.*"""
"Outlook EnableUnsafeClientMailRules Setting Enabled","Markus Neis, Nasreddine Bencherchali (Nextron Systems)","Detects an attacker trying to enable the outlook security setting ""EnableUnsafeClientMailRules"" which allows outlook to run applications or execute macros","attack.execution, attack.t1059, attack.t1202","process_creation","windows","Not classified","Check the process creation logs from Windows event logs or a SIEM solution for any instances where the Outlook process (outlook.exe) is spawned with the command line containing \Outlook\Security\EnableUnsafeClientMailRules. 
Look for any associated network traffic or communication patterns that may indicate malicious activity, such as connections to suspicious IP addresses or domains. 
Cross-reference the detected activity with other security events or indicators of compromise (IOCs) to determine if it is part of a larger attack campaign. 
If possible, gather additional context by reviewing the user account or system that initiated the process and check for any other suspicious behavior or indicators of compromise.","Legitimate use of the EnableUnsafeClientMailRules setting by authorized users or administrators. 
False positives may occur if the detection is triggered by legitimate applications or system processes that use a similar command line.","CommandLine=""*\\Outlook\\Security\\EnableUnsafeClientMailRules*"""
"Execution in Outlook Temp Folder","Florian Roth (Nextron Systems)","Detects a suspicious program execution in Outlook temp folder","attack.initial_access, attack.t1566.001","process_creation","windows","Not classified","To investigate this detection, you can perform the following steps 
Identify the process name and command line associated with the detection. 
Check if the process is a known legitimate program that uses the Outlook temp folder, such as Microsoft Office applications. 
If the process is not a known legitimate program, analyze the command line arguments to determine if they indicate malicious activity. 
Review the parent process command line to understand the context of the execution. 
Check for any other suspicious activities or indicators of compromise on the system, such as network connections or file modifications. 
Consult threat intelligence sources and security incident response playbooks for additional guidance on investigating similar detections. 
Example log sources that may contain relevant information for investigation 
Windows process creation logs (Event ID 4688) that capture the execution of the suspicious process. 
Endpoint detection and response (EDR) logs that provide detailed information about the process execution and associated events. 
Network logs that show any network connections made by the suspicious process. 
File system logs that track file modifications in the Outlook temp folder.","Legitimate programs that use the Outlook temp folder for legitimate purposes, such as Microsoft Office applications.","Image=""*\\Temporary Internet Files\\Content.Outlook\\*"""
"Suspicious Outlook Child Process","Michael Haag, Florian Roth (Nextron Systems), Markus Neis, Elastic, FPT.EagleEye Team","Detects a suspicious process spawning from an Outlook process.","attack.execution, attack.t1204.002","process_creation","windows","Not classified","Review the ParentImage field in the process creation logs to confirm that the parent process is indeed Outlook (OUTLOOK.EXE). 
Review the Image field in the process creation logs to identify the suspicious child processes that are being spawned from Outlook. 
Analyze the CommandLine and ParentCommandLine fields in the process creation logs to understand the specific commands being executed by the suspicious child processes. 
Cross-reference the suspicious child processes with known legitimate processes that can be spawned by Outlook during normal operations. 
Check if any known security tools or add-ins are installed in Outlook that may explain the spawning of the suspicious child processes. 
Investigate any recent changes or updates to Outlook or its configuration that may have triggered the detection. 
Consult with the user or owner of the Outlook account to gather additional context or information about their activities. 
If necessary, escalate the investigation to the endpoint or system level to gather more detailed information about the suspicious child processes and their impact on the system.","Legitimate child processes spawned by Outlook, such as add-ins or plugins. 
Legitimate child processes spawned by Outlook during normal operations, such as opening attachments or accessing external content. 
Legitimate child processes spawned by Outlook when interacting with other applications or services, such as synchronization processes with cloud services. 
Legitimate child processes spawned by Outlook when performing scheduled tasks or reminders. 
Legitimate child processes spawned by Outlook when using automation or scripting features. 
Legitimate child processes spawned by Outlook when using built-in or third-party security features, such as scanning attachments or checking for malicious links. 
Legitimate child processes spawned by Outlook when interacting with the operating system, such as accessing system resources or executing system commands. 
Legitimate child processes spawned by Outlook when using productivity or collaboration features, such as sharing files or sending meeting invitations.","ParentImage=""*\\OUTLOOK.EXE"" Image IN (""*\\AppVLP.exe"", ""*\\bash.exe"", ""*\\cmd.exe"", ""*\\cscript.exe"", ""*\\forfiles.exe"", ""*\\hh.exe"", ""*\\mftrace.exe"", ""*\\msbuild.exe"", ""*\\msdt.exe"", ""*\\mshta.exe"", ""*\\msiexec.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\regsvr32.exe"", ""*\\schtasks.exe"", ""*\\scrcons.exe"", ""*\\scriptrunner.exe"", ""*\\sh.exe"", ""*\\svchost.exe"", ""*\\wmic.exe"", ""*\\wscript.exe"")"
"Suspicious Remote Child Process From Outlook","Markus Neis, Nasreddine Bencherchali (Nextron Systems)","Detects a suspicious child process spawning from Outlook where the image is located in a remote location (SMB/WebDav shares).","attack.execution, attack.t1059, attack.t1202","process_creation","windows","Not classified","Review process creation logs from Windows Event Logs (Event ID 4688) to identify the parent process and child process details. 
Check the ParentImage field to confirm if it ends with \outlook.exe. 
Check the Image field to confirm if it starts with \\ indicating a remote location. 
Verify if the remote location is a legitimate SMB or WebDav share. 
Investigate the purpose and legitimacy of the child process by analyzing its behavior and associated network activity. 
Cross-reference with other security events and indicators of compromise to determine if the activity is part of a larger attack.","Legitimate use of remote child processes by authorized users or applications.","ParentImage=""*\\outlook.exe"" Image=""\\\\*"""
"Suspicious Microsoft Office Child Process","Florian Roth (Nextron Systems), Markus Neis, FPT.EagleEye Team, Vadim Khrykov, Cyb3rEng, Michael Haag, Christopher Peacock @securepeacock, @scythe_io","Detects a suspicious process spawning from one of the Microsoft Office suite products (Word, Excel, PowerPoint, Publisher, Visio, etc.)","attack.defense_evasion, attack.execution, attack.t1047, attack.t1204.002, attack.t1218.010","process_creation","windows","Not classified","Review the parent process and confirm if it is a Microsoft Office application (e.g., Word, Excel, PowerPoint, etc.). 
Analyze the child process to determine its legitimacy and purpose. Check if it is a known legitimate process or if it has any suspicious behavior. 
Verify the path of the child process to identify if it is spawned from trusted locations (e.g., system directories) or suspicious locations (e.g., user directories, temporary folders). 
Check if the child process is spawned by a system task or scheduled job. 
Cross-reference the process with threat intelligence sources to identify any known malicious behavior associated with the parent-child process relationship. 
If necessary, perform further analysis using sandbox environments or behavioral analysis tools to understand the behavior and impact of the child process.","Legitimate child processes spawned by Microsoft Office applications 
Child processes spawned from trusted locations or with legitimate purposes 
Child processes spawned by system tasks or scheduled jobs","ParentImage IN (""*\\EQNEDT32.EXE"", ""*\\EXCEL.EXE"", ""*\\MSACCESS.EXE"", ""*\\MSPUB.exe"", ""*\\ONENOTE.EXE"", ""*\\POWERPNT.exe"", ""*\\VISIO.exe"", ""*\\WINWORD.EXE"", ""*\\wordpad.exe"", ""*\\wordview.exe"") OriginalFileName IN (""bitsadmin.exe"", ""CertOC.exe"", ""CertUtil.exe"", ""Cmd.Exe"", ""CMSTP.EXE"", ""cscript.exe"", ""curl.exe"", ""HH.exe"", ""IEExec.exe"", ""InstallUtil.exe"", ""javaw.exe"", ""Microsoft.Workflow.Compiler.exe"", ""msdt.exe"", ""MSHTA.EXE"", ""msiexec.exe"", ""Msxsl.exe"", ""odbcconf.exe"", ""pcalua.exe"", ""PowerShell.EXE"", ""RegAsm.exe"", ""RegSvcs.exe"", ""REGSVR32.exe"", ""RUNDLL32.exe"", ""schtasks.exe"", ""ScriptRunner.exe"", ""wmic.exe"", ""WorkFolders.exe"", ""wscript.exe"") OR Image IN (""*\\AppVLP.exe"", ""*\\bash.exe"", ""*\\bitsadmin.exe"", ""*\\certoc.exe"", ""*\\certutil.exe"", ""*\\cmd.exe"", ""*\\cmstp.exe"", ""*\\control.exe"", ""*\\cscript.exe"", ""*\\curl.exe"", ""*\\forfiles.exe"", ""*\\hh.exe"", ""*\\ieexec.exe"", ""*\\installutil.exe"", ""*\\javaw.exe"", ""*\\mftrace.exe"", ""*\\Microsoft.Workflow.Compiler.exe"", ""*\\msbuild.exe"", ""*\\msdt.exe"", ""*\\mshta.exe"", ""*\\msidb.exe"", ""*\\msiexec.exe"", ""*\\msxsl.exe"", ""*\\odbcconf.exe"", ""*\\pcalua.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\regasm.exe"", ""*\\regsvcs.exe"", ""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\schtasks.exe"", ""*\\scrcons.exe"", ""*\\scriptrunner.exe"", ""*\\sh.exe"", ""*\\svchost.exe"", ""*\\verclsid.exe"", ""*\\wmic.exe"", ""*\\workfolders.exe"", ""*\\wscript.exe"") OR Image IN (""*\\AppData\\*"", ""*\\Users\\Public\\*"", ""*\\ProgramData\\*"", ""*\\Windows\\Tasks\\*"", ""*\\Windows\\Temp\\*"", ""*\\Windows\\System32\\Tasks\\*"")"
"Ping Hex IP","Florian Roth (Nextron Systems)","Detects a ping command that uses a hex encoded IP address","attack.defense_evasion, attack.t1140, attack.t1027","process_creation","windows","Not classified","1. Check the ParentCommandLine field in the process_creation logs for the presence of the ping.exe image and a command line containing a hex-encoded IP address. 
2. Verify if the hex-encoded IP address is being used for a legitimate purpose, such as network troubleshooting or testing. 
3. If the hex-encoded IP address is not expected or cannot be justified, further investigation is required to determine if it is part of a malicious activity.","Administrators or network administrators may use hex-encoded IP addresses for specific purposes, such as troubleshooting or testing network connectivity.","Image=""*\\ping.exe"" CommandLine=""*0x*"""
"Suspicious Plink Port Forwarding","Florian Roth (Nextron Systems)","Detects suspicious Plink tunnel port forwarding to a local port","attack.command_and_control, attack.t1572, attack.lateral_movement, attack.t1021.001","process_creation","windows","Not classified","Check the process creation logs for instances of Plink.exe being executed with the -R option. 
Look for any suspicious or unauthorized SSH, Telnet, or Rlogin connections originating from the local system. 
Analyze network traffic logs for any unusual or unexpected port forwarding activities. 
Review any relevant firewall or proxy logs for connections to external systems using the forwarded ports. 
Cross-reference the detected activity with any known administrative activities that involve remote port forwarding to a local port.","Administrative activity using a remote port forwarding to a local port","Description=""Command-line SSH, Telnet, and Rlogin client"" CommandLine=""* -R *"""
"Potential RDP Tunneling Via SSH Plink","Florian Roth (Nextron Systems)","Execution of plink to perform data exfiltration and tunneling","attack.command_and_control, attack.t1572","process_creation","windows","Not classified","Check for plink.exe executions with a command line containing the target IP address and port 3389 (RDP). 
Check for plink.exe executions with a command line containing the target IP address and either port 443 or 22 (common SSH ports). 
Review the process creation logs for any suspicious or unauthorized plink.exe executions. 
Cross-reference the plink.exe executions with other network or security logs to identify any anomalous behavior or connections. 
Investigate any plink.exe executions that do not align with expected administrative activity.","Administrative activity","(Image=""*\\plink.exe"" CommandLine=""*:127.0.0.1:3389*"") OR (Image=""*\\plink.exe"" CommandLine=""*:3389*"" CommandLine IN (""* -P 443*"", ""* -P 22*""))"
"AADInternals PowerShell Cmdlets Execution - ProccessCreation","Austin Songer (@austinsonger), Nasreddine Bencherchali (Nextron Systems)","Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365.","attack.execution, attack.reconnaissance, attack.discovery, attack.credential_access, attack.impact","process_creation","windows","Not classified","Not available","Not available","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR OriginalFileName IN (""PowerShell.Exe"", ""pwsh.dll"") CommandLine IN (""*Add-AADInt*"", ""*ConvertTo-AADInt*"", ""*Disable-AADInt*"", ""*Enable-AADInt*"", ""*Export-AADInt*"", ""*Get-AADInt*"", ""*Grant-AADInt*"", ""*Install-AADInt*"", ""*Invoke-AADInt*"", ""*Join-AADInt*"", ""*New-AADInt*"", ""*Open-AADInt*"", ""*Read-AADInt*"", ""*Register-AADInt*"", ""*Remove-AADInt*"", ""*Restore-AADInt*"", ""*Search-AADInt*"", ""*Send-AADInt*"", ""*Set-AADInt*"", ""*Start-AADInt*"", ""*Update-AADInt*"")"
"Potential AMSI Bypass Via .NET Reflection","Markus Neis, @Kostastsale","Detects Request to ""amsiInitFailed"" that can be used to disable AMSI Scanning","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check the process creation logs for the presence of the command line containing System.Management.Automation.AmsiUtils and amsiInitFailed. 
Look for instances where [Ref].Assembly.GetType, SetValue($null,$true), and NonPublic, Static are used in the command line of process creation logs.","Legitimate use of the System.Management.Automation.AmsiUtils class and amsiInitFailed parameter. 
Use of [Ref].Assembly.GetType, SetValue($null,$true), NonPublic, Static in a non-malicious context.","CommandLine IN (""*System.Management.Automation.AmsiUtils*"", ""*amsiInitFailed*"") OR (CommandLine=""*[Ref].Assembly.GetType*"" CommandLine=""*SetValue($null,$true)*"" CommandLine=""*NonPublic,Static*"")"
"Suspicious Encoded PowerShell Command Line","Florian Roth (Nextron Systems), Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, Anton Kutepov, oscd.community","Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check the process creation logs for PowerShell.exe or pwsh.exe with command line arguments containing base64 encoded commands. 
Review the command line arguments for suspicious strings such as JAB, SUVYI, SQBFAFgA, aQBlAHgA, aWV4I, IAA, IAB, UwB, cwB. 
Look for instances where PowerShell.exe or pwsh.exe is started with the -ENCOD argument or BA^J e- in the command line. 
Verify if the PowerShell process was started with the -ExecutionPolicy remotesigned argument, as this may indicate a legitimate use case.","Legitimate use of PowerShell with encoded commands for administrative purposes","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") (CommandLine=""* -e*"" CommandLine IN (""* JAB*"", ""* SUVYI*"", ""* SQBFAFgA*"", ""* aQBlAHgA*"", ""* aWV4I*"", ""* IAA*"", ""* IAB*"", ""* UwB*"", ""* cwB*"")) OR CommandLine IN (""*.exe -ENCOD *"", ""* BA^J e-*"") NOT CommandLine=""* -ExecutionPolicy remotesigned *"""
"PowerShell Base64 Encoded FromBase64String Cmdlet","Florian Roth (Nextron Systems)","Detects usage of a base64 encoded ""FromBase64String"" cmdlet in a process command line","attack.defense_evasion, attack.t1140, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review the process command line for the presence of the FromBase64String string 
Check if the base64 encoded strings in the command line are related to legitimate usage of the FromBase64String cmdlet 
Analyze the context of the process execution and look for any suspicious or malicious behavior 
Cross-reference the process execution with other security events and logs to identify any additional indicators of compromise 
Consult with the system owner or application developer to determine if the base64 encoded strings are part of expected behavior 
If necessary, analyze the decoded content of the base64 strings to understand their purpose and potential impact","Legitimate usage of the FromBase64String cmdlet in PowerShell scripts or commands 
Base64 encoded strings used for benign purposes, such as encoding/decoding data 
Base64 encoded strings used in legitimate software installations or updates","CommandLine=""*OjpGcm9tQmFzZTY0U3RyaW5n*"" OR CommandLine=""*o6RnJvbUJhc2U2NFN0cmluZ*"" OR CommandLine=""*6OkZyb21CYXNlNjRTdHJpbm*"" OR CommandLine IN (""*OgA6AEYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcA*"", ""*oAOgBGAHIAbwBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnA*"", ""*6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZw*"")"
"PowerShell Base64 Encoded IEX Cmdlet","Florian Roth (Nextron Systems)","Detects usage of a base64 encoded ""IEX"" cmdlet in a process command line","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review the process command line for the presence of base64 encoded strings 
Check if the base64 encoded strings are followed by the IEX cmdlet 
Analyze the context of the process execution to determine if it is suspicious or part of normal operations 
Cross-reference the process with other logs such as PowerShell logs, script execution logs, or command-line audit logs to gather more information 
Consult with system administrators or application owners to verify if the detected activity is expected or not","Legitimate usage of PowerShells IEX cmdlet in scripts or administrative tasks 
Base64 encoded commands used by legitimate software or system processes 
Base64 encoded commands used by security tools or monitoring agents","CommandLine=""*SUVYIChb*"" OR CommandLine=""*lFWCAoW*"" OR CommandLine=""*JRVggKF*"" OR CommandLine=""*aWV4IChb*"" OR CommandLine=""*lleCAoW*"" OR CommandLine=""*pZXggKF*"" OR CommandLine=""*aWV4IChOZX*"" OR CommandLine=""*lleCAoTmV3*"" OR CommandLine=""*pZXggKE5ld*"" OR CommandLine=""*SUVYIChOZX*"" OR CommandLine=""*lFWCAoTmV3*"" OR CommandLine=""*JRVggKE5ld*"" OR CommandLine=""*SUVYKF*"" OR CommandLine=""*lFWChb*"" OR CommandLine=""*JRVgoW*"" OR CommandLine=""*aWV4KF*"" OR CommandLine=""*lleChb*"" OR CommandLine=""*pZXgoW*"" OR CommandLine=""*aWV4KE5ld*"" OR CommandLine=""*lleChOZX*"" OR CommandLine=""*pZXgoTmV3*"" OR CommandLine=""*SUVYKE5ld*"" OR CommandLine=""*lFWChOZX*"" OR CommandLine=""*JRVgoTmV3*"" OR CommandLine=""*SUVYKCgn*"" OR CommandLine=""*lFWCgoJ*"" OR CommandLine=""*JRVgoKC*"" OR CommandLine=""*aWV4KCgn*"" OR CommandLine=""*lleCgoJ*"" OR CommandLine=""*pZXgoKC*"" OR CommandLine IN (""*SQBFAFgAIAAoAFsA*"", ""*kARQBYACAAKABbA*"", ""*JAEUAWAAgACgAWw*"", ""*aQBlAHgAIAAoAFsA*"", ""*kAZQB4ACAAKABbA*"", ""*pAGUAeAAgACgAWw*"", ""*aQBlAHgAIAAoAE4AZQB3A*"", ""*kAZQB4ACAAKABOAGUAdw*"", ""*pAGUAeAAgACgATgBlAHcA*"", ""*SQBFAFgAIAAoAE4AZQB3A*"", ""*kARQBYACAAKABOAGUAdw*"", ""*JAEUAWAAgACgATgBlAHcA*"")"
"PowerShell Base64 Encoded Invoke Keyword","pH-T (Nextron Systems), Harjot Singh, @cyb3rjy0t","Detects UTF-8 and UTF-16 Base64 encoded powershell 'Invoke-' calls","attack.execution, attack.t1059.001, attack.defense_evasion, attack.t1027","process_creation","windows","Not classified","Check the command line arguments of the process creation events for the presence of Base64 encoded PowerShell commands 
Look for suspicious Base64 encoded strings in the command line arguments 
Analyze the context of the process execution to determine if the Base64 encoded PowerShell commands are part of a malicious activity 
Cross-reference the detected Base64 encoded PowerShell commands with known legitimate use cases 
Consult with system administrators or security tool vendors to validate the use of Base64 encoding for legitimate purposes","Legitimate use of PowerShell Base64 encoding for script obfuscation 
Base64 encoded PowerShell commands used by system administrators for legitimate purposes 
Base64 encoded PowerShell commands used by security tools for legitimate purposes","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") CommandLine=""* -e*"" CommandLine IN (""*SQBuAHYAbwBrAGUALQ*"", ""*kAbgB2AG8AawBlAC0A*"", ""*JAG4AdgBvAGsAZQAtA*"", ""*SW52b2tlL*"", ""*ludm9rZS*"", ""*JbnZva2Ut*"")"
"PowerShell Base64 Encoded Reflective Assembly Load","Christian Burkard (Nextron Systems), pH-T (Nextron Systems)","Detects base64 encoded .NET reflective loading of Assembly","attack.execution, attack.t1059.001, attack.defense_evasion, attack.t1027, attack.t1620","process_creation","windows","Not classified","Examine the process creation logs in your SIEM for events matching this rule. 
Focus on events where the ""CommandLine"" contains base64-encoded PowerShell commands for loading assemblies. 
Investigate the ""CommandLine"" to identify the specific assembly loading techniques and potential malicious activity. 
Pay attention to the origin and purpose of the reflected assembly loads. 
Analyze the context of the execution, including the user account, parent processes, and any associated file operations. 
Check if the PowerShell commands were executed from a suspicious source or used for any defense evasion techniques. 
Take immediate action if you suspect malicious activity, and further investigate the impacted system.","This rule may generate false positives if legitimate processes execute base64-encoded PowerShell commands for reflective assembly loading. Review the context and sources of these events in your environment to reduce false positives.","CommandLine IN (""*WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA*"", ""*sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA*"", ""*bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA*"", ""*AFsAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiAC*"", ""*BbAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgAp*"", ""*AWwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAK*"", ""*WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6ACgAIgBMAG8AYQBkACIAKQ*"", ""*sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgAoACIATABvAGEAZAAiACkA*"", ""*bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoAKAAiAEwAbwBhAGQAIgApA*"", ""*WwByAGUAZgBsAGUAYwB0AGkAbwBuAC4AYQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA*"", ""*sAcgBlAGYAbABlAGMAdABpAG8AbgAuAGEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA*"", ""*bAHIAZQBmAGwAZQBjAHQAaQBvAG4ALgBhAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA*"")"
"Suspicious Encoded And Obfuscated Reflection Assembly Load Function Call","pH-T (Nextron Systems)","Detects suspicious base64 encoded and obfuscated ""LOAD"" keyword used in .NET ""reflection.assembly""","attack.execution, attack.defense_evasion, attack.t1059.001, attack.t1027","process_creation","windows","Not classified","Examine the process creation logs in your SIEM for events matching this rule. 
Pay close attention to events where the ""CommandLine"" contains obfuscated and encoded forms of the ""LOAD"" keyword used in .NET ""reflection.assembly."" 
Investigate the purpose and origin of these keyword uses. 
Analyze the context of the execution, including the user account, parent processes, and any associated file operations. 
Check if the obfuscated keyword usage is associated with any malicious activity or known attack patterns. 
Take immediate action if you suspect malicious activity, and further investigate the impacted system.","This rule may generate false positives if legitimate processes use similar obfuscation techniques with the ""LOAD"" keyword. Review the context and sources of these events in your environment to reduce false positives.","CommandLine IN (""*OgA6ACgAIgBMACIAKwAiAG8AYQBkACIAKQ*"", ""*oAOgAoACIATAAiACsAIgBvAGEAZAAiACkA*"", ""*6ADoAKAAiAEwAIgArACIAbwBhAGQAIgApA*"", ""*OgA6ACgAIgBMAG8AIgArACIAYQBkACIAKQ*"", ""*oAOgAoACIATABvACIAKwAiAGEAZAAiACkA*"", ""*6ADoAKAAiAEwAbwAiACsAIgBhAGQAIgApA*"", ""*OgA6ACgAIgBMAG8AYQAiACsAIgBkACIAKQ*"", ""*oAOgAoACIATABvAGEAIgArACIAZAAiACkA*"", ""*6ADoAKAAiAEwAbwBhACIAKwAiAGQAIgApA*"", ""*OgA6ACgAJwBMACcAKwAnAG8AYQBkACcAKQ*"", ""*oAOgAoACcATAAnACsAJwBvAGEAZAAnACkA*"", ""*6ADoAKAAnAEwAJwArACcAbwBhAGQAJwApA*"", ""*OgA6ACgAJwBMAG8AJwArACcAYQBkACcAKQ*"", ""*oAOgAoACcATABvACcAKwAnAGEAZAAnACkA*"", ""*6ADoAKAAnAEwAbwAnACsAJwBhAGQAJwApA*"", ""*OgA6ACgAJwBMAG8AYQAnACsAJwBkACcAKQ*"", ""*oAOgAoACcATABvAGEAJwArACcAZAAnACkA*"", ""*6ADoAKAAnAEwAbwBhACcAKwAnAGQAJwApA*"")"
"Potential PowerShell Obfuscation Via Reversed Commands","Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton","Detects the presence of reversed PowerShell commands in the CommandLine. This is often used as a method of obfuscation by attackers","attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review the CommandLine field in process creation logs for the presence of reversed PowerShell commands 
Check if the reversed commands are part of known legitimate PowerShell operations or scripts 
Analyze the context of the process execution to determine if it aligns with malicious activity 
Cross-reference with other security events or indicators of compromise to identify any related malicious behavior 
Consult with the system owner or application developer to understand the purpose of the observed PowerShell commands","Legitimate use of PowerShell commands that involve reversed strings 
PowerShell scripts or tools that intentionally obfuscate commands for legitimate purposes 
Reversed commands used in non-malicious scripts or configurations","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") CommandLine IN (""*hctac*"", ""*kaerb*"", ""*dnammoc*"", ""*ekovn*"", ""*eliFd*"", ""*rahc*"", ""*etirw*"", ""*golon*"", ""*tninon*"", ""*eddih*"", ""*tpircS*"", ""*ssecorp*"", ""*llehsrewop*"", ""*esnopser*"", ""*daolnwod*"", ""*tneilCbeW*"", ""*tneilc*"", ""*ptth*"", ""*elifotevas*"", ""*46esab*"", ""*htaPpmeTteG*"", ""*tcejbO*"", ""*maerts*"", ""*hcaerof*"", ""*retupmoc*"") NOT (CommandLine IN (""* -EncodedCommand *"", ""* -enc *""))"
"Potential PowerShell Command Line Obfuscation","Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton (fp)","Detects the PowerShell command lines with special characters","attack.execution, attack.defense_evasion, attack.t1027, attack.t1059.001","process_creation","windows","Not classified","Check the process creation logs for PowerShell executions with special characters in the command line. 
Review the command line arguments of the PowerShell processes to identify any obfuscation techniques. 
Look for patterns such as multiple concatenation operators (+), nested curly braces ({ }), caret (^) characters, or backticks (`) in the command line. 
Investigate any suspicious PowerShell command lines to determine if they are part of an attack or legitimate activity.","Amazon SSM Document Worker 
Windows Defender ATP"
"Powershell Defender Disable Scan Feature","Florian Roth (Nextron Systems)","Detects requests to disable Microsoft Defender features using PowerShell commands","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check the process creation logs for the presence of the following PowerShell commands 
Add-MpPreference 
Set-MpPreference 
Review the command line arguments for the following parameters 
DisableRealtimeMonitoring 
DisableIOAVProtection 
DisableBehaviorMonitoring 
DisableBlockAtFirstSeen 
Look for the presence of the following values in the command line 
$true 
1 
If any of the above indicators are found, investigate further to determine the intent and context of the PowerShell command execution. 
Consider checking the following log sources for additional information 
PowerShell logs 
Windows event logs (e.g., Security, System) 
Endpoint protection logs 
Network logs (e.g., firewall, proxy) 
Compare the observed activity with known legitimate administrative activity and other PowerShell commands that may use similar parameters. 
If the activity is determined to be suspicious or malicious, take appropriate response actions.","Legitimate administrative activity to disable Microsoft Defender features 
Other legitimate PowerShell commands that may contain similar parameters","(CommandLine IN (""*Add-MpPreference *"", ""*Set-MpPreference *"") CommandLine IN (""*DisableRealtimeMonitoring *"", ""*DisableIOAVProtection *"", ""*DisableBehaviorMonitoring *"", ""*DisableBlockAtFirstSeen *"") CommandLine IN (""*$true*"", ""* 1 *"")) OR (CommandLine=""*RGlzYWJsZVJlYWx0aW1lTW9uaXRvcmluZy*"" OR CommandLine=""*Rpc2FibGVSZWFsdGltZU1vbml0b3Jpbmcg*"" OR CommandLine=""*EaXNhYmxlUmVhbHRpbWVNb25pdG9yaW5nI*"" OR CommandLine=""*RGlzYWJsZUlPQVZQcm90ZWN0aW9uI*"" OR CommandLine=""*Rpc2FibGVJT0FWUHJvdGVjdGlvbi*"" OR CommandLine=""*EaXNhYmxlSU9BVlByb3RlY3Rpb24g*"" OR CommandLine=""*RGlzYWJsZUJlaGF2aW9yTW9uaXRvcmluZy*"" OR CommandLine=""*Rpc2FibGVCZWhhdmlvck1vbml0b3Jpbmcg*"" OR CommandLine=""*EaXNhYmxlQmVoYXZpb3JNb25pdG9yaW5nI*"" OR CommandLine=""*RGlzYWJsZUJsb2NrQXRGaXJzdFNlZW4g*"" OR CommandLine=""*Rpc2FibGVCbG9ja0F0Rmlyc3RTZWVuI*"" OR CommandLine=""*EaXNhYmxlQmxvY2tBdEZpcnN0U2Vlbi*"" OR CommandLine=""*ZGlzYWJsZXJlYWx0aW1lbW9uaXRvcmluZy*"" OR CommandLine=""*Rpc2FibGVyZWFsdGltZW1vbml0b3Jpbmcg*"" OR CommandLine=""*kaXNhYmxlcmVhbHRpbWVtb25pdG9yaW5nI*"" OR CommandLine=""*ZGlzYWJsZWlvYXZwcm90ZWN0aW9uI*"" OR CommandLine=""*Rpc2FibGVpb2F2cHJvdGVjdGlvbi*"" OR CommandLine=""*kaXNhYmxlaW9hdnByb3RlY3Rpb24g*"" OR CommandLine=""*ZGlzYWJsZWJlaGF2aW9ybW9uaXRvcmluZy*"" OR CommandLine=""*Rpc2FibGViZWhhdmlvcm1vbml0b3Jpbmcg*"" OR CommandLine=""*kaXNhYmxlYmVoYXZpb3Jtb25pdG9yaW5nI*"" OR CommandLine=""*ZGlzYWJsZWJsb2NrYXRmaXJzdHNlZW4g*"" OR CommandLine=""*Rpc2FibGVibG9ja2F0Zmlyc3RzZWVuI*"" OR CommandLine=""*kaXNhYmxlYmxvY2thdGZpcnN0c2Vlbi*"" CommandLine IN (""*RABpAHMAYQBiAGwAZQBSAGUAYQBsAHQAaQBtAGUATQBvAG4AaQB0AG8AcgBpAG4AZwAgA*"", ""*QAaQBzAGEAYgBsAGUAUgBlAGEAbAB0AGkAbQBlAE0AbwBuAGkAdABvAHIAaQBuAGcAIA*"", ""*EAGkAcwBhAGIAbABlAFIAZQBhAGwAdABpAG0AZQBNAG8AbgBpAHQAbwByAGkAbgBnACAA*"", ""*RABpAHMAYQBiAGwAZQBJAE8AQQBWAFAAcgBvAHQAZQBjAHQAaQBvAG4AIA*"", ""*QAaQBzAGEAYgBsAGUASQBPAEEAVgBQAHIAbwB0AGUAYwB0AGkAbwBuACAA*"", ""*EAGkAcwBhAGIAbABlAEkATwBBAFYAUAByAG8AdABlAGMAdABpAG8AbgAgA*"", ""*RABpAHMAYQBiAGwAZQBCAGUAaABhAHYAaQBvAHIATQBvAG4AaQB0AG8AcgBpAG4AZwAgA*"", ""*QAaQBzAGEAYgBsAGUAQgBlAGgAYQB2AGkAbwByAE0AbwBuAGkAdABvAHIAaQBuAGcAIA*"", ""*EAGkAcwBhAGIAbABlAEIAZQBoAGEAdgBpAG8AcgBNAG8AbgBpAHQAbwByAGkAbgBnACAA*"", ""*RABpAHMAYQBiAGwAZQBCAGwAbwBjAGsAQQB0AEYAaQByAHMAdABTAGUAZQBuACAA*"", ""*QAaQBzAGEAYgBsAGUAQgBsAG8AYwBrAEEAdABGAGkAcgBzAHQAUwBlAGUAbgAgA*"", ""*EAGkAcwBhAGIAbABlAEIAbABvAGMAawBBAHQARgBpAHIAcwB0AFMAZQBlAG4AIA*"", ""*ZABpAHMAYQBiAGwAZQByAGUAYQBsAHQAaQBtAGUAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA*"", ""*QAaQBzAGEAYgBsAGUAcgBlAGEAbAB0AGkAbQBlAG0AbwBuAGkAdABvAHIAaQBuAGcAIA*"", ""*kAGkAcwBhAGIAbABlAHIAZQBhAGwAdABpAG0AZQBtAG8AbgBpAHQAbwByAGkAbgBnACAA*"", ""*ZABpAHMAYQBiAGwAZQBpAG8AYQB2AHAAcgBvAHQAZQBjAHQAaQBvAG4AIA*"", ""*QAaQBzAGEAYgBsAGUAaQBvAGEAdgBwAHIAbwB0AGUAYwB0AGkAbwBuACAA*"", ""*kAGkAcwBhAGIAbABlAGkAbwBhAHYAcAByAG8AdABlAGMAdABpAG8AbgAgA*"", ""*ZABpAHMAYQBiAGwAZQBiAGUAaABhAHYAaQBvAHIAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA*"", ""*QAaQBzAGEAYgBsAGUAYgBlAGgAYQB2AGkAbwByAG0AbwBuAGkAdABvAHIAaQBuAGcAIA*"", ""*kAGkAcwBhAGIAbABlAGIAZQBoAGEAdgBpAG8AcgBtAG8AbgBpAHQAbwByAGkAbgBnACAA*"", ""*ZABpAHMAYQBiAGwAZQBiAGwAbwBjAGsAYQB0AGYAaQByAHMAdABzAGUAZQBuACAA*"", ""*QAaQBzAGEAYgBsAGUAYgBsAG8AYwBrAGEAdABmAGkAcgBzAHQAcwBlAGUAbgAgA*"", ""*kAGkAcwBhAGIAbABlAGIAbABvAGMAawBhAHQAZgBpAHIAcwB0AHMAZQBlAG4AIA*""))"
"Disable Windows Defender AV Security Monitoring","ok @securonix invrep-de, oscd.community, frack113","Detects attackers attempting to disable Windows Defender using Powershell","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check for the presence of PowerShell or pwsh.exe processes with the following command line parameters -DisableBehaviorMonitoring $true or -DisableRuntimeMonitoring $true. 
Look for the execution of sc.exe with the command line parameters stop WinDefend, delete WinDefend, or config WinDefend start=disabled. 
Review the process creation logs for any suspicious activity related to the disabling of Windows Defender.","Developers disabling Windows Defender to improve performance in older versions of dev tools, such as PyCharm.","(Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") CommandLine IN (""*-DisableBehaviorMonitoring $true*"", ""*-DisableRuntimeMonitoring $true*"")) OR (Image=""*\\sc.exe"" OR OriginalFileName=""sc.exe"" (CommandLine=""*stop*"" CommandLine=""*WinDefend*"") OR (CommandLine=""*delete*"" CommandLine=""*WinDefend*"") OR (CommandLine=""*config*"" CommandLine=""*WinDefend*"" CommandLine=""*start=disabled*""))"
"Disabled IE Security Features","Florian Roth (Nextron Systems)","Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check the process creation logs for command lines containing the following strings 
-name IEHarden -value 0 
-name DEPOff -value 1 
-name DisableFirstRunCustomize -value 2 
Review the associated process and its parent process to determine if the modification was performed by a legitimate system administrator or if it is suspicious in nature. 
Cross-reference the detection with other security events or indicators of compromise to determine if further investigation is warranted.","Legitimate system administration tasks may modify these registry keys.","(CommandLine=""* -name IEHarden *"" CommandLine=""* -value 0 *"") OR (CommandLine=""* -name DEPOff *"" CommandLine=""* -value 1 *"") OR (CommandLine=""* -name DisableFirstRunCustomize *"" CommandLine=""* -value 2 *"")"
"Potential PowerShell Execution Via DLL","Markus Neis, Nasreddine Bencherchali","Detects potential PowerShell execution from a DLL instead of the usual PowerShell process as seen used in PowerShdll","attack.defense_evasion, attack.t1218.011","process_creation","windows","Not classified","Check the parent process of the suspicious DLL execution to determine if it is a legitimate process or not 
Analyze the command line arguments of the process to identify any suspicious or malicious PowerShell commands 
Review the network traffic logs for any communication to known malicious domains or IP addresses 
Inspect the DLL file itself for any indicators of compromise, such as suspicious file properties or embedded payloads","Legitimate use of rundll32.exe, regsvcs.exe, InstallUtil.exe, or regasm.exe 
Legitimate use of PowerShell commands such as Default.GetString, FromBase64String, Invoke-Expression, Invoke-Command, or DownloadString","Image IN (""*\\rundll32.exe"", ""*\\regsvcs.exe"", ""*\\InstallUtil.exe"", ""*\\regasm.exe"") OR OriginalFileName IN (""RUNDLL32.EXE"", ""RegSvcs.exe"", ""InstallUtil.exe"", ""RegAsm.exe"") CommandLine IN (""*Default.GetString*"", ""*FromBase64String*"", ""*Invoke-Expression*"", ""*IEX *"", ""*Invoke-Command*"", ""*ICM *"", ""*DownloadString*"")"
"Email Exifiltration Via Powershell","Nasreddine Bencherchali (Nextron Systems),  Azure-Sentinel (idea)","Detects email exfiltration via powershell cmdlets","attack.exfiltration","process_creation","windows","Not classified","Review the command line arguments of the process creation events for powershell.exe or pwsh.exe. 
Look for the presence of the following cmdlets in the command line Add-PSSnapin, Get-Recipient, -ExpandProperty, EmailAddresses, SmtpAddress, -hidetableheaders. 
Check if the process is executed in a context that is expected to perform email exfiltration. 
Correlate with other events or logs related to email activity, such as SMTP logs or email gateway logs, to determine if any data exfiltration has occurred. 
If the process is executed by a legitimate user or system account for a valid purpose, consider adding an exclusion or whitelist rule to prevent false positives in the future.","Legitimate use of PowerShell for email-related tasks, such as sending automated emails or managing email configurations.","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine=""*Add-PSSnapin*"" CommandLine=""*Get-Recipient*"" CommandLine=""*-ExpandProperty*"" CommandLine=""*EmailAddresses*"" CommandLine=""*SmtpAddress*"" CommandLine=""*-hidetableheaders*"""
"Suspicious PowerShell Encoded Command Patterns","Florian Roth (Nextron Systems)","Detects PowerShell command line patterns in combincation with encoded commands that often appear in malware infection chains","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Not available","Not available","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR OriginalFileName IN (""PowerShell.Exe"", ""pwsh.dll"") CommandLine IN (""* -e *"", ""* -en *"", ""* -enc *"", ""* -enco*"") CommandLine IN (""* JAB*"", ""* SUVYI*"", ""* SQBFAFgA*"", ""* aWV4I*"", ""* IAB*"", ""* PAA*"", ""* aQBlAHgA*"") NOT (ParentImage IN (""*C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\*"", ""*\\gc_worker.exe*""))"
"Base64 Encoded PowerShell Command Detected","Florian Roth (Nextron Systems)","Detects usage of the ""FromBase64String"" function in the commandline which is used to decode a base64 encoded string","attack.t1027, attack.defense_evasion, attack.t1140, attack.t1059.001","process_creation","windows","Not classified","Check process creation logs for instances where the command line contains the FromBase64String( string. 
Review PowerShell logs for any suspicious base64 encoded strings being decoded using the FromBase64String function. 
Analyze any associated network traffic logs for communication with suspicious domains or IP addresses. 
Inspect any relevant file system logs for the creation or modification of suspicious files or directories.","Administrative script libraries","CommandLine=""*::FromBase64String(*"""
"PowerShell Get-Process LSASS","Florian Roth (Nextron Systems)","Detects a ""Get-Process"" cmdlet and it's aliases on lsass process, which is in almost all cases a sign of malicious activity","attack.credential_access, attack.t1552.004","process_creation","windows","Not classified","Check the parent process of the PowerShell command to determine if it is being executed from a suspicious or unauthorized source. 
Review the command line arguments and parameters passed to the PowerShell command to identify any suspicious or malicious activity. 
Analyze the network traffic generated by the system during the execution of the PowerShell command to identify any communication with known malicious IP addresses or domains. 
Check for any other suspicious activities or indicators of compromise on the system, such as unauthorized file modifications or unusual process behavior. 
Correlate the detection with other security events or alerts to identify any patterns or additional indicators of compromise.","Legitimate use of Get-Process cmdlet on lsass process during system administration or troubleshooting","CommandLine IN (""*Get-Process lsas*"", ""*ps lsas*"", ""*gps lsas*"")"
"Malicious Base64 Encoded PowerShell Keywords in Command Lines","John Lambert (rule)","Detects base64 encoded strings used in hidden malicious PowerShell command lines","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review the full command line of the process to determine if the base64 encoded string is part of a legitimate operation 
Check if the base64 encoded string is used in known benign scripts or applications 
Analyze the process behavior and network connections to identify any malicious activity associated with the base64 encoded string 
Cross-reference the base64 encoded string with threat intelligence sources to check if it is associated with known malicious activity 
Monitor for any other suspicious behavior or indicators of compromise","Legitimate use of base64 encoding in PowerShell scripts or command lines 
Base64 encoded strings used in non-malicious scenarios, such as data transfer or encoding sensitive information","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") CommandLine=""* hidden *"" CommandLine IN (""*AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA*"", ""*aXRzYWRtaW4gL3RyYW5zZmVy*"", ""*IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA*"", ""*JpdHNhZG1pbiAvdHJhbnNmZX*"", ""*YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg*"", ""*Yml0c2FkbWluIC90cmFuc2Zlc*"", ""*AGMAaAB1AG4AawBfAHMAaQB6AGUA*"", ""*JABjAGgAdQBuAGsAXwBzAGkAegBlA*"", ""*JGNodW5rX3Npem*"", ""*QAYwBoAHUAbgBrAF8AcwBpAHoAZQ*"", ""*RjaHVua19zaXpl*"", ""*Y2h1bmtfc2l6Z*"", ""*AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A*"", ""*kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg*"", ""*lPLkNvbXByZXNzaW9u*"", ""*SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA*"", ""*SU8uQ29tcHJlc3Npb2*"", ""*Ty5Db21wcmVzc2lvb*"", ""*AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ*"", ""*kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA*"", ""*lPLk1lbW9yeVN0cmVhb*"", ""*SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A*"", ""*SU8uTWVtb3J5U3RyZWFt*"", ""*Ty5NZW1vcnlTdHJlYW*"", ""*4ARwBlAHQAQwBoAHUAbgBrA*"", ""*5HZXRDaHVua*"", ""*AEcAZQB0AEMAaAB1AG4Aaw*"", ""*LgBHAGUAdABDAGgAdQBuAGsA*"", ""*LkdldENodW5r*"", ""*R2V0Q2h1bm*"", ""*AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A*"", ""*QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA*"", ""*RIUkVBRF9JTkZPNj*"", ""*SFJFQURfSU5GTzY0*"", ""*VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA*"", ""*VEhSRUFEX0lORk82N*"", ""*AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA*"", ""*cmVhdGVSZW1vdGVUaHJlYW*"", ""*MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA*"", ""*NyZWF0ZVJlbW90ZVRocmVhZ*"", ""*Q3JlYXRlUmVtb3RlVGhyZWFk*"", ""*QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA*"", ""*0AZQBtAG0AbwB2AGUA*"", ""*1lbW1vdm*"", ""*AGUAbQBtAG8AdgBlA*"", ""*bQBlAG0AbQBvAHYAZQ*"", ""*bWVtbW92Z*"", ""*ZW1tb3Zl*"")"
"Abuse of Service Permissions to Hide Services Via Set-Service","Nasreddine Bencherchali (Nextron Systems)","Detects usage of the ""Set-Service"" powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as ""sc.exe"", ""Get-Service""...etc. (Works only in powershell 7)","attack.persistence, attack.defense_evasion, attack.privilege_escalation, attack.t1574.011","process_creation","windows","Not classified","Review process creation logs for instances of the Set-Service PowerShell cmdlet being executed with the -SecurityDescriptorSddl or -sd parameters. 
Look for any suspicious or unusual service names or SecurityDescriptors being configured. 
Cross-reference the identified services with known legitimate services to identify any anomalies. 
Check for any other suspicious activity or indicators of compromise on the system, such as unusual network connections or file modifications.","Rare intended use of hidden services","Image=""*\\pwsh.exe"" OR OriginalFileName=""pwsh.dll"" CommandLine=""*Set-Service *"" CommandLine=""*DCLCWPDTSD*"" CommandLine IN (""*-SecurityDescriptorSddl *"", ""*-sd *"")"
"Suspicious PowerShell IEX Execution Patterns","Florian Roth (Nextron Systems)","Detects suspicious ways to run Invoke-Execution using IEX alias","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review the command line arguments of the process to identify the presence of suspicious IEX execution patterns 
Check if the process is executed from a legitimate location and by a trusted user 
Analyze the parent process and its behavior to determine if it is part of a known legitimate workflow 
Cross-reference the command line arguments with known good scripts or commands to identify false positives 
Monitor network traffic for any suspicious communication originating from the process 
Inspect the processs file system and registry activity for any indicators of compromise 
Consult with the system owner or application developer to validate the legitimacy of the executed PowerShell commands","Legitimate scripts that use IEX to execute PowerShell commands 
Scripts that use IEX for benign purposes, such as downloading files or executing legitimate PowerShell modules","(Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine IN (""* | iex;*"", ""* | iex *"", ""* | iex}*"", ""* | IEX ;*"", ""* | IEX -Error*"", ""* | IEX (new*"", ""*);IEX *"") CommandLine IN (""*::FromBase64String*"", ""*.GetString([System.Convert]::*"")) OR CommandLine IN (""*)|iex;$*"", ""*);iex($*"", ""*);iex $*"", ""* | IEX | *"")"
"Suspicious PowerShell Mailbox Export to Share","Florian Roth (Nextron Systems)","Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations","attack.exfiltration","process_creation","windows","Not classified","Review PowerShell logs for instances of New-MailboxExportRequest command with suspicious parameters, such as exporting to a remote or local share 
Check for any abnormal or unauthorized usage of the New-MailboxExportRequest command 
Cross-reference the command execution with user and account activity logs to identify any anomalies or suspicious behavior 
Investigate any associated parent processes or command line arguments for additional context","Legitimate usage of New-MailboxExportRequest for authorized mailbox exports","CommandLine=""*New-MailboxExportRequest*"" CommandLine=""* -Mailbox *"" CommandLine=""* -FilePath \\\\*"""
"Potential PowerShell Obfuscation Via WCHAR","Florian Roth (Nextron Systems)","Detects suspicious encoded character syntax often used for defense evasion","attack.execution, attack.t1059.001, attack.defense_evasion, attack.t1027","process_creation","windows","Not classified","Review process creation logs from Windows event logs (Event ID 4688) for instances where the CommandLine field contains the string (WCHAR)0x. 
Check if the process is a legitimate PowerShell script or if it is obfuscated using WCHAR encoding. 
Analyze the context and purpose of the script to determine if it is a false positive or a potential indicator of defense evasion.","Legitimate use of WCHAR encoding in PowerShell scripts","CommandLine=""*(WCHAR)0x*"""
"Execution of Powershell Script in Public Folder","Max Altgelt (Nextron Systems)","This rule detects execution of PowerShell scripts located in the ""C:\Users\Public"" folder","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check the command line arguments of the process creation events for the presence of the following patterns -f C\Users\Public, -f ""C\Users\Public, -f %Public%, -fi C\Users\Public, -fi ""C\Users\Public, -fi %Public%, -fil C\Users\Public, -fil ""C\Users\Public, -fil %Public%, -file C\Users\Public, -file ""C\Users\Public, -file %Public%. 
Review the process creation events for any suspicious PowerShell scripts executed from the ""C\Users\Public"" folder. 
Cross-reference the process creation events with other relevant logs, such as file access logs, to identify any malicious activities associated with the execution of PowerShell scripts in the ""C\Users\Public"" folder.","Legitimate use of PowerShell scripts in the ""C\Users\Public"" folder","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine IN (""*-f C:\\Users\\Public*"", ""*-f \""C:\\Users\\Public*"", ""*-f %Public%*"", ""*-fi C:\\Users\\Public*"", ""*-fi \""C:\\Users\\Public*"", ""*-fi %Public%*"", ""*-fil C:\\Users\\Public*"", ""*-fil \""C:\\Users\\Public*"", ""*-fil %Public%*"", ""*-file C:\\Users\\Public*"", ""*-file \""C:\\Users\\Public*"", ""*-file %Public%*"")"
"RemoteFXvGPUDisablement Abuse Via AtomicTestHarnesses","frack113","Detects calls to the AtomicTestHarnesses ""Invoke-ATHRemoteFXvGPUDisablementCommand"" which is designed to abuse the ""RemoteFXvGPUDisablement.exe"" binary to run custom PowerShell code via module load-order hijacking.","attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Check your SIEM for process creation events that match this rule. 
Examine the ""CommandLine"" field in the events to identify instances of the ""Invoke-ATHRemoteFXvGPUDisablementCommand"" or similar keywords. 
Investigate the associated process, its parent process, and the user account responsible for the execution. 
Review any file operations or binary loading that might be associated with this activity. 
Determine if this activity is legitimate or indicative of abuse. 
If you suspect abuse, take immediate action and conduct a more thorough investigation to identify the extent of the threat.","False positives are currently unknown for this rule, but its essential to analyze the context and source of events to minimize false positives.","CommandLine IN (""*Invoke-ATHRemoteFXvGPUDisablementCommand*"", ""*Invoke-ATHRemoteFXvGPUDisableme*"")"
"Potential Powershell ReverseShell Connection","FPT.EagleEye, wagga, Nasreddine Bencherchali (Nextron Systems)","Detects usage of the ""TcpClient"" class. Which can be abused to establish remote connections and reverse-shells. As seen used by the Nishang ""Invoke-PowerShellTcpOneLine"" reverse shell and other.","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review process creation logs for instances where the TcpClient class is used in combination with the .GetStream( and .Write( methods. 
Look for PowerShell processes with command line arguments containing Net.Sockets.TCPClient, .GetStream(, and .Write(. 
Check for any suspicious network connections originating from the system where the PowerShell process is running.","In rare administrative cases, this function might be used to check network connectivity","OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") OR Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine=""* Net.Sockets.TCPClient*"" CommandLine=""*.GetStream(*"" CommandLine=""*.Write(*"""
"Run PowerShell Script from ADS","Sergey Soldatov, Kaspersky Lab, oscd.community","Detects PowerShell script execution from Alternate Data Stream (ADS)","attack.defense_evasion, attack.t1564.004","process_creation","windows","Not classified","Review process creation logs from Windows Event Logs (Event ID 4688) to identify the execution of PowerShell with the specified command line arguments. 
Check for any legitimate use cases where PowerShell is accessing Alternate Data Streams, such as system administration or security tools. 
Correlate with other security events or indicators of compromise to determine if the PowerShell script execution from ADS is part of a larger attack.","Legitimate use of PowerShell to access Alternate Data Streams","ParentImage IN (""*\\powershell.exe"", ""*\\pwsh.exe"") Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine=""*Get-Content*"" CommandLine=""*-Stream*"""
"Run PowerShell Script from Redirected Input Stream","Moriarty Meng (idea), Anton Kutepov (rule), oscd.community","Detects PowerShell script execution via input stream redirect","attack.defense_evasion, attack.execution, attack.t1059","process_creation","windows","Not classified","1. Identify the process name and command line arguments of the executed PowerShell script. 
2. Review the parent process and its command line arguments to determine if it is a legitimate use case or suspicious activity. 
3. Check for any indicators of compromise (IOCs) associated with known malicious PowerShell scripts. 
4. Analyze other relevant logs such as network traffic, file system, and endpoint logs to gather additional context and evidence. 
5. Consult with the system owner or user to validate the purpose and intent of the PowerShell script execution.","Legitimate use of PowerShell script execution via input stream redirect in specific administrative or scripting scenarios.","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"")"
"PowerShell SAM Copy","Florian Roth (Nextron Systems)","Detects suspicious PowerShell scripts accessing SAM hives","attack.credential_access, attack.t1003.002","process_creation","windows","Not classified","Check the process creation logs for PowerShell commands that contain the following keywords 
\HarddiskVolumeShadowCopy 
System32\config\sam 
Copy-Item 
cp $_. 
cpi $_. 
copy $_. 
.File]Copy( 
Review the command line arguments and parameters used in the PowerShell scripts 
Analyze the context and purpose of the script execution 
Cross-reference with other security events and logs to identify any related suspicious activities or indicators of compromise 
Consider the presence of any known false positives mentioned in the known_false_positives list","Some rare backup scenarios 
PowerShell scripts fixing HiveNightmare / SeriousSAM ACLs","CommandLine=""*\\HarddiskVolumeShadowCopy*"" CommandLine=""*System32\\config\\sam*"" CommandLine IN (""*Copy-Item*"", ""*cp $_.*"", ""*cpi $_.*"", ""*copy $_.*"", ""*.File]::Copy(*"")"
"Suspicious Service DACL Modification Via Set-Service Cmdlet","Nasreddine Bencherchali (Nextron Systems)","Detects suspicious DACL modifications via the ""Set-Service"" cmdlet using the ""SecurityDescriptorSddl"" flag (Only available with PowerShell 7) that can be used to hide services or make them unstopable","attack.persistence, attack.t1543.003","process_creation","windows","Not classified","Review the command line arguments of the process creation events to identify the use of the ""Set-Service"" cmdlet with the ""SecurityDescriptorSddl"" flag. 
Check if the command line contains the specific strings ""-SecurityDescriptorSddl"" or ""-sd"". 
Inspect the command line for the presence of ""Set-Service"" followed by the string ""D;;"". 
Look for the presence of any of the following strings in the command line "";;;IU"", "";;;SU"", "";;;BA"", "";;;SY"", "";;;WD"".","Legitimate changes to service DACLs made by system administrators or authorized personnel.","Image=""*\\pwsh.exe"" OR OriginalFileName=""pwsh.dll"" CommandLine IN (""*-SecurityDescriptorSddl *"", ""*-sd *"") CommandLine=""*Set-Service *"" CommandLine=""*D;;*"" CommandLine IN (""*;;;IU*"", ""*;;;SU*"", ""*;;;BA*"", ""*;;;SY*"", ""*;;;WD*"")"
"PowerShell Script Change Permission Via Set-Acl","Nasreddine Bencherchali (Nextron Systems)","Detects PowerShell execution to set the ACL of a file or a folder","attack.defense_evasion","process_creation","windows","Not classified","Review the command line arguments of the PowerShell process to identify the specific file or folder being targeted for ACL modification. 
Check if the PowerShell process is executed by a privileged user or system account. 
Correlate the PowerShell execution with other related events, such as file or folder creation, modification, or access. 
Analyze the parent process and its context to determine if it is a suspicious or malicious activity. 
Cross-reference the PowerShell execution with known legitimate activities or authorized scripts in the environment.","Legitimate use of PowerShell to set ACL on files or folders by system administrators or authorized users. 
Use of PowerShell to set ACL during legitimate software installations or updates. 
Use of PowerShell to set ACL as part of a known security tool or script.","OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") OR Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine=""*Set-Acl *"" CommandLine=""*-AclObject *"" CommandLine=""*-Path *"""
"PowerShell Set-Acl On Windows Folder","Nasreddine Bencherchali (Nextron Systems)","Detects PowerShell scripts to set the ACL to a file in the Windows folder","attack.defense_evasion","process_creation","windows","Not classified","Review the command line arguments of the process to determine if it includes the Set-Acl cmdlet and references to files in the Windows folder 
Check if the process is executed by a privileged user or service account 
Verify if the process execution is part of a known administrative action or authorized script/tool 
Cross-reference with configuration management logs or change management records to identify if the ACL modification is expected","Legitimate administrative actions to modify ACLs on files in the Windows folder 
Authorized scripts or tools that use the Set-Acl cmdlet to modify ACLs on files in the Windows folder 
Configuration management tools that modify ACLs on files in the Windows folder","OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") OR Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine=""*Set-Acl *"" CommandLine=""*-AclObject *"" CommandLine IN (""*-Path \""C:\\Windows*"", ""*-Path 'C:\\Windows*"", ""*-Path %windir%*"", ""*-Path $env:windir*"") CommandLine IN (""*FullControl*"", ""*Allow*"")"
"Deletion of Volume Shadow Copies via WMI with PowerShell","Tim Rauch","Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil","attack.impact, attack.t1490","process_creation","windows","Not classified","Not available","Not available","CommandLine IN (""*Get-WmiObject*"", ""*gwmi*"", ""*Get-CimInstance*"", ""*gcim*"") CommandLine=""*Win32_Shadowcopy*"" CommandLine IN (""*.Delete()*"", ""*Remove-WmiObject*"", ""*rwmi*"", ""*Remove-CimInstance*"", ""*rcim*"")"
"Suspicious PowerShell Download and Execute Pattern","Florian Roth (Nextron Systems)","Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive)","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check the process creation logs for the presence of the suspicious PowerShell download patterns. 
Look for any associated network connections or communication with suspicious domains or IP addresses. 
Review the command-line arguments and parameters used in the PowerShell execution. 
Analyze the behavior of the process and its interactions with other system components. 
Cross-reference the detected pattern with known indicators of compromise (IOCs) or threat intelligence feeds. 
Consider the context of the system and user behavior to determine if the PowerShell execution is legitimate or malicious.","Software installers that pull packages from remote systems and execute them","CommandLine IN (""*IEX ((New-Object Net.WebClient).DownloadString*"", ""*IEX (New-Object Net.WebClient).DownloadString*"", ""*IEX((New-Object Net.WebClient).DownloadString*"", ""*IEX(New-Object Net.WebClient).DownloadString*"", ""* -command (New-Object System.Net.WebClient).DownloadFile(*"", ""* -c (New-Object System.Net.WebClient).DownloadFile(*"")"
"Suspicious PowerShell Parameter Substring","Florian Roth (Nextron Systems), Daniel Bohannon (idea), Roberto Rodriguez (Fix)","Detects suspicious PowerShell invocation with a parameter substring","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Review the process creation logs for instances of PowerShell.exe or Pwsh.exe being executed with suspicious command line parameters. 
Check for the presence of any of the following parameter substrings in the command line -windowstyle h, -windowstyl h, -windowsty h, -windowst h, -windows h, -windo h, -wind h, -win h, -wi h, -win h , -win hi , -win hid , -win hidd , -win hidde , -NoPr , -NoPro , -NoProf , -NoProfi , -NoProfil , -nonin , -nonint , -noninte , -noninter , -nonintera , -noninterac , -noninteract , -noninteracti , -noninteractiv , -ec , -encodedComman , -encodedComma , -encodedComm , -encodedCom , -encodedCo , -encodedC , -encoded , -encode , -encod , -enco , -en , -executionpolic , -executionpoli , -executionpol , -executionpo , -executionp , -execution bypass, -executio bypass, -executi bypass, -execut bypass, -execu bypass, -exec bypass, -exe bypass, -ex bypass, -ep bypass, /windowstyle h , /windowstyl h, /windowsty h, /windowst h, /windows h, /windo h, /wind h, /win h, /wi h, /win h , /win hi , /win hid , /win hidd , /win hidde , /NoPr , /NoPro , /NoProf , /NoProfi , /NoProfil , /nonin , /nonint , /noninte , /noninter , /nonintera , /noninterac , /noninteract , /noninteracti , /noninteractiv , /ec , /encodedComman , /encodedComma , /encodedComm , /encodedCom , /encodedCo , /encodedC , /encoded , /encode , /encod , /enco , /en , /executionpolic , /executionpoli , /executionpol , /executionpo , /executionp , /execution bypass, /executio bypass, /executi bypass, /execut bypass, /execu bypass, /exec bypass, /exe bypass, /ex bypass, /ep bypass]","There are no known false positives for this rule.","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine IN (""* -windowstyle h *"", ""* -windowstyl h*"", ""* -windowsty h*"", ""* -windowst h*"", ""* -windows h*"", ""* -windo h*"", ""* -wind h*"", ""* -win h*"", ""* -wi h*"", ""* -win h *"", ""* -win hi *"", ""* -win hid *"", ""* -win hidd *"", ""* -win hidde *"", ""* -NoPr *"", ""* -NoPro *"", ""* -NoProf *"", ""* -NoProfi *"", ""* -NoProfil *"", ""* -nonin *"", ""* -nonint *"", ""* -noninte *"", ""* -noninter *"", ""* -nonintera *"", ""* -noninterac *"", ""* -noninteract *"", ""* -noninteracti *"", ""* -noninteractiv *"", ""* -ec *"", ""* -encodedComman *"", ""* -encodedComma *"", ""* -encodedComm *"", ""* -encodedCom *"", ""* -encodedCo *"", ""* -encodedC *"", ""* -encoded *"", ""* -encode *"", ""* -encod *"", ""* -enco *"", ""* -en *"", ""* -executionpolic *"", ""* -executionpoli *"", ""* -executionpol *"", ""* -executionpo *"", ""* -executionp *"", ""* -execution bypass*"", ""* -executio bypass*"", ""* -executi bypass*"", ""* -execut bypass*"", ""* -execu bypass*"", ""* -exec bypass*"", ""* -exe bypass*"", ""* -ex bypass*"", ""* -ep bypass*"", ""* /windowstyle h *"", ""* /windowstyl h*"", ""* /windowsty h*"", ""* /windowst h*"", ""* /windows h*"", ""* /windo h*"", ""* /wind h*"", ""* /win h*"", ""* /wi h*"", ""* /win h *"", ""* /win hi *"", ""* /win hid *"", ""* /win hidd *"", ""* /win hidde *"", ""* /NoPr *"", ""* /NoPro *"", ""* /NoProf *"", ""* /NoProfi *"", ""* /NoProfil *"", ""* /nonin *"", ""* /nonint *"", ""* /noninte *"", ""* /noninter *"", ""* /nonintera *"", ""* /noninterac *"", ""* /noninteract *"", ""* /noninteracti *"", ""* /noninteractiv *"", ""* /ec *"", ""* /encodedComman *"", ""* /encodedComma *"", ""* /encodedComm *"", ""* /encodedCom *"", ""* /encodedCo *"", ""* /encodedC *"", ""* /encoded *"", ""* /encode *"", ""* /encod *"", ""* /enco *"", ""* /en *"", ""* /executionpolic *"", ""* /executionpoli *"", ""* /executionpol *"", ""* /executionpo *"", ""* /executionp *"", ""* /execution bypass*"", ""* /executio bypass*"", ""* /executi bypass*"", ""* /execut bypass*"", ""* /execu bypass*"", ""* /exec bypass*"", ""* /exe bypass*"", ""* /ex bypass*"", ""* /ep bypass*"")"
"Suspicious PowerShell Parent Process","Teymur Kheirkhabarov, Harish Segar","Detects a suspicious or uncommon parent processes of PowerShell","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Check the parent process of the PowerShell execution and verify if it matches any of the suspicious or uncommon processes listed in the selection_parent section of the rule. 
Review the command line arguments of the PowerShell execution and check if it contains any of the suspicious patterns listed in the selection_powershell section of the rule. 
Analyze the process tree to identify any abnormal or unexpected parent-child relationships. 
Cross-reference the detected PowerShell execution with other security events or logs to look for any additional indicators of compromise. 
If the PowerShell execution is triggered by a legitimate administrative script or trusted system administrator, verify the purpose and intent of the script. 
If the PowerShell execution is part of a legitimate software installation, confirm the source and integrity of the software. 
Investigate any other relevant logs or events that may provide additional context or evidence of malicious activity.","Legitimate administrative scripts that use PowerShell 
Scripts executed by trusted system administrators 
Scripts executed during legitimate software installations","ParentImage=""*tomcat*"" OR ParentImage IN (""*\\amigo.exe"", ""*\\browser.exe"", ""*\\chrome.exe"", ""*\\firefox.exe"", ""*\\httpd.exe"", ""*\\iexplore.exe"", ""*\\jbosssvc.exe"", ""*\\microsoftedge.exe"", ""*\\microsoftedgecp.exe"", ""*\\MicrosoftEdgeSH.exe"", ""*\\mshta.exe"", ""*\\nginx.exe"", ""*\\outlook.exe"", ""*\\php-cgi.exe"", ""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\safari.exe"", ""*\\services.exe"", ""*\\sqlagent.exe"", ""*\\sqlserver.exe"", ""*\\sqlservr.exe"", ""*\\vivaldi.exe"", ""*\\w3wp.exe"") Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR CommandLine IN (""*/c powershell*"", ""*/c pwsh*"") OR Description=""Windows PowerShell"" OR Product=""PowerShell Core 6"" OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"")"
"PowerShell DownloadFile","Florian Roth (Nextron Systems)","Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line","attack.execution, attack.t1059.001, attack.command_and_control, attack.t1104, attack.t1105","process_creation","windows","Not classified","Check the process command line for the presence of powershell, .DownloadFile, and System.Net.WebClient 
Review the parent process and its command line to understand the context of the PowerShell execution 
Analyze the network traffic to determine if any suspicious or malicious files were downloaded 
Check for any other suspicious activities or indicators of compromise on the affected system 
Consult with the system owner or user to determine if the PowerShell execution was expected or authorized","Legitimate use of PowerShell and WebClient to download files from the internet 
Scripts or tools that use WebClient and DownloadFile for legitimate purposes 
Development or testing activities that involve the use of WebClient and DownloadFile","CommandLine=""*powershell*"" CommandLine=""*.DownloadFile*"" CommandLine=""*System.Net.WebClient*"""
"Tamper Windows Defender Remove-MpPreference","Nasreddine Bencherchali (Nextron Systems)","Detects attempts to remove Windows Defender configurations using the 'MpPreference' cmdlet","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check for any legitimate PowerShell scripts that may be triggering the rule. Review the command line arguments of the process creation events to identify any suspicious use of the Remove-MpPreference cmdlet. 
Look for any patterns or anomalies in the usage of the Remove-MpPreference cmdlet, such as unusual file paths or unexpected combinations of command line arguments. 
Cross-reference the process creation events with other security events, such as file modifications or network connections, to determine if the use of Remove-MpPreference is part of a larger attack chain.","Legitimate PowerShell scripts","CommandLine=""*Remove-MpPreference*"" CommandLine IN (""*-ControlledFolderAccessProtectedFolders *"", ""*-AttackSurfaceReductionRules_Ids *"", ""*-AttackSurfaceReductionRules_Actions *"", ""*-CheckForSignaturesBeforeRunningScan *"")"
"Powershell Token Obfuscation - Process Creation","frack113","Detects TOKEN OBFUSCATION technique from Invoke-Obfuscation","attack.defense_evasion, attack.t1027.009","process_creation","windows","Not classified","Not available","Not available"
"Net WebClient Casing Anomalies","Florian Roth (Nextron Systems)","Detects PowerShell command line contents that include a suspicious abnormal casing in the Net.Webclient (e.g. nEt.WEbCliEnT) string as used in obfuscation techniques","attack.execution, attack.t1059.001","process_creation","windows","Not classified","Not available","Not available","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") CommandLine IN (""*TgBlAFQALgB3AEUAQg*"", ""*4AZQBUAC4AdwBFAEIA*"", ""*OAGUAVAAuAHcARQBCA*"", ""*bgBFAHQALgB3AGUAYg*"", ""*4ARQB0AC4AdwBlAGIA*"", ""*uAEUAdAAuAHcAZQBiA*"", ""*TgBFAHQALgB3AGUAYg*"", ""*OAEUAdAAuAHcAZQBiA*"", ""*bgBlAFQALgB3AGUAYg*"", ""*4AZQBUAC4AdwBlAGIA*"", ""*uAGUAVAAuAHcAZQBiA*"", ""*TgBlAFQALgB3AGUAYg*"", ""*OAGUAVAAuAHcAZQBiA*"", ""*bgBFAFQALgB3AGUAYg*"", ""*4ARQBUAC4AdwBlAGIA*"", ""*uAEUAVAAuAHcAZQBiA*"", ""*bgBlAHQALgBXAGUAYg*"", ""*4AZQB0AC4AVwBlAGIA*"", ""*uAGUAdAAuAFcAZQBiA*"", ""*bgBFAHQALgBXAGUAYg*"", ""*4ARQB0AC4AVwBlAGIA*"", ""*uAEUAdAAuAFcAZQBiA*"", ""*TgBFAHQALgBXAGUAYg*"", ""*OAEUAdAAuAFcAZQBiA*"", ""*bgBlAFQALgBXAGUAYg*"", ""*4AZQBUAC4AVwBlAGIA*"", ""*uAGUAVAAuAFcAZQBiA*"", ""*TgBlAFQALgBXAGUAYg*"", ""*OAGUAVAAuAFcAZQBiA*"", ""*bgBFAFQALgBXAGUAYg*"", ""*4ARQBUAC4AVwBlAGIA*"", ""*uAEUAVAAuAFcAZQBiA*"", ""*bgBlAHQALgB3AEUAYg*"", ""*4AZQB0AC4AdwBFAGIA*"", ""*uAGUAdAAuAHcARQBiA*"", ""*TgBlAHQALgB3AEUAYg*"", ""*OAGUAdAAuAHcARQBiA*"", ""*bgBFAHQALgB3AEUAYg*"", ""*4ARQB0AC4AdwBFAGIA*"", ""*uAEUAdAAuAHcARQBiA*"", ""*TgBFAHQALgB3AEUAYg*"", ""*OAEUAdAAuAHcARQBiA*"", ""*bgBlAFQALgB3AEUAYg*"", ""*4AZQBUAC4AdwBFAGIA*"", ""*uAGUAVAAuAHcARQBiA*"", ""*TgBlAFQALgB3AEUAYg*"", ""*OAGUAVAAuAHcARQBiA*"", ""*bgBFAFQALgB3AEUAYg*"", ""*4ARQBUAC4AdwBFAGIA*"", ""*uAEUAVAAuAHcARQBiA*"", ""*TgBFAFQALgB3AEUAYg*"", ""*OAEUAVAAuAHcARQBiA*"", ""*bgBlAHQALgBXAEUAYg*"", ""*4AZQB0AC4AVwBFAGIA*"", ""*uAGUAdAAuAFcARQBiA*"", ""*TgBlAHQALgBXAEUAYg*"", ""*OAGUAdAAuAFcARQBiA*"", ""*bgBFAHQALgBXAEUAYg*"", ""*4ARQB0AC4AVwBFAGIA*"", ""*uAEUAdAAuAFcARQBiA*"", ""*TgBFAHQALgBXAEUAYg*"", ""*OAEUAdAAuAFcARQBiA*"", ""*bgBlAFQALgBXAEUAYg*"", ""*4AZQBUAC4AVwBFAGIA*"", ""*uAGUAVAAuAFcARQBiA*"", ""*TgBlAFQALgBXAEUAYg*"", ""*OAGUAVAAuAFcARQBiA*"", ""*bgBFAFQALgBXAEUAYg*"", ""*4ARQBUAC4AVwBFAGIA*"", ""*uAEUAVAAuAFcARQBiA*"", ""*TgBFAFQALgBXAEUAYg*"", ""*OAEUAVAAuAFcARQBiA*"", ""*bgBlAHQALgB3AGUAQg*"", ""*4AZQB0AC4AdwBlAEIA*"", ""*uAGUAdAAuAHcAZQBCA*"", ""*TgBlAHQALgB3AGUAQg*"", ""*OAGUAdAAuAHcAZQBCA*"", ""*bgBFAHQALgB3AGUAQg*"", ""*4ARQB0AC4AdwBlAEIA*"", ""*uAEUAdAAuAHcAZQBCA*"", ""*TgBFAHQALgB3AGUAQg*"", ""*OAEUAdAAuAHcAZQBCA*"", ""*bgBlAFQALgB3AGUAQg*"", ""*4AZQBUAC4AdwBlAEIA*"", ""*uAGUAVAAuAHcAZQBCA*"", ""*TgBlAFQALgB3AGUAQg*"", ""*OAGUAVAAuAHcAZQBCA*"", ""*bgBFAFQALgB3AGUAQg*"", ""*4ARQBUAC4AdwBlAEIA*"", ""*uAEUAVAAuAHcAZQBCA*"", ""*TgBFAFQALgB3AGUAQg*"", ""*OAEUAVAAuAHcAZQBCA*"", ""*bgBlAHQALgBXAGUAQg*"", ""*4AZQB0AC4AVwBlAEIA*"", ""*uAGUAdAAuAFcAZQBCA*"", ""*TgBlAHQALgBXAGUAQg*"", ""*OAGUAdAAuAFcAZQBCA*"", ""*bgBFAHQALgBXAGUAQg*"", ""*4ARQB0AC4AVwBlAEIA*"", ""*uAEUAdAAuAFcAZQBCA*"", ""*TgBFAHQALgBXAGUAQg*"", ""*OAEUAdAAuAFcAZQBCA*"", ""*bgBlAFQALgBXAGUAQg*"", ""*4AZQBUAC4AVwBlAEIA*"", ""*uAGUAVAAuAFcAZQBCA*"", ""*TgBlAFQALgBXAGUAQg*"", ""*OAGUAVAAuAFcAZQBCA*"", ""*bgBFAFQALgBXAGUAQg*"", ""*4ARQBUAC4AVwBlAEIA*"", ""*uAEUAVAAuAFcAZQBCA*"", ""*TgBFAFQALgBXAGUAQg*"", ""*OAEUAVAAuAFcAZQBCA*"", ""*bgBlAHQALgB3AEUAQg*"", ""*4AZQB0AC4AdwBFAEIA*"", ""*uAGUAdAAuAHcARQBCA*"", ""*TgBlAHQALgB3AEUAQg*"", ""*OAGUAdAAuAHcARQBCA*"", ""*bgBFAHQALgB3AEUAQg*"", ""*4ARQB0AC4AdwBFAEIA*"", ""*uAEUAdAAuAHcARQBCA*"", ""*TgBFAHQALgB3AEUAQg*"", ""*OAEUAdAAuAHcARQBCA*"", ""*bgBlAFQALgB3AEUAQg*"", ""*uAGUAVAAuAHcARQBCA*"", ""*bgBFAFQALgB3AEUAQg*"", ""*4ARQBUAC4AdwBFAEIA*"", ""*uAEUAVAAuAHcARQBCA*"", ""*TgBFAFQALgB3AEUAQg*"", ""*OAEUAVAAuAHcARQBCA*"", ""*TgBlAHQALgBXAEUAQg*"", ""*4AZQB0AC4AVwBFAEIA*"", ""*OAGUAdAAuAFcARQBCA*"", ""*bgBFAHQALgBXAEUAQg*"", ""*4ARQB0AC4AVwBFAEIA*"", ""*uAEUAdAAuAFcARQBCA*"", ""*TgBFAHQALgBXAEUAQg*"", ""*OAEUAdAAuAFcARQBCA*"", ""*bgBlAFQALgBXAEUAQg*"", ""*4AZQBUAC4AVwBFAEIA*"", ""*uAGUAVAAuAFcARQBCA*"", ""*TgBlAFQALgBXAEUAQg*"", ""*OAGUAVAAuAFcARQBCA*"", ""*bgBFAFQALgBXAEUAQg*"", ""*4ARQBUAC4AVwBFAEIA*"", ""*uAEUAVAAuAFcARQBCA*"")"
"PUA - AdFind Suspicious Execution","Janantha Marasinghe (https://github.com/blueteam0ps), FPT.EagleEye Team, omkar72, oscd.community","Detects AdFind execution with common flags seen used during attacks","attack.discovery, attack.t1018, attack.t1087.002, attack.t1482, attack.t1069.002","process_creation","windows","Not classified","Check if the AdFind execution was performed by a legitimate system administrator or user. Review the user account associated with the process and verify if it aligns with expected activity. 
Analyze the command-line arguments used in the AdFind execution. Look for any suspicious or unauthorized flags that may indicate malicious intent. 
Correlate the AdFind execution with other security events or indicators of compromise (IOCs) to determine if it is part of a larger attack campaign. 
Review relevant logs such as Windows process creation logs (e.g., Sysmon, Windows Event Log) to gather additional context and identify any associated suspicious activities or behaviors. 
Consult threat intelligence sources and security advisories to identify any known malicious techniques or campaigns involving AdFind. 
If necessary, perform memory or disk forensics to gather more detailed information about the AdFind execution and its impact on the system. 
Consider conducting a risk assessment to evaluate the potential impact of the AdFind execution and determine appropriate mitigation measures.","Legitimate admin activity","CommandLine IN (""*domainlist*"", ""*trustdmp*"", ""*dcmodes*"", ""*adinfo*"", ""* dclist *"", ""*computer_pwdnotreqd*"", ""*objectcategory=*"", ""*-subnets -f*"", ""*name=\""Domain Admins\""*"", ""*-sc u:*"", ""*domainncs*"", ""*dompol*"", ""* oudmp *"", ""*subnetdmp*"", ""*gpodmp*"", ""*fspdmp*"", ""*users_noexpire*"", ""*computers_active*"", ""*computers_pwdnotreqd*"")"
"PUA - DIT Snapshot Viewer","Furkan Caliskan (@caliskanfurkan_)","Detects the use of Ditsnap tool, an inspection tool for Active Directory database, ntds.dit.","attack.credential_access, attack.t1003.003","process_creation","windows","Not classified","Check process creation logs for instances of ditsnap.exe being executed. 
Review command-line arguments of the process creation logs to identify any suspicious usage of ditsnap.exe. 
Cross-reference the process creation logs with user activity logs to identify any abnormal behavior or unauthorized usage of ditsnap.exe. 
Investigate any instances of ditsnap.exe being executed by non-administrative users or from unusual locations. 
Monitor for any repeated or frequent usage of ditsnap.exe that deviates from normal patterns of usage.","Legitimate admin usage","Image=""*\\ditsnap.exe"" OR CommandLine=""*ditsnap.exe*"""
"PUA - Ngrok Execution","Florian Roth (Nextron Systems)","Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available.
Involved domains are bin.equinox.io for download and *.ngrok.io for connections.
","attack.command_and_control, attack.t1572","process_creation","windows","Not classified","Check your SIEM for process creation events that match this rule. 
Examine the ""CommandLine"" field in the events to identify instances of Ngrok execution. 
Investigate the associated process, its parent process, and the user account responsible for the execution. 
Review any network connections to domains such as bin.equinox.io and *.ngrok.io. 
Determine if this activity is legitimate or indicative of potential malicious use of Ngrok. 
If you suspect abuse, take immediate action and conduct a more thorough investigation to identify the extent of the threat.","False positives may occur if another tool or legitimate use of Ngrok with similar command line switches is detected. Verify the context and source of the events to minimize false positives.","CommandLine IN (""* tcp 139*"", ""* tcp 445*"", ""* tcp 3389*"", ""* tcp 5985*"", ""* tcp 5986*"") OR (CommandLine=""* start *"" CommandLine=""*--all*"" CommandLine=""*--config*"" CommandLine=""*.yml*"") OR (Image=""*ngrok.exe"" CommandLine IN (""* tcp *"", ""* http *"", ""* authtoken *"")) OR CommandLine IN (""*.exe authtoken *"", ""*.exe start --all*"")"
"PUA - NirCmd Execution As LOCAL SYSTEM","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects the use of NirCmd tool for command execution as SYSTEM user","attack.execution, attack.t1569.002, attack.s0029","process_creation","windows","Not classified","Check the CommandLine field in process_creation logs for the presence of runassystem. 
Review the ParentCommandLine field to identify the parent process that executed the NirCmd tool. 
Cross-reference with other logs such as authentication logs or network logs to identify any suspicious activity associated with the NirCmd execution.","Legitimate use by administrators","CommandLine=""* runassystem *"""
"PUA - Nmap/Zenmap Execution","frack113","Detects usage of namp/zenmap. Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation","attack.discovery, attack.t1046","process_creation","windows","Not classified","Review process creation logs from Windows systems for instances of nmap.exe or zennmap.exe being executed. 
Check for any legitimate use cases where nmap or zenmap may be authorized and expected, such as by a network administrator performing network scans or vulnerability assessments. 
Cross-reference with network traffic logs to identify any suspicious or unauthorized scanning activities. 
Review any associated command-line arguments or parameters used with the nmap or zenmap execution to determine the intent and potential risk. 
Investigate any related network connections or communication to identify potential targets or compromised systems.","Network administrator computer","Image IN (""*\\nmap.exe"", ""*\\zennmap.exe"") OR OriginalFileName IN (""nmap.exe"", ""zennmap.exe"")"
"PUA - Radmin Viewer Utility Execution","frack113","Detects the execution of Radmin which can be abused by an adversary to remotely control Windows machines","attack.execution, attack.lateral_movement, attack.t1072","process_creation","windows","Not classified","Review process creation logs from Windows event logs (Event ID 4688) for instances of Radmin Viewer (Radmin.exe) being executed. 
Look for any unusual or unauthorized usage of Radmin Viewer, such as connections to unfamiliar IP addresses or unusual patterns of activity. 
Cross-reference with network logs (e.g., firewall logs, proxy logs) to identify any suspicious network connections associated with Radmin Viewer usage. 
Check for any other indicators of compromise (IOCs) associated with Radmin Viewer, such as suspicious file modifications or registry changes. 
If possible, gather additional context from the affected system, such as memory dumps or process memory analysis, to identify any malicious behavior or artifacts.","Legitimate use of Radmin Viewer for authorized remote administration","Description=""Radmin Viewer"" OR Product=""Radmin Viewer"" OR OriginalFileName=""Radmin.exe"""
"PUA - RunXCmd Execution","Florian Roth (Nextron Systems)","Detects the use of the RunXCmd tool to execute commands with System or TrustedInstaller accounts","attack.execution, attack.t1569.002, attack.s0029","process_creation","windows","Not classified","Review process creation logs from Windows Event Logs (Event ID 4688) for instances where the RunXCmd tool is used with the /account=system or /account=ti parameters. 
Check for any scheduled tasks that run with System or TrustedInstaller accounts and correlate with the detection rule.","Scheduled tasks that run with System or TrustedInstaller accounts","CommandLine IN (""* /account=system *"", ""* /account=ti *"") CommandLine=""*/exec=*"""
"Python Spawning Pretty TTY on Windows","Nextron Systems","Detects python spawning a pretty tty","attack.execution, attack.t1059","process_creation","windows","Not classified","Review process creation logs for instances of Python executables (python.exe, python3.exe, python2.exe) being launched with command line arguments that contain import pty and .spawn( or from pty import spawn. 
Check if the process execution is associated with a legitimate use case, such as a system administrator performing authorized actions. 
Analyze the parent-child relationship of the process to identify any suspicious or unexpected behavior. 
Correlate the detection with other security events or indicators of compromise to determine if it is part of a larger attack campaign.","Legitimate usage of Python for spawning a pretty tty","Image IN (""*python.exe"", ""*python3.exe"", ""*python2.exe"") (CommandLine=""*import pty*"" CommandLine=""*.spawn(*"") OR CommandLine=""*from pty import spawn*"""
"Rar Usage with Password and Compression Level","@ROxPinTeddy","Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.","attack.collection, attack.t1560.001","process_creation","windows","Not classified","Search your SIEM for process creation events that match this rule. 
Examine the ""CommandLine"" field in the events to identify instances of rar.exe with the -hp (password) and -m (compression level) flags. 
Investigate the associated process, parent process, and the user account responsible for the execution. 
Review the details of the archive created, including its contents and any password used. 
Determine if this activity is legitimate or indicative of potential malicious use of rar.exe. 
If you suspect malicious intent, take immediate action and conduct a more comprehensive investigation to understand the extent of the threat.","False positives may occur if rar.exe is legitimately used with the specified flags. Verify the context and source of the events to minimize false positives. Legitimate use cases may include compression and password protection of sensitive files or archives.","CommandLine=""* -hp*"" CommandLine IN (""* -m*"", ""* a *"")"
"Process Memory Dump via RdrLeakDiag.EXE","Cedric MAURUGEON, Florian Roth (Nextron Systems), Swachchhanda Shrawan Poudel, Nasreddine Bencherchali (Nextron Systems)","Detects the use of the Microsoft Windows Resource Leak Diagnostic tool ""rdrleakdiag.exe"" to dump process memory","attack.credential_access, attack.t1003.001","process_creation","windows","Not classified","Check for the presence of rdrleakdiag.exe in the system. This can be done by searching for the file path or by checking the process creation logs for the execution of rdrleakdiag.exe. 
Review the command-line arguments used with rdrleakdiag.exe. Look for the presence of the following arguments fullmemdmp, /memdmp, -memdmp, -o, /o, -p, /p. These arguments indicate the dumping of process memory and specifying output files or process IDs. 
Analyze the context in which rdrleakdiag.exe is executed. Look for any suspicious or unauthorized activity associated with the process, such as unusual network connections or access to sensitive files or credentials. 
Correlate the detection with other security events or indicators of compromise (IOCs) to determine if there is any malicious activity associated with the use of rdrleakdiag.exe. 
If the use of rdrleakdiag.exe is determined to be legitimate, ensure that it is properly authorized and documented for memory analysis or troubleshooting purposes.","Legitimate use of rdrleakdiag.exe for authorized memory analysis or troubleshooting purposes.","(CommandLine IN (""*fullmemdmp*"", ""*/memdmp*"", ""*-memdmp*"") CommandLine IN (""* -o *"", ""* /o *"") CommandLine IN (""* -p *"", ""* /p *"")) OR (Image=""*\\rdrleakdiag.exe"" OR OriginalFileName=""RdrLeakDiag.exe"" CommandLine IN (""*fullmemdmp*"", ""*/memdmp*"", ""*-memdmp*""))"
"Exports Critical Registry Keys To a File","Oddvar Moe, Sander Wiebing, oscd.community","Detects the export of a crital Registry key to a file.","attack.exfiltration, attack.t1012","process_creation","windows","Not classified","Check the ParentImage field in the process_creation logs to identify the process that executed regedit.exe. 
Inspect the CommandLine field in the process_creation logs to identify the specific command used with regedit.exe. 
Review the context of the event to determine if the export of critical Registry keys was performed for legitimate purposes, such as backup or forensic investigation.","Dumping hives for legitimate purpose i.e. backup or forensic investigation","Image=""*\\regedit.exe"" OR OriginalFileName=""REGEDIT.EXE"" CommandLine IN (""* /E *"", ""* -E *"") CommandLine IN (""*hklm*"", ""*hkey_local_machine*"") CommandLine IN (""*\\system"", ""*\\sam"", ""*\\security"")"
"Imports Registry Key From an ADS","Oddvar Moe, Sander Wiebing, oscd.community","Detects the import of a alternate datastream to the registry with regedit.exe.","attack.t1112, attack.defense_evasion","process_creation","windows","Not classified","Search your SIEM for process creation events that match this rule. 
Examine the ""Image"" and ""CommandLine"" fields in the events to identify instances of regedit.exe being used to import an alternate data stream to the registry. 
Investigate the associated process, parent process, and the user account responsible for the execution. 
Review the content of the imported registry key to understand its purpose and contents. 
Determine if this activity is legitimate or indicative of potential malicious actions. 
If you suspect malicious intent, take immediate action and conduct a more comprehensive investigation to understand the extent of the threat.","False positives may occur if regedit.exe is legitimately used to import legitimate registry data from alternate data streams. Verify the context and source of the events to minimize false positives. Legitimate use cases may include system or application updates.","Image=""*\\regedit.exe"" OR OriginalFileName=""REGEDIT.EXE"" CommandLine IN (""* /i *"", ""*.reg*"") NOT (CommandLine IN (""* /e *"", ""* /a *"", ""* /c *"", ""* -e *"", ""* -a *"", ""* -c *""))"
"Regedit as Trusted Installer","Florian Roth (Nextron Systems)","Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe","attack.privilege_escalation, attack.t1548","process_creation","windows","Not classified","Review process creation logs from Windows event logs or SIEM for instances of regedit.exe being started with TrustedInstaller privileges or by ProcessHacker.exe. 
Look for any other suspicious activity or indicators of compromise on the system, such as unusual network connections or file modifications. 
Correlate the detection with other security events or alerts to identify any potential attack patterns or techniques being used.","Unlikely","Image=""*\\regedit.exe"" ParentImage IN (""*\\TrustedInstaller.exe"", ""*\\ProcessHacker.exe"")"
"Suspicious Debugger Registration Cmdline","Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro","Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor).","attack.persistence, attack.privilege_escalation, attack.t1546.008","process_creation","windows","Not classified","Check the process creation logs for instances where the command line contains \CurrentVersion\Image File Execution Options\ and one of the following executables sethc.exe, utilman.exe, osk.exe, magnify.exe, narrator.exe, displayswitch.exe, atbroker.exe, HelpPane.exe. 
Review the associated process details, including the parent process, user account, and any additional command line arguments. 
Cross-reference the detected process with other security events or indicators of compromise to determine if it is part of a larger attack pattern or campaign. 
If possible, collect memory or disk forensics for further analysis and artifact extraction.","Unknown","CommandLine=""*\\CurrentVersion\\Image File Execution Options\\*"" CommandLine IN (""*sethc.exe*"", ""*utilman.exe*"", ""*osk.exe*"", ""*magnify.exe*"", ""*narrator.exe*"", ""*displayswitch.exe*"", ""*atbroker.exe*"", ""*HelpPane.exe*"")"
"Potential Privilege Escalation via Service Permissions Weakness","Teymur Kheirkhabarov","Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level","attack.privilege_escalation, attack.t1574.011","process_creation","windows","Not classified","Check the process creation logs from the Windows event logs (Event ID 4688) to identify the process that triggered the detection 
Review the command line arguments of the process to determine if it contains the keywords ControlSet and services 
Examine the registry modifications made by the process to the keys related to services configuration, such as ImagePath, FailureCommand, and ServiceDll 
Cross-reference the process information with the integrity level to ensure it matches the Medium level 
Validate the legitimacy of the changes by verifying if they were performed by system administrators or authorized personnel 
If the changes were made during software installations or updates, confirm if they were expected and authorized 
Determine if any security tools or monitoring agents are responsible for the modifications","Legitimate changes to services configuration by system administrators or authorized personnel 
Changes made during software installations or updates 
Changes made by security tools or monitoring agents","IntegrityLevel=""Medium"" CommandLine=""*ControlSet*"" CommandLine=""*services*"" CommandLine IN (""*\\ImagePath*"", ""*\\FailureCommand*"", ""*\\ServiceDll*"")"
"Suspicious Regsvr32 Execution From Remote Share","Nasreddine Bencherchali (Nextron Systems)","Detects REGSVR32.exe to execute DLL hosted on remote shares","attack.defense_evasion, attack.t1218.010","process_creation","windows","Not classified","Review process creation logs for instances of REGSVR32.exe being executed with a command line containing multiple backslashes (\\\\) indicating a remote share path. 
Check the command line arguments of REGSVR32.exe to identify the DLL being registered and the remote share path it is being executed from. 
Verify the legitimacy of the remote share and the DLL being registered by checking the file hashes and comparing them with known good values. 
Investigate any suspicious or unknown DLLs being registered from remote shares for signs of malicious behavior or indicators of compromise. 
Correlate the REGSVR32.exe execution with other security events or alerts to identify any related malicious activity.","Legitimate use of REGSVR32.exe to register DLLs hosted on remote shares","Image=""*\\regsvr32.exe"" OR OriginalFileName=""\\REGSVR32.EXE"" CommandLine=""* \\\\*"""
"Add SafeBoot Keys Via Reg Utility","Nasreddine Bencherchali (Nextron Systems)","Detects execution of ""reg.exe"" commands with the ""add"" or ""copy"" flags on safe boot registry keys. Often used by attacker to allow the ransomware to work in safe mode as some security products do not","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check process creation logs for instances of reg.exe with the add or copy flags being used on safe boot registry keys. 
Review the command line arguments of the reg.exe process to identify the presence of \SYSTEM\CurrentControlSet\Control\SafeBoot in the command line. 
Look for the presence of the copy or add flags in the command line arguments of the reg.exe process. 
Cross-reference the identified process with other security events or indicators of compromise to determine if it is part of a larger attack.","Unlikely","Image=""*reg.exe"" OR OriginalFileName=""reg.exe"" CommandLine=""*\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot*"" CommandLine IN (""* copy *"", ""* add *"")"
"Suspicious Reg Add BitLocker","frack113","Detects suspicious addition to BitLocker related registry keys via the reg.exe utility","attack.impact, attack.t1486","process_creation","windows","Not classified","Check the command line arguments of the process that triggered the detection. Look for the presence of REG ADD followed by the BitLocker related registry key path and the /v and /f options. 
Review the context of the process execution. Look for any suspicious or unauthorized activity associated with the process, such as unusual network connections or file modifications. 
Cross-reference the detected activity with other security events or logs, such as authentication logs, file access logs, or network logs, to gather additional context and determine if the activity is part of a larger attack. 
Consult with system administrators or authorized personnel to verify if the detected changes were made intentionally or if they are part of a legitimate operation. 
If necessary, collect additional forensic evidence, such as memory dumps or disk images, to further analyze the system and identify any signs of compromise or malicious activity.","Legitimate changes to BitLocker related registry keys made by system administrators or authorized personnel 
Changes made during legitimate software installations or updates that involve modifying BitLocker settings 
Changes made during troubleshooting or recovery processes that involve modifying BitLocker settings","CommandLine=""*REG*"" CommandLine=""*ADD*"" CommandLine=""*\\SOFTWARE\\Policies\\Microsoft\\FVE*"" CommandLine=""*/v*"" CommandLine=""*/f*"" CommandLine IN (""*EnableBDEWithNoTPM*"", ""*UseAdvancedStartup*"", ""*UseTPM*"", ""*UseTPMKey*"", ""*UseTPMKeyPIN*"", ""*RecoveryKeyMessageSource*"", ""*UseTPMPIN*"", ""*RecoveryKeyMessage*"")"
"Security Service Disabled Via Reg.EXE","Florian Roth (Nextron Systems), John Lambert (idea), elhoim","Detects execution of ""reg.exe"" to disable security services such as Windows Defender.","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Review the command line arguments of the process execution to determine if it matches the expected pattern of disabling security services using reg.exe. 
Check the parent process and user context to identify any suspicious or unauthorized activity. 
Analyze the system logs, such as Windows Event Logs, for any related events or anomalies that may indicate malicious activity. 
Cross-reference the detection with other security controls and indicators of compromise (IOCs) to validate the findings. 
If available, review network logs, such as firewall or proxy logs, to identify any suspicious network connections or communication associated with the process execution. 
Consider conducting memory or disk forensics to gather additional evidence and artifacts related to the execution of reg.exe.","There may be legitimate reasons for using reg.exe to modify registry settings, such as system configuration changes or software installations. It is important to investigate the context and intent behind the execution of reg.exe before considering it as a true positive.","CommandLine=""*reg*"" CommandLine=""*add*"" CommandLine=""*d 4*"" CommandLine=""*v Start*"" CommandLine IN (""*\\AppIDSvc*"", ""*\\MsMpSvc*"", ""*\\NisSrv*"", ""*\\SecurityHealthService*"", ""*\\Sense*"", ""*\\UsoSvc*"", ""*\\WdBoot*"", ""*\\WdFilter*"", ""*\\WdNisDrv*"", ""*\\WdNisSvc*"", ""*\\WinDefend*"", ""*\\wscsvc*"", ""*\\wuauserv*"")"
"Dumping of Sensitive Hives Via Reg.EXE","Teymur Kheirkhabarov, Endgame, JHasenbusch, Daniil Yugoslavskiy, oscd.community, frack113","Detects the usage of ""reg.exe"" in order to dump sensitive registry hives, which includes SAM, SYSTEM and SECURITY","attack.credential_access, attack.t1003.002, attack.t1003.004, attack.t1003.005, car.2013-07-001","process_creation","windows","Not classified","Check for the presence of reg.exe in the process creation logs 
Look for command line arguments containing keywords like save, export, or their obfuscated versions 
Identify command line arguments referencing hives such as system, sam, or security 
Correlate the process creation event with other related events such as file access or network connections","Dumping hives for legitimate purposes such as backup or forensic investigation","Image=""*\\reg.exe"" OR OriginalFileName=""reg.exe"" CommandLine IN (""*save*"", ""*export*"", ""*ave*"", ""*eport*"") CommandLine IN (""*hklm*"", ""*hkm*"", ""*hkey_local_machine*"", ""*hkey_ocal_machine*"", ""*hkey_loca_machine*"", ""*hkey_oca_machine*"") CommandLine IN (""*\\system*"", ""*\\sam*"", ""*\\security*"", ""*\\ystem*"", ""*\\sytem*"", ""*\\ytem*"", ""*\\am*"", ""*\\ecurity*"")"
"Reg Add Suspicious Paths","frack113, Nasreddine Bencherchali","Detects when an adversary uses the reg.exe utility to add or modify new keys or subkeys","attack.defense_evasion, attack.t1112, attack.t1562.001","process_creation","windows","Not classified","Check the process creation logs for instances of reg.exe being executed. 
Look for command line arguments that include the suspicious paths mentioned in the selection_path condition. 
Review the parent process and user context to determine if the reg.exe execution is expected or suspicious. 
Cross-reference with other security events or alerts to identify any correlated activities or indicators of compromise. 
If possible, analyze the content of the modified registry keys to understand the impact and potential malicious intent.","Rare legitimate add to registry via cli (to these locations)","Image=""*\\reg.exe"" OR OriginalFileName=""reg.exe"" CommandLine IN (""*\\AppDataLow\\Software\\Microsoft\\*"", ""*\\Policies\\Microsoft\\Windows\\OOBE*"", ""*\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon*"", ""*\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon*"", ""*\\CurrentControlSet\\Control\\SecurityProviders\\WDigest*"", ""*\\Microsoft\\Windows Defender\\*"")"
"Disabled Volume Snapshots","Florian Roth (Nextron Systems)","Detects commands that temporarily turn off Volume Snapshots","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check for legitimate administration activities that may involve disabling Volume Snapshots. Examples of log sources to investigate include 
Windows Event Logs Look for events related to changes in Volume Snapshot settings or registry modifications. 
Endpoint Protection Logs Check for any alerts or detections related to suspicious processes or commands. 
PowerShell Logs Analyze PowerShell command history or script execution logs for any commands related to disabling Volume Snapshots. 
System Logs Monitor system logs for any abnormal behavior or errors related to Volume Snapshot functionality.","Legitimate administration","CommandLine=""*reg*"" CommandLine=""* add *"" CommandLine=""*\\Services\\VSS\\Diag*"" CommandLine=""*/d Disabled*"""
"Remote Access Tool - AnyDesk Silent Installation","Jn Trenansk","Detects AnyDesk Remote Desktop silent installation. Which can be used by attackers to gain remote access.","attack.command_and_control, attack.t1219","process_creation","windows","Not classified","Check the CommandLine field in process creation logs for the presence of --install, --start-with-win, and --silent parameters. 
Review the ParentCommandLine field to identify the parent process that initiated the AnyDesk silent installation. 
Examine the CurrentDirectory field to determine the location from which the installation was triggered.","Legitimate deployment of AnyDesk","CommandLine=""*--install*"" CommandLine=""*--start-with-win*"" CommandLine=""*--silent*"""
"Remote Access Tool - ScreenConnect Suspicious Execution","Florian Roth (Nextron Systems)","Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support)","attack.initial_access, attack.t1133","process_creation","windows","Not classified","Check the process creation logs on Windows systems for instances where the ScreenConnect program is started with suspicious parameters. 
Look for command line arguments that contain e=Access&, y=Guest&, &p=, &c=, or &k=. 
Review the associated user account and IP address to determine if it aligns with legitimate administrative activity. 
Cross-reference with other logs, such as network traffic logs or authentication logs, to identify any suspicious or unauthorized activity. 
If possible, gather additional context from the user or system owner to validate the legitimacy of the remote access.","Legitimate use by administrative staff","CommandLine=""*e=Access&*"" CommandLine=""*y=Guest&*"" CommandLine=""*&p=*"" CommandLine=""*&c=*"" CommandLine=""*&k=*"""
"Renamed AdFind Execution","Florian Roth (Nextron Systems)","Detects the use of a renamed Adfind.exe. AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.","attack.discovery, attack.t1018, attack.t1087.002, attack.t1482, attack.t1069.002","process_creation","windows","Not classified","Check process creation logs for instances of AdFind.exe being executed with suspicious command line arguments such as domainlist, trustdmp, dcmodes, etc. 
Look for processes with the original file name AdFind.exe and check if they are being executed from unexpected locations or with unusual parameters. 
Analyze the import hashes (Imphash) and file hashes of the executed AdFind.exe to identify any known malicious versions. 
Cross-reference the detected AdFind.exe executions with other security events and logs to identify any associated suspicious or malicious activities. 
Review any network traffic logs or DNS logs for connections or queries related to the IP addresses or domains discovered by AdFind.exe. 
Consider conducting further investigation on systems where AdFind.exe is executed to identify any signs of lateral movement, privilege escalation, or other indicators of compromise.","Unknown","CommandLine IN (""*domainlist*"", ""*trustdmp*"", ""*dcmodes*"", ""*adinfo*"", ""* dclist *"", ""*computer_pwdnotreqd*"", ""*objectcategory=*"", ""*-subnets -f*"", ""*name=\""Domain Admins\""*"", ""*-sc u:*"", ""*domainncs*"", ""*dompol*"", ""* oudmp *"", ""*subnetdmp*"", ""*gpodmp*"", ""*fspdmp*"", ""*users_noexpire*"", ""*computers_active*"", ""*computers_pwdnotreqd*"") OR Imphash IN (""bca5675746d13a1f246e2da3c2217492"", ""53e117a96057eaf19c41380d0e87f1c2"") OR Hashes IN (""*IMPHASH=BCA5675746D13A1F246E2DA3C2217492*"", ""*IMPHASH=53E117A96057EAF19C41380D0E87F1C2*"") OR OriginalFileName=""AdFind.exe"" NOT Image=""*\\AdFind.exe"""
"Potential Defense Evasion Via Rename Of Highly Relevant Binaries","Matthew Green - @mgreen27, Florian Roth (Nextron Systems), frack113","Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.","attack.defense_evasion, attack.t1036.003, car.2013-05-009","process_creation","windows","Not classified","Check the process creation logs for any execution of the binaries mentioned in the OriginalFileName list, such as certutil.exe, cmstp.exe, cscript.exe, etc. 
Look for any instances of remote process execution, especially using tools like Sysinternals PsExec. 
Monitor for any PowerShell activity, particularly if it involves the use of Windows PowerShell or pwsh. 
Analyze the command-line arguments and parameters used during process execution to identify any suspicious or malicious activity. 
Cross-reference the process execution logs with other security events, such as network traffic logs or endpoint detection and response (EDR) logs, to gather additional context and evidence of potential defense evasion. 
Investigate any instances where custom applications are using renamed binaries, ensuring that the changes in the binary names are legitimate and expected. 
If PsExec is installed via the Windows Store, verify if the original filename field is missing and consider it as a false negative.","Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist 
PsExec installed via Windows Store doesnt contain original filename field (False negative)","Description=""Execute processes remotely"" OR Product=""Sysinternals PsExec"" OR Description IN (""Windows PowerShell*"", ""pwsh*"") OR OriginalFileName IN (""certutil.exe"", ""cmstp.exe"", ""cscript.exe"", ""mshta.exe"", ""msiexec.exe"", ""powershell_ise.exe"", ""powershell.exe"", ""psexec.c"", ""psexec.exe"", ""psexesvc.exe"", ""pwsh.dll"", ""reg.exe"", ""regsvr32.exe"", ""rundll32.exe"", ""WerMgr"", ""wmic.exe"", ""wscript.exe"") NOT (Image IN (""*\\certutil.exe"", ""*\\cmstp.exe"", ""*\\cscript.exe"", ""*\\mshta.exe"", ""*\\msiexec.exe"", ""*\\powershell_ise.exe"", ""*\\powershell.exe"", ""*\\psexec.exe"", ""*\\psexec64.exe"", ""*\\PSEXESVC.exe"", ""*\\pwsh.exe"", ""*\\reg.exe"", ""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\wermgr.exe"", ""*\\wmic.exe"", ""*\\wscript.exe""))"
"Renamed ZOHO Dctask64 Execution","Florian Roth (Nextron Systems)","Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation","attack.defense_evasion, attack.t1036, attack.t1055.001, attack.t1202, attack.t1218","process_creation","windows","Not classified","Check the CommandLine, ParentCommandLine, and ParentImage fields in the process_creation logs for instances of dctask64.exe 
Verify the hash of the file to ensure it matches the known malicious hash (6834B1B94E49701D77CCB3C0895E1AFD) 
Investigate the process tree to identify any suspicious parent processes or command lines 
Cross-reference with other security events or indicators of compromise to determine if the activity is part of a larger attack 
Consult with the system owner or user to determine if the use of dctask64.exe is expected or authorized","Legitimate use of dctask64.exe by ZOHO Corporation 
Other legitimate processes with similar names 
False positives caused by software installations or updates","Hashes=""*6834B1B94E49701D77CCB3C0895E1AFD*"" NOT Image=""*\\dctask64.exe"""
"Renamed Jusched.EXE Execution","Markus Neis, Swisscom","Detects the execution of a renamed ""jusched.exe"" as seen used by the cobalt group","attack.execution, attack.defense_evasion, attack.t1036.003","process_creation","windows","Not classified","Check process creation logs for instances of jusched.exe being executed with a different name 
Look for any suspicious or unusual command-line arguments or parameters used with the process 
Cross-reference the process execution with other security events or indicators of compromise (IOCs)","Legitimate use of jusched.exe for Java updates","Description IN (""Java Update Scheduler"", ""Java(TM) Update Scheduler"") NOT Image=""*\\jusched.exe"""
"Renamed MegaSync Execution","Sittikorn S","Detects the execution of a renamed MegaSync.exe as seen used by ransomware families like Nefilim, Sodinokibi, Pysa, and Conti.","attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Check the process creation logs from Windows systems for instances where the OriginalFileName field is megasync.exe but the Image field does not end with \megasync.exe. 
Review the command-line arguments and parent process information for any suspicious activity or anomalies. 
Cross-reference the process execution with other security events and indicators of compromise (IOCs) to determine if it is associated with known ransomware families like Nefilim, Sodinokibi, Pysa, or Conti. 
If possible, analyze the file in a controlled environment to determine its behavior and potential malicious intent.","Software that legally integrates MegaSync in a renamed form","OriginalFileName=""megasync.exe"" NOT Image=""*\\megasync.exe"""
"Renamed Office Binary Execution","Nasreddine Bencherchali (Nextron Systems)","Detects the execution of a renamed office binary","attack.defense_evasion","process_creation","windows","Not classified","Check the process creation logs from Windows Event Logs (Event ID 4688) to identify the process name and command line arguments. 
Verify the process path and compare it with known legitimate locations for Office binaries (e.g., C\Program Files\Microsoft Office\). 
Review the user account associated with the process and check if it belongs to a trusted user or a system account. 
Analyze the parent process and its relationship with the Office binary execution to identify any suspicious behavior or indicators of compromise. 
Cross-reference the detection with other security events or indicators, such as network traffic logs, to determine if any malicious activities are associated with the Office binary execution.","Legitimate usage of renamed Office binaries 
Office binaries executed from legitimate locations 
Office binaries executed by trusted users or processes","OriginalFileName IN (""Excel.exe"", ""MSACCESS.EXE"", ""OneNote.exe"", ""POWERPNT.EXE"", ""WinWord.exe"") OR Description IN (""Microsoft Access"", ""Microsoft Excel"", ""Microsoft OneNote"", ""Microsoft PowerPoint"", ""Microsoft Word"") NOT (Image IN (""*\\EXCEL.exe"", ""*\\MSACCESS.exe"", ""*\\ONENOTE.EXE"", ""*\\POWERPNT.EXE"", ""*\\WINWORD.exe""))"
"Renamed PAExec Execution","Florian Roth (Nextron Systems), Jason Lynch","Detects execution of renamed version of PAExec. Often used by attackers","attack.defense_evasion, attack.t1202","process_creation","windows","Not classified","Check the process creation logs for any execution of PAExec.exe 
Look for any instances where the Image path ends with \paexec.exe 
Look for any instances where the Image path starts with C\Windows\PAExec- 
Check the Imphash of the executed process against the known Imphashes of PAExec 
Check the hashes of the executed process against the known hashes of PAExec 
Verify if the execution is related to any legitimate use cases mentioned in the false positives section","Weird admins that rename their tools 
Software companies that bundle PAExec with their software and rename it, so that it is less embarrassing 
When executed with the ""-s"" flag. PAExec will copy itself to the ""C\Windows\"" directory with a different name. Usually like this ""PAExec-[XXXXX]-[ComputerName]""","Description=""PAExec Application"" OR OriginalFileName=""PAExec.exe"" OR Product=""*PAExec*"" OR Imphash IN (""11D40A7B7876288F919AB819CC2D9802"", ""6444f8a34e99b8f7d9647de66aabe516"", ""dfd6aa3f7b2b1035b76b718f1ddc689f"", ""1a6cca4d5460b1710a12dea39e4a592c"") OR Hashes IN (""*IMPHASH=11D40A7B7876288F919AB819CC2D9802*"", ""*IMPHASH=6444f8a34e99b8f7d9647de66aabe516*"", ""*IMPHASH=dfd6aa3f7b2b1035b76b718f1ddc689f*"", ""*IMPHASH=1a6cca4d5460b1710a12dea39e4a592c*"") NOT (Image IN (""*\\paexec.exe"", ""C:\\Windows\\PAExec-*""))"
"Renamed SysInternals DebugView Execution","Florian Roth (Nextron Systems)","Detects suspicious renamed SysInternals DebugView execution","attack.resource_development, attack.t1588.002","process_creation","windows","Not classified","Check the process creation logs for instances where the Product field is Sysinternals DebugView but the OriginalFileName field does not match Dbgview.exe and the Image field does not end with \Dbgview.exe. 
Review the command-line arguments and parent process information for any suspicious activity or anomalies. 
Cross-reference the process execution with other security events and logs to identify any related indicators of compromise or malicious behavior. 
If possible, compare the hash of the executed file with known good hashes to determine if it has been tampered with or replaced.","Legitimate renaming of SysInternals DebugView executable for legitimate purposes, such as renaming for organizational conventions or obfuscation purposes.","Product=""Sysinternals DebugView"" NOT (OriginalFileName=""Dbgview.exe"" Image=""*\\Dbgview.exe"")"
"Renamed ProcDump Execution","Florian Roth (Nextron Systems)","Detects the execution of a renamed ProcDump executable often used by attackers or malware","attack.defense_evasion, attack.t1036.003","process_creation","windows","Not classified","Check for the presence of other suspicious activities or indicators of compromise, such as 
Unusual network connections or traffic associated with the process 
Creation or modification of suspicious files or registry entries 
Presence of known malicious files or processes on the system 
Review relevant log sources for additional context and evidence, such as 
Windows Event Logs (Event ID 4688 - Process Creation) 
Sysmon logs (Event ID 1 - Process Create) 
Endpoint detection and response (EDR) logs 
Perform memory or disk forensics to analyze the process memory or dumped files, if available 
Consider correlating the detection with other security events or alerts to identify potential attack patterns or campaigns","Procdump used for legitimate debugging purposes 
Procdump executed by system administrators for troubleshooting","OriginalFileName=""procdump"" OR (CommandLine IN (""* -ma *"", ""* /ma *"") CommandLine IN (""* -accepteula *"", ""* /accepteula *"")) NOT (Image IN (""*\\procdump.exe"", ""*\\procdump64.exe""))"
"Renamed PsExec Service Execution","Florian Roth (Nextron Systems)","Detects suspicious launch of a renamed version of the PSEXESVC service with, which is not often used by legitimate administrators","attack.execution","process_creation","windows","Not classified","Check the process creation logs for instances where the OriginalFileName field is psexesvc.exe but the Image field is C\Windows\PSEXESVC.exe. 
Review the command-line arguments used when launching the process to identify any suspicious or unauthorized activity. 
Cross-reference the process creation event with other security events, such as network traffic logs or authentication logs, to determine if any further malicious activity occurred. 
If possible, compare the process creation event with known good baselines or whitelists to identify any deviations from normal behavior.","Legitimate administrative tasks","OriginalFileName=""psexesvc.exe"" NOT Image=""C:\\Windows\\PSEXESVC.exe"""
"Renamed Whoami Execution","Florian Roth (Nextron Systems)","Detects the execution of whoami that has been renamed to a different name to avoid detection","attack.discovery, attack.t1033, car.2016-03-001","process_creation","windows","Not classified","Check the process creation logs for instances where the OriginalFileName field is whoami.exe but the Image field does not end with \whoami.exe. 
Review the command-line arguments and parent process information to determine if the execution is suspicious or part of a legitimate activity. 
Cross-reference with other security events or indicators of compromise (IOCs) to identify any related malicious activity. 
If possible, gather additional context from other log sources such as network traffic logs, file system logs, or endpoint detection and response (EDR) logs to further investigate the suspicious execution.","Legitimate use of a renamed executable for legitimate purposes, such as software installation or system administration tasks.","OriginalFileName=""whoami.exe"" NOT Image=""*\\whoami.exe"""
"Suspicious Call by Ordinal","Florian Roth (Nextron Systems)","Detects suspicious calls of DLLs in rundll32.dll exports by ordinal","attack.defense_evasion, attack.t1218.011","process_creation","windows","Not classified","Check the command line arguments of the rundll32.exe process to identify the DLL being loaded and the ordinal being used 
Verify if the DLL and ordinal combination is expected and authorized in the environment 
Review the parent process and its associated command line arguments to understand the context of the suspicious call 
Cross-reference the suspicious DLL and ordinal combination with known malware or malicious activities 
Monitor for any additional suspicious behavior or indicators of compromise associated with the process or the loaded DLL","Legitimate use of rundll32.exe for system operations 
Legitimate use of DLLs by authorized applications 
Legitimate use of DLLs by administrative tools 
Legitimate use of DLLs by development tools","Image=""*\\rundll32.exe"" OR OriginalFileName=""RUNDLL32.EXE"" CommandLine IN (""*,#*"", ""*, #*"", ""*.dll #*"", ""*.ocx #*"") NOT ((CommandLine=""*EDGEHTML.dll*"" CommandLine=""*#141*"") OR (ParentImage IN (""*\\Msbuild\\Current\\Bin\\*"", ""*\\VC\\Tools\\MSVC\\*"", ""*\\Tracker.exe*"") CommandLine IN (""*\\FileTracker32.dll,#1*"", ""*\\FileTracker32.dll\"",#1*"", ""*\\FileTracker64.dll,#1*"", ""*\\FileTracker64.dll\"",#1*"")))"
"Suspicious Rundll32 Invoking Inline VBScript","Florian Roth (Nextron Systems)","Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452","attack.defense_evasion, attack.t1055","process_creation","windows","Not classified","Review process creation logs from Windows Event Logs or Sysmon for instances of rundll32.exe being used with the specified command line parameters. 
Check for legitimate use cases where rundll32.exe is used to execute VBScript files, such as system maintenance or software installation. 
Compare the command line parameters with known good executions to identify any anomalies or suspicious patterns. 
Correlate the rundll32.exe process with other events or indicators of compromise to determine if it is part of a larger attack chain.","Legitimate use of rundll32.exe to execute VBScript files","CommandLine=""*rundll32.exe*"" CommandLine=""*Execute*"" CommandLine=""*RegRead*"" CommandLine=""*window.close*"""
"Rundll32 JS RunHTMLApplication Pattern","Florian Roth (Nextron Systems)","Detects suspicious command line patterns used when rundll32 is used to run JavaScript code","attack.defense_evasion","process_creation","windows","Not classified","Check the parent process of rundll32 to determine if it is a known or expected process 
Review the command line arguments passed to rundll32 and analyze the presence of suspicious keywords or patterns 
Correlate the rundll32 activity with other security events or logs to identify any malicious behavior or indicators of compromise 
Monitor network traffic for any suspicious connections or communication initiated by the rundll32 process 
Analyze any related log sources such as web server logs, firewall logs, or DNS logs to gather additional context or evidence","Legitimate use of rundll32 to run JavaScript code 
Development or testing scenarios where these command line patterns are used 
Scripting or automation tools that utilize similar command line patterns","(CommandLine=""*rundll32*"" CommandLine=""*javascript*"" CommandLine=""*..\\..\\mshtml,RunHTMLApplication*"") OR CommandLine=""*;document.write();GetObject(\""script*"""
"Mshtml DLL RunHTMLApplication Abuse","Nasreddine Bencherchali (Nextron Systems)","Detects suspicious command line using the ""mshtml.dll"" RunHTMLApplication export to run arbitrary code via different protocol handlers (vbscript, javascript, file, htpp...)","attack.defense_evasion","process_creation","windows","Not classified","Review process creation logs for instances where the mshtml.dll RunHTMLApplication export is used with suspicious command line arguments. 
Check for any unusual or unexpected network connections or traffic associated with the process using mshtml.dll RunHTMLApplication. 
Analyze any related files or artifacts created or modified during the execution of the suspicious command line.","Legitimate use of mshtml.dll RunHTMLApplication export","CommandLine=""*\\..\\*"" CommandLine=""*mshtml*"" CommandLine=""*RunHTMLApplication*"""
"Rundll32 Registered COM Objects","frack113","load malicious registered COM objects","attack.privilege_escalation, attack.persistence, attack.t1546.015","process_creation","windows","Not classified","Check the parent process of rundll32.exe to identify the source of the command line execution. 
Review the command line arguments of rundll32.exe to identify any suspicious or unexpected values. 
Inspect the loaded DLLs by rundll32.exe to identify any malicious or unauthorized COM objects. 
Analyze the network traffic generated by rundll32.exe to identify any suspicious communication with external systems. 
Monitor any changes made to the Windows registry related to registered COM objects. 
Review any relevant logs from the application or system that triggered the execution of rundll32.exe.","Legitimate use of rundll32.exe for system operations or software installations.","Image=""*\\rundll32.exe"" OR OriginalFileName=""RUNDLL32.EXE"" CommandLine IN (""*-sta *"", ""*-localserver *"") CommandLine=""*{*"" CommandLine=""*}*"""
"RunDLL32 Spawning Explorer","elhoim, CD_ROM_","Detects RunDLL32.exe spawning explorer.exe as child, which is very uncommon, often observes Gamarue spawning the explorer.exe process in an unusual way","attack.defense_evasion, attack.t1218.011","process_creation","windows","Not classified","Check for any legitimate software or system processes that may be using RunDLL32.exe to spawn explorer.exe as a child process. Look for any unusual or suspicious command line arguments or parameters in the ParentCommandLine field. Cross-reference with known good processes and their expected behavior. If no legitimate explanation is found, further investigation is warranted.","Unknown","ParentImage=""*\\rundll32.exe"" Image=""*\\explorer.exe"" NOT ParentCommandLine=""*\\shell32.dll,Control_RunDLL*"""
"Suspicious Control Panel DLL Load","Florian Roth (Nextron Systems)","Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits","attack.defense_evasion, attack.t1218.011","process_creation","windows","Not classified","Check the ParentImage field to verify if the process execution is initiated by control.exe 
Check the Image field to verify if the process execution is rundll32.exe 
Check the CommandLine field to see if it contains the reference to Shell32.dll 
Review the ParentCommandLine field to gather additional context 
Cross-reference with other logs such as network traffic logs, file access logs, and endpoint logs to identify any suspicious behavior or indicators of compromise","Legitimate use of control.exe and rundll32.exe for system administration tasks 
Legitimate use of Shell32.dll by trusted applications","ParentImage=""*\\System32\\control.exe"" Image=""*\\rundll32.exe"" OR OriginalFileName=""RUNDLL32.EXE"" NOT CommandLine=""*Shell32.dll*"""
"Suspicious Usage Of ShellExec_RunDLL","Nasreddine Bencherchali (Nextron Systems)","Detects suspicious usage of the ShellExec_RunDLL function to launch other commands as seen in the the raspberry-robin attack","attack.defense_evasion","process_creation","windows","Not classified","Not available","Not available","CommandLine=""*ShellExec_RunDLL*"" CommandLine IN (""*regsvr32*"", ""*msiexec*"", ""*\\Users\\Public\\*"", ""*odbcconf*"", ""*\\Desktop\\*"", ""*\\Temp\\*"", ""*Invoke-*"", ""*iex*"", ""*comspec*"")"
"ShimCache Flush","Florian Roth (Nextron Systems)","Detects actions that clear the local ShimCache and remove forensic evidence","attack.defense_evasion, attack.t1112","process_creation","windows","Not classified","Review process creation logs (e.g., Windows Event ID 4688) for instances of rundll32.exe with the apphelp.dll argument or ShimFlushCache command, or rundll32.exe with the kernel32.dll argument or BaseFlushAppcompatCache command. 
Check if the process creation is associated with a legitimate system maintenance or troubleshooting activity. 
Correlate with other security events to determine if any malicious activity is associated with the ShimCache flushing.","Legitimate use of ShimCache flushing tools during system maintenance or troubleshooting","(CommandLine=""*rundll32*"" CommandLine=""*apphelp.dll*"" CommandLine IN (""*ShimFlushCache*"", ""*#250*"")) OR (CommandLine=""*rundll32*"" CommandLine=""*kernel32.dll*"" CommandLine IN (""*BaseFlushAppcompatCache*"", ""*#46*""))"
"Suspicious Rundll32 Activity Invoking Sys File","Florian Roth (Nextron Systems)","Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452","attack.defense_evasion, attack.t1218.011","process_creation","windows","Not classified","Review process creation logs from Windows Event Logs or SIEM for instances of rundll32.exe being invoked with a command line that includes a *.sys file. 
Check if the rundll32.exe process is being executed from a suspicious or unexpected location. 
Analyze the command line arguments passed to rundll32.exe to identify any suspicious or malicious behavior. 
Cross-reference the rundll32.exe process with other security events or indicators of compromise to determine if it is part of a larger attack campaign.","Legitimate use of rundll32.exe for system operations","CommandLine=""*rundll32.exe*"" CommandLine IN (""*.sys,*"", ""*.sys *"")"
"Rundll32 UNC Path Execution","Nasreddine Bencherchali (Nextron Systems)","Detects rundll32 execution where the DLL is located on a remote location (share)","attack.defense_evasion, attack.execution, attack.t1021.002, attack.t1218.011","process_creation","windows","Not classified","Check the command line arguments of the rundll32 process to identify the DLL being loaded and the UNC path used 
Review the process creation logs for rundll32.exe to identify the parent process and any suspicious behavior 
Analyze network logs for any communication to the remote share or any other suspicious network activity 
Cross-reference the rundll32 execution with other security events or indicators of compromise to determine if it is part of a larger attack campaign 
Verify the legitimacy of the DLL and the remote share by checking with the authorized system owners or IT department 
Consider the context of the execution, such as the user, time, and system, to determine if it aligns with expected behavior","Legitimate use of rundll32 with DLL located on a remote share for authorized purposes 
Rundll32 execution with DLL located on a remote share in a trusted environment","Image=""*\\rundll32.exe"" OR OriginalFileName=""RUNDLL32.EXE"" OR CommandLine=""*rundll32*"" CommandLine=""* \\\\*"""
"Rundll32 Execution Without Parameters","Bartlomiej Czyz, Relativity","Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module","attack.lateral_movement, attack.t1021.002, attack.t1570, attack.execution, attack.t1569.002","process_creation","windows","Not classified","Investigate the command line arguments passed to rundll32.exe to determine if it was executed without any parameters. 
Review the parent process and its command line to understand the context of the rundll32 execution. 
Check if any suspicious or malicious DLLs were loaded by rundll32. 
Correlate the rundll32 execution with other security events or indicators of compromise to identify any potential malicious activity.","User called rundll32 from CLI with no options for legitimate reasons, such as troubleshooting or running specific commands.","CommandLine IN (""rundll32.exe"", ""rundll32"")"
"Suspicious Schtasks Execution AppData Folder","pH-T (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects the creation of a schtask that executes a file from C:\Users\<USER>\AppData\Local","attack.execution, attack.persistence, attack.t1053.005, attack.t1059.001","process_creation","windows","Not classified","Review the process creation logs from the Windows event logs or SIEM for instances of schtasks.exe being executed with the following characteristics 
['Image ends with \\schtasks.exe'] 
['CommandLine contains /Create, /RU, /TR, C\\Users\\, and \\AppData\\Local\\'] 
['CommandLine contains NT AUT or SYSTEM'] 
Check if the parent process image contains any of the following 
['\\AppData\\Local\\Temp\\'] 
['TeamViewer_.exe'] 
Ensure that the CommandLine does not contain /TN TVInstallRestore. 
If the above conditions are met, investigate further to determine if the schtask creation is malicious or legitimate. 
Examples of log sources that can be used for investigation 
['Windows Security Event Logs (Event ID 4688 - Process Creation)'] 
['SIEM logs from endpoint security solutions'] 
['SIEM logs from application control solutions']","Legitimate scheduled tasks created by system administrators or legitimate software installations may trigger this rule.","Image=""*\\schtasks.exe"" CommandLine=""*/Create*"" CommandLine=""*/RU*"" CommandLine=""*/TR*"" CommandLine=""*C:\\Users\\*"" CommandLine=""*\\AppData\\Local\\*"" CommandLine IN (""*NT AUT*"", ""* SYSTEM *"") NOT (ParentImage=""*\\AppData\\Local\\Temp\\*"" ParentImage=""*TeamViewer_.exe*"" Image=""*\\schtasks.exe"" CommandLine=""*/TN TVInstallRestore*"")"
"Suspicious Modification Of Scheduled Tasks","Nasreddine Bencherchali (Nextron Systems)","Detects when an attacker tries to modify an already existing scheduled tasks to run from a suspicious location
Attackers can create a simple looking task in order to avoid detection on creation as it's often the most focused on
Instead they modify the task after creation to include their malicious payload
","attack.execution, attack.t1053.005","process_creation","windows","Not classified","Check the Windows Security Event Log for Event ID 4698 (A scheduled task was created) and Event ID 4699 (A scheduled task was deleted). Look for any suspicious modifications made to existing scheduled tasks, such as changes to the tasks command line or the task being moved to a suspicious location. 
Review the command line of the schtasks.exe process to identify any suspicious modifications. Pay attention to the /Change and /TN parameters, which indicate a modification to an existing task. 
Inspect the command line of the process creation events for suspicious locations, such as temporary directories, public directories, or unexpected system directories. 
Analyze the command line of the process creation events for suspicious images or executables commonly used by attackers, such as regsvr32, rundll32, powershell, mshta, wscript, cscript, certutil, bitsadmin, bash.exe, wmic.exe, scriptrunner, hh.exe, etc. 
Cross-reference the modified scheduled task with known legitimate changes made by system administrators or authorized users to identify any anomalies.","Unknown","Image=""*\\schtasks.exe"" CommandLine=""* /Change *"" CommandLine=""* /TN *"" CommandLine IN (""*\\AppData\\Local\\Temp*"", ""*\\AppData\\Roaming\\*"", ""*\\Users\\Public\\*"", ""*\\WINDOWS\\Temp\\*"", ""*\\Desktop\\*"", ""*\\Downloads\\*"", ""*\\Temporary Internet*"", ""*C:\\ProgramData\\*"", ""*C:\\Perflogs\\*"", ""*%ProgramData%*"", ""*%appdata%*"", ""*%comspec%*"", ""*%localappdata%*"") CommandLine IN (""*regsvr32*"", ""*rundll32*"", ""*cmd /c *"", ""*cmd /k *"", ""*cmd /r *"", ""*cmd.exe /c *"", ""*cmd.exe /k *"", ""*cmd.exe /r *"", ""*powershell*"", ""*mshta*"", ""*wscript*"", ""*cscript*"", ""*certutil*"", ""*bitsadmin*"", ""*bash.exe*"", ""*bash *"", ""*scrcons*"", ""*wmic *"", ""*wmic.exe*"", ""*forfiles*"", ""*scriptrunner*"", ""*hh.exe*"", ""*hh *"")"
"Suspicious Scheduled Task Creation Involving Temp Folder","Florian Roth (Nextron Systems)","Detects the creation of scheduled tasks that involves a temporary folder and runs only once","attack.execution, attack.persistence, attack.t1053.005","process_creation","windows","Not classified","Check the CommandLine and ParentCommandLine fields in process_creation logs for the presence of schtasks.exe and the specific command line parameters used for task creation. 
Review the process_creation logs for any legitimate administrative activity or software installations that may match the detection criteria.","Administrative activity 
Software installation","Image=""*\\schtasks.exe"" CommandLine=""* /create *"" CommandLine=""* /sc once *"" CommandLine=""*\\Temp\\*"""
"Delete Important Scheduled Task","Nasreddine Bencherchali (Nextron Systems)","Detects when adversaries stop services or processes by deleting their respective scheduled tasks in order to conduct data destructive activities","attack.impact, attack.t1489","process_creation","windows","Not classified","Check the security event logs for process creation events with schtasks.exe as the image name 
Look for command line arguments containing /delete and /tn 
Examine the command line for the presence of known important scheduled tasks such as those related to system restore, Windows Defender, BitLocker, Windows Backup, Windows Update, Update Orchestrator, and Exploit Guard 
Verify if the scheduled task deletion was performed by a legitimate administrator or if it was an unauthorized action","Legitimate administrative actions to remove scheduled tasks 
Scheduled tasks being deleted as part of a system update or patching process","Image=""*\\schtasks.exe"" CommandLine=""*/delete*"" CommandLine=""*/tn*"" CommandLine IN (""*\\Windows\\SystemRestore\\SR*"", ""*\\Windows\\Windows Defender\\*"", ""*\\Windows\\BitLocker*"", ""*\\Windows\\WindowsBackup\\*"", ""*\\Windows\\WindowsUpdate\\*"", ""*\\Windows\\UpdateOrchestrator\\*"", ""*\\Windows\\ExploitGuard*"")"
"Delete All Scheduled Tasks","Nasreddine Bencherchali (Nextron Systems)","Detects the usage of schtasks with the delete flag and the asterisk symbol to delete all tasks from the schedule of the local computer, including tasks scheduled by other users.","attack.impact, attack.t1489","process_creation","windows","Not classified","Review process creation logs from Windows event logs (Event ID 4688) to identify instances of schtasks.exe being executed with the delete flag and the asterisk symbol in the command line. 
Check for any legitimate scheduled task deletion activities performed by authorized administrators or system maintenance scripts. 
Cross-reference the identified instances with the list of known false positives to filter out authorized activities.","Scheduled task deletion performed by authorized administrators or system maintenance scripts.","Image=""*\\schtasks.exe"" CommandLine=""* /delete *"" CommandLine=""*/tn \**"" CommandLine=""* /f*"""
"Disable Important Scheduled Task","frack113, Nasreddine Bencherchali (Nextron Systems)","Detects when adversaries stop services or processes by disabling their respective scheduled tasks in order to conduct data destructive activities","attack.impact, attack.t1489","process_creation","windows","Not classified","Check the Windows Event Log for events related to scheduled task modifications or disablement. Look for Event ID 4698 (A scheduled task was created or modified) and Event ID 4699 (A scheduled task was deleted). 
Review the command-line arguments of the schtasks.exe process to identify the specific task being disabled. Look for the /Change, /TN, and /disable parameters. 
Cross-reference the disabled task with known legitimate administrative actions or scheduled tasks that are disabled for maintenance or troubleshooting purposes. 
Analyze any associated network traffic or file modifications that may indicate malicious activity. 
Consult with system administrators or other relevant personnel to determine if the disablement of the scheduled task is expected or suspicious.","Legitimate administrative actions to disable scheduled tasks 
Scheduled tasks disabled by system administrators for maintenance or troubleshooting purposes","Image=""*\\schtasks.exe"" CommandLine=""*/Change*"" CommandLine=""*/TN*"" CommandLine=""*/disable*"" CommandLine IN (""*\\Windows\\SystemRestore\\SR*"", ""*\\Windows\\Windows Defender\\*"", ""*\\Windows\\BitLocker*"", ""*\\Windows\\WindowsBackup\\*"", ""*\\Windows\\WindowsUpdate\\*"", ""*\\Windows\\UpdateOrchestrator\\*"", ""*\\Windows\\ExploitGuard*"")"
"Schtasks From Suspicious Folders","Florian Roth (Nextron Systems)","Detects scheduled task creations that have suspicious action command and folder combinations","attack.execution, attack.t1053.005","process_creation","windows","Not classified","Review the process creation logs from the Windows event logs (Event ID 4688) to identify the creation of scheduled tasks using schtasks.exe. 
Analyze the command line arguments of the schtasks.exe process to identify suspicious action command and folder combinations. 
Cross-reference the suspicious scheduled task with known legitimate scheduled tasks on the system to determine if it is a false positive. 
Check the execution context of the suspicious scheduled task (e.g., user account, privileges) to assess its potential impact and determine if it aligns with expected behavior. 
Consult with system administrators or software vendors to validate the purpose and legitimacy of the scheduled task. 
If the suspicious scheduled task is associated with a specific software or application, investigate the softwares documentation or contact the vendor for further information. 
If the suspicious scheduled task is associated with a known threat actor or malware campaign, refer to threat intelligence reports or security blogs for additional context and indicators of compromise.","Legitimate scheduled tasks created by system administrators or software installations may trigger this rule. It is important to verify the source and purpose of the scheduled task before considering it as a false positive. 
Scheduled tasks created by security tools or monitoring agents may also match the detection criteria. Check the configuration and purpose of these tools to confirm if they are responsible for the observed activity.","Image=""*\\schtasks.exe"" OR OriginalFileName=""schtasks.exe"" CommandLine=""* /create *"" CommandLine IN (""*powershell*"", ""*pwsh*"", ""*cmd /c *"", ""*cmd /k *"", ""*cmd /r *"", ""*cmd.exe /c *"", ""*cmd.exe /k *"", ""*cmd.exe /r *"") CommandLine IN (""*C:\\ProgramData\\*"", ""*%ProgramData%*"")"
"Scheduled Task Executing Encoded Payload from Registry","pH-T (Nextron Systems), @Kostastsale, @TheDFIRReport, X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects the creation of a schtask that potentially executes a base64 encoded payload stored in the Windows Registry using PowerShell.","attack.execution, attack.persistence, attack.t1053.005, attack.t1059.001","process_creation","windows","Not classified","Review the process creation logs from the Windows event logs (Event ID 4688) to identify the creation of the schtasks.exe process with the /Create command line parameter. 
Check the command line arguments of the schtasks.exe process to see if it contains the keywords FromBase64String or encodedcommand, indicating the potential execution of a base64 encoded payload. 
Inspect the command line arguments of the schtasks.exe process to determine if it includes the keywords Get-ItemProperty or  gp , suggesting the retrieval of registry values. 
Examine the command line arguments of the schtasks.exe process to identify if it references registry hives such as HKCU, HKLM, registry, or HKEY_, indicating interaction with the Windows Registry.","Scheduled tasks created by legitimate system administrators or IT personnel for legitimate purposes may trigger this rule. It is important to verify the source and purpose of the scheduled task before considering it a false positive.","Image=""*\\schtasks.exe"" OR OriginalFileName=""schtasks.exe"" CommandLine=""*/Create*"" CommandLine IN (""*FromBase64String*"", ""*encodedcommand*"") CommandLine IN (""*Get-ItemProperty*"", ""* gp *"") CommandLine IN (""*HKCU:*"", ""*HKLM:*"", ""*registry::*"", ""*HKEY_*"")"
"Suspicious Schtasks Schedule Types","Nasreddine Bencherchali (Nextron Systems)","Detects scheduled task creations or modification on a suspicious schedule type","attack.execution, attack.t1053.005","process_creation","windows","Not classified","Review the command line arguments of the schtasks.exe process. 
Check if the scheduled task is associated with a legitimate process or application. 
Verify if the scheduled task is configured to run at logon or has high privileges. 
Cross-reference the scheduled task with known legitimate tasks in your environment. 
Analyze the behavior and purpose of the scheduled task to determine if it is suspicious or malicious.","Legitimate scheduled tasks that run at logon or have high privileges. Filter according to your environment","Image=""*\\schtasks.exe"" OR OriginalFileName=""schtasks.exe"" CommandLine IN (""* ONLOGON *"", ""* ONSTART *"", ""* ONCE *"", ""* ONIDLE *"") NOT (CommandLine IN (""*NT AUT*"", ""* SYSTEM*"", ""*HIGHEST*""))"
"Possible Privilege Escalation via Weak Service Permissions","Teymur Kheirkhabarov","Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand","attack.persistence, attack.defense_evasion, attack.privilege_escalation, attack.t1574.011","process_creation","windows","Not classified","Check the process creation logs for instances of sc.exe being spawned by users with Medium integrity level. 
Look for instances where the sc.exe command includes keywords related to changing service ImagePath or FailureCommand, such as config and binPath for ImagePath changes, and failure and command for FailureCommand changes. 
Cross-reference the detected sc.exe instances with the user accounts and their associated privileges to identify potential unauthorized privilege escalation attempts. 
Investigate any instances where sc.exe is used by authorized administrators to ensure they are legitimate and not indicative of an attack.","Legitimate use of sc.exe utility by authorized administrators to manage services. 
False positives may occur if the sc.exe utility is used for legitimate purposes unrelated to privilege escalation.","Image=""*\\sc.exe"" IntegrityLevel=""Medium"" (CommandLine=""*config*"" CommandLine=""*binPath*"") OR (CommandLine=""*failure*"" CommandLine=""*command*"")"
"Deny Service Access Using Security Descriptor Tampering Via Sc.EXE","Jonhnathan Ribeiro, oscd.community","Detects suspicious DACL modifications to deny access to a service that affects critical trustees. This can be used to hide services or make them unstoppable.","attack.persistence, attack.t1543.003","process_creation","windows","Not classified","Review the process creation logs for instances of sc.exe being executed with the sdset command and specific trustee parameters. 
Check for any legitimate reasons for the observed DACL modifications, such as system administration tasks or security tool operations. 
Verify if the modifications were made during software installations or updates. 
Determine if the changes were part of system hardening or security configuration changes. 
Investigate if the modifications were made during troubleshooting or debugging activities. 
Identify the user or process responsible for the changes and validate their authorization status.","Legitimate changes to service permissions made by system administrators or security tools. 
Changes made during legitimate software installations or updates. 
Changes made during system hardening or security configuration changes. 
Changes made during troubleshooting or debugging activities. 
Changes made by authorized users or processes.","Image=""*\\sc.exe"" OR OriginalFileName=""sc.exe"" CommandLine=""*sdset*"" CommandLine=""*D;*"" CommandLine IN (""*;IU*"", ""*;SU*"", ""*;BA*"", ""*;SY*"", ""*;WD*"")"
"Service DACL Abuse To Hide Services Via Sc.EXE","Andreas Hunkeler (@Karneades)","Detects usage of the ""sc.exe"" utility adding a new service with special permission seen used by threat actors which makes the service hidden and unremovable.","attack.persistence, attack.defense_evasion, attack.privilege_escalation, attack.t1574.011","process_creation","windows","Not classified","Check the command line arguments of the process creation events for the presence of sc.exe and sdset commands. 
Review the permissions assigned to the new service created by sc.exe. 
Verify if the DCLCWPDTSD parameter is used in the command line arguments and investigate the purpose of its usage. 
Cross-reference the process creation events with other security events, such as network traffic or file modifications, to identify any suspicious behavior associated with the sc.exe usage. 
Consult with system administrators or service owners to confirm the legitimacy of the service creation and the associated permissions.","Legitimate use of sc.exe to manage services. 
Legitimate use of sdset command with valid permissions. 
Legitimate use of DCLCWPDTSD in command line arguments.","Image=""*\\sc.exe"" OR OriginalFileName=""sc.exe"" CommandLine=""*sdset*"" CommandLine=""*DCLCWPDTSD*"""
"Suspicious Service Path Modification","Victor Sergeev, oscd.community, Nasreddine Bencherchali (Nextron Systems)","Detects service path modification via the ""sc"" binary to a suspicious command or path","attack.persistence, attack.privilege_escalation, attack.t1543.003","process_creation","windows","Not classified","Review the CommandLine and ParentCommandLine fields in process creation logs for instances where the sc.exe binary is used with suspicious commands or paths. 
Windows Security Event Logs (Event ID 4688) can provide process creation information. 
Sysmon logs can also be useful for capturing process creation events. 
Look for patterns of sc.exe being used with commands such as powershell, cmd, mshta, wscript, cscript, rundll32, svchost, dllhost, cmd.exe /c, cmd.exe /k, cmd.exe /r, cmd /c, cmd /k, cmd /r. 
Pay attention to modifications of service paths to suspicious locations such as C\Users\Public, \Downloads\, \Desktop\, \Microsoft\Windows\Start Menu\Programs\Startup\, C\Windows\TEMP\, \AppData\Local\Temp. 
Investigate the purpose and intent behind the modification. Is it a known legitimate change or does it align with malicious activity?","There may be legitimate cases where the sc.exe binary is used to modify service paths for valid reasons. It is important to investigate the context and intent behind the modification before considering it as a true positive.","Image=""*\\sc.exe"" CommandLine=""*config*"" CommandLine=""*binPath*"" CommandLine IN (""*powershell*"", ""*cmd *"", ""*mshta*"", ""*wscript*"", ""*cscript*"", ""*rundll32*"", ""*svchost*"", ""*dllhost*"", ""*cmd.exe /c*"", ""*cmd.exe /k*"", ""*cmd.exe /r*"", ""*cmd /c*"", ""*cmd /k*"", ""*cmd /r*"", ""*C:\\Users\\Public*"", ""*\\Downloads\\*"", ""*\\Desktop\\*"", ""*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*"", ""*C:\\Windows\\TEMP\\*"", ""*\\AppData\\Local\\Temp*"")"
"Suspicious Shim Database Installation via Sdbinst.EXE","Nasreddine Bencherchali (Nextron Systems)","Detects installation of a potentially suspicious new shim with an uncommon extension using sdbinst.exe.
Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims
","attack.persistence, attack.privilege_escalation, attack.t1546.011","process_creation","windows","Not classified","Review process creation logs for instances of sdbinst.exe being executed with an uncommon extension (.sdb). 
Check the command line arguments used with sdbinst.exe to identify any suspicious or unusual parameters. 
Analyze the parent process of sdbinst.exe to determine if it is a legitimate process like svchost.exe. 
Inspect the file being installed by sdbinst.exe with an uncommon extension to determine if it is a known legitimate shim or potentially malicious.","Legitimate shim installations by trusted software vendors","Image=""*\\sdbinst.exe"" OR OriginalFileName=""sdbinst.exe"" NOT (CommandLine=""*.sdb*"" OR (ParentImage=""*:\\Windows\\System32\\svchost.exe"" Image=""*:\\Windows\\System32\\sdbinst.exe"" CommandLine=""* -m -bg*"") OR (ParentImage=""*:\\Windows\\System32\\svchost.exe"" Image=""*:\\Windows\\System32\\sdbinst.exe"" CommandLine=""* -mm""))"
"Sdiagnhost Calling Suspicious Child Process","Nextron Systems","Detects sdiagnhost.exe calling a suspicious child process (e.g. used in exploits for Follina / CVE-2022-30190)","attack.defense_evasion, attack.t1036, attack.t1218","process_creation","windows","Not classified","Review process creation logs for instances of sdiagnhost.exe calling any of the listed child processes. Look for any suspicious or unauthorized activity associated with these processes, such as unusual command-line arguments or execution from unexpected locations. Cross-reference with other security events or indicators of compromise (IOCs) to determine if the activity is part of a known attack or exploit.","Legitimate use of sdiagnhost.exe calling the listed child processes for system administration or troubleshooting purposes.","ParentImage=""*\\sdiagnhost.exe"" Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\cmd.exe"", ""*\\mshta.exe"", ""*\\cscript.exe"", ""*\\wscript.exe"", ""*\\taskkill.exe"", ""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\calc.exe"")"
"Suspicious Serv-U Process Pattern","Florian Roth (Nextron Systems)","Detects a suspicious process pattern which could be a sign of an exploited Serv-U service","attack.credential_access, attack.t1555, cve.2021.35211","process_creation","windows","Not classified","Check the process creation logs on Windows systems for instances of Serv-U.exe being launched with suspicious parent processes such as cmd.exe, powershell.exe, pwsh.exe, wscript.exe, cscript.exe, sh.exe, bash.exe, schtasks.exe, regsvr32.exe, wmic.exe, mshta.exe, rundll32.exe, msiexec.exe, forfiles.exe, scriptrunner.exe. 
Review the command-line arguments and parameters passed to Serv-U.exe to identify any suspicious or unauthorized activity. 
Cross-reference the timestamps of the process creation events with other security logs, such as network traffic logs or authentication logs, to identify any correlated suspicious activities. 
If possible, analyze the memory or disk artifacts associated with the suspicious process to identify any indicators of compromise or malicious behavior.","Legitimate uses in which users or programs use the SSH service of Serv-U for remote command execution","ParentImage=""*\\Serv-U.exe"" Image IN (""*\\cmd.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\wscript.exe"", ""*\\cscript.exe"", ""*\\sh.exe"", ""*\\bash.exe"", ""*\\schtasks.exe"", ""*\\regsvr32.exe"", ""*\\wmic.exe"", ""*\\mshta.exe"", ""*\\rundll32.exe"", ""*\\msiexec.exe"", ""*\\forfiles.exe"", ""*\\scriptrunner.exe"")"
"Suspicious Splwow64 Without Params","Florian Roth (Nextron Systems)","Detects suspicious Splwow64.exe process without any command line parameters","attack.defense_evasion, attack.t1202","process_creation","windows","Not classified","1. Check the parent process of Splwow64.exe to determine if it is launched from a legitimate source or if it is spawned by a suspicious process. 
2. Review the command line arguments of the parent process to see if it includes any suspicious or unusual parameters. 
3. Analyze the network connections made by Splwow64.exe to identify any suspicious communication. 
4. Check for any other suspicious activities or indicators of compromise associated with Splwow64.exe, such as file modifications or registry changes. 
5. Compare the behavior of the Splwow64.exe process with known legitimate behavior to identify any anomalies or deviations.","Legitimate use of Splwow64.exe without command line parameters","Image=""*\\splwow64.exe"" CommandLine=""*splwow64.exe"""
"Suspicious Spool Service Child Process","Justin C. (@endisphotic), @dreadphones (detection), Thomas Patzke (Sigma rule)","Detects suspicious print spool service (spoolsv.exe) child processes.","attack.execution, attack.t1203, attack.privilege_escalation, attack.t1068","process_creation","windows","Not classified","Check the process tree to identify the parent process of the suspicious child process. Look for any abnormal or unexpected parent processes. 
Review the command line arguments of the suspicious child process to identify any unusual or malicious behavior. 
Check the integrity level of the suspicious child process to determine if it is running with elevated privileges. 
Monitor network connections and traffic associated with the suspicious child process to identify any suspicious or unauthorized activity. 
Analyze any related logs, such as firewall logs, DNS logs, or proxy logs, to gather additional information about the suspicious child process. 
Compare the suspicious child process with known good processes to identify any discrepancies or anomalies. 
If available, review the digital signature of the suspicious child process to determine if it is signed by a trusted entity. 
Consult threat intelligence sources and security forums to check if the suspicious child process is associated with any known malware or attack techniques.","Unknown","ParentImage=""*\\spoolsv.exe"" IntegrityLevel=""System"" Image IN (""*\\gpupdate.exe"", ""*\\whoami.exe"", ""*\\nltest.exe"", ""*\\taskkill.exe"", ""*\\wmic.exe"", ""*\\taskmgr.exe"", ""*\\sc.exe"", ""*\\findstr.exe"", ""*\\curl.exe"", ""*\\wget.exe"", ""*\\certutil.exe"", ""*\\bitsadmin.exe"", ""*\\accesschk.exe"", ""*\\wevtutil.exe"", ""*\\bcdedit.exe"", ""*\\fsutil.exe"", ""*\\cipher.exe"", ""*\\schtasks.exe"", ""*\\write.exe"", ""*\\wuauclt.exe"", ""*\\systeminfo.exe"", ""*\\reg.exe"", ""*\\query.exe"") OR (Image IN (""*\\net.exe"", ""*\\net1.exe"") NOT CommandLine=""*start*"") OR (Image=""*\\cmd.exe"" NOT (CommandLine IN (""*.spl*"", ""*route add*"", ""*program files*""))) OR (Image=""*\\netsh.exe"" NOT (CommandLine IN (""*add portopening*"", ""*rule name*""))) OR (Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") NOT CommandLine=""*.spl*"") OR (Image=""*\\rundll32.exe"" OR OriginalFileName=""RUNDLL32.EXE"" CommandLine=""*rundll32.exe"")"
"VeeamBackup Database Credentials Dump Via Sqlcmd.EXE","frack113","Detects dump of credentials in VeeamBackup dbo","attack.collection, attack.t1005","process_creation","windows","Not classified","Check the process creation logs for instances of sqlcmd.exe being executed. 
Look for command line arguments containing SELECT, TOP, and [VeeamBackup].[dbo].[Credentials]. 
Verify if the execution of sqlcmd.exe with these command line arguments is authorized and expected. 
Review any relevant documentation or change management records to confirm the purpose of the sqlcmd.exe execution.","Legitimate use of sqlcmd.exe for authorized database operations. 
Use of SELECT and TOP in command line arguments for other legitimate purposes. 
Use of [VeeamBackup].[dbo].[Credentials] in command line arguments for authorized operations.","Image=""*\\sqlcmd.exe"" CommandLine=""*SELECT*"" CommandLine=""*TOP*"" CommandLine=""*[VeeamBackup].[dbo].[Credentials]*"""
"Execution via stordiag.exe","Austin Songer (@austinsonger)","Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe","attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Check the command-line arguments of stordiag.exe and the associated child processes (schtasks.exe, systeminfo.exe, fltmc.exe) for any suspicious or unexpected values. 
Review the parent process of stordiag.exe to determine if it is being launched from a legitimate location (e.g., c\windows\system32\). 
Analyze the network connections made by stordiag.exe and the child processes to identify any unusual or malicious communication. 
Inspect the file properties and digital signatures of stordiag.exe and the associated executables to ensure they are legitimate and have not been tampered with. 
Correlate the execution of stordiag.exe with other security events or indicators of compromise to identify any patterns or additional malicious activity.","Legitimate usage of stordiag.exe for system diagnostics or troubleshooting purposes.","ParentImage=""*\\stordiag.exe"" Image IN (""*\\schtasks.exe"", ""*\\systeminfo.exe"", ""*\\fltmc.exe"") NOT (ParentImage IN (""c:\\windows\\system32\\*"", ""c:\\windows\\syswow64\\*""))"
"Abused Debug Privilege by Arbitrary Parent Processes","Semanur Guneysu @semanurtg, oscd.community","Detection of unusual child processes by different system processes","attack.privilege_escalation, attack.t1548","process_creation","windows","Not classified","Review the ParentImage field to identify the parent processes. Look for any unusual or unexpected parent processes that are not commonly associated with the child processes. 
Examine the Image field to identify the child processes. Pay attention to any instances of powershell.exe, pwsh.exe, or cmd.exe that are spawned by the unusual parent processes. 
Check the User field to determine the user account associated with the parent and child processes. Look for any suspicious or unauthorized user accounts. 
Analyze the CommandLine field to identify any instances of route or ADD commands. These commands are commonly used for network configuration and may indicate legitimate administrative tasks or potential abuse of debug privileges. 
Correlate the information from the different fields to identify any patterns or anomalies that suggest privilege escalation or unauthorized activity. 
If possible, cross-reference the detected activity with other log sources such as network logs, authentication logs, or file system logs to gather additional context and evidence of malicious activity.","Legitimate administrative tasks that involve adding or modifying routes in the network configuration 
Authorized use of PowerShell, pwsh, or cmd.exe for system administration or scripting purposes 
Legitimate child processes spawned by system processes for normal operations","ParentImage IN (""*\\winlogon.exe"", ""*\\services.exe"", ""*\\lsass.exe"", ""*\\csrss.exe"", ""*\\smss.exe"", ""*\\wininit.exe"", ""*\\spoolsv.exe"", ""*\\searchindexer.exe"") User IN (""*AUTHORI*"", ""*AUTORI*"") Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\cmd.exe"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"", ""Cmd.Exe"") NOT (CommandLine=""* route *"" CommandLine=""* ADD *"")"
"Suspicious Add User to Remote Desktop Users Group","Florian Roth (Nextron Systems)","Detects suspicious command line in which a user gets added to the local Remote Desktop Users group","attack.persistence, attack.lateral_movement, attack.t1133, attack.t1136.001, attack.t1021.001","process_creation","windows","Not classified","Check the parent process of the suspicious command line to determine if it is a legitimate administrative activity. 
Review the user account that was added to the Remote Desktop Users group and verify if it is authorized. 
Cross-reference the event with other security logs, such as authentication logs, to identify any suspicious or unauthorized activity associated with the added user. 
If possible, check the source IP address or hostname from where the command was executed to identify any potential malicious activity. 
Consult with the system owner or relevant stakeholders to confirm if the activity was expected or if it aligns with any ongoing administrative tasks or projects.","Administrative activity where legitimate users are added to the Remote Desktop Users group for authorized access.","(CommandLine=""*localgroup *"" CommandLine=""* /add*"") OR (CommandLine=""*Add-LocalGroupMember *"" CommandLine=""* -Group *"") CommandLine IN (""*Remote Desktop Users*"", ""*Utilisateurs du Bureau  distance*"", ""*Usuarios de escritorio remoto*"")"
"Phishing Pattern ISO in Archive","Florian Roth (Nextron Systems)","Detects cases in which an ISO files is opend within an archiver like 7Zip or Winrar, which is a sign of phishing as threat actors put small ISO files in archives as email attachments to bypass certain filters and protective measures (mark of web)","attack.initial_access, attack.t1566","process_creation","windows","Not classified","Check the process creation logs for instances where an ISO file is opened within an archiver like Winrar, 7Zip, or PeaZip, and the parent process is one of these archiver executables (Winrar.exe, 7zFM.exe, peazip.exe). 
Verify if the ISO file is being opened directly from the archive without extraction. 
Review the context of the event, including the user, source IP, and any other relevant information. 
If the event is determined to be a false positive, add the necessary exclusions to prevent future alerts.","Legitimate cases in which archives contain ISO or IMG files and the user opens the archive and the image via clicking and not extraction","ParentImage IN (""*\\Winrar.exe"", ""*\\7zFM.exe"", ""*\\peazip.exe"") Image IN (""*\\isoburn.exe"", ""*\\PowerISO.exe"", ""*\\ImgBurn.exe"")"
"Suspicious Calculator Usage","Florian Roth (Nextron Systems)","Detects suspicious use of 'calc.exe' with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion","attack.defense_evasion, attack.t1036","process_creation","windows","Not classified","Review the command line parameters used with calc.exe to identify any suspicious or unexpected values. 
Check the parent process and user context to determine if the execution of calc.exe is part of a legitimate workflow or if it is being used for malicious purposes. 
Analyze the directory path of calc.exe to determine if it is located in a suspicious or unexpected location. 
Correlate the calc.exe execution with other security events or indicators of compromise to identify any patterns or anomalies.","Legitimate use of calc.exe in specific scenarios, such as system administration or troubleshooting","CommandLine=""*\\calc.exe *"" OR (Image=""*\\calc.exe"" NOT (Image IN (""C:\\Windows\\System32\\*"", ""C:\\Windows\\SysWOW64\\*"", ""C:\\Windows\\WinSxS\\*"")))"
"Suspicious Child Process Created as System","Teymur Kheirkhabarov, Roberto Rodriguez (@Cyb3rWard0g), Open Threat Research (OTR)","Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts","attack.privilege_escalation, attack.t1134.002","process_creation","windows","Not classified","Check the process creation logs from Windows Event Logs or Sysmon logs. 
Look for child processes spawned with SYSTEM privileges. 
Identify the parent processes with LOCAL SERVICE or NETWORK SERVICE accounts. 
Verify the integrity level of the child process is System. 
Check if the command line of the child process contains DavSetCookie when the image name is rundll32.exe.","Unknown","ParentUser IN (""*AUTHORI*"", ""*AUTORI*"") ParentUser IN (""*\\NETWORK SERVICE"", ""*\\LOCAL SERVICE"") User IN (""*AUTHORI*"", ""*AUTORI*"") User IN (""*\\SYSTEM"", ""*\\Systme"", ""*\\"") IntegrityLevel=""System"" NOT (Image=""*\\rundll32.exe"" CommandLine=""*DavSetCookie*"")"
"Potential Commandline Obfuscation Using Unicode Characters","frack113, Florian Roth (Nextron Systems)","Detects potential commandline obfuscation using unicode characters.
Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit.
","attack.defense_evasion, attack.t1027","process_creation","windows","Not classified","Review the commandline arguments of the process creation events for the presence of the Unicode characters mentioned in the rule. 
Check if the presence of these Unicode characters is part of a legitimate use case or if it indicates obfuscation or evasion techniques. 
Correlate the process creation events with other security events to identify any suspicious or malicious activities. 
Consult with the system owner or application developer to understand if the use of Unicode characters in commandline arguments is expected or not. 
If necessary, analyze the process behavior and network traffic to determine the intent and impact of the commandline obfuscation.","Legitimate use of Unicode characters in commandline arguments","CommandLine IN (""**"", ""**"", ""**"") OR CommandLine IN (""**"", ""**"") OR CommandLine IN (""**"", ""**"") OR CommandLine IN (""**"", ""**"", ""**"", ""**"", ""**"", ""**"", ""**"")"
"Copy from Admin Share","Florian Roth (Nextron Systems), oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st, Nasreddine Bencherchali","Detects a suspicious copy command to or from an Admin share or remote","attack.lateral_movement, attack.collection, attack.exfiltration, attack.t1039, attack.t1048, attack.t1021.002","process_creation","windows","Not classified","Check if the copy command is being executed from or to an Admin share or remote location. 
Review the command line arguments of the process to identify the source and destination paths. 
Analyze the process creation logs to determine the user account responsible for the copy command. 
Cross-reference the activity with other security events to identify any suspicious or malicious behavior. 
If the copy command is being executed by an administrative script, verify its legitimacy and purpose. 
If the copy command is being executed by a legitimate user, investigate the intent and context of the action. 
Consider checking for any indicators of compromise (IOCs) associated with known threats or attack techniques. 
Consult relevant documentation and security resources to understand the potential impact and risks associated with the detected activity.","Administrative scripts","(CommandLine=""*\\\\*"" CommandLine=""*$*"") OR CommandLine=""*\\Sysvol\\*"" Image IN (""*\\robocopy.exe"", ""*\\xcopy.exe"") OR OriginalFileName IN (""robocopy.exe"", ""XCOPY.EXE"") OR (Image=""*\\cmd.exe"" OR OriginalFileName=""Cmd.Exe"" CommandLine=""*copy*"") OR (Image IN (""*\\powershell.exe*"", ""*\\pwsh.exe*"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"") CommandLine IN (""*copy-item*"", ""*copy *"", ""*cpi *"", ""* cp *"", ""*move *"", ""*move-item*"", ""* mi *"", ""* mv *""))"
"Potential Crypto Mining Activity","Florian Roth (Nextron Systems)","Detects command line parameters or strings often used by crypto miners","attack.impact, attack.t1496","process_creation","windows","Not classified","Check the process creation logs for command lines containing the following strings 
--cpu-priority= 
--donate-level=0 
-o pool. 
--nicehash 
--algo=rx/0 
['stratum+tcp//'] 
['stratum+udp//'] 
['LS1kb25hdGUtbGV2ZWw9'] 
['0tZG9uYXRlLWxldmVsP'] 
['tLWRvbmF0ZS1sZXZlbD'] 
['c3RyYXR1bSt0Y3A6Ly'] 
['N0cmF0dW0rdGNwOi8v'] 
['zdHJhdHVtK3RjcDovL'] 
['c3RyYXR1bSt1ZHA6Ly'] 
['N0cmF0dW0rdWRwOi8v'] 
['zdHJhdHVtK3VkcDovL'] 
Additionally, filter out command lines containing the following strings 
['pool.c'] 
['pool.o'] 
['gcc -'] 
Investigate any process with a command line matching the selection criteria but not the filter criteria as potential crypto mining activity. 
Consider the context of the process, its parent-child relationship, and any associated network connections to determine if the activity is suspicious or legitimate. 
If necessary, correlate with other logs such as network traffic logs, file system logs, or endpoint protection logs to gather more evidence of crypto mining activity.","Legitimate use of crypto miners 
Some build frameworks","CommandLine IN (""* --cpu-priority=*"", ""*--donate-level=0*"", ""* -o pool.*"", ""* --nicehash*"", ""* --algo=rx/0 *"", ""*stratum+tcp://*"", ""*stratum+udp://*"", ""*LS1kb25hdGUtbGV2ZWw9*"", ""*0tZG9uYXRlLWxldmVsP*"", ""*tLWRvbmF0ZS1sZXZlbD*"", ""*c3RyYXR1bSt0Y3A6Ly*"", ""*N0cmF0dW0rdGNwOi8v*"", ""*zdHJhdHVtK3RjcDovL*"", ""*c3RyYXR1bSt1ZHA6Ly*"", ""*N0cmF0dW0rdWRwOi8v*"", ""*zdHJhdHVtK3VkcDovL*"") NOT (CommandLine IN (""* pool.c *"", ""* pool.o *"", ""*gcc -*""))"
"Raccine Uninstall","Florian Roth (Nextron Systems)","Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool.","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check the command line of the process creation events for the presence of the following commands 
1. taskkill and RaccineSettings.exe 
2. reg.exe, delete, and Raccine Tray 
3. schtasks, /DELETE, and Raccine Rules Updater 
Verify if the commands are executed by authorized personnel or if they are suspicious in nature. 
Review the process creation logs from the Windows event logs or any other relevant log sources.","Legitimate deinstallation by administrative staff","(CommandLine=""*taskkill *"" CommandLine=""*RaccineSettings.exe*"") OR (CommandLine=""*reg.exe*"" CommandLine=""*delete*"" CommandLine=""*Raccine Tray*"") OR (CommandLine=""*schtasks*"" CommandLine=""*/DELETE*"" CommandLine=""*Raccine Rules Updater*"")"
"Suspicious Double Extension File Execution","Florian Roth (Nextron Systems), @blu3_team (idea), Nasreddine Bencherchali (Nextron Systems)","Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns","attack.initial_access, attack.t1566.001","process_creation","windows","Not classified","Check the process creation logs for any suspicious command lines containing double extension files 
Look for any unusual file extensions or patterns in the file names 
Analyze the parent process and its reputation 
Check if the file is being executed from a suspicious location or by an unauthorized user 
Cross-reference with other security events or alerts to identify any related suspicious activities 
If possible, analyze the file using sandboxing or other security tools to determine its behavior and potential maliciousness","Legitimate use of double extension files in certain applications or environments 
False positives may occur when files are compressed or encrypted","Image IN (""*.doc.exe"", ""*.docx.exe"", ""*.xls.exe"", ""*.xlsx.exe"", ""*.ppt.exe"", ""*.pptx.exe"", ""*.rtf.exe"", ""*.pdf.exe"", ""*.txt.exe"", ""*      .exe"", ""*______.exe"", ""*.doc.js"", ""*.docx.js"", ""*.xls.js"", ""*.xlsx.js"", ""*.ppt.js"", ""*.pptx.js"", ""*.rtf.js"", ""*.pdf.js"", ""*.txt.js"") CommandLine IN (""*.doc.exe*"", ""*.docx.exe*"", ""*.xls.exe*"", ""*.xlsx.exe*"", ""*.ppt.exe*"", ""*.pptx.exe*"", ""*.rtf.exe*"", ""*.pdf.exe*"", ""*.txt.exe*"", ""*      .exe*"", ""*______.exe*"", ""*.doc.js*"", ""*.docx.js*"", ""*.xls.js*"", ""*.xlsx.js*"", ""*.ppt.js*"", ""*.pptx.js*"", ""*.rtf.js*"", ""*.pdf.js*"", ""*.txt.js*"")"
"Suspicious Download from Office Domain","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects suspicious ways to download files from Microsoft domains that are used to store attachments in Emails or OneNote documents","attack.command_and_control, attack.t1105, attack.t1608","process_creation","windows","Not classified","Check the process creation logs for the presence of suspicious download tools such as curl.exe or wget.exe 
Look for command-line arguments that indicate the use of suspicious download commands like Invoke-WebRequest, iwr, curl, wget, Start-BitsTransfer, .DownloadFile(), or .DownloadString() 
Inspect the command-line arguments for the presence of the suspicious Microsoft domains https//attachment.outlook.live.net/owa/ and https//onenoteonlinesync.onenote.com/onenoteonlinesync/ 
Review the context of the suspicious activity to determine if it is expected or anomalous 
Cross-reference the activity with other security events or indicators of compromise to identify any related malicious behavior","Scripts or tools that legitimately download attachments from these domains (OneNote, Outlook 365)","Image IN (""*\\curl.exe"", ""*\\wget.exe"") OR CommandLine IN (""*Invoke-WebRequest*"", ""*iwr *"", ""*curl *"", ""*wget *"", ""*Start-BitsTransfer*"", ""*.DownloadFile(*"", ""*.DownloadString(*"") CommandLine IN (""*https://attachment.outlook.live.net/owa/*"", ""*https://onenoteonlinesync.onenote.com/onenoteonlinesync/*"")"
"DumpStack.log Defender Evasion","Florian Roth (Nextron Systems)","Detects the use of the filename DumpStack.log to evade Microsoft Defender","attack.defense_evasion","process_creation","windows","Not classified","Review process creation logs from Windows event logs (Event ID 4688) for instances where the Image ends with \DumpStack.log 
Check for command-line arguments containing -o DumpStack.log in process creation logs (Event ID 4688)","Legitimate use of DumpStack.log for troubleshooting purposes","Image=""*\\DumpStack.log"" OR CommandLine=""* -o DumpStack.log*"""
"ETW Logging Tamper In .NET Processes","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)","Detects changes to environment variables related to ETW logging. This could indicate potential adversaries stopping ETW providers recording loaded .NET assemblies.","attack.defense_evasion, attack.t1562","process_creation","windows","Not classified","Search your SIEM for process creation events that match this rule. 
Examine the ""CommandLine"" field in the events to identify instances where the ""COMPlus_ETWEnabled"" and ""COMPlus_ETWFlags"" environment variables are being manipulated. 
Investigate the associated process, parent process, and the user account responsible for the execution. 
Analyze the changes made to these environment variables and their potential impact on ETW logging. 
Determine if the activity is legitimate or indicative of potential tampering with ETW logging by adversaries. 
If suspicious activity is identified, take immediate action and conduct a more comprehensive investigation to understand the extent of the threat.","False positives are unlikely as the rule is specifically designed to detect potential tampering with ETW logging environment variables, which is not a common or legitimate operation in most environments.","CommandLine IN (""*COMPlus_ETWEnabled*"", ""*COMPlus_ETWFlags*"")"
"Disable of ETW Trace","@neu5ron, Florian Roth (Nextron Systems), Jonhnathan Ribeiro, oscd.community","Detects a command that clears or disables any ETW trace log which could indicate a logging evasion.","attack.defense_evasion, attack.t1070, attack.t1562.006, car.2016-04-002","process_creation","windows","Not classified","Search your SIEM for process creation events that match this rule. 
Examine the ""CommandLine"" field in the events to identify instances where the listed commands or PowerShell cmdlets are used to clear or disable ETW trace logs. 
Investigate the associated process, parent process, and the user account responsible for the execution. 
Determine if the activity is legitimate or indicative of potential logging evasion. 
Verify the purpose and intent behind clearing or disabling the ETW trace, as legitimate actions might occur in some scenarios. 
Assess the impact of the action and evaluate whether additional security measures or investigations are needed.","False positives are possible when legitimate system maintenance or monitoring tasks involve clearing or disabling ETW trace logs. These actions may be performed by authorized administrators for specific purposes.","(CommandLine=""*cl*"" CommandLine=""*/Trace*"") OR (CommandLine=""*clear-log*"" CommandLine=""*/Trace*"") OR (CommandLine=""*sl*"" CommandLine=""*/e:false*"") OR (CommandLine=""*set-log*"" CommandLine=""*/e:false*"") OR (CommandLine=""*logman*"" CommandLine=""*update*"" CommandLine=""*trace*"" CommandLine=""*--p*"" CommandLine=""*-ets*"") OR CommandLine=""*Remove-EtwTraceProvider*"" OR (CommandLine=""*Set-EtwTraceProvider*"" CommandLine=""*0x11*"")"
"Suspicious Eventlog Clear or Configuration Change","Ecco, Daniil Yugoslavskiy, oscd.community, D3F7A5105","Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others).","attack.defense_evasion, attack.t1070.001, attack.t1562.002, car.2016-04-002","process_creation","windows","Not classified","Check if the eventlog clearing or configuration was performed by an authorized administrator or system process. 
Review the command line arguments of the process to determine if it matches the known patterns for eventlog clearing or configuration. 
Cross-reference the eventlog clearing or configuration activity with other security events or logs to identify any suspicious or malicious behavior. 
Investigate any associated network traffic or file activity that may be related to the eventlog clearing or configuration. 
If possible, analyze the memory or disk artifacts of the system to identify any additional evidence of malicious activity.","Admin activity 
Scripts and administrative tools used in the monitored environment 
Maintenance activity","(Image=""*\\wevtutil.exe"" CommandLine IN (""*clear-log *"", ""* cl *"", ""*set-log *"", ""* sl *"", ""*lfn:*"")) OR (Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"") CommandLine IN (""*Clear-EventLog *"", ""*Remove-EventLog *"", ""*Limit-EventLog *"", ""*Clear-WinEvent *"")) OR (Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\wmic.exe"") CommandLine=""*ClearEventLog*"") NOT (ParentImage IN (""C:\\Windows\\SysWOW64\\msiexec.exe"", ""C:\\Windows\\System32\\msiexec.exe"") CommandLine=""* sl *"")"
"Parent in Public Folder Suspicious Process","Florian Roth (Nextron Systems)","This rule detects suspicious processes with parent images located in the C:\Users\Public folder","attack.defense_evasion, attack.execution, attack.t1564, attack.t1059","process_creation","windows","Not classified","1. Check the ParentImage field in the process creation logs to identify the parent image of the suspicious process. Example log source Windows Security Event Logs (Event ID 4688). 
2. Review the CommandLine field in the process creation logs to understand the specific command used to launch the suspicious process. Example log source Sysmon logs (Event ID 1). 
3. Validate the legitimacy of the process by cross-referencing with known legitimate processes that are commonly launched from the C\Users\Public folder. Example log source Endpoint protection logs (e.g., Windows Defender, Symantec Endpoint Protection). 
4. Analyze any additional contextual information available, such as the user associated with the process and the computer name, to determine if the activity is expected or suspicious.","Legitimate processes launched from the C\Users\Public folder","ParentImage=""C:\\Users\\Public\\*"" CommandLine IN (""*powershell*"", ""*cmd.exe /c *"", ""*cmd.exe /r *"", ""*cmd.exe /k *"", ""*cmd /c *"", ""*cmd /r *"", ""*cmd /k *"", ""*wscript.exe*"", ""*cscript.exe*"", ""*bitsadmin*"", ""*certutil*"", ""*mshta.exe*"")"
"Suspicious Reconnaissance Activity Via GatherNetworkInfo.VBS","Nasreddine Bencherchali (Nextron Systems)","Detects execution of the built-in script located in ""C:\Windows\System32\gatherNetworkInfo.vbs"". Which can be used to gather information about the target machine","attack.discovery, attack.execution, attack.t1615, attack.t1059.005","process_creation","windows","Not classified","Check the command line of the process to confirm if it contains gatherNetworkInfo.vbs. 
Review the parent process and command line arguments to identify the context of the execution. 
Analyze the network traffic generated by the system during the execution of gatherNetworkInfo.vbs to identify any suspicious communication. 
Cross-reference the execution with other logs such as file access logs, registry logs, or PowerShell logs to gather additional context. 
Compare the execution with known legitimate use cases of gatherNetworkInfo.vbs in your environment.","Legitimate use of gatherNetworkInfo.vbs for system administration or troubleshooting purposes. 
Execution of similar scripts with different names or locations.","CommandLine=""*gatherNetworkInfo.vbs*"" NOT (Image IN (""*\\cscript.exe"", ""*\\wscript.exe""))"
"Execution Of Non-Existing File","Max Altgelt (Nextron Systems)","Checks whether the image specified in a process creation event is not a full, absolute path (caused by process ghosting or other unorthodox methods to start a process)","attack.defense_evasion","process_creation","windows","Not classified","Investigate the process creation event logs from the specified log source (Windows process_creation logs) for events where the Image field does not contain a full, absolute path. 
Check if the process creation events with non-existing file paths are associated with any known legitimate processes or applications. 
Review the command line arguments (if available) for any suspicious or unorthodox methods used to start a process. 
Cross-reference the process creation events with other security logs (e.g., network logs, endpoint logs) to identify any additional suspicious activity or indicators of compromise.","Legitimate use of relative paths in process creation events","NOT Image=""*\\*"" NOT (Image!=* OR Image IN (""-"", """") OR Image IN (""System"", ""Registry"", ""MemCompression"", ""vmmem"") OR CommandLine IN (""Registry"", ""MemCompression"", ""vmmem""))"
"Base64 MZ Header In CommandLine","Nasreddine Bencherchali (Nextron Systems)","Detects encoded base64 MZ header in the commandline","attack.execution","process_creation","windows","Not classified","Review process creation logs from Windows event logs or other relevant log sources such as Sysmon or EDR solutions. 
Look for processes with command lines containing the base64 encoded MZ header values mentioned in the rule. 
Check if the process is associated with any suspicious or unauthorized activity. 
Investigate the process further to determine its legitimacy and potential malicious intent. 
Consider correlating the process execution with other security events or indicators of compromise to gain more context.","Legitimate use of encoded base64 MZ header in the commandline","CommandLine IN (""*TVqQAAMAAAAEAAAA*"", ""*TVpQAAIAAAAEAA8A*"", ""*TVqAAAEAAAAEABAA*"", ""*TVoAAAAAAAAAAAAA*"", ""*TVpTAQEAAAAEAAAA*"")"
"LSASS Dump Keyword In CommandLine","E.M. Anhaus, Tony Lambert, oscd.community, Nasreddine Bencherchali (Nextron Systems)","Detects the presence of the keywords ""lsass"" and "".dmp"" in the commandline, which could indicate a potential attempt to dump or create a dump of the lsass process.
","attack.credential_access, attack.t1003.001","process_creation","windows","Not classified","To investigate this detection, you can perform the following steps 
Identify the affected system where the detection occurred. 
Collect process creation logs from the identified system. 
Look for the presence of the lsass keyword in the CommandLine field of the process creation logs. 
Check if the .dmp extension is also present in the CommandLine field. 
Analyze the user account associated with the process creation event. 
Determine if the action was performed by a legitimate user or if it is suspicious. 
If the action was performed by a legitimate user, verify if it was part of a known troubleshooting or debugging process. 
If the action was performed by an unauthorized or suspicious user, further investigation is required to determine the intent and impact of the activity. 
Correlate the detection with other security events or indicators of compromise to assess the overall security posture of the system. 
Consult with the system owner or relevant stakeholders to validate the legitimacy of the lsass dump activity.","There may be legitimate cases where the lsass process is legitimately dumped for troubleshooting or debugging purposes. It is important to investigate the context and the user responsible for the action before considering it a false positive.","CommandLine IN (""*lsass.dmp*"", ""*lsass.zip*"", ""*lsass.rar*"", ""*Andrew.dmp*"", ""*Coredump.dmp*"", ""*NotLSASS.zip*"", ""*lsass_2*"", ""*lsassdump*"", ""*lsassdmp*"") OR (CommandLine=""*lsass*"" CommandLine=""*.dmp*"") OR (CommandLine=""*SQLDmpr*"" CommandLine=""*.mdmp*"") OR (CommandLine=""*nanodump*"" CommandLine=""*.dmp*"")"
"Non-privileged Usage of Reg or Powershell","Teymur Kheirkhabarov (idea), Ryan Plas (rule), oscd.community","Search for usage of reg or Powershell by non-privileged users to modify service configuration in registry","attack.defense_evasion, attack.t1112","process_creation","windows","Not classified","Check the EventID field in the process_creation logs to identify the specific event that triggered the detection. 
Review the CommandLine field in the process_creation logs to analyze the command executed by the user. 
Cross-reference the IntegrityLevel field in the process_creation logs to determine the privilege level of the user. 
Look for the presence of keywords such as reg, add, powershell, set-itemproperty, sp, new-itemproperty, ControlSet, Services, ImagePath, FailureCommand, ServiceDLL in the CommandLine field to identify relevant commands. 
Investigate the context of the command execution, including the user account, source IP address, and any associated processes or events. 
If the command execution is performed by a privileged user or authorized non-privileged user for approved tasks, consider it as a legitimate activity. 
If the command execution is performed by an unauthorized or suspicious user, further investigation is required to determine if it is a potential privilege escalation attempt or an indicator of compromise. 
Consult with system administrators or relevant teams to validate the purpose and authorization of the command execution. 
Analyze additional logs such as security logs, audit logs, or endpoint logs to gather more information about the users activities and any potential impact. 
If necessary, escalate the investigation to the incident response team or follow the organizations security incident response procedures.","Legitimate usage of reg or Powershell by privileged users for system administration tasks. 
Usage of reg or Powershell by authorized non-privileged users for approved configuration changes. 
Usage of reg or Powershell by security tools or scripts. 
Usage of reg or Powershell in a lab or testing environment.","(CommandLine=""*reg *"" CommandLine=""*add*"") OR CommandLine IN (""*powershell*"", ""*set-itemproperty*"", ""* sp *"", ""*new-itemproperty*"") IntegrityLevel=""Medium"" CommandLine=""*ControlSet*"" CommandLine=""*Services*"" CommandLine IN (""*ImagePath*"", ""*FailureCommand*"", ""*ServiceDLL*"")"
"Suspicious Process Patterns NTDS.DIT Exfil","Florian Roth (Nextron Systems)","Detects suspicious process patterns used in NTDS.DIT exfiltration","attack.credential_access, attack.t1003.003","process_creation","windows","Not classified","Review the process creation logs for the suspicious process patterns mentioned in the rule. 
Check if the process is associated with any known legitimate administrative tools or scripts. 
Verify if the process is executed by a privileged user or service account. 
Cross-reference the process with other security events or indicators of compromise to determine if it is part of a larger attack. 
If possible, analyze the process behavior using endpoint detection and response (EDR) or sandboxing solutions. 
Consult with the system or network administrators to understand if the process is expected or abnormal in the environment.","Legitimate administrative processes may use similar process patterns for legitimate purposes, such as backup and recovery operations.","Image IN (""*\\NTDSDump.exe"", ""*\\NTDSDumpEx.exe"") OR (CommandLine=""*ntds.dit*"" CommandLine=""*system.hiv*"") OR CommandLine=""*NTDSgrab.ps1*"" OR (CommandLine=""*ac i ntds*"" CommandLine=""*create full*"") OR (CommandLine=""*/c copy *"" CommandLine=""*\\windows\\ntds\\ntds.dit*"") OR (CommandLine=""*activate instance ntds*"" CommandLine=""*create full*"") OR (CommandLine=""*powershell*"" CommandLine=""*ntds.dit*"") OR (CommandLine=""*ntds.dit*"" ParentImage IN (""*\\apache*"", ""*\\tomcat*"", ""*\\AppData\\*"", ""*\\Temp\\*"", ""*\\Public\\*"", ""*\\PerfLogs\\*"") OR Image IN (""*\\apache*"", ""*\\tomcat*"", ""*\\AppData\\*"", ""*\\Temp\\*"", ""*\\Public\\*"", ""*\\PerfLogs\\*""))"
"Suspicious Process Parents","Florian Roth (Nextron Systems)","Detects suspicious parent processes that should not have any children or should only have a single possible child program","attack.defense_evasion, attack.t1036","process_creation","windows","Not classified","Review the process creation logs for the suspicious parent processes and their child processes. 
Check if the parent processes are known to have multiple child processes in legitimate scenarios. 
Analyze the behavior of the child processes to determine if they are malicious or abnormal. 
Cross-reference the process information with threat intelligence sources to identify known malicious parent-child process relationships.","Legitimate processes that may have multiple child processes, such as svchost.exe or explorer.exe","ParentImage IN (""*\\minesweeper.exe"", ""*\\winver.exe"", ""*\\bitsadmin.exe"") OR (ParentImage IN (""*\\csrss.exe"", ""*\\certutil.exe"", ""*\\eventvwr.exe"", ""*\\calc.exe"", ""*\\notepad.exe"") NOT (Image IN (""*\\WerFault.exe"", ""*\\wermgr.exe"", ""*\\conhost.exe"", ""*\\mmc.exe"", ""*\\win32calc.exe"", ""*\\notepad.exe"") OR Image!=*))"
"Privilege Escalation via Named Pipe Impersonation","Tim Rauch","Detects a remote file copy attempt to a hidden network share. This may indicate lateral movement or data staging activity.","attack.lateral_movement, attack.t1021","process_creation","windows","Not classified","Not available","Not available","Image IN (""*\\cmd.exe"", ""*\\powershell.exe"") OR OriginalFileName IN (""Cmd.Exe"", ""PowerShell.EXE"") CommandLine=""*echo*"" CommandLine=""*>*"" CommandLine=""*\\\\.\\pipe\\*"""
"Suspicious Program Names","Florian Roth (Nextron Systems)","Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools","attack.execution, attack.t1059","process_creation","windows","Not classified","Review the CommandLine, ParentCommandLine, and CurrentDirectory fields in process creation logs 
Look for any program names or folders that contain the suspicious patterns mentioned in the rule 
Check if the process is associated with any known legitimate tools or if it matches any known false positives 
If the process is associated with a known legitimate tool, consider it a false positive 
If the process does not match any known legitimate tools or false positives, further investigation may be required 
Investigate the processs behavior, network connections, and any other relevant logs to determine if it is malicious","Legitimate tools that accidentally match on the searched patterns","Image IN (""*\\CVE-202*"", ""*\\CVE202*"") OR Image IN (""*\\poc.exe"", ""*\\artifact.exe"", ""*\\artifact64.exe"", ""*\\artifact_protected.exe"", ""*\\artifact32.exe"", ""*\\artifact32big.exe"", ""*obfuscated.exe"", ""*obfusc.exe"", ""*\\meterpreter"") OR CommandLine IN (""*inject.ps1*"", ""*Invoke-CVE*"", ""*pupy.ps1*"", ""*payload.ps1*"", ""*beacon.ps1*"", ""*PowerView.ps1*"", ""*bypass.ps1*"", ""*obfuscated.ps1*"", ""*obfusc.ps1*"", ""*obfus.ps1*"", ""*obfs.ps1*"", ""*evil.ps1*"", ""*MiniDogz.ps1*"", ""*_enc.ps1*"", ""*\\shell.ps1*"", ""*\\rshell.ps1*"", ""*revshell.ps1*"", ""*\\av.ps1*"", ""*\\av_test.ps1*"", ""*adrecon.ps1*"", ""*mimikatz.ps1*"", ""*\\PowerUp_*"", ""*powerup.ps1*"", ""*\\Temp\\a.ps1*"", ""*\\Temp\\p.ps1*"", ""*\\Temp\\1.ps1*"", ""*Hound.ps1*"", ""*encode.ps1*"", ""*powercat.ps1*"")"
"Suspicious Redirection to Local Admin Share","Florian Roth (Nextron Systems)","Detects a suspicious output redirection to the local admins share, this technique is often found in malicious scripts or hacktool stagers","attack.exfiltration, attack.t1048","process_creation","windows","Not classified","Check the command line of the process creation event for the presence of the > character, indicating output redirection. 
Review the process name and parent process to identify any suspicious or unknown executables. 
Check the destination path in the command line to see if it matches the local admin share path (\\\\127.0.0.1\\admin$\\ or \\\\localhost\\admin$\\). 
Correlate with other events, such as network traffic or file access, to determine if any data exfiltration or unauthorized access has occurred. 
Verify if the activity is part of a legitimate administrative task by consulting system administrators or reviewing documentation. 
If possible, analyze the content of the redirected output to identify any sensitive or confidential information that may have been accessed or exfiltrated.","Legitimate administrative tasks that involve redirection to the local admin share, such as system backups or remote administration tools.","CommandLine=""*>*"" ""\\\\127.0.0.1\\admin$\\"" OR ""\\\\localhost\\admin$\\"""
"Script Interpreter Execution From Suspicious Folder","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects a suspicious script execution in temporary folders or folders accessible by environment variables","attack.execution, attack.t1059","process_creation","windows","Not classified","Search your SIEM for process creation events that match this rule. 
Examine the ""CommandLine"" field in the events to identify instances where suspicious script interpreters are executed from suspicious folders. 
Investigate the associated process, parent process, and the user account responsible for the execution. 
Verify the legitimacy of the action by checking the execution flags and the folder location. 
Determine if the activity is consistent with normal operations or indicative of a potentially malicious script execution. 
Consider additional context and threat intelligence to assess the severity of the alert.","False positives are possible when legitimate applications or scripts are executed from temporary folders or folders accessible by environment variables. This may occur during normal system or application operations.","Image IN (""*\\cscript.exe"", ""*\\mshta.exe"", ""*\\wscript.exe"") OR CommandLine IN (""* -ep bypass *"", ""* -ExecutionPolicy bypass *"", ""* -w hidden *"", ""*/e:javascript *"", ""*/e:Jscript *"", ""*/e:vbscript *"") OR OriginalFileName IN (""cscript.exe"", ""mshta.exe"", ""wscript.exe"") CommandLine IN (""*:\\Perflogs\\*"", ""*:\\Users\\Public\\*"", ""*\\AppData\\Local\\Temp*"", ""*\\AppData\\Roaming\\Temp*"", ""*\\Temporary Internet*"", ""*\\Windows\\Temp*"") OR (CommandLine=""*:\\Users\\*"" CommandLine=""*\\Favorites\\*"") OR (CommandLine=""*:\\Users\\*"" CommandLine=""*\\Favourites\\*"") OR (CommandLine=""*:\\Users\\*"" CommandLine=""*\\Contacts\\*"")"
"Suspicious Script Execution From Temp Folder","Florian Roth (Nextron Systems), Max Altgelt (Nextron Systems), Tim Shelton","Detects a suspicious script executions from temporary folder","attack.execution, attack.t1059","process_creation","windows","Not classified","Review the process creation logs from the Windows event logs or a SIEM 
Look for processes with image paths ending in \powershell.exe, \pwsh.exe, \mshta.exe, \wscript.exe, or \cscript.exe 
Check if the command line contains any of the following paths or environment variables \Windows\Temp, \Temporary Internet, \AppData\Local\Temp, \AppData\Roaming\Temp, %TEMP%, %TMP%, or %LocalAppData%\Temp 
Examine the command line for suspicious keywords such as  >, Out-File, ConvertTo-Json, -WindowStyle hidden -Verb runAs, or \Windows\system32\config\systemprofile\AppData\Local\Temp\Amazon\EC2-Windows\ 
Exclude known false positives, such as administrative scripts 
Cross-reference the suspicious process with other security events or indicators of compromise to determine if further investigation is necessary","Administrative scripts","Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\mshta.exe"", ""*\\wscript.exe"", ""*\\cscript.exe"") CommandLine IN (""*\\Windows\\Temp*"", ""*\\Temporary Internet*"", ""*\\AppData\\Local\\Temp*"", ""*\\AppData\\Roaming\\Temp*"", ""*%TEMP%*"", ""*%TMP%*"", ""*%LocalAppData%\\Temp*"") NOT (CommandLine IN (""* >*"", ""*Out-File*"", ""*ConvertTo-Json*"", ""*-WindowStyle hidden -Verb runAs*"", ""*\\Windows\\system32\\config\\systemprofile\\AppData\\Local\\Temp\\Amazon\\EC2-Windows\\*""))"
"Suspicious New Service Creation","Nasreddine Bencherchali (Nextron Systems)","Detects creation of a new service via ""sc"" command or the powershell ""new-service"" cmdlet with suspicious binary paths","attack.persistence, attack.privilege_escalation, attack.t1543.003","process_creation","windows","Not classified","Review the process creation logs from the log source specified in the rule (Windows process creation logs) 
Look for instances where the sc.exe command or the New-Service cmdlet is used to create a new service 
Examine the command line arguments of the process to identify the binary path used for the new service 
Check if the binary path contains any of the suspicious keywords listed in the rule 
If the binary path is suspicious, investigate further to determine the legitimacy of the service creation 
Cross-reference the service name and binary path with known legitimate services and software installations 
Consult with system administrators or authorized users to confirm if the service creation was authorized 
If the service creation is confirmed to be unauthorized or suspicious, initiate appropriate response and mitigation actions","Legitimate service creation or modification by system administrators or authorized users 
Installation of legitimate software that creates services 
Creation of services with non-suspicious binary paths","(Image=""*\\sc.exe"" CommandLine=""*create*"" CommandLine=""*binPath=*"") OR (CommandLine=""*New-Service*"" CommandLine=""*-BinaryPathName*"") CommandLine IN (""*powershell*"", ""*mshta*"", ""*wscript*"", ""*cscript*"", ""*svchost*"", ""*dllhost*"", ""*cmd *"", ""*cmd.exe /c*"", ""*cmd.exe /k*"", ""*cmd.exe /r*"", ""*rundll32*"", ""*C:\\Users\\Public*"", ""*\\Downloads\\*"", ""*\\Desktop\\*"", ""*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*"", ""*C:\\Windows\\TEMP\\*"", ""*\\AppData\\Local\\Temp*"")"
"Suspicious Service Binary Directory","Florian Roth (Nextron Systems)","Detects a service binary running in a suspicious directory","attack.defense_evasion, attack.t1202","process_creation","windows","Not classified","To investigate this detection, you can perform the following steps 
Review the process creation logs from the Windows event logs or any other relevant log source. 
Look for processes with suspicious binary directories, such as \Users\Public\, \$Recycle.bin\, \Users\All Users\, \Users\Default\, \Users\Contacts\, \Users\Searches\, C\Perflogs\, \config\systemprofile\, \Windows\Fonts\, \Windows\IME\, \Windows\addins\. 
Check the parent process of the suspicious binary to see if it is services.exe or svchost.exe. 
Verify the legitimacy of the binary and its associated directory. Legitimate software installations or updates may place binaries in these directories. 
If the binary is determined to be malicious or suspicious, take appropriate action to contain and remediate the threat, such as isolating the affected system, blocking network communication, and conducting further analysis.","Legitimate software installations or updates may place binaries in these directories.","Image IN (""*\\Users\\Public\\*"", ""*\\$Recycle.bin*"", ""*\\Users\\All Users\\*"", ""*\\Users\\Default\\*"", ""*\\Users\\Contacts\\*"", ""*\\Users\\Searches\\*"", ""*C:\\Perflogs\\*"", ""*\\config\\systemprofile\\*"", ""*\\Windows\\Fonts\\*"", ""*\\Windows\\IME\\*"", ""*\\Windows\\addins\\*"") ParentImage IN (""*\\services.exe"", ""*\\svchost.exe"")"
"Shadow Copies Deletion Using Operating Systems Utilities","Florian Roth (Nextron Systems), Michael Haag, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community, Andreas Hunkeler (@Karneades)","Shadow Copies deletion using operating systems utilities","attack.defense_evasion, attack.impact, attack.t1070, attack.t1490","process_creation","windows","Not classified","Check the command line of the process to see if it contains any of the following keywords shadow and delete. 
Verify if the process is one of the known operating system utilities powershell.exe, pwsh.exe, wmic.exe, vssadmin.exe, diskshadow.exe, or wbadmin.exe. 
Review the parent command line to identify the context and purpose of the process execution. 
Check if the process is executed by a legitimate administrator or a trusted system account. 
Cross-reference the process execution with other security events and logs to identify any suspicious or malicious activities. 
If the process execution is determined to be a false positive, add the process or its associated command line to the list of known false positives for future reference.","Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason 
LANDesk LDClient Ivanti-PSModule (PS EncodedCommand)","(Image IN (""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\wmic.exe"", ""*\\vssadmin.exe"", ""*\\diskshadow.exe"") OR OriginalFileName IN (""PowerShell.EXE"", ""pwsh.dll"", ""wmic.exe"", ""VSSADMIN.EXE"", ""diskshadow.exe"") CommandLine=""*shadow*"" CommandLine=""*delete*"") OR (Image=""*\\wbadmin.exe"" OR OriginalFileName=""WBADMIN.EXE"" CommandLine=""*delete*"" CommandLine=""*catalog*"" CommandLine=""*quiet*"") OR (Image=""*\\vssadmin.exe"" OR OriginalFileName=""VSSADMIN.EXE"" CommandLine=""*resize*"" CommandLine=""*shadowstorage*"" CommandLine IN (""*unbounded*"", ""*/MaxSize=*""))"
"Windows Shell/Scripting Processes Spawning Suspicious Programs","Florian Roth (Nextron Systems), Tim Shelton","Detects suspicious child processes of a Windows shell and scripting processes such as wscript, rundll32, powershell, mshta...etc.","attack.execution, attack.defense_evasion, attack.t1059.005, attack.t1059.001, attack.t1218","process_creation","windows","Not classified","Review the CommandLine, ParentCommandLine, CurrentDirectory, Image, and ParentImage fields of the process creation logs. 
Look for suspicious child processes spawned by Windows shell and scripting processes such as wscript, rundll32, powershell, mshta, etc. 
Pay attention to any unusual or unexpected programs being executed. 
Check if the process is related to any known administrative scripts or legitimate activities. 
For example, if the CommandLine contains \Program Files\Amazon\WorkSpacesConfig\Scripts\setup-scheduledtask.ps1, it may be a legitimate Amazon WorkSpaces configuration script. 
If the CommandLine contains \nessus_, it may be related to Nessus vulnerability scanning. 
If the ParentCommandLine contains C\MEM_Configmgr_ and the CommandLine contains \SMSSETUP\BIN\, it may be part of a Microsoft SCCM installation. 
If the ParentCommandLine contains \mshta.exe and the CommandLine contains \splash.hta or {1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}, it may be a legitimate process related to Microsoft SCCM. 
If the ParentCommandLine contains \mshta.exe and the CommandLine contains \autorun.hta or {1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}, it may be a legitimate process related to Microsoft SCCM.","Administrative scripts 
Microsoft SCCM","ParentImage IN (""*\\mshta.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\rundll32.exe"", ""*\\cscript.exe"", ""*\\wscript.exe"", ""*\\wmiprvse.exe"", ""*\\regsvr32.exe"") Image IN (""*\\schtasks.exe"", ""*\\nslookup.exe"", ""*\\certutil.exe"", ""*\\bitsadmin.exe"", ""*\\mshta.exe"") NOT (CurrentDirectory=""*\\ccmcache\\*"" OR ParentCommandLine IN (""*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\setup-scheduledtask.ps1*"", ""*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\set-selfhealing.ps1*"", ""*\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\check-workspacehealth.ps1*"", ""*\\nessus_*"") OR CommandLine=""*\\nessus_*"" OR (ParentImage=""*\\mshta.exe"" Image=""*\\mshta.exe"" ParentCommandLine=""*C:\\MEM_Configmgr_*"" ParentCommandLine=""*\\splash.hta*"" ParentCommandLine=""*{1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}*"" CommandLine=""*C:\\MEM_Configmgr_*"" CommandLine=""*\\SMSSETUP\\BIN\\*"" CommandLine=""*\\autorun.hta*"" CommandLine=""*{1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}*""))"
"Suspicious SYSTEM User Process Creation","Florian Roth (Nextron Systems), David ANDRE (additional keywords)","Detects a suspicious process creation as SYSTEM user (suspicious program or command line parameter)","attack.credential_access, attack.defense_evasion, attack.privilege_escalation, attack.t1134, attack.t1003, attack.t1027","process_creation","windows","Not classified","Check the parent process of the suspicious process creation to identify any unusual or unauthorized activity. 
Review the command line parameters used during the process creation to identify any suspicious or malicious behavior. 
Analyze the integrity level of the process to determine if it is running with elevated privileges. 
Cross-reference the process image name with known legitimate processes to identify any anomalies. 
Monitor network traffic associated with the process to identify any suspicious communication or data exfiltration. 
Check for any modifications made to system files or registry entries by the suspicious process. 
Review any relevant log sources such as Windows Event Logs, process monitoring logs, or endpoint security logs for additional information or indicators of compromise. 
Conduct further investigation using threat intelligence sources to identify any known malware or attack techniques associated with the suspicious process.","Administrative activity 
Scripts and administrative tools used in the monitored environment 
Monitoring activity","IntegrityLevel=""System"" User IN (""*AUTHORI*"", ""*AUTORI*"") Image IN (""*\\calc.exe"", ""*\\wscript.exe"", ""*\\cscript.exe"", ""*\\hh.exe"", ""*\\mshta.exe"", ""*\\forfiles.exe"", ""*\\ping.exe"") OR CommandLine IN (""* -NoP *"", ""* -W Hidden *"", ""* -decode *"", ""* /decode *"", ""* /urlcache *"", ""* -urlcache *"", ""* -e* JAB*"", ""* -e* SUVYI*"", ""* -e* SQBFAFgA*"", ""* -e* aWV4I*"", ""* -e* IAB*"", ""* -e* PAA*"", ""* -e* aQBlAHgA*"", ""*vssadmin delete shadows*"", ""*reg SAVE HKLM*"", ""* -ma *"", ""*Microsoft\\Windows\\CurrentVersion\\Run*"", ""*.downloadstring(*"", ""*.downloadfile(*"", ""* /ticket:*"", ""*dpapi::*"", ""*event::clear*"", ""*event::drop*"", ""*id::modify*"", ""*kerberos::*"", ""*lsadump::*"", ""*misc::*"", ""*privilege::*"", ""*rpc::*"", ""*sekurlsa::*"", ""*sid::*"", ""*token::*"", ""*vault::cred*"", ""*vault::list*"", ""* p::d *"", ""*;iex(*"", ""*MiniDump*"", ""*net user *"") NOT (CommandLine=""ping 127.0.0.1 -n 5"" OR (Image=""*\\PING.EXE"" ParentCommandLine=""*\\DismFoDInstall.cmd*"") OR ParentImage=""C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\*"" OR (ParentImage=""C:\\Program Files (x86)\\Java\\*"" ParentImage=""*\\bin\\javaws.exe"" Image=""C:\\Program Files (x86)\\Java\\*"" Image=""*\\bin\\jp2launcher.exe"" CommandLine=""* -ma *""))"
"Tasks Folder Evasion","Sreeman","The Tasks folder in system32 and syswow64 are globally writable paths.
Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application
in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr
","attack.defense_evasion, attack.persistence, attack.execution, attack.t1574.002","process_creation","windows","Not classified","Review the CommandLine and ParentProcess fields in the process_creation logs for any suspicious activity related to the Tasks folder in system32 and syswow64. 
Check if any suspicious commands such as echo, copy, type, or file createnew are being executed in the Tasks folder. 
Look for any unusual or unexpected processes being launched from the Tasks folder, such as cscript, wscript, regsvr32, mshta, or eventvwr. 
Cross-reference the detected activity with known legitimate scheduled tasks or software installations to determine if the activity is malicious or benign.","Scheduled tasks legitimately created by system administrators or legitimate software installations may trigger this rule.","CommandLine IN (""*echo *"", ""*copy *"", ""*type *"", ""*file createnew*"") CommandLine IN (""* C:\\Windows\\System32\\Tasks\\*"", ""* C:\\Windows\\SysWow64\\Tasks\\*"")"
"WhoAmI as Parameter","Florian Roth (Nextron Systems)","Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato)","attack.discovery, attack.t1033, car.2016-03-001","process_creation","windows","Not classified","Review the process creation logs from the log source specified in the logsource field, filtering for processes with command lines containing .exe whoami. 
Check if the process is associated with a known legitimate script or administrative activity. 
If the process is not associated with a known legitimate activity, investigate further to determine if it is a potential indicator of compromise.","Legitimate use of whoami command in scripts or legitimate administrative activities.","CommandLine=""*.exe whoami*"""
"Execution via WorkFolders.exe","Maxime Thiebaut (@0xThiebaut)","Detects using WorkFolders.exe to execute an arbitrary control.exe","attack.defense_evasion, attack.t1218","process_creation","windows","Not classified","Check the process creation logs for instances where WorkFolders.exe is the parent process and control.exe is the child process. 
Review the command-line arguments and parameters used during the execution of control.exe. 
Verify if the execution of control.exe is part of a legitimate usage of the Windows Work Folders feature. 
Cross-reference the detection with other security events or indicators of compromise to determine if it is part of a larger attack pattern.","Legitimate usage of the uncommon Windows Work Folders feature.","Image=""*\\control.exe"" ParentImage=""*\\WorkFolders.exe"" NOT Image=""C:\\Windows\\System32\\control.exe"""
"Suspect Svchost Activity","David Burkett, @signalblur","It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space.","attack.defense_evasion, attack.privilege_escalation, attack.t1055","process_creation","windows","Not classified","Check the command line arguments of the svchost.exe process to see if any suspicious or unexpected arguments are present. This can be done by analyzing the CommandLine field in the process_creation logs from Windows systems. 
Review the parent process of svchost.exe to identify any potentially malicious processes that may have spawned it. Look for any unusual or unauthorized processes in the ParentImage field of the process_creation logs. 
Inspect the memory space of the svchost.exe process for any injected code or suspicious behavior. This can be done using memory analysis tools or by analyzing the process memory dump if available.","Rpcnet.exe / rpcnetp.exe which is a lojack style software. https//www.blackhat.com/docs/us-14/materials/us-14-Kamlyuk-Kamluk-Computrace-Backdoor-Revisited.pdf","CommandLine=""*svchost.exe"" Image=""*\\svchost.exe"" NOT (ParentImage IN (""*\\rpcnet.exe"", ""*\\rpcnetp.exe"") OR CommandLine!=*)"
"Suspicious Svchost Process","Florian Roth (Nextron Systems)","Detects a suspicious svchost process start","attack.defense_evasion, attack.t1036.005","process_creation","windows","Not classified","Investigate the parent process of the suspicious svchost.exe instance to determine if it is a known legitimate process or not. 
Check the command line arguments of the svchost.exe process to identify any suspicious or unusual behavior. 
Review the process creation logs from the Windows event logs or a SIEM solution to gather additional context and identify any other potentially malicious activity. 
Cross-reference the svchost.exe process with known good hashes or reputation databases to determine if it is a known malicious variant.","Legitimate instances of svchost.exe running with legitimate parent processes.","Image=""*\\svchost.exe"" NOT (ParentImage IN (""*\\services.exe"", ""*\\MsMpEng.exe"", ""*\\Mrt.exe"", ""*\\rpcnet.exe"", ""*\\ngen.exe"", ""*\\TiWorker.exe"") OR ParentImage!=* OR ParentImage="""" OR ParentImage=""-"")"
"Terminal Service Process Spawn","Florian Roth (Nextron Systems)","Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)","attack.initial_access, attack.t1190, attack.lateral_movement, attack.t1210, car.2013-07-002","process_creation","windows","Not classified","Review the ParentCommandLine field in process creation logs for instances where the command line contains \svchost.exe and termsvcs. 
Check if the spawned process is one of the known legitimate processes rdpclip.exe, csrss.exe, wininit.exe, winlogon.exe. 
Verify if the process spawning is expected and authorized in the environment.","Legitimate use of terminal service process spawning","ParentCommandLine=""*\\svchost.exe*"" ParentCommandLine=""*termsvcs*"" NOT (Image IN (""*\\rdpclip.exe"", ""*:\\Windows\\System32\\csrss.exe"", ""*:\\Windows\\System32\\wininit.exe"", ""*:\\Windows\\System32\\winlogon.exe"") OR Image!=*)"
"Potential SysInternals ProcDump Evasion","Florian Roth (Nextron Systems)","Detects uses of the SysInternals ProcDump utility in which ProcDump or its output get renamed, or a dump file is moved or copied to a different name","attack.defense_evasion, attack.t1036, attack.t1003.001","process_creation","windows","Not classified","Review process creation logs (e.g., Windows Event ID 4688) for instances where the command line contains copy procdump or move procdump. 
Inspect process creation logs for command lines that include copy  and .dmp and also contain 2.dmp, lsass, or out.dmp. 
Analyze process creation logs for occurrences of copy lsass.exe_ or move lsass.exe_.","ProcDump being copied to a different directory without any renaming","CommandLine IN (""*copy procdump*"", ""*move procdump*"") OR (CommandLine=""*copy *"" CommandLine=""*.dmp *"" CommandLine IN (""*2.dmp*"", ""*lsass*"", ""*out.dmp*"")) OR CommandLine IN (""*copy lsass.exe_*"", ""*move lsass.exe_*"")"
"Potential LSASS Process Dump Via Procdump","Florian Roth (Nextron Systems)","Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process.
This way we are also able to catch cases in which the attacker has renamed the procdump executable.
","attack.defense_evasion, attack.t1036, attack.credential_access, attack.t1003.001, car.2013-05-009","process_creation","windows","Not classified","Check process creation logs for instances of Procdump being executed with the -ma or /ma command line parameter. 
Look for instances where Procdump is used with the ls process in the command line. 
Review any instances where Procdump is used with suspicious or unexpected command line parameters.","Unlikely, because no one should dump an lsass process memory 
Another tool that uses command line flags similar to ProcDump","CommandLine IN (""* -ma *"", ""* /ma *"") CommandLine=""* ls*"""
"Uninstall Sysinternals Sysmon","frack113","Detects the removal of Sysmon, which could be a potential attempt at defense evasion","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check the command line arguments of the process creation events for the presence of -u or /u indicating an attempt to uninstall Sysmon. 
Review the process image path to ensure it matches the expected location of Sysmon (e.g., C\Windows\Sysmon64.exe or C\Windows\Sysmon.exe). 
Cross-reference with other security logs, such as file system or registry events, to identify any related activity or artifacts. 
Consider the context of the system and user account involved in the process creation event to determine if the uninstallation is expected or suspicious.","Legitimate administrators might use this command to remove Sysmon for debugging purposes","Image IN (""*\\Sysmon64.exe"", ""*\\Sysmon.exe"") OR Description=""System activity monitor"" CommandLine IN (""*-u*"", ""*/u*"")"
"Taskkill Symantec Endpoint Protection","Ilya Krestinichev, Florian Roth (Nextron Systems)","Detects one of the possible scenarios for disabling Symantec Endpoint Protection.
Symantec Endpoint Protection antivirus software services incorrectly implement the protected service mechanism.
As a result, the NT AUTHORITY/SYSTEM user can execute the taskkill /im command several times ccSvcHst.exe /f, thereby killing the process belonging to the service, and thus shutting down the service.
","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check the process creation logs for instances of the taskkill command with the specific parameters mentioned in the rule. 
Look for multiple occurrences of the taskkill command targeting ccSvcHst.exe. 
Verify if the taskkill command was executed by the NT AUTHORITY/SYSTEM user. 
Cross-reference the event with other security events or indicators of compromise to determine if it is part of a larger attack.","Legitimate use of taskkill command for other purposes, such as terminating other processes.","CommandLine=""*taskkill*"" CommandLine=""* /F *"" CommandLine=""* /IM *"" CommandLine=""*ccSvcHst.exe*"""
"Taskmgr as LOCAL_SYSTEM","Florian Roth (Nextron Systems)","Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM","attack.defense_evasion, attack.t1036","process_creation","windows","Not classified","Check the process creation logs on Windows systems for taskmgr.exe being executed in the context of LOCAL_SYSTEM.","Unknown","User IN (""*AUTHORI*"", ""*AUTORI*"") Image=""*\\taskmgr.exe"""
"Suspicious TSCON Start as SYSTEM","Florian Roth (Nextron Systems)","Detects a tscon.exe start as LOCAL SYSTEM","attack.command_and_control, attack.t1219","process_creation","windows","Not classified","1. Check the process command line arguments and parent process to determine if the tscon.exe execution is expected and authorized. 
2. Review the user account associated with the tscon.exe process to verify if it is a privileged account or a normal user account. 
3. Cross-reference the tscon.exe execution with other security events such as RDP logon events or network traffic to identify any suspicious or unauthorized activity. 
4. Analyze the system and network logs for any other indicators of compromise or abnormal behavior that may be related to the tscon.exe execution. 
5. Consult with system administrators or other relevant personnel to validate the legitimacy of the tscon.exe execution and determine if any further action is required.","Legitimate use of tscon.exe by authorized system administrators for remote desktop management.","User IN (""*AUTHORI*"", ""*AUTORI*"") Image=""*\\tscon.exe"""
"Suspicious RDP Redirect Using TSCON","Florian Roth (Nextron Systems)","Detects a suspicious RDP session redirect using tscon.exe","attack.lateral_movement, attack.t1563.002, attack.t1021.001, car.2013-07-002","process_creation","windows","Not classified","Review process creation logs for instances of tscon.exe being used with the /destrdp-tcp# parameter. 
Check for legitimate use cases where tscon.exe is used for RDP session redirection, such as system administrators performing remote management tasks. 
Cross-reference with user authentication logs to identify any suspicious or unauthorized activity during the time of the tscon.exe execution. 
Monitor network traffic logs for any unusual or unexpected RDP connections originating from the system where tscon.exe was executed.","Legitimate use of tscon.exe for RDP session redirection","CommandLine=""* /dest:rdp-tcp#*"""
"UAC Bypass Using ChangePK and SLUI","Christian Burkard (Nextron Systems)","Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Review process creation logs from Windows event logs (Event ID 4688) to identify instances of changepk.exe being launched with slui.exe as the parent process. 
Check the Integrity Level of the process to determine if it matches the expected values of High or System. 
Correlate with other security events or indicators of compromise to determine if the UAC bypass is part of a larger attack chain or if it is an isolated incident.","Legitimate use of changepk.exe and slui.exe for system administration or software licensing purposes.","Image=""*\\changepk.exe"" ParentImage=""*\\slui.exe"" IntegrityLevel IN (""High"", ""System"")"
"UAC Bypass Using Disk Cleanup","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the process creation logs for instances where the CommandLine ends with ""\system32\cleanmgr.exe /autoclean /d C"". 
Verify if the ParentCommandLine is ""C\Windows\system32\svchost.exe -k netsvcs -p -s Schedule"". 
Check the IntegrityLevel of the process and ensure it is either ""High"" or ""System"".","Unknown","CommandLine=""*\""\\system32\\cleanmgr.exe /autoclean /d C:"" ParentCommandLine=""C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Schedule"" IntegrityLevel IN (""High"", ""System"")"
"Bypass UAC via CMSTP","E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community","Detect commandline usage of Microsoft Connection Manager Profile Installer (cmstp.exe) to install specially formatted local .INF files","attack.privilege_escalation, attack.defense_evasion, attack.t1548.002, attack.t1218.003","process_creation","windows","Not classified","Check the command line arguments of cmstp.exe process executions. 
Review the associated user account and computer name for any suspicious activity. 
Analyze the content of the .INF files being installed by cmstp.exe for any signs of malicious intent.","Legitimate use of cmstp.exe utility by legitimate user","Image=""*\\cmstp.exe"" OR OriginalFileName=""CMSTP.EXE"" CommandLine IN (""*/s*"", ""*-s*"", ""*/au*"", ""*-au*"", ""*/ni*"", ""*-ni*"")"
"UAC Bypass Tools Using ComputerDefaults","Christian Burkard (Nextron Systems)","Detects tools such as UACMe used to bypass UAC with computerdefaults.exe (UACMe 59)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the parent process of ComputerDefaults.exe to determine if it is launched from a suspicious location or by an unknown process. 
Review the command-line arguments passed to ComputerDefaults.exe for any unusual or unexpected values. 
Analyze the integrity level of the process to identify if it is running with elevated privileges. 
Correlate the detection with other security events or indicators of compromise to determine the context and severity of the potential UAC bypass.","Legitimate use of ComputerDefaults.exe during system configuration or troubleshooting.","IntegrityLevel IN (""High"", ""System"") Image=""C:\\Windows\\System32\\ComputerDefaults.exe"" NOT (ParentImage IN (""*:\\Windows\\System32*"", ""*:\\Program Files*""))"
"UAC Bypass Using Consent and Comctl32 - Process","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check process creation logs for instances where consent.exe is the parent process and werfault.exe is the child process. 
Look for processes with high or system integrity level that involve consent.exe and werfault.exe. 
Review any instances where consent.exe is used in combination with comctl32.dll. 
Correlate the process creation events with other relevant security events to identify any suspicious or malicious activity.","Unknown","ParentImage=""*\\consent.exe"" Image=""*\\werfault.exe"" IntegrityLevel IN (""High"", ""System"")"
"UAC Bypass Using DismHost","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Review process creation logs for instances of DismHost.exe being launched from unexpected locations, such as user directories or temporary folders. 
Check the integrity level of the process to identify if it is running with elevated privileges (High or System). 
Cross-reference with other security events or indicators of compromise to determine if the activity is part of a larger attack chain.","Legitimate use of DismHost.exe for system maintenance or updates","ParentImage=""*C:\\Users\\*"" ParentImage=""*\\AppData\\Local\\Temp\\*"" ParentImage=""*\\DismHost.exe*"" IntegrityLevel IN (""High"", ""System"")"
"UAC Bypass Using Event Viewer RecentViews","Nasreddine Bencherchali (Nextron Systems)","Detects the pattern of UAC Bypass using Event Viewer RecentViews","attack.defense_evasion, attack.privilege_escalation","process_creation","windows","Not classified","Check the command line of the process creation events for the presence of \Event Viewer\RecentViews or \EventV~1\RecentViews. 
Look for any redirection operators (>) in the command line, which may indicate an attempt to bypass UAC. 
Review the parent process and user context to determine if the activity is suspicious or part of normal administrative activity. 
Correlate with other security events, such as privilege escalation attempts or suspicious network connections, to gather additional context.","Legitimate administrative activity that involves using Event Viewer RecentViews for troubleshooting or system management purposes.","CommandLine IN (""*\\Event Viewer\\RecentViews*"", ""*\\EventV~1\\RecentViews*"") CommandLine=""*>*"""
"Bypass UAC via Fodhelper.exe","E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community","Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.","attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the command line arguments of the fodhelper.exe process to identify any suspicious or unexpected values. 
Review the parent process of fodhelper.exe to determine if it is being launched from an unusual or unauthorized location. 
Correlate the fodhelper.exe process with other security events, such as privilege escalation attempts or suspicious network connections.","Legitimate use of fodhelper.exe utility by legitimate user","ParentImage=""*\\fodhelper.exe"""
"UAC Bypass via ICMLuaUtil","Florian Roth (Nextron Systems)","Detects the pattern of UAC Bypass using ICMLuaUtil Elevated COM interface","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the ParentImage field in the process creation logs to identify the parent process that launched dllhost.exe 
Review the ParentCommandLine field in the process creation logs to analyze the command line parameters used to launch dllhost.exe 
Examine the Image field in the process creation logs to determine if WerFault.exe is involved 
Verify the OriginalFileName field in the process creation logs to confirm if the executed file is WerFault.exe 
Cross-reference the detected pattern with known authorized scenarios where UAC bypass is expected 
Consult with system administrators or application owners to validate the legitimacy of ICMLuaUtil usage 
Analyze the specific command line parameters used with dllhost.exe to understand the purpose and intent 
Investigate the conditions under which WerFault.exe is executed to determine if it aligns with legitimate scenarios","Legitimate use of ICMLuaUtil in specific scenarios where UAC bypass is intended and authorized 
Legitimate use of dllhost.exe with specific command line parameters 
Legitimate use of WerFault.exe with specific conditions","ParentImage=""*\\dllhost.exe"" ParentCommandLine IN (""*/Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}*"", ""*/Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}*"") NOT (Image=""*\\WerFault.exe"" OR OriginalFileName=""WerFault.exe"")"
"UAC Bypass Using IDiagnostic Profile","Nasreddine Bencherchali (Nextron Systems)","Detects the ""IDiagnosticProfileUAC"" UAC bypass technique","attack.execution, attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the ParentImage field in the process creation logs to verify if it ends with \DllHost.exe 
Check the ParentCommandLine field in the process creation logs to verify if it contains  /Processid{12C21EA7-2EB8-4B55-9249-AC243DA8C666} 
Check the IntegrityLevel field in the process creation logs to verify if it is High or System 
Correlate the process creation event with other relevant events, such as network connections or file modifications, to determine if any malicious activity is associated","Legitimate use of IDiagnosticProfileUAC by authorized system administrators 
Legitimate use of DllHost.exe with the specified ParentCommandLine 
Legitimate use of DllHost.exe with the specified IntegrityLevel","ParentImage=""*\\DllHost.exe"" ParentCommandLine=""* /Processid:{12C21EA7-2EB8-4B55-9249-AC243DA8C666}*"" IntegrityLevel IN (""High"", ""System"")"
"UAC Bypass Using IEInstal - Process","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the parent process of IEInstal.exe to determine if it is launched from a suspicious or unexpected source 
Review the command-line arguments passed to IEInstal.exe for any unusual or suspicious values 
Analyze the integrity level of the process to identify if it is running with elevated privileges 
Examine the image path of the process to verify if it is located in the expected location (e.g., \AppData\Local\Temp\) 
Investigate the presence of consent.exe in the process tree to determine if it is related to a legitimate UAC prompt or an attempt to bypass UAC","Legitimate use of IEInstal.exe for installation or update purposes 
Legitimate use of consent.exe for UAC prompts during software installation or system changes","IntegrityLevel IN (""High"", ""System"") ParentImage=""*\\ieinstal.exe"" Image=""*\\AppData\\Local\\Temp\\*"" Image=""*consent.exe"""
"UAC Bypass Using MSConfig Token Modification - Process","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the integrity level of the process using the IntegrityLevel field in the process creation logs. Look for processes with High or System integrity level. 
Examine the parent image path in the process creation logs to verify if it ends with \AppData\Local\Temp\pkgmgr.exe. This indicates a potential UAC bypass attempt. 
Review the command line of the process creation logs to see if it matches the pattern ""C\Windows\system32\msconfig.exe"" -5. This indicates a potential UAC bypass attempt. 
Cross-reference the process information with other security events and logs to identify any suspicious or malicious behavior. 
If the process is executed by a trusted user or system account, it may be a legitimate use of the UAC bypass technique. Verify the purpose and context of the activity with the user or system owner.","Legitimate use of msconfig.exe with the specified command line arguments 
Legitimate use of pkgmgr.exe with the specified parent image path 
Legitimate use of High or System Integrity Level by trusted processes","IntegrityLevel IN (""High"", ""System"") ParentImage=""*\\AppData\\Local\\Temp\\pkgmgr.exe"" CommandLine=""\""C:\\Windows\\system32\\msconfig.exe\"" -5"""
"UAC Bypass Using NTFS Reparse Point - Process","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the command line of the process to see if it matches the pattern of UAC bypass using NTFS reparse point and wusa.exe DLL hijacking 
Verify the integrity level of the process to ensure it is running with high or system integrity level 
Look for parent processes that match the command line pattern of dism.exe with specific parameters and dismhost.exe 
Review the image path of the process to confirm it ends with DismHost.exe 
Cross-reference the detected process with known legitimate use cases of wusa.exe, dism.exe, NTFS reparse points, and DLL hijacking","Legitimate use of wusa.exe and dism.exe with similar command lines 
Legitimate use of NTFS reparse points for non-malicious purposes 
Legitimate use of DLL hijacking for non-malicious purposes","(CommandLine=""\""C:\\Windows\\system32\\wusa.exe\""  /quiet C:\\Users\\*"" CommandLine=""*\\AppData\\Local\\Temp\\update.msu"" IntegrityLevel IN (""High"", ""System"")) OR (ParentCommandLine=""\""C:\\Windows\\system32\\dism.exe\"" /online /quiet /norestart /add-package /packagepath:\""C:\\Windows\\system32\\pe386\"" /ignorecheck"" IntegrityLevel IN (""High"", ""System"") CommandLine=""*C:\\Users\\*"" CommandLine=""*\\AppData\\Local\\Temp\\*"" CommandLine=""*\\dismhost.exe {*"" Image=""*\\DismHost.exe"")"
"UAC Bypass Using PkgMgr and DISM","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Review process creation logs from Windows event logs (Event ID 4688) to identify instances of pkgmgr.exe and dism.exe being executed with high or system integrity level. 
Cross-reference the process creation logs with other relevant logs such as command-line logs (Event ID 4689) or PowerShell logs (Event ID 4104) to gather additional context and command-line arguments used during the execution of pkgmgr.exe and dism.exe. 
Check for any legitimate system administration tasks or known software installations that may involve the use of pkgmgr.exe and dism.exe. 
If the execution of pkgmgr.exe and dism.exe is not expected or cannot be attributed to legitimate system administration tasks, further investigation is warranted to determine if UAC bypass techniques are being employed.","Legitimate use of pkgmgr.exe and dism.exe for system administration tasks","ParentImage=""*\\pkgmgr.exe"" Image=""*\\dism.exe"" IntegrityLevel IN (""High"", ""System"")"
"TrustedPath UAC Bypass Pattern","Florian Roth (Nextron Systems)","Detects indicators of a UAC bypass method by mocking directories","attack.defense_evasion, attack.t1548.002","process_creation","windows","Not classified","Review process creation logs from Windows event logs (Event ID 4688) to identify the process that triggered the detection. 
Check the command-line arguments and parent process information to understand the context of the suspicious activity. 
Analyze the process behavior and any associated network connections or file modifications to determine if it aligns with known UAC bypass techniques. 
Cross-reference the detection with other security controls and indicators of compromise (IOCs) to validate the findings. 
Consider performing memory analysis or endpoint forensics to gather additional evidence if necessary.","Legitimate use of C\Windows\System32\ directory by trusted applications","Image=""*C:\\Windows \\System32\\*"""
"UAC Bypass Abusing Winsat Path Parsing - Process","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Review process creation logs from Windows event logs or SIEM for instances where winsat.exe is launched with parent process being in the AppData\Local\Temp\system32\ directory and the parent command line containing C\Windows \system32\winsat.exe. 
Check the integrity level of the process to see if it is running with High or System integrity level.","Legitimate use of winsat.exe for system performance testing or troubleshooting.","IntegrityLevel IN (""High"", ""System"") ParentImage=""*\\AppData\\Local\\Temp\\system32\\winsat.exe"" ParentCommandLine=""*C:\\Windows \\system32\\winsat.exe*"""
"UAC Bypass Using Windows Media Player - Process","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check if the process creation of C\Program Files\Windows Media Player\osk.exe is part of a normal user activity or if it is being executed in an unusual context. 
Investigate the usage of cmd.exe with the ParentCommandLine ""C\Windows\system32\mmc.exe"" ""C\Windows\system32\eventvwr.msc"" /s to determine if it is a legitimate action or potentially malicious.","Legitimate use of Windows Media Player and osksupport.dll 
Legitimate use of cmd.exe with specific ParentCommandLine","(Image=""C:\\Program Files\\Windows Media Player\\osk.exe"" IntegrityLevel IN (""High"", ""System"")) OR (Image=""C:\\Windows\\System32\\cmd.exe"" ParentCommandLine=""\""C:\\Windows\\system32\\mmc.exe\"" \""C:\\Windows\\system32\\eventvwr.msc\"" /s"" IntegrityLevel IN (""High"", ""System""))"
"Bypass UAC via WSReset.exe","E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community, Florian Roth","Detects use of WSReset.exe to bypass User Account Control (UAC). Adversaries use this technique to execute privileged processes.","attack.privilege_escalation, attack.defense_evasion, attack.t1548.002","process_creation","windows","Not classified","Check for any instances of WSReset.exe being executed with a parent process that is not conhost.exe or CONHOST.EXE. 
Review process creation logs for any suspicious or unauthorized use of WSReset.exe. 
Monitor for any unusual or unexpected command-line arguments passed to WSReset.exe. 
Cross-reference the execution of WSReset.exe with other security events or indicators of compromise (IOCs) to identify any related malicious activity. 
Investigate any instances of WSReset.exe that are associated with privileged processes or actions, as this may indicate an attempt to bypass UAC.","Unknown sub processes of Wsreset.exe","ParentImage=""*\\wsreset.exe"" NOT (Image=""*\\conhost.exe"" OR OriginalFileName=""CONHOST.EXE"")"
"UAC Bypass WSReset","Christian Burkard (Nextron Systems)","Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config","attack.defense_evasion, attack.privilege_escalation, attack.t1548.002","process_creation","windows","Not classified","Check the parent process of wsreset.exe to determine if it is launched from a suspicious or unexpected source. 
Review the command-line arguments passed to wsreset.exe for any unusual or malicious parameters. 
Correlate the detection with other security events or indicators of compromise (IOCs) to identify any related malicious activity. 
Monitor the integrity level of processes and compare it with known legitimate processes to identify anomalies.","Legitimate use of WSReset.exe during system maintenance or troubleshooting.","Image=""*\\wsreset.exe"" IntegrityLevel IN (""High"", ""System"")"
"Suspicious UltraVNC Execution","Bhabesh Raj","Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group)","attack.lateral_movement, attack.g0047, attack.t1021.005","process_creation","windows","Not classified","Check the process creation logs for instances where UltraVNC is executed with the suspicious command line flag combination. 
Review the command line arguments of the UltraVNC process to identify any instances of -autoreconnect, -connect, and -id being used together. 
Cross-reference the process execution with other security events and indicators of compromise to determine if the activity is part of a larger attack campaign. 
If possible, gather additional context from network logs, such as firewall or proxy logs, to identify any suspicious network connections associated with the UltraVNC process. 
Consult threat intelligence sources and internal knowledge base to determine if the observed activity aligns with known TTPs of the Gamaredon threat group.","Legitimate use of UltraVNC with the specified command line flags","CommandLine=""*-autoreconnect *"" CommandLine=""*-connect *"" CommandLine=""*-id:*"""
"Uninstall Crowdstrike Falcon Sensor","frack113","Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Review process creation logs from Windows systems for instances where the command line contains \WindowsSensor.exe /uninstall /quiet. 
Look for any other suspicious activity or indicators of compromise on the affected system, such as unusual network connections or changes to critical system files. 
Check for any other security tool uninstallations or modifications on the system.","Administrator might leverage the same command line for debugging or other purposes. However this action must be always investigated","CommandLine=""*\\WindowsSensor.exe*"" CommandLine=""* /uninstall*"" CommandLine=""* /quiet*"""
"Uncommon Userinit Child Process","Tom Ueltschi (@c_APT_ure), Tim Shelton","Detects uncommon ""userinit.exe"" child processes, which could be a sign of uncommon shells or login scripts used for persistence.","attack.t1037.001, attack.persistence","process_creation","windows","Not classified","Review the parent process of the detected child process to determine if it is a legitimate shell or login script. 
Check if the detected child process is commonly associated with persistence techniques or known malware. 
Analyze the command line arguments of the detected child process to identify any suspicious or uncommon behavior. 
Cross-reference the detected child process with known good processes or trusted sources to determine its legitimacy.","Legitimate logon scripts or custom shells may trigger false positives. Apply additional filters accordingly.","ParentImage=""*\\userinit.exe"" NOT Image=""C:\\WINDOWS\\explorer.exe"" NOT (CommandLine IN (""*netlogon.bat*"", ""*UsrLogon.cmd*"") OR CommandLine=""PowerShell.exe"" OR Image IN (""C:\\Windows\\System32\\proquota.exe"", ""C:\\Windows\\SysWOW64\\proquota.exe"") OR Image=""*\\Citrix\\System32\\icast.exe"" OR Image!=*)"
"Use of W32tm as Timer","frack113","When configured with suitable command line arguments, w32tm can act as a delay mechanism","attack.discovery, attack.t1124","process_creation","windows","Not classified","Investigate the command line arguments used with w32tm.exe to determine if they match the suspicious pattern. Look for any unusual or unexpected values for the /stripchart, /computer, /period, /dataonly, and /samples parameters. 
Review the process creation logs for instances of w32tm.exe being executed with the suspicious command line arguments. 
Cross-reference the activity with other logs, such as network traffic logs or endpoint logs, to identify any associated suspicious or malicious behavior.","Legitimate use cases where w32tm is used for time synchronization or other legitimate purposes.","Image=""*\\w32tm.exe"" OR OriginalFileName=""w32time.dll"" CommandLine=""*/stripchart*"" CommandLine=""*/computer:*"" CommandLine=""*/period:*"" CommandLine=""*/dataonly*"" CommandLine=""*/samples:*"""
"Wab Execution From Non Default Location","Nasreddine Bencherchali (Nextron Systems)","Detects execution of wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) from non default locations as seen with bumblebee activity","attack.defense_evasion, attack.execution","process_creation","windows","Not classified","Check the process creation logs for instances of wab.exe or wabmig.exe being executed from non-default locations. 
Review the command-line arguments and parent processes of the suspicious wab.exe or wabmig.exe executions. 
Cross-reference the execution with other security events or indicators of compromise (IOCs) associated with the bumblebee activity. 
Verify the legitimacy of the execution by checking the file path and the purpose of the executed process. 
If necessary, consult with the system owner or user to confirm if the execution was expected or authorized.","Legitimate usage of wab.exe or wabmig.exe from non-default locations","Image IN (""*\\wab.exe"", ""*\\wabmig.exe"") NOT (Image IN (""C:\\Windows\\WinSxS\\*"", ""C:\\Program Files\\Windows Mail\\*"", ""C:\\Program Files (x86)\\Windows Mail\\*""))"
"Wab/Wabmig Unusual Parent Or Child Processes","Nasreddine Bencherchali (Nextron Systems)","Detects unusual parent or children of the wab.exe (Windows Contacts) and Wabmig.exe (Microsoft Address Book Import Tool) processes as seen being used with bumblebee activity","attack.defense_evasion, attack.execution","process_creation","windows","Not classified","Check the parent process of wab.exe or wabmig.exe to determine if it is a known legitimate process. Examples of legitimate parent processes include WmiPrvSE.exe, svchost.exe, and dllhost.exe. 
Review the child processes of wab.exe or wabmig.exe to identify any unusual or suspicious processes. Look for processes that are not typically associated with the normal operation of Windows Contacts or the Microsoft Address Book Import Tool. 
Correlate the detection with other security events or indicators of compromise (IOCs) to determine if there is a larger security incident or attack campaign underway. 
Consult threat intelligence sources and security advisories to identify any known malicious activity or indicators associated with the bumblebee activity mentioned in the rule description.","Legitimate usage of wab.exe or wabmig.exe in specific scenarios, such as during normal Windows operations or legitimate software installations.","(ParentImage IN (""*\\WmiPrvSE.exe"", ""*\\svchost.exe"", ""*\\dllhost.exe"") Image IN (""*\\wab.exe"", ""*\\wabmig.exe"")) OR ParentImage IN (""*\\wab.exe"", ""*\\wabmig.exe"")"
"SystemStateBackup Deleted Using Wbadmin.EXE","frack113","Deletes the Windows systemstatebackup using wbadmin.exe.
This technique is used by numerous ransomware families.
This may only be successful on server platforms that have Windows Backup enabled.
","attack.impact, attack.t1490","process_creation","windows","Not classified","Check for the presence of other suspicious activities or indicators of compromise (IOCs) on the system. 
Review the command line arguments used with wbadmin.exe to determine if they match known legitimate use cases. 
Cross-reference the activity with other logs, such as file system logs, to identify any unauthorized modifications or deletions. 
Check for any other signs of ransomware activity, such as encrypted files or ransom notes. 
Verify the legitimacy of the process by checking the digital signature and file hash of wbadmin.exe. 
Consult with the system owner or administrator to confirm if the wbadmin.exe activity was authorized and expected.","Legitimate use of wbadmin.exe for system backup and maintenance purposes.","Image=""*\\wbadmin.exe"" OR OriginalFileName=""WBADMIN.EXE"" CommandLine=""*delete *"" CommandLine=""*systemstatebackup *"" CommandLine=""*-keepVersions:0*"""
"Chopper Webshell Process Pattern","Florian Roth (Nextron Systems), MSTI (query)","Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells","attack.persistence, attack.t1505.003, attack.t1018, attack.t1033, attack.t1087","process_creation","windows","Not classified","Check the process execution logs for the w3wp.exe process with the provided command line arguments 
Verify the legitimacy of the command line arguments by comparing them with known legitimate usage patterns 
Cross-reference the process execution logs with other relevant logs, such as network traffic logs or authentication logs, to identify any suspicious activity associated with the process","Legitimate usage of the w3wp.exe process with the provided command line arguments 
Legitimate usage of the w3wp.exe process with different command line arguments 
Legitimate usage of other processes with similar command line arguments","Image=""*\\w3wp.exe"" OR ParentImage=""*\\w3wp.exe"" CommandLine IN (""*&ipconfig&echo*"", ""*&quser&echo*"", ""*&whoami&echo*"", ""*&c:&echo*"", ""*&cd&echo*"", ""*&dir&echo*"", ""*&echo [E]*"", ""*&echo [S]*"")"
"Webshell Detection With Command Line Keywords","Florian Roth (Nextron Systems), Jonhnathan Ribeiro, Anton Kutepov, oscd.community","Detects certain command line parameters often used during reconnaissance activity via web shells","attack.persistence, attack.t1505.003, attack.t1018, attack.t1033, attack.t1087","process_creation","windows","Not classified","Review process creation logs from the Windows operating system. 
Look for instances of the following processes w3wp.exe, php-cgi.exe, nginx.exe, httpd.exe, caddy.exe, ws_tomcatservice.exe. 
Check if the parent image of the process ends with any of the specified strings. 
Review process creation logs for instances of java.exe or javaw.exe. 
Check if the parent image contains -tomcat- or \tomcat. 
Look for instances of catalina.jar or CATALINA_HOME in the command line of java.exe or javaw.exe processes. 
Review process creation logs for instances of net.exe or net1.exe. 
Check if the command line contains  user ,  use , or  group . 
Review process creation logs for instances of ping.exe. 
Check if the command line contains  -n . 
Review process creation logs for instances of &cd&echo or cd /d . 
Check if the command line contains &cd&echo or cd /d . 
Review process creation logs for instances of wmic.exe. 
Check if the command line contains  /node. 
Review process creation logs for instances of whoami.exe, systeminfo.exe, quser.exe, ipconfig.exe, pathping.exe, tracert.exe, netstat.exe, schtasks.exe, vssadmin.exe, wevtutil.exe, or tasklist.exe. 
Check if the image ends with any of the specified strings or if the original file name matches any of the specified strings. 
Review process creation logs for instances of Test-NetConnection or dir \. 
Check if the command line contains  Test-NetConnection  or dir \.","Unknown","ParentImage IN (""*\\w3wp.exe"", ""*\\php-cgi.exe"", ""*\\nginx.exe"", ""*\\httpd.exe"", ""*\\caddy.exe"", ""*\\ws_tomcatservice.exe"") OR (ParentImage IN (""*\\java.exe"", ""*\\javaw.exe"") ParentImage IN (""*-tomcat-*"", ""*\\tomcat*"")) OR (ParentImage IN (""*\\java.exe"", ""*\\javaw.exe"") CommandLine IN (""*catalina.jar*"", ""*CATALINA_HOME*"")) (OriginalFileName IN (""net.exe"", ""net1.exe"") CommandLine IN (""* user *"", ""* use *"", ""* group *"")) OR (OriginalFileName=""ping.exe"" CommandLine=""* -n *"") OR CommandLine IN (""*&cd&echo*"", ""*cd /d *"") OR (OriginalFileName=""wmic.exe"" CommandLine=""* /node:*"") OR Image IN (""*\\whoami.exe"", ""*\\systeminfo.exe"", ""*\\quser.exe"", ""*\\ipconfig.exe"", ""*\\pathping.exe"", ""*\\tracert.exe"", ""*\\netstat.exe"", ""*\\schtasks.exe"", ""*\\vssadmin.exe"", ""*\\wevtutil.exe"", ""*\\tasklist.exe"") OR OriginalFileName IN (""whoami.exe"", ""sysinfo.exe"", ""quser.exe"", ""ipconfig.exe"", ""pathping.exe"", ""tracert.exe"", ""netstat.exe"", ""schtasks.exe"", ""VSSADMIN.EXE"", ""wevtutil.exe"", ""tasklist.exe"") OR CommandLine IN (""* Test-NetConnection *"", ""*dir \\*"")"
"Webshell Hacking Activity Patterns","Florian Roth (Nextron Systems)","Detects certain parent child patterns found in cases in which a web shell is used to perform certain credential dumping or exfiltration activities on a compromised system
","attack.persistence, attack.t1505.003, attack.t1018, attack.t1033, attack.t1087","process_creation","windows","Not classified","Review the context and purpose of the detected parent-child patterns to determine if they align with legitimate administrative activities or indicate malicious behavior. 
Check if the creation of new users or groups on the system was authorized and performed by an authorized user. 
Verify if the usage of command-line tools like ntdsutil.exe, ldifde.exe, adfind.exe, procdump.exe, Nanodump.exe, vssadmin.exe, and fsutil.exe was part of authorized system administration tasks. 
Validate if the detected web server processes (w3wp.exe, php-cgi.exe, nginx.exe, httpd.exe, caddy.exe, ws_tomcatservice.exe) were used for normal web server operations. 
Confirm if the Java processes (java.exe, javaw.exe) were running Tomcat web servers as expected. 
Investigate if the usage of rundll32.exe and comsvcs.exe was related to legitimate system operations. 
Determine if the usage of net.exe was for authorized network administration tasks. 
Check if the net user command was used legitimately to add new users. 
Verify if the net localgroup command was used legitimately to add users to the administrators group. 
Validate if the command-line options like -hp, -m, -NoP, -W Hidden, -decode, /decode, reg save, .downloadstring(, .downloadfile(, FromBase64String, /ticket, sekurlsa, .dmp full, process call create, and whoami /priv were used for authorized system administration tasks.","Legitimate administrative activity that involves the creation of new users or groups on the system. 
Legitimate usage of command-line tools like ntdsutil.exe, ldifde.exe, adfind.exe, procdump.exe, Nanodump.exe, vssadmin.exe, and fsutil.exe for authorized system administration tasks. 
Legitimate usage of web server processes like w3wp.exe, php-cgi.exe, nginx.exe, httpd.exe, caddy.exe, and ws_tomcatservice.exe for normal web server operations. 
Legitimate usage of Java processes like java.exe and javaw.exe for running Tomcat web servers. 
Legitimate usage of rundll32.exe and comsvcs.exe for system operations. 
Legitimate usage of net.exe for network administration tasks. 
Legitimate usage of the net user command to add new users. 
Legitimate usage of the net localgroup command to add users to the administrators group. 
Legitimate usage of command-line options like -hp, -m, -NoP, -W Hidden, -decode, /decode, reg save, .downloadstring(, .downloadfile(, FromBase64String, /ticket, sekurlsa, .dmp full, process call create, and whoami /priv for authorized system administration tasks.","ParentImage IN (""*\\w3wp.exe"", ""*\\php-cgi.exe"", ""*\\nginx.exe"", ""*\\httpd.exe"", ""*\\caddy.exe"", ""*\\ws_tomcatservice.exe"") OR (ParentImage IN (""*\\java.exe"", ""*\\javaw.exe"") ParentImage IN (""*-tomcat-*"", ""*\\tomcat*"")) OR (ParentImage IN (""*\\java.exe"", ""*\\javaw.exe"") CommandLine IN (""*catalina.jar*"", ""*CATALINA_HOME*"")) (CommandLine=""*rundll32*"" CommandLine=""*comsvcs*"") OR (CommandLine=""* -hp*"" CommandLine=""* a *"" CommandLine=""* -m*"") OR (CommandLine=""*net*"" CommandLine=""* user *"" CommandLine=""* /add*"") OR (CommandLine=""*net*"" CommandLine=""* localgroup *"" CommandLine=""* administrators *"" CommandLine=""*/add*"") OR Image IN (""*\\ntdsutil.exe"", ""*\\ldifde.exe"", ""*\\adfind.exe"", ""*\\procdump.exe"", ""*\\Nanodump.exe"", ""*\\vssadmin.exe"", ""*\\fsutil.exe"") OR CommandLine IN (""* -NoP *"", ""* -W Hidden *"", ""* -decode *"", ""* /decode *"", ""*reg save *"", ""*.downloadstring(*"", ""*.downloadfile(*"", ""*FromBase64String*"", ""* /ticket:*"", ""* sekurlsa*"", ""*.dmp full*"", ""*process call create*"", ""*whoami /priv*"")"
"Webshell Detection With Command Line Keywords","Florian Roth (Nextron Systems), Jonhnathan Ribeiro, Anton Kutepov, oscd.community","Detects certain command line parameters often used during reconnaissance activity via web shells","attack.persistence, attack.t1505.003, attack.t1018, attack.t1033, attack.t1087","process_creation","windows","Not classified","Not available","Not available"
"Webshell Recon Detection Via CommandLine & Processes","Cian Heasley, Florian Roth","Detects processes spawned from web servers (php, tomcat, iis...etc) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands","attack.persistence, attack.t1505.003","process_creation","windows","Not classified","Check the ParentImage field in the logs to identify the web server processes that spawned the suspicious process. 
Review the CommandLine field to identify the specific commands executed by the process. 
Analyze the ParentCommandLine field to understand the context in which the suspicious process was spawned. 
Cross-reference the detected commands with known legitimate usage by system administrators or developers. 
Consult with system administrators or developers to confirm the legitimacy of the observed activity. 
Investigate any additional indicators of compromise or suspicious behavior on the system. 
If necessary, escalate the investigation to incident response or the appropriate team for further analysis.","Legitimate processes spawned from web servers that perform legitimate reconnaissance activities. 
Legitimate usage of scripting tools like Perl, Python, and Wget by system administrators or developers. 
Legitimate help commands executed by authorized users.","ParentImage IN (""*\\w3wp.exe"", ""*\\php-cgi.exe"", ""*\\nginx.exe"", ""*\\httpd.exe"", ""*\\caddy.exe"", ""*\\ws_tomcatservice.exe"") OR (ParentImage IN (""*\\java.exe"", ""*\\javaw.exe"") ParentImage IN (""*-tomcat-*"", ""*\\tomcat*"")) OR (ParentImage IN (""*\\java.exe"", ""*\\javaw.exe"") CommandLine IN (""*catalina.jar*"", ""*CATALINA_HOME*"")) CommandLine IN (""*perl --help*"", ""*python --help*"", ""*python -h*"", ""*python3 --help*"", ""*python3 -h*"", ""*wget --help*"", ""*perl -h*"")"
"Shells Spawned by Web Servers","Thomas Patzke, Florian Roth (Nextron Systems), Zach Stanford @svch0st, Tim Shelton, Nasreddine Bencherchali (Nextron Systems)","Detects web servers that spawn shell processes which could be the result of a successfully placed web shell or another attack","attack.persistence, attack.t1505.003, attack.t1190","process_creation","windows","Not classified","Check the ParentImage field in the process creation logs to identify the web server processes that are spawning shell processes. Example log sources Windows Security Event Logs, Sysmon logs 
Look for any suspicious command line arguments or parameters in the CommandLine field of the process creation logs. Example log sources Windows Security Event Logs, Sysmon logs 
Analyze the ParentCommandLine field in the process creation logs to determine if any known false positives are present. Example log sources Windows Security Event Logs, Sysmon logs 
Cross-reference the detected shell processes with known legitimate web applications or administrative tasks to rule out false positives. Example log sources Web server logs, application logs, administrative logs","Particular web applications may spawn a shell process legitimately 
Legitimate administrative tasks may involve the execution of shell processes","ParentImage IN (""*\\w3wp.exe"", ""*\\php.exe"", ""*\\php-cgi.exe"", ""*\\nginx.exe"", ""*\\httpd.exe"", ""*\\caddy.exe"", ""*\\ws_TomcatService.exe"", ""*\\tomcat.exe"", ""*\\UMWorkerProcess.exe"") OR (ParentImage IN (""*\\java.exe"", ""*\\javaw.exe"") ParentImage IN (""*-tomcat-*"", ""*\\tomcat*"")) OR (ParentImage IN (""*\\java.exe"", ""*\\javaw.exe"") ParentCommandLine IN (""*catalina.jar*"", ""*CATALINA_HOME*"", ""*catalina.home*"")) Image IN (""*\\cmd.exe"", ""*\\cscript.exe"", ""*\\sh.exe"", ""*\\bash.exe"", ""*\\powershell.exe"", ""*\\powershell_ise.exe"", ""*\\pwsh.exe"", ""*\\bitsadmin.exe"", ""*\\arp.exe"", ""*\\at.exe"", ""*\\certutil.exe"", ""*\\dsget.exe"", ""*\\dsquery.exe"", ""*\\find.exe"", ""*\\findstr.exe"", ""*\\fsutil.exe"", ""*\\hostname.exe"", ""*\\ipconfig.exe"", ""*\\nbtstat.exe"", ""*\\net.exe"", ""*\\net1.exe"", ""*\\netdom.exe"", ""*\\netsh.exe"", ""*\\netstat.exe"", ""*\\nltest.exe"", ""*\\nslookup.exe"", ""*\\ntdutil.exe"", ""*\\pathping.exe"", ""*\\ping.exe"", ""*\\qprocess.exe"", ""*\\query.exe"", ""*\\qwinsta.exe"", ""*\\reg.exe"", ""*\\rundll32.exe"", ""*\\sc.exe"", ""*\\schtasks.exe"", ""*\\systeminfo.exe"", ""*\\tasklist.exe"", ""*\\tracert.exe"", ""*\\ver.exe"", ""*\\vssadmin.exe"", ""*\\wevtutil.exe"", ""*\\whoami.exe"", ""*\\wmic.exe"", ""*\\wscript.exe"", ""*\\wusa.exe"") NOT (CommandLine=""*Windows\\system32\\cmd.exe /c C:\\ManageEngine\\ADManager \""Plus\\ES\\bin\\elasticsearch.bat -Enode.name=RMP-NODE1 -pelasticsearch-pid.txt"" OR (CommandLine=""*sc query*"" CommandLine=""*ADManager Plus*""))"
"Suspicious Process By Web Server Process","Thomas Patzke, Florian Roth (Nextron Systems), Zach Stanford @svch0st, Tim Shelton, Nasreddine Bencherchali (Nextron Systems)","Detects potentially suspicious processes being spawned by a web server process which could be the result of a successfully placed web shell or exploitation
","attack.persistence, attack.t1505.003, attack.t1190","process_creation","windows","Not classified","Not available","Not available"
"Webshell Tool Reconnaissance Activity","Cian Heasley, Florian Roth (Nextron Systems)","Detects processes spawned from web servers (PHP, Tomcat, IIS, etc.) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands
","attack.persistence, attack.t1505.003","process_creation","windows","Not classified","Not available","Not available"
"Potential Credential Dumping Via WER","@pbssubhash , Nasreddine Bencherchali","Detects potential credential dumping via Windows Error Reporting LSASS Shtinkering technique which uses the Windows Error Reporting to dump lsass","attack.credential_access, attack.t1003.001","process_creation","windows","Not classified","Check for the presence of the WerFault.exe process in the process creation logs. 
Inspect the ParentUser and User fields in the process creation logs for any occurrences of AUTHORI or AUTORI. 
Analyze the CommandLine field in the process creation logs for the presence of -u -p, -ip, and -s parameters. 
Verify if the ParentImage field in the process creation logs matches C\Windows\System32\lsass.exe. 
If the above conditions are met, further investigation is required to determine if credential dumping via WER is occurring.","Windows Error Reporting might produce similar behavior. In that case, check the PID associated with the ""-p"" parameter in the CommandLine.","Image=""*\\Werfault.exe"" OR OriginalFileName=""WerFault.exe"" ParentUser IN (""*AUTHORI*"", ""*AUTORI*"") User IN (""*AUTHORI*"", ""*AUTORI*"") CommandLine=""* -u -p *"" CommandLine=""* -ip *"" CommandLine=""* -s *"" NOT ParentImage=""C:\\Windows\\System32\\lsass.exe"""
"Suspicious Processes Spawned by WinRM","Andreas Hunkeler (@Karneades), Markus Neis","Detects suspicious processes including shells spawnd from WinRM host process","attack.t1190, attack.initial_access, attack.persistence, attack.privilege_escalation","process_creation","windows","Not classified","Check the ParentImage field in the process creation logs to identify the parent process of the suspicious process. 
Review the Image field in the process creation logs to determine the specific suspicious process that was spawned. 
Correlate the process creation logs with other security events, such as network traffic logs or authentication logs, to gather additional context. 
Analyze the command-line arguments of the suspicious process to understand its behavior and potential impact. 
Consult with system administrators or other relevant teams to validate if the detected activity is expected and authorized. 
If necessary, perform memory or disk forensics on the affected system to gather more evidence and understand the extent of the compromise.","Legitimate WinRM usage","ParentImage=""*\\wsmprovhost.exe"" Image IN (""*\\cmd.exe"", ""*\\sh.exe"", ""*\\bash.exe"", ""*\\powershell.exe"", ""*\\pwsh.exe"", ""*\\wsl.exe"", ""*\\schtasks.exe"", ""*\\certutil.exe"", ""*\\whoami.exe"", ""*\\bitsadmin.exe"")"
"New ActiveScriptEventConsumer Created Via Wmic.EXE","Florian Roth (Nextron Systems)","Detects WMIC executions in which an event consumer gets created. This could be used to establish persistence","attack.persistence, attack.t1546.003","process_creation","windows","Not classified","Review process creation logs for WMIC executions with ActiveScriptEventConsumer and CREATE in the command line.","Legitimate software creating script event consumers","CommandLine=""*ActiveScriptEventConsumer*"" CommandLine=""* CREATE *"""
"Suspicious Process Created Via Wmic.EXE","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects WMIC executing ""process call create"" with suspicious calls to processes such as ""rundll32"", ""regsrv32"", etc.","attack.execution, attack.t1047","process_creation","windows","Not classified","Check the parent process of the suspicious WMIC execution to determine if it is initiated by a legitimate process or script 
Review the command line arguments of the WMIC execution to identify any suspicious or unauthorized activity 
Correlate the WMIC execution with other security events, such as network connections or file modifications, to determine if it is part of a larger attack 
Analyze the process tree to identify any abnormal behavior or suspicious process chains 
Monitor for any subsequent malicious activity or indicators of compromise (IOCs) associated with the suspicious processes","Legitimate use of WMIC to create processes 
Authorized scripts or tools that use the listed suspicious processes 
Administrative tasks that involve the listed suspicious processes","CommandLine=""*process *"" CommandLine=""*call *"" CommandLine=""*create *"" CommandLine IN (""*rundll32*"", ""*bitsadmin*"", ""*regsvr32*"", ""*cmd.exe /c *"", ""*cmd.exe /k *"", ""*cmd.exe /r *"", ""*cmd /c *"", ""*cmd /k *"", ""*cmd /r *"", ""*powershell*"", ""*pwsh*"", ""*certutil*"", ""*cscript*"", ""*wscript*"", ""*mshta*"", ""*\\Users\\Public\\*"", ""*\\Windows\\Temp\\*"", ""*\\AppData\\Local\\*"", ""*%temp%*"", ""*%tmp%*"", ""*%ProgramData%*"", ""*%appdata%*"", ""*%comspec%*"", ""*%localappdata%*"")"
"Potential Tampering With Security Products Via WMIC","Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)","Detects uninstallation or termination of security products using the WMIC utility","attack.defense_evasion, attack.t1562.001","process_creation","windows","Not classified","Check the process creation logs for any instances of the wmic command being used with the product where call uninstall /nointeractive parameters. 
Look for any wmic commands with caption like parameters followed by call delete or call terminate. 
Investigate any process creation logs that contain process where delete in the command line. 
Review the command line of processes for any mentions of security product names or keywords related to security products. 
Cross-reference the detected security product names or keywords with the list of known security products to identify potential tampering attempts.","Legitimate administration","(CommandLine=""*wmic*"" CommandLine=""*product where *"" CommandLine=""*call*"" CommandLine=""*uninstall*"" CommandLine=""*/nointeractive*"") OR (CommandLine=""*wmic*"" CommandLine=""*caption like *"" CommandLine IN (""*call delete*"", ""*call terminate*"")) OR (CommandLine=""*process *"" CommandLine=""*where *"" CommandLine=""*delete*"") CommandLine IN (""*%carbon%*"", ""*%cylance%*"", ""*%endpoint%*"", ""*%eset%*"", ""*%malware%*"", ""*%Sophos%*"", ""*%symantec%*"", ""*Antivirus*"", ""*AVG *"", ""*Carbon Black*"", ""*CarbonBlack*"", ""*Cb Defense Sensor 64-bit*"", ""*Crowdstrike Sensor*"", ""*Cylance *"", ""*Dell Threat Defense*"", ""*DLP Endpoint*"", ""*Endpoint Detection*"", ""*Endpoint Protection*"", ""*Endpoint Security*"", ""*Endpoint Sensor*"", ""*ESET File Security*"", ""*LogRhythm System Monitor Service*"", ""*Malwarebytes*"", ""*McAfee Agent*"", ""*Microsoft Security Client*"", ""*Sophos Anti-Virus*"", ""*Sophos AutoUpdate*"", ""*Sophos Credential Store*"", ""*Sophos Management Console*"", ""*Sophos Management Database*"", ""*Sophos Management Server*"", ""*Sophos Remote Management System*"", ""*Sophos Update Manager*"", ""*Threat Protection*"", ""*VirusScan*"", ""*Webroot SecureAnywhere*"", ""*Windows Defender*"")"
"Suspicious WmiPrvSE Child Process","Vadim Khrykov (ThreatIntel), Cyb3rEng, Florian Roth (Nextron Systems)","Detects suspicious and uncommon child processes of WmiPrvSE","attack.execution, attack.defense_evasion, attack.t1047, attack.t1204.002, attack.t1218.010","process_creation","windows","Not classified","Review the command line arguments of the suspicious child processes to determine if they are being used in a malicious manner. 
Check the parent process of the suspicious child processes to identify any unusual behavior or signs of compromise. 
Analyze the network traffic associated with the suspicious child processes to identify any communication with known malicious IP addresses or domains. 
Inspect the file system and registry for any artifacts or indicators of compromise related to the suspicious child processes. 
Correlate the activity of the suspicious child processes with other security events or alerts to identify any patterns or indicators of a larger attack.","Legitimate use of WmiPrvSE child processes","ParentImage=""*\\wbem\\WmiPrvSE.exe"" Image IN (""*\\certutil.exe"", ""*\\cscript.exe"", ""*\\mshta.exe"", ""*\\msiexec.exe"", ""*\\regsvr32.exe"", ""*\\rundll32.exe"", ""*\\verclsid.exe"", ""*\\wscript.exe"") OR (Image=""*\\cmd.exe"" CommandLine IN (""*cscript*"", ""*mshta*"", ""*powershell*"", ""*pwsh*"", ""*regsvr32*"", ""*rundll32*"", ""*wscript*"")) NOT (Image IN (""*\\WerFault.exe"", ""*\\WmiPrvSE.exe""))"
"WMI Backdoor Exchange Transport Agent","Florian Roth (Nextron Systems)","Detects a WMI backdoor in Exchange Transport Agents via WMI event filters","attack.persistence, attack.t1546.003","process_creation","windows","Not classified","Check for any suspicious WMI event filters associated with Exchange Transport Agents. 
Review process creation logs for instances of EdgeTransport.exe launching conhost.exe and OleConverter.exe. 
Monitor for any abnormal behavior or network connections originating from Exchange Transport Agents.","Unknown","ParentImage=""*\\EdgeTransport.exe"" NOT (Image=""C:\\Windows\\System32\\conhost.exe"" OR (Image=""C:\\Program Files\\Microsoft\\Exchange Server\\*"" Image=""*\\Bin\\OleConverter.exe""))"
"UEFI Persistence Via Wpbbin - ProcessCreation","Nasreddine Bencherchali (Nextron Systems)","Detects execution of the binary ""wpbbin"" which is used as part of the UEFI based persistence method described in the reference section","attack.persistence, attack.defense_evasion, attack.t1542.001","process_creation","windows","Not classified","Check the process creation logs for the execution of the binary ""wpbbin.exe"" in the specified path (C\Windows\System32\wpbbin.exe). 
Look for any associated suspicious or malicious behavior, such as modifications to system files or registry entries, network connections to suspicious IP addresses, or unusual process behavior. 
Correlate the detection with other security events or indicators of compromise (IOCs) to determine if it is part of a larger attack campaign or persistence method. 
If possible, analyze the binary itself for any indicators of malicious activity or known signatures. 
Consult with hardware manufacturers, such as Lenovo, to confirm if the execution of ""wpbbin.exe"" is a legitimate usage by their products.","Legitimate usage of the file by hardware manufacturers such as Lenovo","Image=""C:\\Windows\\System32\\wpbbin.exe"""
"Proxy Execution Via Wuauclt.EXE","Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), Florian Roth (Nextron Systems), Sreeman, FPT.EagleEye Team","Detects the use of the Windows Update Client binary (wuauclt.exe) for proxy execution.","attack.defense_evasion, attack.t1218, attack.execution","process_creation","windows","Not classified","Not available","Not available"
"Windows Update Client LOLBIN","FPT.EagleEye Team","Detects code execution via the Windows Update client (wuauclt)","attack.command_and_control, attack.execution, attack.t1105, attack.t1218","process_creation","windows","Not classified","Check the parent process of wuauclt.exe to determine if it is launched from a suspicious or unexpected source 
Review the command line arguments of wuauclt.exe to identify any unusual or malicious parameters 
Analyze the network connections made by wuauclt.exe to determine if it is communicating with suspicious or malicious IP addresses or domains 
Monitor the file system activity of wuauclt.exe to identify any suspicious or unexpected file modifications or creations 
Cross-reference the execution of wuauclt.exe with other security events or indicators of compromise to identify any correlation or patterns","Legitimate use of the Windows Update client (wuauclt) for updating the system 
Legitimate use of the Windows Update client (wuauclt) by system administrators for managing updates 
Legitimate use of the Windows Update client (wuauclt) by software installers or updaters","Image=""*\\wuauclt.exe"" OR OriginalFileName=""wuauclt.exe"" CommandLine=""*/UpdateDeploymentProvider*"" CommandLine=""*/RunHandlerComServer*"" CommandLine=""*.dll*"" NOT (CommandLine IN (""* /ClassId *"", ""* wuaueng.dll *""))"
"Suspicious Windows Update Agent Empty Cmdline","Florian Roth (Nextron Systems)","Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn't contain any command line flags
","attack.defense_evasion, attack.t1036","process_creation","windows","Not classified","To investigate this detection, you can perform the following steps 
Review the process creation logs from the Windows Event Log or a SIEM solution. 
Look for instances of wuauclt.exe process creation events. 
Check the command line associated with each wuauclt.exe process. 
If the command line does not contain any command line flags, it may indicate suspicious activity. 
Compare the process creation events with known legitimate Windows Update Agent activity to identify anomalies. 
Consider correlating this detection with other relevant events or indicators of compromise (IOCs) to determine the severity and potential impact of the activity.","Legitimate Windows Update Agent activity may sometimes have an empty command line due to specific circumstances.","Image=""*\\Wuauclt.exe"" OR OriginalFileName=""Wuauclt.exe"" CommandLine=""*\\Wuauclt.exe"""
"Wusa Extracting Cab Files From Suspicious Paths","Nasreddine Bencherchali (Nextron Systems)","Detects usage of the ""wusa.exe"" (Windows Update Standalone Installer) utility to extract cab using the ""/extract"" argument from suspicious paths","attack.execution","process_creation","windows","Not classified","Check the parent process of wusa.exe to determine if it is launched from a suspicious location or by an unknown process. 
Review the command line arguments of wusa.exe to identify any suspicious or unexpected values. 
Analyze the file paths specified in the command line to determine if they are commonly used by legitimate processes or if they are associated with suspicious activity. 
Correlate the wusa.exe activity with other security events or indicators of compromise to identify any related malicious activity. 
Review the system logs, such as event logs or process monitoring logs, to identify any additional suspicious or malicious activity associated with the wusa.exe process.","Legitimate usage of wusa.exe for extracting cab files during Windows Update process","Image=""*\\wusa.exe"" CommandLine=""*/extract:*"" CommandLine IN (""*C:\\Users\\Public\\*"", ""*\\Desktop\\*"", ""*\\Downloads\\*"", ""*\\Appdata\\Local\\Temp\\*"", ""*\\Windows\\Temp\\*"", ""*\\PerfLogs\\*"")"
"Sysmon Configuration Error","frack113","Detects when an adversary is trying to hide it's action from Sysmon logging based on error messages","attack.defense_evasion, attack.t1564","sysmon_error","windows","Not classified","Check if any legitimate administrative actions were performed during the time of the detection 
Review the logs from the Windows Event Log (Event ID 7045) to see if any services were modified or accessed 
Analyze the Sysmon logs for any other suspicious activities or indicators of compromise","Legitimate administrative action","Description IN (""*Failed to open service configuration with error*"", ""*Failed to connect to the driver to update configuration*"") NOT ((Description=""*Failed to open service configuration with error*"" Description=""*Last error: The media is write protected.*"") OR Description IN (""*Failed to open service configuration with error 19*"", ""*Failed to open service configuration with error 93*""))"
"Sysmon Configuration Modification","frack113","Detects when an attacker tries to hide from Sysmon by disabling or stopping it","attack.defense_evasion, attack.t1564","sysmon_status","windows","Not classified","Check for any legitimate administrative actions that may have caused the Sysmon configuration state change. 
Review the logs from the Windows Event Log, specifically the Microsoft-Windows-Sysmon/Operational log, for any relevant events. 
Look for any suspicious processes or commands executed around the time of the Sysmon configuration state change. 
Cross-reference the Sysmon configuration change with other security events or alerts to identify any potential correlation or patterns.","Legitimate administrative action","State=""Stopped"" OR ""Sysmon config state changed"" NOT State=""Started"""
"Suspicious Encoded Scripts in a WMI Consumer","Florian Roth (Nextron Systems)","Detects suspicious encoded payloads in WMI Event Consumers","attack.execution, attack.t1047, attack.persistence, attack.t1546.003","wmi_event","windows","Not classified","Review WMI Event Consumer logs for the presence of suspicious encoded payloads. 
Check the User and Operation fields in the WMI Event Consumer logs for any unusual or unauthorized activity. 
Cross-reference the detected payloads with known legitimate use cases of encoded scripts in WMI Event Consumers. 
Investigate any anomalies or deviations from normal behavior in the WMI Event Consumer logs. 
If necessary, analyze the encoded payloads using appropriate tools or techniques to determine their purpose and potential threat.","Legitimate use of encoded scripts in WMI Event Consumers"
